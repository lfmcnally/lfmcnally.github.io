<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Topic 1 Retrieval Practice - Politics of the Late Republic</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #0066ff 0%, #4d94ff 25%, #e6f0ff 60%, #ffffff 100%);
            background-attachment: fixed;
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* Background Shapes - Matching Classicalia style */
        .bg-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1;
            pointer-events: none;
        }

        .shape {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(100px);
        }

        .shape1 {
            width: 400px;
            height: 400px;
            top: -200px;
            right: -100px;
        }

        .shape2 {
            width: 300px;
            height: 300px;
            bottom: -150px;
            left: -100px;
        }

        .shape3 {
            width: 200px;
            height: 200px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Header */
        header {
            position: relative;
            z-index: 10;
            padding: 3rem 2rem 2rem;
            text-align: center;
        }

        .logo {
            font-size: 4rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ffffff 0%, #e6f0ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -3px;
            margin-bottom: 0.5rem;
            text-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .logo a {
            text-decoration: none;
            background: linear-gradient(135deg, #ffffff 0%, #e6f0ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 1.25rem;
            color: rgba(255, 255, 255, 0.95);
            font-weight: 300;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
        }

        .author {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 300;
        }

        /* Info Button */
        .info-btn {
            position: fixed;
            top: 2rem;
            right: 2rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.95);
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .info-btn:hover {
            transform: scale(1.1);
            background: white;
            box-shadow: 0 6px 20px rgba(0, 102, 255, 0.2);
        }

        /* Dashboard Container */
        .dashboard-container {
            max-width: 1500px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 5;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            align-items: start;
        }

        /* Left Sidebar */
        .left-sidebar {
            padding-top: 1rem;
        }

        .nav-section {
            margin-bottom: 1.5rem;
        }

        .nav-title {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .nav-link-sidebar {
            display: block;
            padding: 0.5rem 0;
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            border-left: 2px solid transparent;
            padding-left: 0.5rem;
            margin-left: -0.5rem;
        }

        .nav-link-sidebar:hover {
            color: white;
            border-left-color: white;
        }

        .nav-link-sidebar.current {
            color: white;
            border-left-color: white;
            font-weight: 600;
        }

        /* Main Content Area */
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            border-radius: 24px;
            padding: 2.5rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        .content-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .topic-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 1rem;
        }

        .section-intro {
            background: rgba(0, 102, 255, 0.05);
            border: 1px solid rgba(0, 102, 255, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: left;
        }

        .section-intro h3 {
            color: #0066ff;
            margin-bottom: 1rem;
            font-weight: 600;
            font-size: 1.2rem;
        }

        .section-intro p {
            color: #666;
            line-height: 1.6;
        }

        .content-body {
            /* No extra padding needed */
        }

        /* Right Sidebar */
        .right-sidebar {
            padding-top: 1rem;
        }

        .sidebar-widget {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.6);
        }

        .widget-title {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1rem;
        }

        .widget-content {
            color: #666;
            font-size: 0.9rem;
        }

        /* Quiz Mode Selection */
        .quiz-mode-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .mode-option {
            background: white;
            border: 2px solid rgba(0, 0, 0, 0.06);
            border-radius: 16px;
            padding: 1.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .mode-option:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(0, 102, 255, 0.15);
            border-color: #0066ff;
        }

        .mode-option.selected {
            border-color: #0066ff;
            background: linear-gradient(135deg, rgba(0, 102, 255, 0.02) 0%, rgba(77, 148, 255, 0.05) 100%);
        }

        .mode-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 0.5rem;
        }

        .mode-description {
            color: #666;
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 1.25rem;
        }

        .mode-stats {
            display: flex;
            justify-content: center;
            gap: 1rem;
            font-size: 0.8rem;
            color: #0066ff;
            font-weight: 600;
        }

        .start-quiz-btn {
            display: block;
            width: 200px;
            margin: 2rem auto 0;
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #0066ff, #4d94ff);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
        }

        .start-quiz-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 102, 255, 0.3);
        }

        .start-quiz-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Question Screen */
        .question-screen {
            display: none;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(0, 102, 255, 0.1);
        }

        .question-number {
            background: #0066ff;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.2rem;
        }

        .question-info {
            flex: 1;
            margin-left: 1.5rem;
        }

        .question-type {
            font-size: 0.9rem;
            color: #0066ff;
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .question-topic {
            font-size: 1rem;
            color: #666;
            margin-bottom: 0.25rem;
        }

        .question-difficulty {
            font-size: 0.8rem;
            background: rgba(0, 102, 255, 0.1);
            color: #0066ff;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            display: inline-block;
        }

        .progress-info {
            text-align: right;
            color: #666;
            font-size: 0.9rem;
        }

        .question-content {
            margin-bottom: 2rem;
        }

        .question-text {
            font-size: 1.2rem;
            color: #333;
            margin-bottom: 1.5rem;
            font-weight: 500;
            line-height: 1.5;
        }

        .question-context {
            background: #f8f9fa;
            border-left: 4px solid #0066ff;
            padding: 1rem;
            margin-bottom: 1.5rem;
            font-style: italic;
            color: #666;
            border-radius: 0 8px 8px 0;
        }

        /* Answer Input Styles */
        .answer-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .answer-input:focus {
            outline: none;
            border-color: #0066ff;
        }

        .multiple-choice {
            display: grid;
            gap: 0.75rem;
        }

        .choice-option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }

        .choice-option:hover {
            border-color: #0066ff;
            background: rgba(0, 102, 255, 0.05);
        }

        .choice-option.selected {
            border-color: #0066ff;
            background: rgba(0, 102, 255, 0.05);
        }

        .choice-letter {
            background: #0066ff;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        /* Drag and Drop */
        .drag-drop-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            border: 2px solid #e9ecef;
        }

        .drag-instruction {
            text-align: center;
            color: #666;
            margin-bottom: 1rem;
            font-weight: 500;
        }

        .drag-items {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            justify-content: center;
        }

        .drag-item {
            background: #0066ff;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: move;
            user-select: none;
            font-weight: 500;
            transition: transform 0.2s ease;
            border: 2px solid #0066ff;
        }

        .drag-item:hover {
            transform: scale(1.05);
        }

        .drag-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .drop-zones {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .drop-zone {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 1rem;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            background: white;
        }

        .drop-zone.drag-over {
            border-color: #0066ff;
            background: rgba(0, 102, 255, 0.05);
        }

        .drop-zone-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #333;
            text-align: center;
        }

        .dropped-items {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
            min-height: 40px;
        }

        /* Feedback */
        .feedback {
            margin-top: 1.5rem;
            padding: 1rem;
            border-radius: 8px;
            display: none;
            border-left: 4px solid;
        }

        .feedback.correct {
            background: #d4edda;
            border-left-color: #28a745;
            color: #155724;
        }

        .feedback.incorrect {
            background: #f8d7da;
            border-left-color: #dc3545;
            color: #721c24;
        }

        .feedback.partial {
            background: #fff3cd;
            border-left-color: #ffc107;
            color: #856404;
        }

        .feedback-header {
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .feedback-icon {
            font-size: 1.2rem;
        }

        .feedback-explanation {
            font-size: 0.95rem;
            line-height: 1.5;
        }

        /* Question Controls */
        .question-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e9ecef;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .btn-primary {
            background: #0066ff;
            color: white;
        }

        .btn-primary:hover {
            background: #0052cc;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .progress-text {
            color: #666;
            font-size: 0.9rem;
        }

        /* Results Screen */
        .results-screen {
            display: none;
            text-align: center;
        }

        .results-score {
            font-size: 4rem;
            font-weight: 700;
            color: #0066ff;
            margin-bottom: 1rem;
        }

        .results-message {
            font-size: 1.2rem;
            color: #333;
            margin-bottom: 2rem;
        }

        .results-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .breakdown-item {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .breakdown-number {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .breakdown-label {
            color: #666;
            font-size: 0.9rem;
        }

        .topic-performance {
            margin-top: 2rem;
            text-align: left;
        }

        .performance-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border-bottom: 1px solid #e9ecef;
        }

        .performance-score {
            font-weight: 600;
        }

        /* Mobile responsiveness */
        @media (max-width: 1024px) {
            .quiz-mode-selector {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .dashboard-container {
                padding: 1rem;
            }
            
            .main-content {
                padding: 1.5rem;
            }
            
            .logo {
                font-size: 3rem;
            }

            .quiz-mode-selector {
                grid-template-columns: 1fr;
            }

            .topic-title {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Background Shapes -->
    <div class="bg-shapes">
        <div class="shape shape1"></div>
        <div class="shape shape2"></div>
        <div class="shape shape3"></div>
    </div>

    <!-- Info Button -->
    <button class="info-btn" onclick="showInfoModal()">‚ÑπÔ∏è</button>

    <!-- Header -->
    <header>
        <h1 class="logo">
            <a href="../index.html">Classicalia</a>
        </h1>
        <div class="subtitle">Politics of the Late Republic - Topic 1 Practice</div>
        <div class="author">by Lawrence McNally</div>
    </header>

    <!-- Dashboard -->
    <div class="dashboard-container">
        <div class="dashboard-grid">
            <!-- Main Content -->
            <main class="main-content">
                <div class="content-header">
                    <h1 class="topic-title">Topic 1 Retrieval Practice</h1>
                    <div class="section-intro">
                        <h3>Test Your Knowledge</h3>
                        <p>Comprehensive practice covering all five sections of Topic 1. Questions are drawn from your lesson content and designed to prepare you for assessments. Each session randomises questions for repeated practice.</p>
                    </div>
                </div>

                <div class="content-body">
                    <!-- Mode Selection Screen -->
                    <div id="mode-selection-screen">
                        <div class="quiz-mode-selector">
                            <div class="mode-option" onclick="selectMode('comprehensive')" data-mode="comprehensive">
                                <div class="mode-title">Comprehensive Review</div>
                                <div class="mode-description">30 questions covering all lesson content from Topics 1.1-1.5. Includes complex scenarios and detailed knowledge checks.</div>
                                <div class="mode-stats">
                                    <span>üìö All 5 Topics</span>
                                    <span>‚è±Ô∏è 20-25 mins</span>
                                    <span>üéØ Assessment Prep</span>
                                </div>
                            </div>
                            
                            <div class="mode-option" onclick="selectMode('quick')" data-mode="quick">
                                <div class="mode-title">Quick Check</div>
                                <div class="mode-description">15 key questions for rapid review. Perfect for consolidating main concepts before lessons or exams.</div>
                                <div class="mode-stats">
                                    <span>‚ö° Key Concepts</span>
                                    <span>‚è±Ô∏è 10-12 mins</span>
                                    <span>üîÑ Quick Review</span>
                                </div>
                            </div>
                            
                            <div class="mode-option" onclick="selectMode('detailed')" data-mode="detailed">
                                <div class="mode-title">Detailed Knowledge</div>
                                <div class="mode-description">20 questions focusing on specific details from lesson content - perfect for thorough understanding.</div>
                                <div class="mode-stats">
                                    <span>üîç Deep Dive</span>
                                    <span>‚è±Ô∏è 15-18 mins</span>
                                    <span>üìñ Lesson Content</span>
                                </div>
                            </div>
                        </div>
                        
                        <button class="start-quiz-btn" id="start-quiz-btn" onclick="startQuiz()" disabled>
                            Start Practice Session
                        </button>
                    </div>

                    <!-- Question Screen -->
                    <div class="question-screen" id="question-screen">
                        <div class="question-header">
                            <div class="question-number" id="question-number">1</div>
                            <div class="question-info">
                                <div class="question-type" id="question-type">Multiple Choice</div>
                                <div class="question-topic" id="question-topic">Topic 1.1: What was the Roman Republic?</div>
                                <div class="question-difficulty" id="question-difficulty">Assessment Level</div>
                            </div>
                            <div class="progress-info">
                                <div class="progress-text" id="progress-text">Question 1 of 30</div>
                            </div>
                        </div>

                        <div class="question-content">
                            <div class="question-text" id="question-text">
                                Loading question...
                            </div>
                            
                            <div class="question-context" id="question-context" style="display: none;">
                                <!-- Context information when needed -->
                            </div>
                            
                            <div id="answer-area">
                                <!-- Dynamic content based on question type -->
                            </div>
                            
                            <div class="feedback" id="feedback">
                                <div class="feedback-header">
                                    <span class="feedback-icon" id="feedback-icon">‚úì</span>
                                    <span id="feedback-title">Correct!</span>
                                </div>
                                <div class="feedback-explanation" id="feedback-explanation"></div>
                            </div>
                        </div>

                        <div class="question-controls">
                            <button class="btn btn-secondary" id="prev-btn" onclick="previousQuestion()">Previous</button>
                            <div class="progress-text" id="progress-indicator">Question 1 of 30</div>
                            <button class="btn btn-primary" id="check-btn" onclick="checkAnswer()">Check Answer</button>
                            <button class="btn btn-primary" id="next-btn" onclick="nextQuestion()" style="display: none;">Next Question</button>
                        </div>
                    </div>

                    <!-- Results Screen -->
                    <div class="results-screen" id="results-screen">
                        <div class="results-score" id="final-score">85%</div>
                        <div class="results-message" id="results-message">Excellent work! You're well-prepared for assessments.</div>
                        
                        <div class="results-breakdown">
                            <div class="breakdown-item">
                                <div class="breakdown-number" id="correct-count">26</div>
                                <div class="breakdown-label">Correct</div>
                            </div>
                            <div class="breakdown-item">
                                <div class="breakdown-number" id="partial-count">2</div>
                                <div class="breakdown-label">Partially Correct</div>
                            </div>
                            <div class="breakdown-item">
                                <div class="breakdown-number" id="incorrect-count">2</div>
                                <div class="breakdown-label">Incorrect</div>
                            </div>
                            <div class="breakdown-item">
                                <div class="breakdown-number" id="completion-time">18</div>
                                <div class="breakdown-label">Minutes</div>
                            </div>
                        </div>
                        
                        <div class="topic-performance" id="topic-performance">
                            <h3>Performance by Topic:</h3>
                            <!-- Will be populated by JavaScript -->
                        </div>
                        
                        <button class="start-quiz-btn" onclick="restartQuiz()">Practice Again</button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // Info modal function
        function showInfoModal() {
            alert('Welcome to Topic 1 Retrieval Practice!\n\nThis quiz covers all the content from your Politics lessons (Topics 1.1-1.5). Questions are designed to match your assessment style with flexible marking for spelling variations.\n\nCreated by Lawrence McNally - Teacher of Latin and Classics in Bristol');
        }
        // Comprehensive Question Bank - Drawing from actual lesson content
        const questionBank = {
            'comprehensive': [
                // Topic 1.1 - What was the Roman Republic?
                {
                    type: 'text-flexible',
                    topic: 'Topic 1.1',
                    difficulty: 'Assessment Level',
                    question: 'The Romans claimed divine ancestry through two legendary figures - Aeneas and Romulus. Name the god who was the parent of Aeneas.',
                    correctAnswers: ['venus'],
                    acceptableVariations: ['venus', 'aphrodite'],
                    explanation: 'Venus (Aphrodite in Greek mythology) was the mother of Aeneas, making the Romans descendants of the goddess of love and establishing their divine legitimacy.'
                },
                {
                    type: 'multiple-choice',
                    topic: 'Topic 1.1',
                    difficulty: 'Assessment Level',
                    question: 'What does SPQR stand for?',
                    choices: [
                        'Senatus Populusque Romanus (The Senate and the Roman People)',
                        'Senatus Popularis Romanus (The Senate Popular Roman)',
                        'Spiritus Populus Romanus (Spirit of the Roman People)',
                        'Senatus Publicus Romanus (The Public Roman Senate)'
                    ],
                    correct: 0,
                    explanation: 'SPQR stands for "Senatus Populusque Romanus" meaning "The Senate and the Roman People", representing the two key elements of Republican government and appearing on standards, coins, and buildings throughout the Roman world.'
                },
                {
                    type: 'text-flexible',
                    topic: 'Topic 1.1',
                    difficulty: 'Lesson Detail',
                    question: 'What event sparked the revolution that ended the Roman monarchy?',
                    correctAnswers: ['rape of lucretia'],
                    acceptableVariations: ['rape of lucretia', 'lucretia', 'sextus tarquinius raped lucretia', 'lucretia rape', 'lucretia suicide'],
                    explanation: 'The rape of Lucretia by Sextus Tarquinius and her subsequent suicide became the catalyst for revolution. Her story embodied the violation of Roman virtue by tyrannical power and justified the overthrow of the monarchy.'
                },
                {
                    type: 'multiple-choice',
                    topic: 'Topic 1.1',
                    difficulty: 'Lesson Detail',
                    question: 'According to Roman foundation myths, what quality did the Romans inherit from their divine ancestry?',
                    choices: [
                        'Wisdom from Minerva and courage from Mars',
                        'Love from Venus and war-like nature from Mars',
                        'Justice from Jupiter and beauty from Venus',
                        'Strategy from Minerva and wealth from Plutus'
                    ],
                    correct: 1,
                    explanation: 'Roman foundation myths emphasised their inheritance of both love/passion from Venus (through Aeneas) and military prowess from Mars (through Romulus), creating a people destined for both civilization and conquest.'
                },

                // Topic 1.2 - The Constitution
                {
                    type: 'drag-drop',
                    topic: 'Topic 1.2',
                    difficulty: 'Assessment Level',
                    question: 'Match each office in the cursus honorum with its main duties:',
                    items: ['Censor', 'Consul', 'Praetor', 'Aedile', 'Quaestor'],
                    categories: {
                        'Census and moral oversight': ['Censor'],
                        'Chief executive and military command': ['Consul'],
                        'Legal administration and courts': ['Praetor'],
                        'Public works and games': ['Aedile'],
                        'Financial administration': ['Quaestor']
                    },
                    explanation: 'Each office in the cursus honorum had specific responsibilities that built experience for higher positions, creating a systematic career progression for the Roman elite.'
                },
                {
                    type: 'multiple-choice',
                    topic: 'Topic 1.2',
                    difficulty: 'Assessment Level',
                    question: 'Which of these was NOT a unique power of the tribune of the plebs?',
                    choices: [
                        'Intercessio (veto power over magistrates)',
                        'Sacrosanctitas (physical inviolability)',
                        'Imperium (military command authority)',
                        'Auxilium (personal protection for citizens)'
                    ],
                    correct: 2,
                    explanation: 'Tribunes did not have imperium (military command authority). Their power was civil and protective: intercessio (veto), sacrosanctitas (physical protection), and auxilium (assistance to citizens).'
                },
                {
                    type: 'text-flexible',
                    topic: 'Topic 1.2',
                    difficulty: 'Lesson Detail',
                    question: 'What were lictors and what did they carry?',
                    correctAnswers: ['attendants fasces', 'officials fasces'],
                    acceptableVariations: ['lictors carried fasces', 'attendants carried fasces', 'officials with fasces', 'bodyguards fasces'],
                    explanation: 'Lictors were official attendants who accompanied magistrates with imperium, carrying fasces (bundles of rods with axes) as symbols of the magistrate\'s authority to punish and execute.'
                },
                {
                    type: 'multiple-choice',
                    topic: 'Topic 1.2',
                    difficulty: 'Lesson Detail',
                    question: 'Why were the axes removed from fasces within the city of Rome?',
                    choices: [
                        'To prevent accidents in crowded streets',
                        'To respect citizens\' right of appeal (provocatio)',
                        'To show respect for the gods',
                        'To save money on expensive ceremonial axes'
                    ],
                    correct: 1,
                    explanation: 'Within Rome, axes were removed from fasces to respect citizens\' right of appeal (provocatio) - magistrates could not execute citizens without trial. Outside Rome, full fasces with axes showed unlimited power over non-citizens.'
                },
                {
                    type: 'scenario',
                    topic: 'Topic 1.2',
                    difficulty: 'Lesson Detail',
                    question: 'A consul wants to execute a citizen who has committed treason within the city of Rome. According to Republican law, what must happen first?',
                    choices: [
                        'The citizen can appeal to the popular assemblies',
                        'The Senate must vote to approve the execution',
                        'The other consul must agree to the execution',
                        'The Pontifex Maximus must perform religious rites'
                    ],
                    correct: 0,
                    explanation: 'Citizens within Rome had the right of provocatio (appeal) to the popular assemblies. This fundamental protection meant magistrates could not execute citizens without trial, symbolised by axes being removed from fasces within the city.'
                },

                // Topic 1.3 - Patronage and Amicitia
                {
                    type: 'text-flexible',
                    topic: 'Topic 1.3',
                    difficulty: 'Assessment Level',
                    question: 'What does "amicitia" mean in Roman political terms?',
                    correctAnswers: ['political friendship', 'calculated alliance'],
                    acceptableVariations: ['political friendship', 'friendship', 'political alliance', 'calculated alliance', 'mutual advantage', 'political relationship'],
                    explanation: 'Amicitia was political "friendship" - calculated alliances between elite Romans based on mutual advantage rather than emotional bonds. These horizontal relationships allowed politicians to pool resources and coordinate policy.'
                },
                {
                    type: 'multiple-choice',
                    topic: 'Topic 1.3',
                    difficulty: 'Assessment Level',
                    question: 'What was sportula and how did it reinforce the patron-client relationship?',
                    choices: [
                        'A daily gift of food/money that created economic dependence',
                        'A religious ceremony that blessed political alliances',
                        'A voting token that ensured electoral support',
                        'A legal contract that formalised business partnerships'
                    ],
                    correct: 0,
                    explanation: 'Sportula was the daily gift of food or money from patron to clients, originally carried in a small basket. It institutionalised economic dependence and ensured daily contact between patron and client.'
                },
                {
                    type: 'text-flexible',
                    topic: 'Topic 1.3',
                    difficulty: 'Lesson Detail',
                    question: 'What was the salutatio and why was it politically important?',
                    correctAnswers: ['morning reception', 'morning visit'],
                    acceptableVariations: ['morning reception', 'morning visit', 'morning greeting', 'daily reception', 'client visits'],
                    explanation: 'The salutatio was the morning reception where clients paid respects to their patron. The size and quality of a politician\'s morning crowd (turba) was a visible measure of his power and influence in Roman society.'
                },
                {
                    type: 'multiple-choice',
                    topic: 'Topic 1.3',
                    difficulty: 'Lesson Detail',
                    question: 'Which alliance best exemplifies the dangers of amicitia in Roman politics?',
                    choices: [
                        'The alliance between Cicero and Atticus',
                        'The First Triumvirate between Caesar, Pompey, and Crassus',
                        'The friendship between Scipio Aemilianus and Laelius',
                        'The partnership between Marius and Sulla'
                    ],
                    correct: 1,
                    explanation: 'The First Triumvirate (60 BC) showed how private amicitia could override public institutions. Caesar, Pompey, and Crassus secretly divided the Roman world between them, using their combined influence to control elections and provincial commands.'
                },
                {
                    type: 'scenario',
                    topic: 'Topic 1.3',
                    difficulty: 'Lesson Detail',
                    question: 'A wealthy Roman politician has 200 clients attending his morning salutatio. What does this demonstrate about his political position?',
                    choices: [
                        'He is probably running for consul and needs votes',
                        'He has significant political influence and power',
                        'He is in financial trouble and needs support',
                        'He is preparing for a religious ceremony'
                    ],
                    correct: 1,
                    explanation: 'A large morning crowd (turba) was a visible demonstration of a politician\'s influence and power. The number and quality of clients showed his ability to mobilise support and his standing in Roman society.'
                },
                {
                    type: 'text-flexible',
                    topic: 'Topic 1.3',
                    difficulty: 'Lesson Detail',
                    question: 'Name two typical causes of inimicitia (political enmity) between Roman politicians.',
                    correctAnswers: ['competition for office', 'personal insults'],
                    acceptableVariations: ['electoral competition', 'office competition', 'insults', 'prosecution', 'legal disputes', 'family feuds', 'business disputes'],
                    explanation: 'Inimicitia typically arose from electoral competition for the same offices, personal insults or humiliation, legal prosecutions, family feuds, or ideological disagreements. These personal hatreds often drove politics more than policy differences.'
                },

                // Topic 1.4 - Political Ideals
                {
                    type: 'multiple-choice',
                    topic: 'Topic 1.4',
                    difficulty: 'Assessment Level',
                    question: 'Which two principles are central to Stoic philosophy?',
                    choices: [
                        'Pleasure above all and avoid pain',
                        'Duty above personal gain and reason over emotion',
                        'Wealth accumulation and social climbing',
                        'Military conquest and territorial expansion'
                    ],
                    correct: 1,
                    explanation: 'Stoicism emphasised duty above personal gain, reason over emotion, virtue as the highest good, and resistance to corruption. These principles attracted Roman politicians who wanted to appear incorruptible.'
                },
                {
                    type: 'text-flexible',
                    topic: 'Topic 1.4',
                    difficulty: 'Assessment Level',
                    question: 'What did Cicero mean by "concordia ordinum"?',
                    correctAnswers: ['harmony between orders', 'harmony senators equites'],
                    acceptableVariations: ['harmony between orders', 'harmony between classes', 'senators and equites working together', 'harmony senators equites'],
                    explanation: 'Concordia ordinum meant harmony between the senatorial and equestrian orders - the two main elite classes working together for the good of the state rather than pursuing conflicting interests.'
                },
                {
                    type: 'text-flexible',
                    topic: 'Topic 1.4',
                    difficulty: 'Lesson Detail',
                    question: 'Define "dignitas" and explain why it was crucial for Roman politicians.',
                    correctAnswers: ['personal standing', 'political prestige'],
                    acceptableVariations: ['dignitas personal standing', 'political dignity', 'status prestige', 'honour reputation', 'personal honour'],
                    explanation: 'Dignitas was personal standing and prestige accumulated through achievement, office-holding, and public service. It was crucial because it determined a politician\'s auctoritas (moral authority) and ability to influence others.'
                },
                {
                    type: 'multiple-choice',
                    topic: 'Topic 1.4',
                    difficulty: 'Lesson Detail',
                    question: 'According to Roman political ideals, what was the difference between auctoritas and potestas?',
                    choices: [
                        'Auctoritas was legal power, potestas was moral authority',
                        'Auctoritas was moral authority, potestas was legal power',
                        'Auctoritas was military command, potestas was civil authority',
                        'Auctoritas was temporary, potestas was permanent'
                    ],
                    correct: 1,
                    explanation: 'Auctoritas was moral authority based on personal prestige and past achievement, while potestas was formal legal power granted by office. The ideal Roman leader combined both - legal authority backed by moral credibility.'
                },
                {
                    type: 'scenario',
                    topic: 'Topic 1.4',
                    difficulty: 'Lesson Detail',
                    question: 'Cato the Younger refuses a profitable business deal because it involves bribing provincial governors. This behaviour exemplifies which Roman ideal?',
                    choices: [
                        'Dignitas - maintaining personal honour',
                        'Virtus - courage in battle',
                        'Clementia - mercy towards enemies',
                        'Pietas - duty to family'
                    ],
                    correct: 0,
                    explanation: 'This exemplifies dignitas - maintaining personal honour and integrity. Cato\'s Stoic principles meant he would not compromise his moral standing for financial gain, even at personal cost.'
                },
                {
                    type: 'text-flexible',
                    topic: 'Topic 1.4',
                    difficulty: 'Lesson Detail',
                    question: 'Name the three main social classes in Roman society.',
                    correctAnswers: ['senators equites plebeians'],
                    acceptableVariations: ['senators, equites, plebeians', 'senatorial, equestrian, plebeian', 'patricians, equites, plebs'],
                    explanation: 'The three main free social classes were Senators (political elite who had held magistracies), Equites (wealthy business class with property qualification), and Plebeians (ordinary citizens).'
                },

                // Topic 1.5 - Political Factions
                {
                    type: 'text-flexible',
                    topic: 'Topic 1.5',
                    difficulty: 'Assessment Level',
                    question: 'Explain why Roman political factions were not the same as modern political parties.',
                    correctAnswers: ['no formal structure', 'politicians switched'],
                    acceptableVariations: ['no formal structure', 'could switch factions', 'personal relationships', 'no party discipline', 'informal groups', 'flexible membership'],
                    explanation: 'Roman factions lacked formal party structures, politicians could switch factions when convenient, and they were based more on personal relationships than ideology. Labels were often rhetorical weapons rather than genuine ideological categories.'
                },
                {
                    type: 'multiple-choice',
                    topic: 'Topic 1.5',
                    difficulty: 'Assessment Level',
                    question: 'Which two beliefs or methods were typical of the optimates?',
                    choices: [
                        'Defend Senate authority and uphold mos maiorum',
                        'Use popular assemblies and bypass the Senate',
                        'Promote land redistribution and grain distribution',
                        'Appeal to tribunes and use populist rhetoric'
                    ],
                    correct: 0,
                    explanation: 'Optimates ("the best men") defended Senate authority, upheld traditional customs (mos maiorum), supported property rights, and used established magistracies rather than appealing directly to the people.'
                },
                {
                    type: 'scenario',
                    topic: 'Topic 1.5',
                    difficulty: 'Assessment Level',
                    question: 'A tribune proposes a law to distribute public land to landless citizens, bypassing the Senate. Is this a popularis or optimate policy?',
                    choices: ['Popularis', 'Optimate'],
                    correct: 0,
                    explanation: 'This is clearly popularis - using a tribune to bypass the Senate and appeal directly to popular assemblies with land redistribution, exactly the methods populares politicians employed.'
                },
                {
                    type: 'text-flexible',
                    topic: 'Topic 1.5',
                    difficulty: 'Lesson Detail',
                    question: 'Define "boni" and explain how this label was used politically.',
                    correctAnswers: ['good men', 'morally upright'],
                    acceptableVariations: ['good men', 'the good', 'upright men', 'morally reliable', 'virtuous senators'],
                    explanation: 'Boni meant "the good men" - senators regarded as morally upright and politically reliable. Cicero used this label to create a moral coalition excluding opponents as corrupt or dangerous.'
                },
                {
                    type: 'multiple-choice',
                    topic: 'Topic 1.5',
                    difficulty: 'Lesson Detail',
                    question: 'How did populares politicians typically gain support?',
                    choices: [
                        'Through Senate debates and traditional procedures',
                        'By appealing to tribunes and popular assemblies',
                        'Through religious ceremonies and augury',
                        'By building military alliances with foreign kings'
                    ],
                    correct: 1,
                    explanation: 'Populares gained support by appealing to tribunes (who could propose legislation directly), using popular assemblies to bypass the Senate, and employing populist rhetoric about land, grain, and citizenship.'
                },
                {
                    type: 'scenario',
                    topic: 'Topic 1.5',
                    difficulty: 'Lesson Detail',
                    question: 'Cicero calls his political opponents "enemies of the state" while describing his own supporters as "all good men." This demonstrates:',
                    choices: [
                        'Genuine ideological differences between parties',
                        'The rhetorical use of factional labels for political advantage',
                        'The formal structure of Roman political organisations',
                        'Religious differences about the role of the gods'
                    ],
                    correct: 1,
                    explanation: 'This demonstrates how factional labels like "boni" (good men) were rhetorical weapons used to legitimise supporters and delegitimise opponents, rather than reflecting genuine ideological divisions.'
                },

                // Additional complex scenario and analysis questions
                {
                    type: 'scenario',
                    topic: 'Topic 1.2-1.3',
                    difficulty: 'Analysis',
                    question: 'A consul uses his lictors to arrest a citizen, but the tribune intervenes using intercessio. The consul argues he has imperium. Who has the legal right to prevail?',
                    choices: [
                        'The consul, because imperium outranks tribunician power',
                        'The tribune, because intercessio can block any magistrate',
                        'Neither, they must seek Senate arbitration',
                        'The citizen, who can appeal to popular assemblies'
                    ],
                    correct: 1,
                    explanation: 'The tribune has the legal right to prevail because intercessio (veto power) could block any magistrate\'s action, even those with imperium. This was a fundamental check on executive power built into the Republican system.'
                },
                {
                    type: 'scenario',
                    topic: 'Topic 1.3-1.5',
                    difficulty: 'Analysis',
                    question: 'Caesar forms a secret alliance with Pompey and Crassus to control elections and divide provincial commands. This represents:',
                    choices: [
                        'Normal amicitia between political equals',
                        'The corruption of Republican institutions by private relationships',
                        'Effective cooperation between optimates politicians',
                        'A temporary military alliance against foreign enemies'
                    ],
                    correct: 1,
                    explanation: 'The First Triumvirate represents the corruption of Republican institutions by private relationships. Secret amicitia overrode public debate, electoral choice, and constitutional procedures, privatising the Roman state.'
                }
            ],
            
            'quick': [
                // Streamlined selection of key concepts for quick review
                {
                    type: 'multiple-choice',
                    topic: 'Topic 1.1',
                    difficulty: 'Key Concept',
                    question: 'What does SPQR stand for?',
                    choices: [
                        'Senatus Populusque Romanus',
                        'Spiritus Populus Romanus',
                        'Senatus Publicus Romanus',
                        'Senatus Popularis Romanus'
                    ],
                    correct: 0,
                    explanation: 'SPQR stands for "Senatus Populusque Romanus" - "The Senate and the Roman People", representing the two key elements of Republican government.'
                },
                {
                    type: 'text-flexible',
                    topic: 'Topic 1.2',
                    difficulty: 'Key Concept',
                    question: 'Name the highest regular magistracy in the Roman Republic.',
                    correctAnswers: ['consul'],
                    acceptableVariations: ['consul', 'consuls', 'consulship'],
                    explanation: 'The consulship was the highest regular magistracy. Two consuls were elected annually to lead the Roman state, embodying the rejection of monarchy through shared leadership.'
                },
                {
                    type: 'multiple-choice',
                    topic: 'Topic 1.3',
                    difficulty: 'Key Concept',
                    question: 'What was the main purpose of the patron-client relationship?',
                    choices: [
                        'To provide mutual protection and political support',
                        'To organize religious ceremonies',
                        'To regulate business transactions',
                        'To arrange military service'
                    ],
                    correct: 0,
                    explanation: 'The patron-client relationship provided mutual protection and political support - patrons offered legal protection and resources, while clients provided political backing and demonstrated the patron\'s importance.'
                }
                // ... more quick questions
            ],
            
            'detailed': [
                // More specific lesson content questions
                {
                    type: 'text-flexible',
                    topic: 'Topic 1.2',
                    difficulty: 'Detailed',
                    question: 'What does "collegiality" mean in the context of Roman magistracies?',
                    correctAnswers: ['shared office', 'two magistrates'],
                    acceptableVariations: ['shared office', 'two people', 'pair of magistrates', 'two holders', 'dual leadership'],
                    explanation: 'Collegiality meant that most magistracies were shared between two people (e.g., two consuls) to prevent any individual from accumulating too much power and to provide checks against abuse of authority.'
                }
                // ... more detailed questions
            ]
        };

        // Quiz state variables
        let currentMode = '';
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let quizStartTime = null;

        // Utility functions
        function normaliseText(text) {
            return text.toLowerCase()
                .trim()
                .replace(/[^\w\s]/g, '')
                .replace(/\s+/g, ' ');
        }

        function checkFlexibleAnswer(userInput, correctAnswers, acceptableVariations) {
            const normalised = normaliseText(userInput);
            
            // Check exact matches first
            for (let answer of correctAnswers) {
                if (normalised.includes(normaliseText(answer)) || normaliseText(answer).includes(normalised)) {
                    return 'correct';
                }
            }
            
            // Check acceptable variations
            for (let variation of acceptableVariations) {
                if (normalised.includes(normaliseText(variation)) || normaliseText(variation).includes(normalised)) {
                    return 'correct';
                }
            }
            
            // Partial credit for close matches
            for (let answer of [...correctAnswers, ...acceptableVariations]) {
                const words = normaliseText(answer).split(' ');
                const userWords = normalised.split(' ');
                const matchingWords = words.filter(word => userWords.some(userWord => 
                    userWord.includes(word) || word.includes(userWord)
                ));
                
                if (matchingWords.length >= Math.ceil(words.length * 0.6)) {
                    return 'partial';
                }
            }
            
            return 'incorrect';
        }

        // Mode selection
        function selectMode(mode) {
            document.querySelectorAll('.mode-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            document.querySelector(`[data-mode="${mode}"]`).classList.add('selected');
            currentMode = mode;
            document.getElementById('start-quiz-btn').disabled = false;
        }

        // Start quiz
        function startQuiz() {
            currentQuestions = [...questionBank[currentMode]].sort(() => Math.random() - 0.5);
            currentQuestionIndex = 0;
            userAnswers = [];
            quizStartTime = Date.now();
            
            document.getElementById('mode-selection-screen').style.display = 'none';
            document.getElementById('question-screen').style.display = 'block';
            
            loadQuestion();
        }

        // Load current question
        function loadQuestion() {
            const question = currentQuestions[currentQuestionIndex];
            
            document.getElementById('question-number').textContent = currentQuestionIndex + 1;
            document.getElementById('question-type').textContent = formatQuestionType(question.type);
            document.getElementById('question-topic').textContent = question.topic;
            document.getElementById('question-difficulty').textContent = question.difficulty;
            document.getElementById('question-text').textContent = question.question;
            document.getElementById('progress-text').textContent = `Question ${currentQuestionIndex + 1} of ${currentQuestions.length}`;
            document.getElementById('progress-indicator').textContent = `Question ${currentQuestionIndex + 1} of ${currentQuestions.length}`;
            
            // Show context if available
            const contextEl = document.getElementById('question-context');
            if (question.context) {
                contextEl.textContent = question.context;
                contextEl.style.display = 'block';
            } else {
                contextEl.style.display = 'none';
            }
            
            // Clear previous feedback
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('check-btn').style.display = 'inline-block';
            document.getElementById('next-btn').style.display = 'none';
            
            // Load answer area
            loadAnswerArea(question);
            
            // Update navigation buttons
            document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
        }

        function formatQuestionType(type) {
            const types = {
                'multiple-choice': 'Multiple Choice',
                'text-flexible': 'Short Answer',
                'drag-drop': 'Drag & Drop',
                'scenario': 'Scenario Analysis'
            };
            return types[type] || type;
        }

        // Load answer area based on question type
        function loadAnswerArea(question) {
            const answerArea = document.getElementById('answer-area');
            
            switch(question.type) {
                case 'text-flexible':
                    answerArea.innerHTML = `
                        <input type="text" class="answer-input" id="text-answer" 
                               placeholder="Type your answer here..." autocomplete="off">
                    `;
                    // Focus on input for better UX
                    setTimeout(() => document.getElementById('text-answer').focus(), 100);
                    break;
                    
                case 'multiple-choice':
                case 'scenario':
                    answerArea.innerHTML = `
                        <div class="multiple-choice" id="multiple-choice">
                            ${question.choices.map((choice, index) => `
                                <div class="choice-option" onclick="selectChoice(${index})" data-choice="${index}">
                                    <div class="choice-letter">${String.fromCharCode(65 + index)}</div>
                                    <div>${choice}</div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    break;
                    
                case 'drag-drop':
                    const categories = Object.keys(question.categories);
                    answerArea.innerHTML = `
                        <div class="drag-drop-container">
                            <div class="drag-instruction">Drag the items to the correct categories</div>
                            <div class="drag-items" id="drag-items">
                                ${question.items.map(item => `
                                    <div class="drag-item" draggable="true" data-item="${item}">${item}</div>
                                `).join('')}
                            </div>
                            <div class="drop-zones" id="drop-zones">
                                ${categories.map(category => `
                                    <div class="drop-zone" data-category="${category}">
                                        <div class="drop-zone-title">${category}</div>
                                        <div class="dropped-items" id="dropped-${category.replace(/\s+/g, '-')}"></div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    setupDragAndDrop();
                    break;
            }
        }

        // Multiple choice selection
        function selectChoice(index) {
            document.querySelectorAll('.choice-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`[data-choice="${index}"]`).classList.add('selected');
        }

        // Drag and drop functionality
        function setupDragAndDrop() {
            const dragItems = document.querySelectorAll('.drag-item');
            const dropZones = document.querySelectorAll('.drop-zone');
            
            dragItems.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
            });
            
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('drop', handleDrop);
                zone.addEventListener('dragenter', handleDragEnter);
                zone.addEventListener('dragleave', handleDragLeave);
            });
        }

        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.dataset.item);
            e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDragEnter(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            const itemText = e.dataTransfer.getData('text/plain');
            const category = e.currentTarget.dataset.category;
            const droppedArea = e.currentTarget.querySelector('.dropped-items');
            
            // Remove item from original location
            const draggedItem = document.querySelector(`[data-item="${itemText}"]`);
            if (draggedItem.parentNode.classList.contains('dropped-items')) {
                draggedItem.parentNode.removeChild(draggedItem);
            }
            
            // Add to new location
            const newItem = document.createElement('div');
            newItem.className = 'drag-item';
            newItem.textContent = itemText;
            newItem.dataset.item = itemText;
            newItem.draggable = true;
            
            // Re-add event listeners
            newItem.addEventListener('dragstart', handleDragStart);
            newItem.addEventListener('dragend', handleDragEnd);
            
            droppedArea.appendChild(newItem);
            
            // Remove from original location
            if (draggedItem.parentNode.id === 'drag-items') {
                draggedItem.remove();
            }
        }

        // Check answer functionality
        function checkAnswer() {
            const question = currentQuestions[currentQuestionIndex];
            let userAnswer = null;
            let result = 'incorrect';
            
            switch(question.type) {
                case 'text-flexible':
                    userAnswer = document.getElementById('text-answer').value;
                    result = checkFlexibleAnswer(userAnswer, question.correctAnswers, question.acceptableVariations);
                    break;
                    
                case 'multiple-choice':
                case 'scenario':
                    const selected = document.querySelector('.choice-option.selected');
                    if (selected) {
                        userAnswer = parseInt(selected.dataset.choice);
                        result = userAnswer === question.correct ? 'correct' : 'incorrect';
                    }
                    break;
                    
                case 'drag-drop':
                    userAnswer = {};
                    document.querySelectorAll('.drop-zone').forEach(zone => {
                        const category = zone.dataset.category;
                        const items = Array.from(zone.querySelectorAll('.drag-item')).map(item => item.dataset.item);
                        userAnswer[category] = items;
                    });
                    
                    // Check drag and drop answer
                    let correct = 0;
                    let total = 0;
                    Object.keys(question.categories).forEach(category => {
                        const expectedItems = question.categories[category];
                        const actualItems = userAnswer[category] || [];
                        expectedItems.forEach(item => {
                            total++;
                            if (actualItems.includes(item)) correct++;
                        });
                    });
                    
                    if (correct === total) result = 'correct';
                    else if (correct > 0) result = 'partial';
                    else result = 'incorrect';
                    break;
            }
            
            // Store answer
            userAnswers[currentQuestionIndex] = {
                question: question,
                userAnswer: userAnswer,
                result: result
            };
            
            // Show feedback
            showFeedback(result, question.explanation);
            
            // Update UI
            document.getElementById('check-btn').style.display = 'none';
            document.getElementById('next-btn').style.display = 'inline-block';
        }

        function showFeedback(result, explanation) {
            const feedback = document.getElementById('feedback');
            const feedbackIcon = document.getElementById('feedback-icon');
            const feedbackTitle = document.getElementById('feedback-title');
            const feedbackExplanation = document.getElementById('feedback-explanation');
            
            feedback.className = `feedback ${result}`;
            
            switch(result) {
                case 'correct':
                    feedbackIcon.textContent = '‚úì';
                    feedbackTitle.textContent = 'Correct!';
                    break;
                case 'partial':
                    feedbackIcon.textContent = '‚óê';
                    feedbackTitle.textContent = 'Partially Correct';
                    break;
                case 'incorrect':
                    feedbackIcon.textContent = '‚úó';
                    feedbackTitle.textContent = 'Incorrect';
                    break;
            }
            
            feedbackExplanation.textContent = explanation;
            feedback.style.display = 'block';
        }

        // Navigation functions
        function nextQuestion() {
            if (currentQuestionIndex < currentQuestions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            } else {
                showResults();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
                
                // If we've already answered this question, show the feedback
                if (userAnswers[currentQuestionIndex]) {
                    const answer = userAnswers[currentQuestionIndex];
                    showFeedback(answer.result, answer.question.explanation);
                    document.getElementById('check-btn').style.display = 'none';
                    document.getElementById('next-btn').style.display = 'inline-block';
                }
            }
        }

        // Results functionality
        function showResults() {
            const quizEndTime = Date.now();
            const completionTime = Math.round((quizEndTime - quizStartTime) / (1000 * 60));
            
            document.getElementById('question-screen').style.display = 'none';
            document.getElementById('results-screen').style.display = 'block';
            
            // Calculate scores
            let correct = 0;
            let incorrect = 0;
            let partial = 0;
            
            const topicScores = {};
            
            userAnswers.forEach(answer => {
                if (answer.result === 'correct') correct++;
                else if (answer.result === 'partial') partial++;
                else incorrect++;
                
                // Track by topic
                const topic = answer.question.topic;
                if (!topicScores[topic]) {
                    topicScores[topic] = { correct: 0, total: 0 };
                }
                topicScores[topic].total++;
                if (answer.result === 'correct') topicScores[topic].correct++;
                else if (answer.result === 'partial') topicScores[topic].correct += 0.5;
            });
            
            const totalScore = Math.round((correct + partial * 0.5) / userAnswers.length * 100);
            
            // Update display
            document.getElementById('final-score').textContent = `${totalScore}%`;
            document.getElementById('correct-count').textContent = correct;
            document.getElementById('incorrect-count').textContent = incorrect;
            document.getElementById('partial-count').textContent = partial;
            document.getElementById('completion-time').textContent = completionTime;
            
            // Results message based on performance
            const resultsMessage = document.getElementById('results-message');
            if (totalScore >= 85) {
                resultsMessage.textContent = 'Excellent work! You\'re well-prepared for assessments.';
            } else if (totalScore >= 70) {
                resultsMessage.textContent = 'Good progress! Review the areas where you lost marks.';
            } else if (totalScore >= 60) {
                resultsMessage.textContent = 'Getting there! Focus on reviewing the lesson content.';
            } else {
                resultsMessage.textContent = 'Keep practising! Revisit the lesson materials before your next attempt.';
            }
            
            // Topic breakdown
            const topicPerformance = document.getElementById('topic-performance');
            topicPerformance.innerHTML = '<h3>Performance by Topic:</h3>';
            
            Object.keys(topicScores).forEach(topic => {
                const score = topicScores[topic];
                const percentage = Math.round(score.correct / score.total * 100);
                
                const topicElement = document.createElement('div');
                topicElement.className = 'performance-item';
                topicElement.innerHTML = `
                    <span>${topic}</span>
                    <span class="performance-score">${percentage}% (${score.correct}/${score.total})</span>
                `;
                topicPerformance.appendChild(topicElement);
            });
        }

        function restartQuiz() {
            currentMode = '';
            currentQuestions = [];
            currentQuestionIndex = 0;
            userAnswers = [];
            quizStartTime = null;
            
            document.getElementById('results-screen').style.display = 'none';
            document.getElementById('mode-selection-screen').style.display = 'block';
            
            // Reset selections
            document.querySelectorAll('.mode-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.getElementById('start-quiz-btn').disabled = true;
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            // Only process shortcuts if we're in the question screen
            if (document.getElementById('question-screen').style.display === 'block') {
                if (event.key === 'Enter') {
                    const checkBtn = document.getElementById('check-btn');
                    const nextBtn = document.getElementById('next-btn');
                    
                    if (checkBtn.style.display !== 'none') {
                        checkAnswer();
                    } else if (nextBtn.style.display !== 'none') {
                        nextQuestion();
                    }
                    event.preventDefault();
                }
                
                // Number keys for multiple choice
                if (event.key >= '1' && event.key <= '4') {
                    const choiceIndex = parseInt(event.key) - 1;
                    const choice = document.querySelector(`[data-choice="${choiceIndex}"]`);
                    if (choice) {
                        selectChoice(choiceIndex);
                    }
                }
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Any initialization code here
            console.log('Politics Topic 1 Quiz loaded successfully');
        });
