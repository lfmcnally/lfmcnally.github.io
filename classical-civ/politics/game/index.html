<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cursus Honorum ‚Äî Rise to Power</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --parchment: #f4e4bc; --parchment-dark: #e8d4a8; --parchment-light: #faf6eb;
            --ink: #2c1810; --ink-light: #4a3728; --wax-red: #8b2323; --wax-gold: #c9a227;
            --bronze: #cd7f32; --success: #2d5016; --danger: #6b1c1c; --senate: #1a365d;
        }
        body { font-family: 'Crimson Text', Georgia, serif; background: linear-gradient(135deg, #3d2914, #2c1810, #1a0f0a); min-height: 100vh; color: var(--ink); }
        .game-container { max-width: 1000px; margin: 0 auto; padding: 15px; }
        .game-board {
            background: var(--parchment); border: 12px solid #5c4033;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5), inset 0 0 60px rgba(139,69,19,0.1);
            padding: 20px; position: relative; min-height: 90vh;
        }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--ink-light); padding-bottom: 12px; margin-bottom: 15px; flex-wrap: wrap; gap: 10px; }
        .header h1 { font-family: 'Cinzel', serif; font-size: 1.6rem; font-weight: 700; letter-spacing: 0.1em; }
        .header-info { text-align: right; }
        .year-display { font-family: 'Cinzel', serif; font-size: 1.3rem; color: var(--wax-red); }
        .age-display { font-size: 0.9rem; color: var(--ink-light); }
        .career-track { display: flex; justify-content: space-between; align-items: center; background: var(--parchment-dark); padding: 10px 15px; margin-bottom: 15px; border: 1px solid var(--ink-light); overflow-x: auto; gap: 5px; }
        .career-office { text-align: center; padding: 5px 8px; opacity: 0.4; transition: all 0.3s; min-width: 70px; }
        .career-office.achieved { opacity: 1; color: var(--success); }
        .career-office.current { opacity: 1; background: var(--wax-red); color: white; border-radius: 5px; }
        .career-office.available { opacity: 0.8; border: 2px dashed var(--wax-gold); border-radius: 5px; }
        .career-office .office-name { font-family: 'Cinzel', serif; font-size: 0.7rem; font-weight: 600; }
        .career-office .office-age { font-size: 0.6rem; }
        .stats-row { display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap; }
        .stat-box { flex: 1; min-width: 80px; text-align: center; padding: 8px 5px; background: var(--parchment-light); border: 2px solid var(--bronze); border-radius: 5px; }
        .stat-box.danger { border-color: var(--danger); background: #f5e0e0; }
        .stat-box.good { border-color: var(--success); background: #e0f0e0; }
        .stat-name { font-family: 'Cinzel', serif; font-size: 0.6rem; text-transform: uppercase; color: var(--ink-light); }
        .stat-value { font-family: 'Cinzel', serif; font-size: 1.3rem; font-weight: 700; }
        .relationships { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px; margin-bottom: 15px; padding: 10px; background: var(--parchment-dark); border: 1px solid var(--ink-light); }
        .relationship { display: flex; align-items: center; gap: 6px; font-size: 0.8rem; }
        .rel-name { font-weight: 600; min-width: 60px; font-size: 0.75rem; }
        .rel-bar { flex: 1; height: 8px; background: #ddd; border-radius: 4px; overflow: hidden; }
        .rel-fill { height: 100%; transition: width 0.3s; }
        .rel-fill.hostile { background: linear-gradient(to right, var(--danger), #a33); }
        .rel-fill.cold { background: linear-gradient(to right, #b44, #c66); }
        .rel-fill.neutral { background: linear-gradient(to right, #888, #aaa); }
        .rel-fill.warm { background: linear-gradient(to right, #6a6, #8c8); }
        .rel-fill.allied { background: linear-gradient(to right, var(--success), #4a7); }
        .content-area { background: var(--parchment-light); border: 2px solid var(--ink-light); padding: 20px; margin-bottom: 15px; min-height: 300px; }
        .section-title { font-family: 'Cinzel', serif; font-size: 1.15rem; color: var(--wax-red); margin-bottom: 15px; text-align: center; border-bottom: 1px solid var(--ink-light); padding-bottom: 10px; }
        .event-card { background: white; border: 2px solid var(--ink-light); padding: 15px; margin-bottom: 15px; }
        .event-type { font-family: 'Cinzel', serif; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.15em; color: var(--bronze); margin-bottom: 5px; }
        .event-title { font-family: 'Cinzel', serif; font-size: 1.05rem; font-weight: 600; margin-bottom: 10px; }
        .event-desc { line-height: 1.6; margin-bottom: 15px; font-size: 0.95rem; }
        .event-desc .highlight { color: var(--wax-red); font-weight: 600; }
        .choices { display: flex; flex-direction: column; gap: 8px; }
        .choice-btn {
            background: linear-gradient(to bottom, var(--parchment), var(--parchment-dark));
            border: 2px solid var(--ink-light); padding: 12px 15px; font-family: 'Crimson Text', serif;
            font-size: 0.95rem; color: var(--ink); cursor: pointer; text-align: left; transition: all 0.2s;
        }
        .choice-btn:hover:not(:disabled) { background: linear-gradient(to bottom, #fff, var(--parchment)); border-color: var(--bronze); transform: translateX(5px); }
        .choice-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .choice-btn .choice-cost { display: inline-block; background: var(--wax-red); color: white; font-size: 0.7rem; padding: 2px 6px; border-radius: 8px; margin-left: 8px; }
        .choice-btn .choice-effect { display: block; font-size: 0.8rem; color: var(--ink-light); margin-top: 5px; font-style: italic; }
        .election-container { background: #fffef5; border: 3px double var(--wax-gold); padding: 20px; }
        .candidates { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; margin: 15px 0; }
        .candidate { background: var(--parchment); border: 2px solid var(--ink-light); padding: 12px; text-align: center; }
        .candidate.player { border-color: var(--wax-gold); background: #fffef8; }
        .candidate.winner { border-color: var(--success); background: #e8f5e0; }
        .candidate-name { font-family: 'Cinzel', serif; font-size: 0.9rem; font-weight: 600; margin-bottom: 5px; }
        .candidate-support { font-size: 0.8rem; color: var(--ink-light); }
        .vote-bar { height: 15px; background: #ddd; border-radius: 8px; margin-top: 8px; overflow: hidden; }
        .vote-fill { height: 100%; background: linear-gradient(to right, var(--wax-red), var(--bronze)); transition: width 1s; border-radius: 8px; }
        .campaign-actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 10px; margin-top: 15px; }
        .campaign-btn { background: linear-gradient(to bottom, var(--parchment-dark), #cdb98a); border: 2px solid var(--bronze); padding: 10px; font-family: 'Cinzel', serif; font-size: 0.75rem; cursor: pointer; text-align: center; }
        .campaign-btn:hover:not(:disabled) { background: linear-gradient(to bottom, #e8d8b8, var(--parchment-dark)); }
        .campaign-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .campaign-btn .cost { display: block; font-size: 0.65rem; color: var(--danger); margin-top: 3px; }
        .btn-primary {
            display: block; width: 100%; background: linear-gradient(to bottom, var(--wax-red), #6b1818);
            color: white; border: none; padding: 12px; font-family: 'Cinzel', serif;
            font-size: 1rem; letter-spacing: 0.1em; cursor: pointer; transition: all 0.2s; margin-top: 10px;
        }
        .btn-primary:hover { background: linear-gradient(to bottom, #a02c2c, var(--wax-red)); }
        .btn-secondary { background: linear-gradient(to bottom, var(--ink-light), var(--ink)); }
        .btn-success { background: linear-gradient(to bottom, var(--success), #1a3a0a); }
        .intro-screen { padding: 15px; }
        .intro-screen h2 { font-family: 'Cinzel', serif; font-size: 1.4rem; text-align: center; margin-bottom: 15px; color: var(--wax-red); }
        .intro-screen p { line-height: 1.7; margin-bottom: 12px; }
        .family-choices { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin: 15px 0; }
        .family-choice { background: var(--parchment-dark); border: 2px solid var(--ink-light); padding: 12px; cursor: pointer; transition: all 0.2s; }
        .family-choice:hover { border-color: var(--wax-red); background: var(--parchment-light); }
        .family-choice.selected { border-color: var(--wax-red); background: var(--parchment-light); box-shadow: 0 0 10px rgba(139,35,35,0.3); }
        .family-choice h4 { font-family: 'Cinzel', serif; font-size: 0.9rem; margin-bottom: 8px; color: var(--wax-red); }
        .family-choice p { font-size: 0.85rem; margin-bottom: 5px; }
        .family-choice .bonuses { font-size: 0.75rem; color: var(--ink-light); }
        .end-screen { text-align: center; padding: 20px; }
        .end-screen h2 { font-family: 'Cinzel', serif; font-size: 1.6rem; margin-bottom: 15px; }
        .end-screen.victory h2 { color: var(--success); }
        .end-screen.defeat h2 { color: var(--danger); }
        .end-screen p { line-height: 1.7; margin-bottom: 12px; }
        .final-record { background: var(--parchment-dark); padding: 15px; margin: 15px 0; text-align: left; }
        .final-record h4 { font-family: 'Cinzel', serif; margin-bottom: 10px; }
        .year-summary { background: #fffef8; border-left: 4px solid var(--bronze); padding: 12px; margin-bottom: 15px; }
        .year-summary h4 { font-family: 'Cinzel', serif; color: var(--bronze); margin-bottom: 8px; font-size: 0.95rem; }
        .summary-item { display: flex; justify-content: space-between; padding: 3px 0; font-size: 0.85rem; }
        .historical-note { background: var(--senate); color: white; padding: 12px 15px; margin-top: 15px; font-size: 0.85rem; border-radius: 5px; }
        .historical-note strong { color: var(--wax-gold); }
        .hidden { display: none !important; }
        @media (max-width: 600px) {
            .header { flex-direction: column; text-align: center; }
            .career-track { flex-wrap: wrap; justify-content: center; }
            .stats-row { flex-wrap: wrap; }
            .stat-box { min-width: 70px; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-board">
            <div class="header">
                <div>
                    <h1>CURSUS HONORUM</h1>
                    <div id="playerName" style="font-style:italic;color:var(--ink-light);font-size:0.9rem;"></div>
                </div>
                <div class="header-info">
                    <div class="year-display" id="yearDisplay">134 BC</div>
                    <div class="age-display" id="ageDisplay">Age 17</div>
                </div>
            </div>
            <div class="career-track hidden" id="careerTrack">
                <div class="career-office" data-office="military"><div class="office-name">Military</div><div class="office-age">17-27</div></div>
                <div class="career-office" data-office="quaestor"><div class="office-name">Quaestor</div><div class="office-age">30+</div></div>
                <div class="career-office" data-office="aedile"><div class="office-name">Aedile</div><div class="office-age">36+</div></div>
                <div class="career-office" data-office="praetor"><div class="office-name">Praetor</div><div class="office-age">39+</div></div>
                <div class="career-office" data-office="consul"><div class="office-name">Consul</div><div class="office-age">42+</div></div>
                <div class="career-office" data-office="censor"><div class="office-name">Censor</div><div class="office-age">Ex-Consul</div></div>
            </div>
            <div class="stats-row hidden" id="statsRow">
                <div class="stat-box" id="dignitasBox"><div class="stat-name">Dignitas</div><div class="stat-value" id="dignitas">50</div></div>
                <div class="stat-box" id="auctoritasBox"><div class="stat-name">Influence</div><div class="stat-value" id="auctoritas">20</div></div>
                <div class="stat-box" id="pecuniaBox"><div class="stat-name">Wealth</div><div class="stat-value" id="pecunia">50</div></div>
                <div class="stat-box" id="militaryBox"><div class="stat-name">Military</div><div class="stat-value" id="military">0</div></div>
                <div class="stat-box" id="popularisBox"><div class="stat-name">Popularity</div><div class="stat-value" id="popularis">50</div></div>
            </div>
            <div class="relationships hidden" id="relationships"></div>
            <div class="content-area" id="contentArea"></div>
        </div>
    </div>
    <script>
    const OFFICES = {
        none: { name: 'Private Citizen', minAge: 0, order: 0 },
        military: { name: 'Military Tribune', minAge: 17, order: 1 },
        quaestor: { name: 'Quaestor', minAge: 30, order: 2, slots: 20 },
        aedile: { name: 'Aedile', minAge: 36, order: 3, slots: 4 },
        praetor: { name: 'Praetor', minAge: 39, order: 4, slots: 8 },
        consul: { name: 'Consul', minAge: 42, order: 5, slots: 2 },
        censor: { name: 'Censor', minAge: 44, order: 6, requiresConsul: true, slots: 2 }
    };

    const NPCS = {
        crassus: { name: 'Crassus', fullName: 'Marcus Licinius Crassus', desc: 'The richest man in Rome', trait: 'greedy' },
        pompey: { name: 'Pompey', fullName: 'Gnaeus Pompeius Magnus', desc: 'Great general', trait: 'proud' },
        caesar: { name: 'Caesar', fullName: 'Gaius Julius Caesar', desc: 'Ambitious patrician', trait: 'ambitious' },
        cicero: { name: 'Cicero', fullName: 'Marcus Tullius Cicero', desc: 'Master orator', trait: 'principled' },
        cato: { name: 'Cato', fullName: 'Marcus Porcius Cato', desc: 'Stubborn traditionalist', trait: 'stubborn' }
    };

    const FAMILIES = [
        { id: 'patrician', name: 'Patrician Noble', desc: 'Ancient bloodline, modest means. The Senate respects your name.', bonuses: { dignitas: 20, auctoritas: 15, pecunia: -20 } },
        { id: 'plebeian_noble', name: 'Plebeian Noble', desc: 'Your family has produced consuls. Well-connected and wealthy.', bonuses: { dignitas: 10, pecunia: 30, auctoritas: 10 } },
        { id: 'equestrian', name: 'Equestrian', desc: 'Wealthy businessmen. Money opens doors, but nobles sneer.', bonuses: { pecunia: 50, dignitas: -10, popularis: 10 } },
        { id: 'novus', name: 'Novus Homo', desc: 'First in your family to seek office. Everything to prove.', bonuses: { dignitas: -20, popularis: 25, pecunia: 10 } }
    ];

    const RANDOM_EVENTS = [
        { type: 'good', title: 'Inheritance', desc: 'A distant relative leaves you money.', effects: { pecunia: 25 }, chance: 0.08 },
        { type: 'good', title: 'Popular Speech', desc: 'Your speech in the Forum is well-received.', effects: { popularis: 12, dignitas: 5 }, chance: 0.1 },
        { type: 'good', title: 'Senate Favour', desc: 'A senior senator speaks well of you.', effects: { auctoritas: 12, dignitas: 5 }, chance: 0.08 },
        { type: 'good', title: 'Military Glory', desc: 'News of a victory by troops you commanded.', effects: { military: 10, dignitas: 12 }, chance: 0.06, requires: { military: 20 } },
        { type: 'good', title: 'Good Investment', desc: 'Your business ventures pay off.', effects: { pecunia: 30 }, chance: 0.07 },
        { type: 'bad', title: 'Scandal', desc: 'Rumours spread about your private life.', effects: { dignitas: -15, popularis: -10 }, chance: 0.1 },
        { type: 'bad', title: 'Debt Called In', desc: 'A creditor demands immediate repayment.', effects: { pecunia: -25 }, chance: 0.08 },
        { type: 'bad', title: 'Political Enemy', desc: 'Someone powerful takes against you.', effects: { auctoritas: -12 }, makeEnemy: true, chance: 0.07 },
        { type: 'bad', title: 'Failed Venture', desc: 'A shipping investment lost to pirates.', effects: { pecunia: -20 }, chance: 0.08 },
        { type: 'bad', title: 'Illness', desc: 'Fever keeps you bedridden for weeks.', effects: { dignitas: -10, military: -5 }, chance: 0.06 },
        { type: 'bad', title: 'Family Disgrace', desc: 'A relative caught in scandal.', effects: { dignitas: -20, auctoritas: -10 }, chance: 0.05 },
        { type: 'choice', title: 'Bribery Opportunity', desc: 'A magistrate offers to "lose" evidence against a friend... for a price.',
          choices: [
            { text: 'Pay the bribe (-15 wealth)', effects: { pecunia: -15, auctoritas: 8 }, risk: { chance: 0.25, penalty: { dignitas: -30 }, desc: 'The bribe becomes public!' } },
            { text: 'Refuse on principle', effects: { dignitas: 10 } }
          ], chance: 0.06 },
        { type: 'choice', title: 'Grain Crisis', desc: 'The grain supply is short. The people look to their leaders.',
          choices: [
            { text: 'Fund grain distribution (-30 wealth)', effects: { pecunia: -30, popularis: 25, dignitas: 15 }, requires: { pecunia: 30 } },
            { text: 'Blame current magistrates', effects: { popularis: 10, auctoritas: -10 } },
            { text: 'Do nothing', effects: { popularis: -15 } }
          ], chance: 0.05 },
        { type: 'choice', title: 'Gladiatorial Games', desc: 'An opportunity to sponsor games.',
          choices: [
            { text: 'Lavish games (-50 wealth)', effects: { pecunia: -50, popularis: 30, dignitas: 20 }, requires: { pecunia: 50 } },
            { text: 'Modest games (-20 wealth)', effects: { pecunia: -20, popularis: 15, dignitas: 5 }, requires: { pecunia: 20 } },
            { text: 'Skip the games', effects: { dignitas: -10, popularis: -10 } }
          ], chance: 0.05 },
        { type: 'choice', title: 'Alliance Offer', desc: 'A powerful family offers marriage alliance.',
          choices: [
            { text: 'Accept the alliance', effects: { auctoritas: 20, dignitas: 10 } },
            { text: 'Politely decline', effects: { dignitas: 5 } }
          ], chance: 0.04 },
        { type: 'choice', title: 'Prosecution', desc: 'You have evidence to prosecute a corrupt official.',
          choices: [
            { text: 'Prosecute publicly', effects: { dignitas: 20, popularis: 15 }, risk: { chance: 0.3, penalty: { auctoritas: -20, dignitas: -10 }, desc: 'He has powerful friends!' } },
            { text: 'Sell evidence to enemies (+25 wealth)', effects: { pecunia: 25, dignitas: -15 } },
            { text: 'Destroy the evidence', effects: { auctoritas: 10 } }
          ], chance: 0.05 }
    ];

    const HISTORICAL_EVENTS = [
        { year: 133, title: 'Death of Tiberius Gracchus', desc: 'Tiberius Gracchus is beaten to death by senators. The Republic will never be the same.' },
        { year: 121, title: 'Death of Gaius Gracchus', desc: 'Gaius Gracchus dies fleeing his enemies. Reform movements crushed.' },
        { year: 107, title: 'Marius Elected Consul', desc: 'Gaius Marius becomes consul and opens the army to the landless poor.' },
        { year: 88, title: 'Sulla Marches on Rome', desc: 'For the first time, a Roman general marches legions against the city.' },
        { year: 82, title: 'Sulla\'s Proscriptions', desc: 'Sulla posts lists of enemies to be killed. Thousands die.' },
        { year: 73, title: 'Spartacus Revolt', desc: 'A gladiator leads a massive slave revolt threatening Italy.' },
        { year: 63, title: 'Catiline Conspiracy', desc: 'Cicero exposes Catiline\'s plot to overthrow the Republic.' },
        { year: 60, title: 'First Triumvirate', desc: 'Caesar, Pompey, and Crassus form a secret alliance.' },
        { year: 49, title: 'Caesar Crosses Rubicon', desc: '"The die is cast." Civil war begins.' },
        { year: 44, title: 'Assassination of Caesar', desc: 'On the Ides of March, Caesar falls beneath the daggers.' }
    ];

    let game = {
        year: 134, age: 17, name: '', family: null, currentOffice: 'none', officesHeld: [],
        stats: { dignitas: 50, auctoritas: 20, pecunia: 50, military: 0, popularis: 50 },
        relationships: { crassus: 50, pompey: 50, caesar: 50, cicero: 50, cato: 50 },
        enemies: [], phase: 'intro', militaryYears: 0, consulYears: [], actionsThisYear: 0, currentEvent: null
    };

    function updateDisplay() {
        document.getElementById('yearDisplay').textContent = game.year + ' BC';
        document.getElementById('ageDisplay').textContent = 'Age ' + game.age;
        document.getElementById('playerName').textContent = game.name;
        ['dignitas', 'auctoritas', 'pecunia', 'military', 'popularis'].forEach(stat => {
            const el = document.getElementById(stat);
            const box = document.getElementById(stat + 'Box');
            if (el) {
                el.textContent = Math.round(game.stats[stat]);
                box.classList.remove('danger', 'good');
                if (game.stats[stat] <= 20) box.classList.add('danger');
                else if (game.stats[stat] >= 80) box.classList.add('good');
            }
        });
        document.querySelectorAll('.career-office').forEach(el => {
            const office = el.dataset.office;
            el.classList.remove('achieved', 'current', 'available');
            if (game.officesHeld.includes(office)) el.classList.add('achieved');
            if (game.currentOffice === office) el.classList.add('current');
            else if (canRunForOffice(office)) el.classList.add('available');
        });
        const relDiv = document.getElementById('relationships');
        relDiv.innerHTML = Object.entries(game.relationships).map(([id, value]) => {
            const npc = NPCS[id];
            let status = value <= 20 ? 'hostile' : value <= 40 ? 'cold' : value >= 80 ? 'allied' : value >= 60 ? 'warm' : 'neutral';
            return `<div class="relationship"><span class="rel-name">${npc.name}</span><div class="rel-bar"><div class="rel-fill ${status}" style="width:${value}%"></div></div></div>`;
        }).join('');
    }

    function modifyStats(changes) {
        let changeText = [];
        for (let stat in changes) {
            if (game.stats.hasOwnProperty(stat)) {
                game.stats[stat] = Math.max(0, Math.min(100, game.stats[stat] + changes[stat]));
                changeText.push(`${stat}: ${changes[stat] > 0 ? '+' : ''}${changes[stat]}`);
            }
        }
        updateDisplay();
        return changeText.join(', ');
    }

    function modifyRelationship(npcId, amount) {
        if (game.relationships.hasOwnProperty(npcId)) {
            game.relationships[npcId] = Math.max(0, Math.min(100, game.relationships[npcId] + amount));
        }
        updateDisplay();
    }

    function canRunForOffice(office) {
        const o = OFFICES[office];
        if (!o || game.age < o.minAge) return false;
        if (o.requiresConsul && !game.officesHeld.includes('consul')) return false;
        if (game.officesHeld.includes(office) && office !== 'consul') return false;
        if (office === 'consul' && game.consulYears.some(y => game.year - y < 10)) return false;
        if (office !== 'military' && game.militaryYears < 10) return false;
        const prevOffice = Object.entries(OFFICES).find(([k, v]) => v.order === o.order - 1);
        if (prevOffice && !game.officesHeld.includes(prevOffice[0]) && office !== 'military') return false;
        return true;
    }

    function checkGameOver() {
        if (game.stats.dignitas <= 0) return { over: true, reason: 'disgrace', title: 'DISGRACE', desc: 'Your reputation is destroyed. You retire to obscurity.' };
        if (game.stats.pecunia <= 0) return { over: true, reason: 'bankrupt', title: 'BANKRUPTCY', desc: 'Your creditors seize everything. Ruined, you flee Rome.' };
        if (game.enemies.length >= 5) return { over: true, reason: 'assassinated', title: 'ASSASSINATION', desc: 'Too many enemies. You are found dead near the Forum.' };
        if (game.age >= 70) return { over: true, reason: 'age', title: 'A LIFE COMPLETED', desc: 'You have lived a long Roman life. What legacy do you leave?' };
        return { over: false };
    }

    function showIntro() {
        game.phase = 'intro';
        document.getElementById('contentArea').innerHTML = `
            <div class="intro-screen">
                <h2>The Path to Power</h2>
                <p>It is <strong>134 BC</strong>. The Roman Republic stands at a crossroads. You are 17 years old. Before you lies the <em>cursus honorum</em> ‚Äî the ladder of offices leading to the consulship and glory. Or perhaps to ruin.</p>
                <p><strong>Goal:</strong> Rise through military service, win elections, become Consul. Survive the politics of the Late Republic.</p>
                <p>Choose your family background:</p>
                <div class="family-choices" id="familyChoices">
                    ${FAMILIES.map(f => `
                        <div class="family-choice" onclick="selectFamily('${f.id}')" data-family="${f.id}">
                            <h4>${f.name}</h4>
                            <p>${f.desc}</p>
                            <div class="bonuses">${Object.entries(f.bonuses).map(([k,v]) => `${k}: ${v>0?'+':''}${v}`).join(', ')}</div>
                        </div>
                    `).join('')}
                </div>
                <button class="btn-primary" onclick="startGame()" id="startBtn" disabled>SELECT A BACKGROUND</button>
                <div class="historical-note">
                    <strong>Educational Note:</strong> The cursus honorum was the sequence of offices held by aspiring Roman politicians. Each had minimum age requirements. Bribery was common. Violence was not unknown.
                </div>
            </div>
        `;
    }

    function selectFamily(familyId) {
        game.family = FAMILIES.find(f => f.id === familyId);
        document.querySelectorAll('.family-choice').forEach(el => el.classList.toggle('selected', el.dataset.family === familyId));
        document.getElementById('startBtn').disabled = false;
        document.getElementById('startBtn').textContent = 'BEGIN YOUR CAREER';
    }

    function startGame() {
        if (!game.family) return;
        for (let stat in game.family.bonuses) {
            if (game.stats.hasOwnProperty(stat)) game.stats[stat] += game.family.bonuses[stat];
        }
        const praenomina = ['Marcus', 'Gaius', 'Lucius', 'Quintus', 'Publius'];
        const nomina = { patrician: ['Cornelius', 'Aemilius', 'Claudius'], plebeian_noble: ['Tullius', 'Sempronius', 'Licinius'], equestrian: ['Atticus', 'Balbus', 'Oppius'], novus: ['Tullius', 'Didius', 'Fufius'] };
        const cognomina = ['Rufus', 'Niger', 'Longus', 'Pulcher', 'Brutus'];
        game.name = praenomina[Math.floor(Math.random()*praenomina.length)] + ' ' + nomina[game.family.id][Math.floor(Math.random()*nomina[game.family.id].length)] + ' ' + cognomina[Math.floor(Math.random()*cognomina.length)];
        document.getElementById('careerTrack').classList.remove('hidden');
        document.getElementById('statsRow').classList.remove('hidden');
        document.getElementById('relationships').classList.remove('hidden');
        updateDisplay();
        showYearStart();
    }

    function showYearStart() {
        game.phase = 'year_start';
        game.actionsThisYear = 0;
        const historicalEvent = HISTORICAL_EVENTS.find(e => e.year === game.year);
        let historyHtml = historicalEvent ? `<div class="event-card" style="border-color:var(--wax-gold);"><div class="event-type">‚ö° Historical Event</div><div class="event-title">${historicalEvent.title}</div><div class="event-desc">${historicalEvent.desc}</div></div>` : '';
        document.getElementById('contentArea').innerHTML = `
            <div class="section-title">Year ${game.year} BC ‚Äî Age ${game.age}</div>
            ${historyHtml}
            <div class="year-summary">
                <h4>Your Situation</h4>
                <div class="summary-item"><span>Position:</span><span>${OFFICES[game.currentOffice].name}</span></div>
                <div class="summary-item"><span>Military Service:</span><span>${game.militaryYears}/10 years</span></div>
                <div class="summary-item"><span>Enemies:</span><span>${game.enemies.length}</span></div>
            </div>
            <button class="btn-primary" onclick="processYear()">Continue</button>
        `;
    }

    function processYear() {
        const event = RANDOM_EVENTS.filter(e => {
            if (e.requires) { for (let s in e.requires) if (game.stats[s] < e.requires[s]) return false; }
            return Math.random() < e.chance;
        })[0];
        if (event) showRandomEvent(event);
        else showYearActions();
    }

    function showRandomEvent(event) {
        game.phase = 'random_event';
        game.currentEvent = event;
        const content = document.getElementById('contentArea');
        if (event.type === 'good' || event.type === 'bad') {
            const changeText = modifyStats(event.effects);
            if (event.makeEnemy) {
                const npcId = Object.keys(NPCS)[Math.floor(Math.random() * Object.keys(NPCS).length)];
                modifyRelationship(npcId, -30);
                if (!game.enemies.includes(NPCS[npcId].name)) game.enemies.push(NPCS[npcId].name);
            }
            content.innerHTML = `
                <div class="event-card" style="border-color:${event.type === 'good' ? 'var(--success)' : 'var(--danger)'};">
                    <div class="event-type">${event.type === 'good' ? 'üåü Fortune' : '‚ö° Misfortune'}</div>
                    <div class="event-title">${event.title}</div>
                    <div class="event-desc">${event.desc}</div>
                    <div style="margin-top:10px;font-style:italic;color:${event.type === 'good' ? 'var(--success)' : 'var(--danger)'};">${changeText}</div>
                </div>
                <button class="btn-primary" onclick="showYearActions()">Continue</button>
            `;
        } else if (event.type === 'choice') {
            content.innerHTML = `
                <div class="event-card">
                    <div class="event-type">‚öñÔ∏è Decision Required</div>
                    <div class="event-title">${event.title}</div>
                    <div class="event-desc">${event.desc}</div>
                    <div class="choices">
                        ${event.choices.map((c, i) => {
                            let disabled = c.requires ? Object.entries(c.requires).some(([s,v]) => game.stats[s] < v) : false;
                            return `<button class="choice-btn" onclick="resolveEventChoice(${i})" ${disabled ? 'disabled' : ''}>${c.text}<span class="choice-effect">${Object.entries(c.effects).map(([k,v]) => `${k}: ${v > 0 ? '+' : ''}${v}`).join(', ')}</span></button>`;
                        }).join('')}
                    </div>
                </div>
            `;
        }
    }

    function resolveEventChoice(i) {
        const choice = game.currentEvent.choices[i];
        let resultText = modifyStats(choice.effects);
        let riskText = '';
        if (choice.risk && Math.random() < choice.risk.chance) {
            modifyStats(choice.risk.penalty);
            riskText = `<div style="color:var(--danger);margin-top:10px;">‚ö†Ô∏è ${choice.risk.desc}</div>`;
        }
        document.getElementById('contentArea').innerHTML = `
            <div class="event-card">
                <div class="event-type">Result</div>
                <div class="event-title">${choice.text}</div>
                <div style="font-style:italic;color:var(--ink-light);">${resultText}</div>
                ${riskText}
            </div>
            <button class="btn-primary" onclick="showYearActions()">Continue</button>
        `;
    }

    function showYearActions() {
        game.phase = 'year_actions';
        const status = checkGameOver();
        if (status.over) { showGameEnd(status); return; }
        let actionsHtml = '';
        if (game.currentOffice === 'none' && game.militaryYears < 10) {
            actionsHtml += `<div class="event-card"><div class="event-type">Military Service</div><div class="event-title">Serve in the Legions</div><div class="event-desc">You need <strong>${10 - game.militaryYears} more years</strong> of service before seeking office.</div><button class="btn-primary btn-success" onclick="doMilitaryService()">Serve This Year</button></div>`;
        }
        const availableOffices = Object.entries(OFFICES).filter(([id]) => canRunForOffice(id) && id !== 'none');
        if (availableOffices.length > 0 && game.militaryYears >= 10) {
            actionsHtml += `<div class="event-card"><div class="event-type">Elections</div><div class="event-title">Stand for Office</div><div class="choices">${availableOffices.map(([id, o]) => `<button class="choice-btn" onclick="startElection('${id}')"><strong>${o.name}</strong> (min age ${o.minAge})</button>`).join('')}</div></div>`;
        }
        if (game.currentOffice !== 'none' && game.currentOffice !== 'military') {
            actionsHtml += `<div class="event-card"><div class="event-type">Official Duties</div><div class="event-title">Serve as ${OFFICES[game.currentOffice].name}</div><button class="btn-primary" onclick="performDuties()">Perform Duties</button></div>`;
        }
        actionsHtml += `<div class="event-card"><div class="event-type">Politics</div><div class="event-title">Build Relationships</div><div class="choices">${Object.entries(NPCS).map(([id, npc]) => `<button class="choice-btn" onclick="networkWith('${id}')">Meet <strong>${npc.name}</strong><span class="choice-effect">${npc.desc} (${game.relationships[id]}%)</span></button>`).join('')}</div></div>`;
        actionsHtml += `<button class="btn-primary btn-secondary" onclick="endYear()" style="margin-top:15px;">End Year</button>`;
        document.getElementById('contentArea').innerHTML = `<div class="section-title">Year ${game.year} BC ‚Äî Actions</div>${actionsHtml}`;
    }

    function doMilitaryService() {
        game.militaryYears++;
        game.currentOffice = 'military';
        if (!game.officesHeld.includes('military')) game.officesHeld.push('military');
        const outcomes = [
            { desc: 'A quiet year on the frontier. You learn the legions\' ways.', effects: { military: 10, dignitas: 5 } },
            { desc: 'Your unit sees action. You acquit yourself well.', effects: { military: 15, dignitas: 10 } },
            { desc: 'A difficult campaign. Your commander is incompetent.', effects: { military: 8, dignitas: -5 } },
            { desc: 'You lead a successful mission. The men respect you.', effects: { military: 12, dignitas: 8, popularis: 5 } },
            { desc: 'Garrison duty. Boring but safe.', effects: { military: 8, pecunia: 5 } }
        ];
        const outcome = outcomes[Math.floor(Math.random() * outcomes.length)];
        const changeText = modifyStats(outcome.effects);
        document.getElementById('contentArea').innerHTML = `
            <div class="event-card"><div class="event-type">üó°Ô∏è Military Service ‚Äî Year ${game.militaryYears}/10</div><div class="event-title">Life in the Legions</div><div class="event-desc">${outcome.desc}</div><div style="margin-top:10px;font-style:italic;">${changeText}</div></div>
            <button class="btn-primary" onclick="endYear()">End Year</button>
        `;
    }

    function startElection(officeId) {
        game.phase = 'election';
        const office = OFFICES[officeId];
        game.currentElection = { office: officeId, support: Math.floor(game.stats.dignitas/3 + game.stats.popularis/4 + game.stats.auctoritas/4), spent: 0, opponents: [] };
        for (let i = 0; i < Math.min(office.slots || 2, 3); i++) {
            game.currentElection.opponents.push({ name: generateName(), support: 30 + Math.floor(Math.random() * 40), desc: ['Senator', 'Tribune', 'Equestrian', 'General'][Math.floor(Math.random() * 4)] });
        }
        showElectionUI();
    }

    function generateName() {
        const p = ['Marcus', 'Gaius', 'Lucius', 'Quintus', 'Publius', 'Gnaeus'];
        const n = ['Cornelius', 'Aemilius', 'Claudius', 'Valerius', 'Fabius', 'Tullius'];
        const c = ['Rufus', 'Niger', 'Crassus', 'Pulcher', 'Brutus', 'Metellus'];
        return p[Math.floor(Math.random()*p.length)] + ' ' + n[Math.floor(Math.random()*n.length)] + ' ' + c[Math.floor(Math.random()*c.length)];
    }

    function showElectionUI() {
        const el = game.currentElection, office = OFFICES[el.office];
        const all = [{ name: game.name, support: el.support, isPlayer: true }, ...el.opponents].sort((a, b) => b.support - a.support);
        document.getElementById('contentArea').innerHTML = `
            <div class="election-container">
                <div class="section-title">‚öñÔ∏è Election for ${office.name}</div>
                <p style="text-align:center;margin-bottom:15px;">Campaign to win! Spend money and influence.</p>
                <div class="candidates">${all.map(c => `<div class="candidate ${c.isPlayer ? 'player' : ''}"><div class="candidate-name">${c.name}</div><div class="candidate-support">${c.isPlayer ? 'YOU' : c.desc}</div><div class="vote-bar"><div class="vote-fill" style="width:${c.support}%"></div></div><div style="font-size:0.85rem;margin-top:5px;">${Math.round(c.support)}%</div></div>`).join('')}</div>
                <div class="campaign-actions">
                    <button class="campaign-btn" onclick="campaignAction('bribe')" ${game.stats.pecunia < 20 ? 'disabled' : ''}>üí∞ Bribe Voters<span class="cost">-20 Wealth, +15 Support</span></button>
                    <button class="campaign-btn" onclick="campaignAction('speech')" ${game.stats.popularis < 30 ? 'disabled' : ''}>üì£ Public Speech<span class="cost">Needs 30 Pop, +10 Support</span></button>
                    <button class="campaign-btn" onclick="campaignAction('favours')" ${game.stats.auctoritas < 30 ? 'disabled' : ''}>ü§ù Call Favours<span class="cost">-10 Influence, +12 Support</span></button>
                    <button class="campaign-btn" onclick="campaignAction('games')" ${game.stats.pecunia < 40 ? 'disabled' : ''}>üèüÔ∏è Fund Games<span class="cost">-40 Wealth, +20 Support</span></button>
                </div>
                <button class="btn-primary" onclick="resolveElection()" style="margin-top:15px;">Hold the Election</button>
            </div>
        `;
    }

    function campaignAction(action) {
        const el = game.currentElection;
        if (action === 'bribe') { game.stats.pecunia -= 20; el.support += 15; }
        else if (action === 'speech') { el.support += 10 + (Math.random() < 0.2 ? -8 : 0); }
        else if (action === 'favours') { game.stats.auctoritas -= 10; el.support += 12; }
        else if (action === 'games') { game.stats.pecunia -= 40; el.support += 20; game.stats.popularis += 10; }
        el.opponents.forEach(o => o.support += Math.floor(Math.random() * 8));
        updateDisplay();
        showElectionUI();
    }

    function resolveElection() {
        const el = game.currentElection, office = OFFICES[el.office];
        const finalSupport = el.support + Math.floor(Math.random() * 20) - 10;
        el.opponents.forEach(o => o.support += Math.floor(Math.random() * 15) - 5);
        const all = [{ name: game.name, support: finalSupport, isPlayer: true }, ...el.opponents].sort((a, b) => b.support - a.support);
        const winners = all.slice(0, office.slots || 1);
        const won = winners.some(w => w.isPlayer);
        if (won) {
            game.currentOffice = el.office;
            if (!game.officesHeld.includes(el.office)) game.officesHeld.push(el.office);
            if (el.office === 'consul') game.consulYears.push(game.year);
            modifyStats({ dignitas: 20, auctoritas: 15 });
        } else {
            modifyStats({ dignitas: -10 });
        }
        document.getElementById('contentArea').innerHTML = `
            <div class="election-container">
                <div class="section-title" style="color:${won ? 'var(--success)' : 'var(--danger)'};">${won ? 'üèÜ VICTORY!' : '‚ùå DEFEAT'}</div>
                <p style="text-align:center;">${won ? `You have been elected <strong>${office.name}</strong>!` : `You lost the election for ${office.name}.`}</p>
                <div class="candidates">${all.map((c,i) => `<div class="candidate ${c.isPlayer ? 'player' : ''} ${i < (office.slots||1) ? 'winner' : ''}"><div class="candidate-name">${c.name}</div><div class="vote-bar"><div class="vote-fill" style="width:${c.support}%"></div></div><div style="font-size:0.85rem;margin-top:5px;">${Math.round(c.support)}%</div></div>`).join('')}</div>
                <button class="btn-primary" onclick="${won ? 'endYear()' : 'showYearActions()'}">Continue</button>
            </div>
        `;
    }

    function performDuties() {
        const results = {
            quaestor: { desc: 'You manage the treasury competently.', effects: { dignitas: 8, auctoritas: 5, pecunia: 10 } },
            aedile: { desc: 'You organize games and maintain streets.', effects: { dignitas: 10, popularis: 15, pecunia: -15 } },
            praetor: { desc: 'You sit in judgment and command troops.', effects: { dignitas: 12, auctoritas: 10, military: 5 } },
            consul: { desc: 'You lead the Republic as its highest magistrate.', effects: { dignitas: 20, auctoritas: 15 } },
            censor: { desc: 'You conduct the census and judge morals.', effects: { dignitas: 25, auctoritas: 20 } }
        };
        const r = results[game.currentOffice] || { desc: 'You serve Rome.', effects: { dignitas: 5 } };
        const changeText = modifyStats(r.effects);
        document.getElementById('contentArea').innerHTML = `<div class="event-card"><div class="event-type">Official Duties</div><div class="event-title">Service as ${OFFICES[game.currentOffice].name}</div><div class="event-desc">${r.desc}</div><div style="margin-top:10px;font-style:italic;">${changeText}</div></div><button class="btn-primary" onclick="endYear()">End Year</button>`;
    }

    function networkWith(npcId) {
        const npc = NPCS[npcId];
        let chance = 0.5;
        if (npc.trait === 'greedy' && game.stats.pecunia > 60) chance += 0.2;
        if (npc.trait === 'proud' && game.stats.dignitas > 60) chance += 0.2;
        if (npc.trait === 'ambitious' && game.stats.auctoritas > 50) chance += 0.15;
        if (npc.trait === 'principled' && game.stats.dignitas > 70) chance += 0.2;
        if (npc.trait === 'stubborn') chance -= 0.15;
        let result;
        if (Math.random() < chance) {
            const gain = 10 + Math.floor(Math.random() * 10);
            modifyRelationship(npcId, gain);
            result = `<span style="color:var(--success);">Success! ${npc.name} warms to you. (+${gain})</span>`;
        } else {
            modifyRelationship(npcId, -3);
            result = `<span style="color:var(--danger);">Your overtures are rebuffed.</span>`;
        }
        document.getElementById('contentArea').innerHTML = `<div class="event-card"><div class="event-type">Political Networking</div><div class="event-title">Meeting ${npc.fullName}</div><div class="event-desc">${npc.desc}</div><div style="margin-top:15px;">${result}</div></div><button class="btn-primary" onclick="showYearActions()">Continue</button>`;
    }

    function endYear() {
        game.stats.pecunia -= 5 + game.officesHeld.length * 2;
        if (game.currentOffice !== 'none' && game.currentOffice !== 'military') game.currentOffice = 'none';
        if (game.militaryYears >= 10 && game.currentOffice === 'military') game.currentOffice = 'none';
        Object.keys(game.relationships).forEach(id => {
            if (game.relationships[id] > 50) game.relationships[id] -= 2;
            else if (game.relationships[id] < 50) game.relationships[id] += 1;
        });
        Object.entries(game.relationships).forEach(([id, val]) => {
            if (val <= 20 && Math.random() < 0.3 && !game.enemies.includes(NPCS[id].name)) game.enemies.push(NPCS[id].name);
        });
        game.year--;
        game.age++;
        updateDisplay();
        const status = checkGameOver();
        if (status.over) showGameEnd(status);
        else showYearStart();
    }

    function showGameEnd(status) {
        game.phase = 'end';
        const isVictory = status.reason === 'age' && game.officesHeld.includes('consul');
        let achievements = [];
        if (game.officesHeld.includes('consul')) achievements.push('Reached Consulship');
        if (game.officesHeld.includes('censor')) achievements.push('Became Censor');
        if (game.consulYears.length >= 2) achievements.push('Multiple Consulships');
        if (game.stats.dignitas >= 80) achievements.push('Highly Respected');
        if (game.enemies.length === 0) achievements.push('No Enemies');
        document.getElementById('contentArea').innerHTML = `
            <div class="end-screen ${isVictory ? 'victory' : 'defeat'}">
                <h2>${status.title}</h2>
                <p>${status.desc}</p>
                <div class="final-record">
                    <h4>Record of ${game.name}</h4>
                    <p><strong>Family:</strong> ${game.family.name}</p>
                    <p><strong>Years:</strong> ${game.age} (134 BC - ${game.year} BC)</p>
                    <p><strong>Highest Office:</strong> ${OFFICES[game.officesHeld[game.officesHeld.length-1] || 'none'].name}</p>
                    <p><strong>Offices:</strong> ${game.officesHeld.map(o => OFFICES[o].name).join(', ') || 'None'}</p>
                    <p><strong>Final Dignitas:</strong> ${Math.round(game.stats.dignitas)}</p>
                    <p><strong>Enemies:</strong> ${game.enemies.join(', ') || 'None'}</p>
                    ${achievements.length ? `<p><strong>Achievements:</strong> ${achievements.join(', ')}</p>` : ''}
                </div>
                <div class="historical-note"><strong>Note:</strong> The Late Republic saw many ambitious men climb the cursus honorum. Some achieved greatness. Many more were forgotten.</div>
                <button class="btn-primary" onclick="restartGame()">Play Again</button>
            </div>
        `;
    }

    function restartGame() {
        game = { year: 134, age: 17, name: '', family: null, currentOffice: 'none', officesHeld: [], stats: { dignitas: 50, auctoritas: 20, pecunia: 50, military: 0, popularis: 50 }, relationships: { crassus: 50, pompey: 50, caesar: 50, cicero: 50, cato: 50 }, enemies: [], phase: 'intro', militaryYears: 0, consulYears: [], actionsThisYear: 0, currentEvent: null };
        document.getElementById('careerTrack').classList.add('hidden');
        document.getElementById('statsRow').classList.add('hidden');
        document.getElementById('relationships').classList.add('hidden');
        showIntro();
    }

    showIntro();
    </script>
</body>
</html>
