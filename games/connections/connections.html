<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connections - Classicalia</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            display: flex;
        }

        .sidebar {
            width: 260px;
            background: white;
            border-right: 1px solid #e5e7eb;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }

        .logo-section {
            padding: 1.5rem 1.25rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #0066ff 0%, #4d94ff 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.1rem;
        }

        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
        }

        .nav-section {
            padding: 1rem 0.5rem;
        }

        .nav-title {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #9ca3af;
            letter-spacing: 0.05em;
            padding: 0 0.75rem;
            margin-bottom: 0.5rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.625rem 0.75rem;
            margin: 0.125rem 0;
            border-radius: 8px;
            color: #4b5563;
            font-size: 0.9rem;
            transition: all 0.15s ease;
            cursor: pointer;
            user-select: none;
        }

        .nav-item:hover {
            background: #f3f4f6;
            color: #1f2937;
        }

        .nav-item.active {
            background: #eef2ff;
            color: #0066ff;
            font-weight: 500;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .main-content {
            margin-left: 260px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .top-bar {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0.875rem 2rem;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .content-wrapper {
            flex: 1;
            overflow-y: auto;
        }

        .content-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }

        .section-content {
            display: none;
        }

        .section-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            background: white;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            padding: 2rem;
            margin-bottom: 1.5rem;
        }

        .card h3 {
            color: #1f2937;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        /* Header */
        .game-header {
            background: linear-gradient(135deg, #0066ff 0%, #4d94ff 100%);
            color: white;
            border: none;
            margin-bottom: 2rem;
        }

        .game-title {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .game-title h1 {
            color: white;
            margin: 0;
            font-size: 2rem;
        }

        .game-subtitle {
            opacity: 0.95;
            font-size: 1rem;
        }

        .date-display {
            font-size: 0.95rem;
            opacity: 0.9;
            margin-top: 0.5rem;
        }

        /* Mistakes tracker */
        .mistakes-tracker {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .mistakes-label {
            font-size: 0.95rem;
            color: #6b7280;
            font-weight: 600;
        }

        .mistakes-dots {
            display: flex;
            gap: 0.5rem;
        }

        .mistake-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #e5e7eb;
            transition: all 0.3s ease;
        }

        .mistake-dot.used {
            background: #ef4444;
            animation: mistakePulse 0.5s ease;
        }

        @keyframes mistakePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }

        /* Solved categories */
        .solved-categories {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .solved-category {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            animation: slideDown 0.5s ease;
            border: 3px solid;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .solved-category-name {
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.75rem;
        }

        .solved-category-words {
            font-size: 1.1rem;
            color: #4b5563;
            font-weight: 500;
        }

        /* Word grid */
        .word-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .word-tile {
            aspect-ratio: 1.5;
            background: #f9fafb;
            border: 3px solid #e5e7eb;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            cursor: pointer;
            transition: all 0.15s ease;
            user-select: none;
        }

        .word-tile:hover {
            background: #f3f4f6;
            border-color: #0066ff;
            transform: translateY(-2px);
        }

        .word-tile.selected {
            background: #dbeafe;
            border-color: #0066ff;
            color: #0066ff;
        }

        .word-tile.correct {
            animation: correctPulse 0.6s ease;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .word-tile.shake {
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Toast notification */
        .toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 1.5rem 2.5rem;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            font-size: 1.2rem;
            font-weight: 600;
            z-index: 1000;
            animation: toastIn 0.3s ease;
        }

        @keyframes toastIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .toast.warning {
            color: #f59e0b;
            border: 3px solid #f59e0b;
        }

        .toast.error {
            color: #dc2626;
            border: 3px solid #dc2626;
        }

        /* Controls */
        .game-controls {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .game-btn {
            padding: 0.875rem 2rem;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s ease;
            color: #374151;
        }

        .game-btn:hover:not(:disabled) {
            border-color: #0066ff;
            color: #0066ff;
            transform: translateY(-2px);
        }

        .game-btn.primary {
            background: #0066ff;
            border-color: #0066ff;
            color: white;
        }

        .game-btn.primary:hover:not(:disabled) {
            background: #0052cc;
            border-color: #0052cc;
            color: white;
        }

        .game-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }

        /* Victory screen */
        .victory-screen {
            text-align: center;
            padding: 3rem 2rem;
        }

        .victory-emoji {
            font-size: 5rem;
            margin-bottom: 1rem;
            animation: bounce 1s ease infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .victory-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .victory-subtitle {
            font-size: 1.1rem;
            color: #6b7280;
            margin-bottom: 2rem;
        }

        .share-btn {
            padding: 1rem 2.5rem;
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            color: white;
            cursor: pointer;
            transition: all 0.15s ease;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(34, 197, 94, 0.4);
        }

        /* Game over screen */
        .gameover-screen {
            text-align: center;
            padding: 3rem 2rem;
        }

        .gameover-emoji {
            font-size: 5rem;
            margin-bottom: 1rem;
        }

        .gameover-title {
            font-size: 2rem;
            font-weight: 700;
            color: #dc2626;
            margin-bottom: 0.5rem;
        }

        .gameover-subtitle {
            font-size: 1.1rem;
            color: #6b7280;
            margin-bottom: 2rem;
        }

        /* Instructions */
        .explanation-text {
            font-size: 1.05rem;
            line-height: 1.7;
            color: #4b5563;
            margin-bottom: 1rem;
        }

        .info-box {
            background: #f0f9ff;
            border-left: 4px solid #0284c7;
            padding: 1.5rem;
            border-radius: 0 8px 8px 0;
            margin: 1.5rem 0;
        }

        .info-box-title {
            font-weight: 700;
            color: #0c4a6e;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .info-box-text {
            color: #0c4a6e;
            line-height: 1.7;
        }

        .example-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .example-tile {
            aspect-ratio: 1.5;
            background: #f3f4f6;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 600;
            color: #4b5563;
        }

        .difficulty-legend {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .difficulty-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 8px;
        }

        .difficulty-color {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            border: 2px solid;
        }

        .difficulty-label {
            font-weight: 600;
            color: #1f2937;
        }

        .start-btn {
            padding: 1.25rem 2.5rem;
            background: linear-gradient(135deg, #0066ff 0%, #4d94ff 100%);
            border: none;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
            cursor: pointer;
            transition: all 0.15s ease;
            box-shadow: 0 4px 12px rgba(0, 102, 255, 0.3);
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 102, 255, 0.4);
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .word-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .game-title h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="logo-section">
            <div class="logo">
                <div class="logo-icon">C</div>
                <span class="logo-text">Classicalia</span>
            </div>
        </div>

        <nav class="nav-section">
            <div class="nav-title">Classicalia Games</div>
            <div class="nav-item active">
                <span class="nav-icon">ðŸŽ¯</span>
                <span>Connections</span>
            </div>
        </nav>
    </aside>

    <main class="main-content">
        <div class="top-bar"></div>
        <div class="content-wrapper">
            <div class="content-container">

                <!-- Game Section -->
                <div class="section-content active" id="game">
                    <div class="card game-header">
                        <div class="game-title">
                            <div style="font-size: 2.5rem;">ðŸŽ¯</div>
                            <div>
                                <h1>Connections</h1>
                                <p class="game-subtitle">Create four groups of four!</p>
                                <p class="date-display" id="date-display">Loading...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Mistakes tracker -->
                    <div class="mistakes-tracker">
                        <span class="mistakes-label">Mistakes remaining:</span>
                        <div class="mistakes-dots" id="mistakes-dots">
                            <div class="mistake-dot"></div>
                            <div class="mistake-dot"></div>
                            <div class="mistake-dot"></div>
                            <div class="mistake-dot"></div>
                        </div>
                    </div>

                    <!-- Feedback message -->
                    <div id="feedback-message" style="text-align: center; margin-bottom: 1rem; min-height: 30px;">
                        <span id="feedback-text" style="font-size: 1.1rem; font-weight: 600;"></span>
                    </div>

                    <!-- Solved categories container -->
                    <div class="solved-categories" id="solved-categories"></div>

                    <!-- Word grid -->
                    <div class="card">
                        <div class="word-grid" id="word-grid">
                            <!-- Words will be inserted here -->
                        </div>

                        <div class="game-controls">
                            <button class="game-btn" onclick="shuffleWords()" id="shuffle-btn">
                                ðŸ”€ Shuffle
                            </button>
                            <button class="game-btn" onclick="deselectAll()" id="deselect-btn">
                                Clear
                            </button>
                            <button class="game-btn primary" onclick="submitGuess()" id="submit-btn" disabled>
                                Submit
                            </button>
                        </div>
                    </div>

                    <!-- Victory screen (hidden initially) -->
                    <div class="card" id="victory-screen" style="display: none;">
                        <div class="victory-screen">
                            <div class="victory-emoji">ðŸŽ‰</div>
                            <h2 class="victory-title">Splendid!</h2>
                            <p class="victory-subtitle" id="victory-message">You found all four groups!</p>
                            <button class="share-btn" onclick="shareResults()">
                                ðŸ“‹ Share Results
                            </button>
                        </div>
                    </div>

                    <!-- Game over screen (hidden initially) -->
                    <div class="card" id="gameover-screen" style="display: none;">
                        <div class="gameover-screen">
                            <div class="gameover-emoji">ðŸ˜¢</div>
                            <h2 class="gameover-title">Game Over</h2>
                            <p class="gameover-subtitle">Better luck tomorrow!</p>
                            <div id="remaining-groups" style="text-align: left; margin-top: 2rem;"></div>
                            <button class="share-btn" onclick="shareResults()" style="background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); margin-top: 2rem;">
                                ðŸ“‹ Share Results
                            </button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <!-- Load puzzle data FIRST -->
    <script src="connections-november-2025.js"></script>

    <script>
        // Game state
        let gameState = {
            puzzle: null,
            selectedWords: [],
            solvedCategories: [],
            remainingWords: [],
            mistakes: 0,
            gameOver: false,
            gameWon: false,
            guesses: []
        };

        // Initialize game
        function initGame() {
            const today = new Date();
            const day = today.getDate();
            const month = today.toLocaleString('en-GB', { month: 'long' });
            const year = today.getFullYear();

            console.log('Looking for puzzle:', day, month, year);
            console.log('Available puzzles:', typeof connectionsNovember2025 !== 'undefined' ? connectionsNovember2025.length : 'NOT LOADED');

            // Find today's puzzle
            const puzzle = connectionsNovember2025.find(p => 
                p.day === day && p.month === month && p.year === year
            );

            if (!puzzle) {
                console.log('No puzzle found for today');
                alert(`No puzzle available for ${day} ${month} ${year}. Please check back later.`);
                return;
            }
            
            console.log('Puzzle found:', puzzle);

            // Set up game state
            gameState.puzzle = puzzle;
            gameState.selectedWords = [];
            gameState.solvedCategories = [];
            gameState.mistakes = 0;
            gameState.gameOver = false;
            gameState.gameWon = false;
            gameState.guesses = [];

            // Get all words from all categories
            const allWords = [];
            puzzle.categories.forEach(cat => {
                allWords.push(...cat.words);
            });

            // Shuffle words
            gameState.remainingWords = shuffleArray(allWords);

            // Update display
            updateDateDisplay();
            renderGrid();
            updateMistakes();
            
            // Clear solved categories and results screens
            document.getElementById('solved-categories').innerHTML = '';
            document.getElementById('victory-screen').style.display = 'none';
            document.getElementById('gameover-screen').style.display = 'none';
        }

        // Update date display
        function updateDateDisplay() {
            const { day, month, year } = gameState.puzzle;
            const dayWithSuffix = day + getDaySuffix(day);
            document.getElementById('date-display').textContent = `${dayWithSuffix} ${month} ${year}`;
        }

        function getDaySuffix(day) {
            if (day >= 11 && day <= 13) return 'th';
            switch (day % 10) {
                case 1: return 'st';
                case 2: return 'nd';
                case 3: return 'rd';
                default: return 'th';
            }
        }

        // Shuffle array
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Render word grid
        function renderGrid() {
            const grid = document.getElementById('word-grid');
            grid.innerHTML = '';

            gameState.remainingWords.forEach(word => {
                const tile = document.createElement('div');
                tile.className = 'word-tile';
                tile.textContent = word;
                tile.onclick = () => toggleWord(word);
                
                if (gameState.selectedWords.includes(word)) {
                    tile.classList.add('selected');
                }
                
                grid.appendChild(tile);
            });

            updateSubmitButton();
        }

        // Toggle word selection
        function toggleWord(word) {
            if (gameState.gameOver || gameState.gameWon) return;

            const index = gameState.selectedWords.indexOf(word);
            
            if (index > -1) {
                gameState.selectedWords.splice(index, 1);
            } else {
                if (gameState.selectedWords.length < 4) {
                    gameState.selectedWords.push(word);
                }
            }

            renderGrid();
        }

        // Deselect all
        function deselectAll() {
            gameState.selectedWords = [];
            renderGrid();
        }

        // Shuffle words
        function shuffleWords() {
            gameState.remainingWords = shuffleArray(gameState.remainingWords);
            renderGrid();
        }

        // Update submit button
        function updateSubmitButton() {
            const btn = document.getElementById('submit-btn');
            btn.disabled = gameState.selectedWords.length !== 4 || gameState.gameOver || gameState.gameWon;
        }

        // Submit guess
        function submitGuess() {
            if (gameState.selectedWords.length !== 4) return;
            if (gameState.gameOver || gameState.gameWon) return;

            const guess = [...gameState.selectedWords].sort();
            
            // Check if this exact guess was already tried
            const alreadyGuessed = gameState.guesses.some(g => 
                JSON.stringify(g.sort()) === JSON.stringify(guess)
            );

            if (alreadyGuessed) {
                showFeedback('Already tried!', 'error');
                return;
            }

            gameState.guesses.push(guess);

            // Check if it's a correct group
            const correctCategory = gameState.puzzle.categories.find(cat => {
                const catWords = [...cat.words].sort();
                return JSON.stringify(catWords) === JSON.stringify(guess);
            });

            if (correctCategory) {
                // Correct!
                handleCorrectGuess(correctCategory);
            } else {
                // Check if one away
                const oneAway = checkOneAway(guess);
                
                if (oneAway) {
                    showFeedback('One away...', 'warning');
                    // Don't increment mistakes for "one away"
                } else {
                    // Wrong guess - increment mistakes
                    gameState.mistakes++;
                    console.log('Mistakes now:', gameState.mistakes);
                    updateMistakes();
                    showFeedback('Incorrect', 'error');
                    
                    if (gameState.mistakes >= 4) {
                        setTimeout(() => endGame(false), 500);
                    }
                }
            }

            deselectAll();
        }

        // Check if guess is one away from correct
        function checkOneAway(guess) {
            for (const category of gameState.puzzle.categories) {
                if (gameState.solvedCategories.includes(category)) continue;
                
                let matches = 0;
                category.words.forEach(word => {
                    if (guess.includes(word)) matches++;
                });
                
                if (matches === 3) return true;
            }
            return false;
        }

        // Handle correct guess
        function handleCorrectGuess(category) {
            // First, move the correct words to the front of the array
            const correctWords = category.words;
            const otherWords = gameState.remainingWords.filter(w => !correctWords.includes(w));
            gameState.remainingWords = [...correctWords, ...otherWords];
            
            // Re-render to show visual rearrangement
            renderGrid();
            
            // Add visual feedback - color the correct tiles
            setTimeout(() => {
                const tiles = document.querySelectorAll('.word-tile');
                tiles.forEach(tile => {
                    if (category.words.includes(tile.textContent)) {
                        tile.classList.add('correct');
                        tile.style.background = category.color;
                        tile.style.borderColor = category.color;
                        tile.style.color = 'white';
                    }
                });
            }, 100);

            // Wait for animation, then update state
            setTimeout(() => {
                gameState.solvedCategories.push(category);
                
                // Remove words from grid
                category.words.forEach(word => {
                    const index = gameState.remainingWords.indexOf(word);
                    if (index > -1) {
                        gameState.remainingWords.splice(index, 1);
                    }
                });

                // Show solved category at top
                showSolvedCategory(category);
                
                // Re-render grid (removes the solved words)
                renderGrid();

                // Check if won
                if (gameState.solvedCategories.length === 4) {
                    setTimeout(() => endGame(true), 500);
                }
            }, 800);
        }

        // Show solved category
        function showSolvedCategory(category) {
            const container = document.getElementById('solved-categories');
            
            const div = document.createElement('div');
            div.className = 'solved-category';
            div.style.borderColor = category.color;
            
            div.innerHTML = `
                <div class="solved-category-name" style="color: ${category.color};">
                    ${category.name}
                </div>
                <div class="solved-category-words">
                    ${category.words.join(', ')}
                </div>
            `;
            
            container.appendChild(div);
        }

        // Show feedback
        function showFeedback(message, type) {
            // Create toast notification
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // Shake tiles on error
            if (type === 'error') {
                const tiles = document.querySelectorAll('.word-tile.selected');
                tiles.forEach(tile => {
                    tile.classList.add('shake');
                    setTimeout(() => tile.classList.remove('shake'), 500);
                });
            } else if (type === 'warning') {
                // Yellow flash for "one away"
                const tiles = document.querySelectorAll('.word-tile.selected');
                tiles.forEach(tile => {
                    tile.style.background = '#fef3c7';
                    tile.style.borderColor = '#f59e0b';
                    setTimeout(() => {
                        tile.style.background = '';
                        tile.style.borderColor = '';
                    }, 1000);
                });
            }
            
            // Remove toast after 1.5 seconds
            setTimeout(() => {
                toast.remove();
            }, 1500);
        }

        // Update mistakes display
        function updateMistakes() {
            const dots = document.querySelectorAll('.mistake-dot');
            console.log('Updating mistakes display. Current mistakes:', gameState.mistakes, 'Dots found:', dots.length);
            dots.forEach((dot, index) => {
                if (index < gameState.mistakes) {
                    dot.classList.add('used');
                } else {
                    dot.classList.remove('used');
                }
            });
        }

        // End game
        function endGame(won) {
            gameState.gameOver = true;
            gameState.gameWon = won;

            // Hide grid and controls
            document.getElementById('word-grid').parentElement.style.display = 'none';

            if (won) {
                document.getElementById('victory-screen').style.display = 'block';
                const mistakeText = gameState.mistakes === 0 ? 'without any mistakes!' :
                                   gameState.mistakes === 1 ? 'with 1 mistake.' :
                                   `with ${gameState.mistakes} mistakes.`;
                document.getElementById('victory-message').textContent = 
                    `You found all four groups ${mistakeText}`;
            } else {
                document.getElementById('gameover-screen').style.display = 'block';
                showRemainingGroups();
            }
        }

        // Show remaining groups on game over
        function showRemainingGroups() {
            const container = document.getElementById('remaining-groups');
            container.innerHTML = '<h3 style="margin-bottom: 1rem; color: #1f2937;">The answers were:</h3>';

            gameState.puzzle.categories.forEach(category => {
                if (!gameState.solvedCategories.includes(category)) {
                    const div = document.createElement('div');
                    div.className = 'solved-category';
                    div.style.borderColor = category.color;
                    div.style.marginBottom = '0.75rem';
                    
                    div.innerHTML = `
                        <div class="solved-category-name" style="color: ${category.color};">
                            ${category.name}
                        </div>
                        <div class="solved-category-words">
                            ${category.words.join(', ')}
                        </div>
                    `;
                    
                    container.appendChild(div);
                }
            });
        }

        // Share results
        function shareResults() {
            const { day, month, year } = gameState.puzzle;
            const date = `${day} ${month} ${year}`;
            
            let result = `Classicalia Connections\n${date}\n\n`;

            if (gameState.gameWon) {
                // Show colour squares for each solved category
                gameState.solvedCategories.forEach(category => {
                    const emoji = getColorEmoji(category.color);
                    result += `${emoji}${emoji}${emoji}${emoji}\n`;
                });
                result += `\nSolved with ${gameState.mistakes} mistake${gameState.mistakes !== 1 ? 's' : ''}!`;
            } else {
                result += `âŒâŒâŒâŒ\n`;
                result += `\nFailed after 4 mistakes.`;
            }

            // Copy to clipboard
            navigator.clipboard.writeText(result).then(() => {
                alert('Results copied to clipboard!');
            }).catch(() => {
                alert('Could not copy to clipboard. Here are your results:\n\n' + result);
            });
        }

        function getColorEmoji(color) {
            switch(color) {
                case '#22c55e': return 'ðŸŸ©';
                case '#eab308': return 'ðŸŸ¨';
                case '#3b82f6': return 'ðŸŸ¦';
                case '#8b5cf6': return 'ðŸŸª';
                default: return 'â¬œ';
            }
        }

        // Navigation (removed - no longer needed)

        // Sidebar navigation
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize game
            initGame();
        });
    </script>
</body>
</html>
