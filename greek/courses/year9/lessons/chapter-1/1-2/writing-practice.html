<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Writing Practice - Greek Alphabet - Classicalia</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <meta property="og:title" content="Writing Practice - Greek Alphabet - Classicalia">
    <meta property="og:description" content="Interactive writing practice for all 24 Greek letters.">
    <link rel="stylesheet" href="../../../css/shared-styles.css">
    <style>
        /* Additional styles for writing practice */
        .writing-intro {
            background: linear-gradient(135deg, #f0f7ff 0%, #ffffff 100%);
            padding: 2rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .writing-intro h2 {
            color: #0066ff;
            font-size: 2rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .writing-intro p {
            color: #555;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto 0.5rem;
        }

        /* Letter Selector */
        .letter-selector-section {
            background: white;
            padding: 1.5rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .letter-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
        }

        .letter-btn {
            padding: 0.5rem 1rem;
            background: #f0f7ff;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.2rem;
            font-family: 'GFS Neohellenic', 'Times New Roman', serif;
        }

        .letter-btn:hover {
            background: #e0f0ff;
            border-color: #0066ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 102, 255, 0.2);
        }

        .letter-btn.active {
            background: linear-gradient(135deg, #0066ff 0%, #4d94ff 100%);
            color: white;
            border-color: #0066ff;
            box-shadow: 0 4px 12px rgba(0, 102, 255, 0.3);
        }

        .letter-btn .letter-name {
            display: block;
            font-size: 0.7rem;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            margin-top: 0.2rem;
            opacity: 0.8;
        }

        /* Practice Canvas Area */
        .practice-area {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            margin-bottom: 2rem;
        }

        .canvas-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .canvas-box {
            text-align: center;
        }

        .canvas-box h4 {
            color: #333;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .canvas-box h4 .greek-display {
            color: #0066ff;
            font-family: 'GFS Neohellenic', 'Times New Roman', serif;
            font-size: 1.5rem;
        }

        .canvas-wrapper {
            position: relative;
            display: inline-block;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            background: white;
            transition: border-color 0.3s ease;
        }

        .canvas-wrapper.saved {
            border-color: #28a745;
        }

        canvas {
            display: block;
            cursor: crosshair;
            background: white;
        }

        /* Guide Overlay */
        .guide-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.2;
            transition: opacity 0.3s ease;
        }

        .guide-overlay.hidden {
            opacity: 0;
        }

        .guide-letter {
            font-size: 200px;
            color: #0066ff;
            font-family: 'GFS Neohellenic', 'Times New Roman', serif;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            user-select: none;
        }

        /* Controls */
        .canvas-controls {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-top: 1rem;
        }

        .control-btn {
            padding: 0.5rem 1rem;
            background: #f0f0f0;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .control-btn:hover {
            background: #e0e0e0;
            transform: translateY(-1px);
        }

        .control-btn.primary {
            background: linear-gradient(135deg, #28a745 0%, #218838 100%);
            color: white;
        }

        .control-btn.primary:hover {
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .control-btn.danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .control-btn.danger:hover {
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }

        /* Stroke Settings */
        .stroke-settings {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .setting-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .setting-group label {
            color: #666;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .color-picker {
            width: 40px;
            height: 40px;
            border: 2px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
        }

        .size-slider {
            width: 150px;
        }

        .size-value {
            background: #0066ff;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
            min-width: 30px;
            text-align: center;
        }

        /* Toggle Guide */
        .toggle-guide {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .toggle-switch {
            position: relative;
            width: 48px;
            height: 24px;
            background: #ddd;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle-switch.active {
            background: #0066ff;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(24px);
        }

        /* Tips Panel */
        .tips-panel {
            background: linear-gradient(135deg, #0066ff 0%, #4d94ff 100%);
            padding: 1.5rem;
            border-radius: 12px;
            color: white;
            margin-bottom: 2rem;
        }

        .tips-panel h4 {
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .tips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .tip-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .tip-item strong {
            display: block;
            margin-bottom: 0.3rem;
        }

        /* Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }
            
            #printSheet, #printSheet * {
                visibility: visible;
            }
            
            #printSheet {
                position: fixed;
                left: 0;
                top: 0;
                width: 100%;
            }
        }
        
        .print-sheet {
            display: none;
            background: white;
            padding: 20px;
            font-family: 'Times New Roman', serif;
        }
        
        @media print {
            .print-sheet {
                display: block !important;
            }
        }
        
        .print-header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }
        
        .print-header h2 {
            margin: 0;
            font-size: 24px;
        }
        
        .print-header .student-info {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .practice-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        .practice-box {
            border: 2px solid #ccc;
            height: 120px;
            position: relative;
            background: white;
        }
        
        .practice-box .guide-letter-print {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px;
            color: #e0e0e0;
            font-family: 'Times New Roman', serif;
        }
        
        .practice-box .guidelines {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }
        
        .practice-box .guideline {
            position: absolute;
            width: 100%;
            border-bottom: 1px dashed #d0d0d0;
        }
        
        .practice-box .guideline.top {
            top: 25%;
        }
        
        .practice-box .guideline.middle {
            top: 50%;
        }
        
        .practice-box .guideline.bottom {
            top: 75%;
        }
        
        .alphabet-practice-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .alphabet-box {
            border: 2px solid #ccc;
            padding: 10px;
            height: 150px;
            position: relative;
        }
        
        .alphabet-box .letter-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .alphabet-box .letter-display {
            display: flex;
            justify-content: space-around;
            margin-bottom: 10px;
        }
        
        .alphabet-box .letter-display span {
            font-size: 40px;
            color: #e0e0e0;
        }
        
        .alphabet-box .practice-lines {
            border-top: 1px solid #ccc;
            border-bottom: 1px solid #ccc;
            height: 60px;
            position: relative;
        }
        
        .alphabet-box .practice-lines::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            border-bottom: 1px dashed #d0d0d0;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .canvas-container {
                grid-template-columns: 1fr;
            }

            .stroke-settings {
                flex-direction: column;
                gap: 1rem;
            }

            .tips-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Background Shapes -->
    <div class="bg-shapes">
        <div class="shape shape1"></div>
        <div class="shape shape2"></div>
        <div class="shape shape3"></div>
    </div>

    <!-- Info Button -->
    <button class="info-btn" onclick="showInfoModal()">‚ÑπÔ∏è</button>

    <!-- Header -->
    <header>
        <h1 class="logo">
            <a href="../../../../../../index.html">Classicalia</a>
        </h1>
        <div class="subtitle">All things Classics, in one place</div>
        <div class="author">by Lawrence McNally</div>
    </header>

    <!-- Dashboard Layout -->
    <div class="dashboard-container">
        <div class="dashboard-grid">
            <!-- Left Sidebar -->
            <aside class="left-sidebar">
                <nav class="nav-section">
                    <div class="nav-title">Navigation</div>
                    <a href="../1-2/index.html" class="nav-link">‚Üê Back to Lesson 1.2</a>
                    <a href="../1-3/index.html" class="nav-link">‚Üí Next: Lesson 1.3</a>
                </nav>
                
                <nav class="nav-section">
                    <div class="nav-title">Additional Sites</div>
                    <div id="additional-sites-links"></div>
                </nav>
                
                <nav class="nav-section">
                    <div class="nav-title">Teaching Resources</div>
                    <div id="teaching-resources-links"></div>
                </nav>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <div class="app-container">
                    <div class="app-header">
                        <div class="app-greeting">Greek Letter Writing Practice</div>
                        <div class="lesson-nav">
                            <button onclick="window.location.href='../1-2/index.html'">‚Üê Back to Alphabet Lesson</button>
                        </div>
                    </div>

                    <!-- Introduction -->
                    <div class="writing-intro">
                        <h2>‚úçÔ∏è Master Greek Letter Writing</h2>
                        <p>Practice writing all 24 letters of the Greek alphabet with our interactive tool.</p>
                        <p>Use the guide overlay to help you learn proper letter formation!</p>
                    </div>

                    <!-- Tips Panel -->
                    <div class="tips-panel">
                        <h4>Writing Tips</h4>
                        <div class="tips-grid">
                            <div class="tip-item">
                                <strong>üéØ Start Simple</strong>
                                Begin with familiar letters like Œë, Œí, Œï
                            </div>
                            <div class="tip-item">
                                <strong>üìê Use Guidelines</strong>
                                The gray lines help with proportions
                            </div>
                            <div class="tip-item">
                                <strong>üîÑ Practice Repeatedly</strong>
                                Muscle memory is key to mastery
                            </div>
                            <div class="tip-item">
                                <strong>üëÅÔ∏è Toggle the Guide</strong>
                                Practice with and without the overlay
                            </div>
                        </div>
                    </div>

                    <!-- Letter Selector -->
                    <div class="letter-selector-section">
                        <h3 class="section-title">Select a Letter to Practice</h3>
                        <div class="letter-selector" id="letterSelector">
                            <!-- Letters will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Practice Area -->
                    <div class="practice-area">
                        <!-- Stroke Settings -->
                        <div class="stroke-settings">
                            <div class="setting-group">
                                <label>Pen Color:</label>
                                <input type="color" id="strokeColor" class="color-picker" value="#0066ff">
                            </div>
                            <div class="setting-group">
                                <label>Pen Size:</label>
                                <input type="range" id="strokeSize" class="size-slider" min="2" max="10" value="4">
                                <span class="size-value" id="sizeValue">4</span>
                            </div>
                            <div class="setting-group toggle-guide">
                                <label>Show Guide:</label>
                                <div class="toggle-switch active" id="guideToggle">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Canvas Container -->
                        <div class="canvas-container" id="canvasContainer">
                            <div class="canvas-box">
                                <h4>Uppercase <span class="greek-display" id="upperLabel">Œë</span></h4>
                                <div class="canvas-wrapper" id="upperWrapper">
                                    <canvas id="upperCanvas" width="300" height="300"></canvas>
                                    <div class="guide-overlay" id="upperGuide">
                                        <div class="guide-letter" id="upperGuideLetter">Œë</div>
                                    </div>
                                </div>
                                <div class="canvas-controls">
                                    <button class="control-btn" onclick="undoStroke('upper')">‚Ü∂ Undo</button>
                                    <button class="control-btn danger" onclick="clearCanvas('upper')">üóëÔ∏è Clear</button>
                                    <button class="control-btn primary" onclick="saveCanvas('upper')">üíæ Save</button>
                                </div>
                            </div>

                            <div class="canvas-box">
                                <h4>Lowercase <span class="greek-display" id="lowerLabel">Œ±</span></h4>
                                <div class="canvas-wrapper" id="lowerWrapper">
                                    <canvas id="lowerCanvas" width="300" height="300"></canvas>
                                    <div class="guide-overlay" id="lowerGuide">
                                        <div class="guide-letter" id="lowerGuideLetter">Œ±</div>
                                    </div>
                                </div>
                                <div class="canvas-controls">
                                    <button class="control-btn" onclick="undoStroke('lower')">‚Ü∂ Undo</button>
                                    <button class="control-btn danger" onclick="clearCanvas('lower')">üóëÔ∏è Clear</button>
                                    <button class="control-btn primary" onclick="saveCanvas('lower')">üíæ Save</button>
                                </div>
                            </div>

                            <!-- Extra box for final sigma -->
                            <div class="canvas-box" id="finalSigmaBox" style="display: none;">
                                <h4>Final Sigma <span class="greek-display" id="finalLabel">œÇ</span></h4>
                                <div class="canvas-wrapper" id="finalWrapper">
                                    <canvas id="finalCanvas" width="300" height="300"></canvas>
                                    <div class="guide-overlay" id="finalGuide">
                                        <div class="guide-letter" id="finalGuideLetter">œÇ</div>
                                    </div>
                                </div>
                                <div class="canvas-controls">
                                    <button class="control-btn" onclick="undoStroke('final')">‚Ü∂ Undo</button>
                                    <button class="control-btn danger" onclick="clearCanvas('final')">üóëÔ∏è Clear</button>
                                    <button class="control-btn primary" onclick="saveCanvas('final')">üíæ Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Right Sidebar -->
            <aside class="right-sidebar">
                <!-- Progress Widget -->
                <div class="progress-widget">
                    <h3>Practice Progress</h3>
                    <div class="progress-stats">
                        <div style="text-align: center; padding: 1rem;">
                            <div style="font-size: 2rem; color: #0066ff; font-weight: bold;" id="progressCount">0/24</div>
                            <div style="color: #666; margin-top: 0.5rem;">Letters Practiced</div>
                        </div>
                    </div>
                    <div class="checklist-items" id="practicedList" style="max-height: 300px; overflow-y: auto;">
                        <!-- Practiced letters will appear here -->
                    </div>
                </div>

                <!-- Current Letter Info -->
                <div class="widget">
                    <h3>Current Letter</h3>
                    <div id="letterInfo" style="padding: 1rem;">
                        <div style="text-align: center; font-family: 'GFS Neohellenic', serif; font-size: 3rem; color: #0066ff; margin-bottom: 0.5rem;">
                            <span id="currentUpper">Œë</span> <span id="currentLower">Œ±</span>
                        </div>
                        <div style="text-align: center; font-size: 1.2rem; color: #333; margin-bottom: 0.5rem;" id="currentName">Alpha</div>
                        <div style="text-align: center; color: #666;" id="currentSound">Pronounced: a (as in father)</div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="widget">
                    <h3>Quick Actions</h3>
                    <div style="padding: 1rem;">
                        <button class="control-btn primary" style="width: 100%; margin-bottom: 0.5rem;" onclick="downloadAll()">
                            üì• Download All Practice
                        </button>
                        <button class="control-btn" style="width: 100%; margin-bottom: 0.5rem;" onclick="resetProgress()">
                            üîÑ Reset Progress
                        </button>
                        <button class="control-btn" style="width: 100%; margin-bottom: 0.5rem;" onclick="printCurrentLetter()">
                            üñ®Ô∏è Print Current Letter Sheet
                        </button>
                        <button class="control-btn" style="width: 100%;" onclick="printFullAlphabet()">
                            üìÑ Print Full Alphabet Sheet
                        </button>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Info Modal -->
    <div id="infoModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeInfoModal()">&times;</span>
            <div class="modal-header">
                <h2>Writing Practice Guide</h2>
            </div>
            <div class="modal-body">
                <p>Practice writing Greek letters with this interactive tool!</p>
                <ul>
                    <li>Select any letter from the alphabet</li>
                    <li>Use your mouse or touch to draw</li>
                    <li>Toggle the guide overlay for help</li>
                    <li>Save your practice for each letter</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Print Sheets (Hidden, only shown when printing) -->
    <div id="printSheet" class="print-sheet"></div>

    <!-- JavaScript -->
    <script src="../../../js/common-data.js"></script>
    <script>
        // Greek alphabet data with pronunciation
        const greekAlphabet = [
            { upper: 'Œë', lower: 'Œ±', name: 'Alpha', sound: 'a (as in father)' },
            { upper: 'Œí', lower: 'Œ≤', name: 'Beta', sound: 'b' },
            { upper: 'Œì', lower: 'Œ≥', name: 'Gamma', sound: 'g (hard, as in go)' },
            { upper: 'Œî', lower: 'Œ¥', name: 'Delta', sound: 'd' },
            { upper: 'Œï', lower: 'Œµ', name: 'Epsilon', sound: 'e (short, as in pet)' },
            { upper: 'Œñ', lower: 'Œ∂', name: 'Zeta', sound: 'zd or dz' },
            { upper: 'Œó', lower: 'Œ∑', name: 'Eta', sound: 'e (long, as in they)' },
            { upper: 'Œò', lower: 'Œ∏', name: 'Theta', sound: 'th (as in thin)' },
            { upper: 'Œô', lower: 'Œπ', name: 'Iota', sound: 'i (as in machine)' },
            { upper: 'Œö', lower: 'Œ∫', name: 'Kappa', sound: 'k' },
            { upper: 'Œõ', lower: 'Œª', name: 'Lambda', sound: 'l' },
            { upper: 'Œú', lower: 'Œº', name: 'Mu', sound: 'm' },
            { upper: 'Œù', lower: 'ŒΩ', name: 'Nu', sound: 'n' },
            { upper: 'Œû', lower: 'Œæ', name: 'Xi', sound: 'x or ks' },
            { upper: 'Œü', lower: 'Œø', name: 'Omicron', sound: 'o (short, as in pot)' },
            { upper: 'Œ†', lower: 'œÄ', name: 'Pi', sound: 'p' },
            { upper: 'Œ°', lower: 'œÅ', name: 'Rho', sound: 'r (rolled)' },
            { upper: 'Œ£', lower: 'œÉ', lowerFinal: 'œÇ', name: 'Sigma', sound: 's' },
            { upper: 'Œ§', lower: 'œÑ', name: 'Tau', sound: 't' },
            { upper: 'Œ•', lower: 'œÖ', name: 'Upsilon', sound: 'u/y (as in French u)' },
            { upper: 'Œ¶', lower: 'œÜ', name: 'Phi', sound: 'ph or f' },
            { upper: 'Œß', lower: 'œá', name: 'Chi', sound: 'ch (as in loch)' },
            { upper: 'Œ®', lower: 'œà', name: 'Psi', sound: 'ps' },
            { upper: 'Œ©', lower: 'œâ', name: 'Omega', sound: 'o (long, as in home)' }
        ];

        // Canvas state
        let currentLetter = greekAlphabet[0];
        let isDrawing = false;
        let strokes = { upper: [], lower: [], final: [] };
        let currentStroke = [];
        let practicedLetters = JSON.parse(localStorage.getItem('practicedGreekLetters') || '[]');

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadCommonData();
            initializeLetterSelector();
            initializeCanvases();
            initializeControls();
            updateProgressDisplay();
            updateLetterInfo();
        });

        function initializeLetterSelector() {
            const selector = document.getElementById('letterSelector');
            greekAlphabet.forEach((letter, index) => {
                const btn = document.createElement('button');
                btn.className = 'letter-btn';
                if (index === 0) btn.classList.add('active');
                
                // Check if already practiced
                if (practicedLetters.includes(letter.name)) {
                    btn.style.borderColor = '#28a745';
                }
                
                // Display different for Sigma
                const lowerDisplay = letter.lowerFinal ? `${letter.lower}/${letter.lowerFinal}` : letter.lower;
                
                btn.innerHTML = `
                    ${letter.upper} ${lowerDisplay}
                    <span class="letter-name">${letter.name}</span>
                `;
                btn.onclick = () => selectLetter(letter, btn);
                selector.appendChild(btn);
            });
        }

        function selectLetter(letter, btn) {
            currentLetter = letter;
            
            // Update active button
            document.querySelectorAll('.letter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Show/hide final sigma box
            const finalSigmaBox = document.getElementById('finalSigmaBox');
            const canvasContainer = document.getElementById('canvasContainer');
            
            if (letter.name === 'Sigma') {
                finalSigmaBox.style.display = 'block';
                // Adjust grid to show 3 boxes for Sigma
                canvasContainer.style.gridTemplateColumns = 'repeat(3, 1fr)';
            } else {
                finalSigmaBox.style.display = 'none';
                // Reset to 2 boxes for other letters
                canvasContainer.style.gridTemplateColumns = '1fr 1fr';
            }
            
            // Update displays
            updateLetterInfo();
            
            // Clear all canvases
            clearCanvas('upper');
            clearCanvas('lower');
            if (letter.name === 'Sigma') {
                clearCanvas('final');
            }
            
            // Reset wrapper borders
            document.getElementById('upperWrapper').classList.remove('saved');
            document.getElementById('lowerWrapper').classList.remove('saved');
            if (letter.name === 'Sigma') {
                document.getElementById('finalWrapper').classList.remove('saved');
            }
        }

        function updateLetterInfo() {
            // Update canvas labels
            document.getElementById('upperLabel').textContent = currentLetter.upper;
            document.getElementById('lowerLabel').textContent = currentLetter.lower;
            document.getElementById('upperGuideLetter').textContent = currentLetter.upper;
            document.getElementById('lowerGuideLetter').textContent = currentLetter.lower;
            
            // Update final sigma if needed
            if (currentLetter.name === 'Sigma') {
                document.getElementById('finalLabel').textContent = currentLetter.lowerFinal;
                document.getElementById('finalGuideLetter').textContent = currentLetter.lowerFinal;
            }
            
            // Update sidebar info
            document.getElementById('currentUpper').textContent = currentLetter.upper;
            const lowerDisplay = currentLetter.lowerFinal ? 
                `${currentLetter.lower}/${currentLetter.lowerFinal}` : 
                currentLetter.lower;
            document.getElementById('currentLower').textContent = lowerDisplay;
            document.getElementById('currentName').textContent = currentLetter.name;
            document.getElementById('currentSound').textContent = 'Pronounced: ' + currentLetter.sound;
        }

        function initializeCanvases() {
            ['upper', 'lower', 'final'].forEach(type => {
                const canvas = document.getElementById(`${type}Canvas`);
                if (!canvas) return; // Skip if canvas doesn't exist (final sigma)
                
                const ctx = canvas.getContext('2d');
                
                // Mouse events
                canvas.addEventListener('mousedown', (e) => startDrawing(e, type));
                canvas.addEventListener('mousemove', (e) => draw(e, type));
                canvas.addEventListener('mouseup', () => stopDrawing(type));
                canvas.addEventListener('mouseleave', () => stopDrawing(type));
                
                // Touch events
                canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const rect = canvas.getBoundingClientRect();
                    const mouseEvent = {
                        clientX: touch.clientX,
                        clientY: touch.clientY
                    };
                    startDrawing(mouseEvent, type);
                });
                
                canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const rect = canvas.getBoundingClientRect();
                    const mouseEvent = {
                        clientX: touch.clientX,
                        clientY: touch.clientY
                    };
                    draw(mouseEvent, type);
                });
                
                canvas.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    stopDrawing(type);
                });
                
                drawGuidelines(ctx);
            });
        }

        function drawGuidelines(ctx) {
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            
            // Horizontal lines (baseline and cap height)
            ctx.beginPath();
            ctx.moveTo(0, 75);
            ctx.lineTo(300, 75);
            ctx.moveTo(0, 225);
            ctx.lineTo(300, 225);
            ctx.stroke();
            
            // Vertical center line
            ctx.beginPath();
            ctx.moveTo(150, 0);
            ctx.lineTo(150, 300);
            ctx.stroke();
            
            ctx.setLineDash([]);
        }

        function startDrawing(e, type) {
            isDrawing = true;
            currentStroke = [];
            
            const canvas = document.getElementById(`${type}Canvas`);
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            currentStroke.push({ x, y });
        }

        function draw(e, type) {
            if (!isDrawing) return;
            
            const canvas = document.getElementById(`${type}Canvas`);
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            ctx.strokeStyle = document.getElementById('strokeColor').value;
            ctx.lineWidth = document.getElementById('strokeSize').value;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            ctx.beginPath();
            ctx.moveTo(currentStroke[currentStroke.length - 1].x, currentStroke[currentStroke.length - 1].y);
            ctx.lineTo(x, y);
            ctx.stroke();
            
            currentStroke.push({ x, y });
        }

        function stopDrawing(type) {
            if (!isDrawing) return;
            isDrawing = false;
            
            if (currentStroke.length > 0) {
                strokes[type].push({
                    points: [...currentStroke],
                    color: document.getElementById('strokeColor').value,
                    size: document.getElementById('strokeSize').value
                });
            }
        }

        function undoStroke(type) {
            if (strokes[type].length === 0) return;
            strokes[type].pop();
            redrawCanvas(type);
        }

        function clearCanvas(type) {
            const canvas = document.getElementById(`${type}Canvas`);
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawGuidelines(ctx);
            strokes[type] = [];
        }

        function redrawCanvas(type) {
            const canvas = document.getElementById(`${type}Canvas`);
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawGuidelines(ctx);
            
            strokes[type].forEach(stroke => {
                ctx.strokeStyle = stroke.color;
                ctx.lineWidth = stroke.size;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                
                ctx.beginPath();
                stroke.points.forEach((point, index) => {
                    if (index === 0) {
                        ctx.moveTo(point.x, point.y);
                    } else {
                        ctx.lineTo(point.x, point.y);
                    }
                });
                ctx.stroke();
            });
        }

        function saveCanvas(type) {
            // Add to practiced letters if not already there
            if (!practicedLetters.includes(currentLetter.name)) {
                practicedLetters.push(currentLetter.name);
                localStorage.setItem('practicedGreekLetters', JSON.stringify(practicedLetters));
                
                // Update button color
                document.querySelectorAll('.letter-btn').forEach((btn, index) => {
                    if (greekAlphabet[index].name === currentLetter.name) {
                        btn.style.borderColor = '#28a745';
                    }
                });
            }
            
            // Visual feedback
            const wrapper = document.getElementById(`${type}Wrapper`);
            wrapper.classList.add('saved');
            
            // Save canvas image
            const canvas = document.getElementById(`${type}Canvas`);
            const imageData = canvas.toDataURL();
            localStorage.setItem(`greek_${currentLetter.name}_${type}`, imageData);
            
            updateProgressDisplay();
        }

        function initializeControls() {
            // Stroke size slider
            const sizeSlider = document.getElementById('strokeSize');
            const sizeValue = document.getElementById('sizeValue');
            sizeSlider.addEventListener('input', () => {
                sizeValue.textContent = sizeSlider.value;
            });
            
            // Guide toggle
            const guideToggle = document.getElementById('guideToggle');
            guideToggle.addEventListener('click', () => {
                guideToggle.classList.toggle('active');
                const guides = document.querySelectorAll('.guide-overlay');
                guides.forEach(guide => {
                    guide.classList.toggle('hidden');
                });
            });
        }

        function updateProgressDisplay() {
            const count = practicedLetters.length;
            document.getElementById('progressCount').textContent = `${count}/24`;
            
            const list = document.getElementById('practicedList');
            list.innerHTML = '';
            
            greekAlphabet.forEach(letter => {
                if (practicedLetters.includes(letter.name)) {
                    const item = document.createElement('div');
                    item.className = 'checklist-row';
                    item.innerHTML = `
                        <div class="checklist-item" style="color: #28a745;">
                            ‚úì ${letter.upper} ${letter.lower} - ${letter.name}
                        </div>
                    `;
                    list.appendChild(item);
                }
            });
        }

        function resetProgress() {
            if (confirm('This will clear all your practice progress. Are you sure?')) {
                practicedLetters = [];
                localStorage.removeItem('practicedGreekLetters');
                
                // Reset all button colors
                document.querySelectorAll('.letter-btn').forEach(btn => {
                    btn.style.borderColor = '#e0e0e0';
                });
                
                // Clear saved images
                greekAlphabet.forEach(letter => {
                    localStorage.removeItem(`greek_${letter.name}_upper`);
                    localStorage.removeItem(`greek_${letter.name}_lower`);
                });
                
                updateProgressDisplay();
            }
        }

        function downloadAll() {
            alert('Download feature would export all your practice sheets as images!');
        }

        function printCurrentLetter() {
            const printSheet = document.getElementById('printSheet');
            
            // Handle Sigma specially with three forms
            if (currentLetter.name === 'Sigma') {
                printSheet.innerHTML = `
                    <div class="print-header">
                        <h2>Greek Letter Practice: ${currentLetter.name}</h2>
                        <div class="student-info">
                            <span>Name: _______________________</span>
                            <span>Date: _______________________</span>
                            <span>Class: _______________________</span>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="display: inline-block; text-align: left;">
                            <h3>Letter: ${currentLetter.upper} ${currentLetter.lower}/${currentLetter.lowerFinal} (${currentLetter.name})</h3>
                            <p>Pronunciation: ${currentLetter.sound}</p>
                            <p style="color: #666; font-size: 14px;">Note: œÉ is used at the beginning/middle of words, œÇ at the end</p>
                        </div>
                    </div>
                    
                    <h4 style="margin-top: 30px;">Uppercase: ${currentLetter.upper}</h4>
                    <div class="practice-grid">
                        ${Array(6).fill('').map(() => `
                            <div class="practice-box">
                                <div class="guide-letter-print">${currentLetter.upper}</div>
                                <div class="guidelines">
                                    <div class="guideline top"></div>
                                    <div class="guideline middle"></div>
                                    <div class="guideline bottom"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <h4 style="margin-top: 30px;">Lowercase (initial/medial): ${currentLetter.lower}</h4>
                    <div class="practice-grid">
                        ${Array(6).fill('').map(() => `
                            <div class="practice-box">
                                <div class="guide-letter-print">${currentLetter.lower}</div>
                                <div class="guidelines">
                                    <div class="guideline top"></div>
                                    <div class="guideline middle"></div>
                                    <div class="guideline bottom"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <h4 style="margin-top: 30px;">Lowercase (final): ${currentLetter.lowerFinal}</h4>
                    <div class="practice-grid">
                        ${Array(6).fill('').map(() => `
                            <div class="practice-box">
                                <div class="guide-letter-print">${currentLetter.lowerFinal}</div>
                                <div class="guidelines">
                                    <div class="guideline top"></div>
                                    <div class="guideline middle"></div>
                                    <div class="guideline bottom"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="margin-top: 30px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <strong>Teacher's Notes:</strong> _________________________________________________
                    </div>
                `;
            } else {
                // Original code for other letters
                printSheet.innerHTML = `
                    <div class="print-header">
                        <h2>Greek Letter Practice: ${currentLetter.name}</h2>
                        <div class="student-info">
                            <span>Name: _______________________</span>
                            <span>Date: _______________________</span>
                            <span>Class: _______________________</span>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="display: inline-block; text-align: left;">
                            <h3>Letter: ${currentLetter.upper} ${currentLetter.lower} (${currentLetter.name})</h3>
                            <p>Pronunciation: ${currentLetter.sound}</p>
                            <p style="color: #666; font-size: 14px;">Trace the gray letters, then practice writing your own</p>
                        </div>
                    </div>
                    
                    <h4 style="margin-top: 30px;">Uppercase: ${currentLetter.upper}</h4>
                    <div class="practice-grid">
                        ${Array(8).fill('').map(() => `
                            <div class="practice-box">
                                <div class="guide-letter-print">${currentLetter.upper}</div>
                                <div class="guidelines">
                                    <div class="guideline top"></div>
                                    <div class="guideline middle"></div>
                                    <div class="guideline bottom"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <h4 style="margin-top: 30px;">Lowercase: ${currentLetter.lower}</h4>
                    <div class="practice-grid">
                        ${Array(8).fill('').map(() => `
                            <div class="practice-box">
                                <div class="guide-letter-print">${currentLetter.lower}</div>
                                <div class="guidelines">
                                    <div class="guideline top"></div>
                                    <div class="guideline middle"></div>
                                    <div class="guideline bottom"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="margin-top: 30px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <strong>Teacher's Notes:</strong> _________________________________________________
                    </div>
                `;
            }
            
            window.print();
        }

        function printFullAlphabet(page = 1) {
            const printSheet = document.getElementById('printSheet');
            
            // Split alphabet into two pages
            const lettersPerPage = 15;
            const startIndex = (page - 1) * lettersPerPage;
            const endIndex = Math.min(startIndex + lettersPerPage, greekAlphabet.length);
            const lettersForPage = greekAlphabet.slice(startIndex, endIndex);
            
            // Create full alphabet practice sheet
            printSheet.innerHTML = `
                <div class="print-header">
                    <h2>Greek Alphabet Practice Sheet - Page ${page} of 2</h2>
                    <div class="student-info">
                        <span>Name: _______________________</span>
                        <span>Date: _______________________</span>
                        <span>Class: _______________________</span>
                    </div>
                </div>
                
                <p style="text-align: center; color: #666; margin: 15px 0;">
                    Practice writing each letter of the Greek alphabet. Trace the gray letters first.
                    ${page === 1 ? '(Letters Œë - Œü)' : '(Letters Œ† - Œ©)'}
                </p>
                
                <div class="alphabet-practice-grid">
                    ${lettersForPage.map(letter => `
                        <div class="alphabet-box">
                            <div class="letter-label">${letter.name}</div>
                            <div class="letter-display">
                                <span>${letter.upper}</span>
                                <span style="${letter.name === 'Sigma' ? 'font-size: 30px;' : ''}">
                                    ${letter.lowerFinal ? `${letter.lower}/${letter.lowerFinal}` : letter.lower}
                                </span>
                            </div>
                            <div class="practice-lines"></div>
                        </div>
                    `).join('')}
                </div>
                
                ${page === 1 ? `
                    <div style="margin-top: 30px; text-align: center; page-break-inside: avoid;">
                        <p style="font-size: 14px; color: #666;">
                            Continue to Page 2 for letters Œ† - Œ©
                        </p>
                    </div>
                ` : `
                    <div style="margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 8px; page-break-inside: avoid;">
                        <strong>Progress Notes:</strong><br>
                        <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; margin-top: 10px; font-size: 12px;">
                            ${greekAlphabet.map(letter => `
                                <label>
                                    <input type="checkbox" style="margin-right: 3px;">
                                    ${letter.name}
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `}
            `;
            
            window.print();
            
            // Ask if they want to print the second page
            if (page === 1) {
                setTimeout(() => {
                    if (confirm('Would you like to print Page 2 (letters Œ† - Œ©)?')) {
                        printFullAlphabet(2);
                    }
                }, 500);
            }
        }

        function printPractice() {
            window.print();
        }

        function showInfoModal() {
            document.getElementById('infoModal').style.display = 'block';
        }

        function closeInfoModal() {
            document.getElementById('infoModal').style.display = 'none';
        }
    </script>
</body>
</html>
