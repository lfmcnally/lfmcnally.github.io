<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latin Grammar Practice - Classicalia</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 2rem 1rem 2rem;
        }

        .header-content {
            background: linear-gradient(135deg, #0066ff 0%, #0052cc 100%);
            border-radius: 24px;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
            box-shadow: 0 8px 24px rgba(0, 102, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .header-content::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0066ff;
            font-weight: 700;
            font-size: 2rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            z-index: 1;
            cursor: pointer;
            text-decoration: none;
        }

        .header-title {
            font-size: 2rem;
            font-weight: 700;
            color: white;
            z-index: 1;
        }

        .header-subtitle {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.9);
            z-index: 1;
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem 2rem 2rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            background: white;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid #e5e7eb;
        }

        .tab-btn:hover {
            border-color: #0066ff;
            color: #0066ff;
        }

        .tab-btn.active {
            background: #0066ff;
            color: white;
            border-color: #0066ff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Panel */
        .panel {
            background: white;
            border-radius: 16px;
            border: 1px solid #e5e7eb;
            padding: 2rem;
            margin-bottom: 1.5rem;
        }

        .panel h2 {
            color: #1f2937;
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
        }

        /* Selectors */
        .selector-row {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }

        .selector-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .selector-group label {
            font-weight: 600;
            color: #6b7280;
            font-size: 0.875rem;
        }

        .selector-group select {
            padding: 0.75rem 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            min-width: 180px;
            background: white;
            cursor: pointer;
        }

        .selector-group select:focus {
            outline: none;
            border-color: #0066ff;
            box-shadow: 0 0 0 3px rgba(0, 102, 255, 0.1);
        }

        /* Grammar Tables */
        .grammar-table-container {
            overflow-x: auto;
            margin: 1.5rem 0;
        }

        .grammar-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 1rem;
        }

        .grammar-table th {
            background: #f3f4f6;
            padding: 0.75rem 1rem;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border: 1px solid #e5e7eb;
        }

        .grammar-table td {
            padding: 0.5rem;
            border: 1px solid #e5e7eb;
            vertical-align: middle;
        }

        .grammar-table .case-label {
            font-weight: 600;
            color: #6b7280;
            background: #f9fafb;
            padding: 0.75rem 1rem;
            min-width: 100px;
        }

        .stem-display {
            font-weight: 600;
            color: #0066ff;
            font-size: 1.1rem;
        }

        .ending-input-container {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .ending-input {
            width: 80px;
            padding: 0.5rem;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 1rem;
            text-align: center;
            transition: all 0.2s;
        }

        .ending-input:focus {
            outline: none;
            border-color: #0066ff;
            box-shadow: 0 0 0 3px rgba(0, 102, 255, 0.1);
        }

        .ending-input.correct {
            border-color: #10b981;
            background: #ecfdf5;
        }

        .ending-input.incorrect {
            border-color: #ef4444;
            background: #fef2f2;
        }

        /* Buttons */
        .btn-row {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1.5rem;
        }

        .btn {
            padding: 0.875rem 2rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: #0066ff;
            color: white;
        }

        .btn-primary:hover {
            background: #0052cc;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        /* Results */
        .results-panel {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border: 1px solid #a7f3d0;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            margin-top: 1.5rem;
            display: none;
        }

        .results-panel.show {
            display: block;
        }

        .results-score {
            font-size: 2rem;
            font-weight: 700;
            color: #059669;
            margin-bottom: 0.5rem;
        }

        .results-message {
            color: #065f46;
            font-size: 1.1rem;
        }

        /* Model word display */
        .model-word-display {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border: 2px solid #93c5fd;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .model-word {
            font-size: 2rem;
            font-weight: 700;
            color: #0052cc;
            font-family: Georgia, 'Times New Roman', serif;
        }

        .model-word-info {
            color: #6b7280;
            margin-top: 0.5rem;
        }

        .model-word-note {
            color: #0066ff;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            font-style: italic;
        }

        /* Full word input for pronouns and special forms */
        .full-word-input {
            width: 100px;
            padding: 0.5rem;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 1rem;
            text-align: center;
        }

        .full-word-input:focus {
            outline: none;
            border-color: #0066ff;
        }

        .full-word-input.correct {
            border-color: #10b981;
            background: #ecfdf5;
        }

        .full-word-input.incorrect {
            border-color: #ef4444;
            background: #fef2f2;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-container, .main-container {
                padding: 1rem;
            }

            .header-title {
                font-size: 1.5rem;
            }

            .tabs {
                gap: 0.25rem;
            }

            .tab-btn {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }

            .selector-row {
                flex-direction: column;
            }

            .selector-group select {
                min-width: 100%;
            }

            .ending-input, .full-word-input {
                width: 60px;
                padding: 0.4rem;
                font-size: 0.9rem;
            }

            .grammar-table {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <div class="header-content">
                <a href="../index.html" class="logo-icon">C</a>
                <h1 class="header-title">Latin Grammar Practice</h1>
                <p class="header-subtitle">Master declensions, conjugations, and more</p>
            </div>
        </div>
    </header>

    <div class="main-container">
        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="nouns">Nouns</button>
            <button class="tab-btn" data-tab="verbs">Verbs</button>
            <button class="tab-btn" data-tab="adjectives">Adjectives</button>
            <button class="tab-btn" data-tab="pronouns">Pronouns</button>
        </div>

        <!-- NOUNS TAB -->
        <div class="tab-content active" id="nouns-tab">
            <div class="panel">
                <h2>Noun Declensions</h2>
                <div class="selector-row">
                    <div class="selector-group">
                        <label for="noun-declension">Declension</label>
                        <select id="noun-declension">
                            <option value="">Select declension...</option>
                            <option value="1st">1st Declension (puella)</option>
                            <option value="2nd_masc">2nd Declension - Masculine (dominus)</option>
                            <option value="2nd_masc_r">2nd Declension - -er (puer)</option>
                            <option value="2nd_neut">2nd Declension - Neuter (bellum)</option>
                            <option value="3rd">3rd Declension (mercātor)</option>
                            <option value="3rd_i">3rd Declension - i-stem (cīvis)</option>
                            <option value="3rd_neut">3rd Declension - Neuter (tempus)</option>
                            <option value="4th">4th Declension (manus)</option>
                            <option value="4th_neut">4th Declension - Neuter (genū)</option>
                            <option value="5th">5th Declension (rēs)</option>
                        </select>
                    </div>
                </div>

                <div id="noun-practice-area" style="display: none;">
                    <div class="model-word-display">
                        <div class="model-word" id="noun-model-word">puella</div>
                        <div class="model-word-info">Stem: <span id="noun-stem" class="stem-display">puell-</span></div>
                        <div class="model-word-note" id="noun-note" style="display: none;"></div>
                    </div>

                    <div class="grammar-table-container">
                        <table class="grammar-table" id="noun-table">
                            <thead>
                                <tr>
                                    <th>Case</th>
                                    <th>Singular</th>
                                    <th>Plural</th>
                                </tr>
                            </thead>
                            <tbody id="noun-table-body">
                            </tbody>
                        </table>
                    </div>

                    <div class="btn-row">
                        <button class="btn btn-primary" onclick="checkNounAnswers()">Check Answers</button>
                        <button class="btn btn-secondary" onclick="showNounAnswers()">Show Answers</button>
                        <button class="btn btn-success" onclick="resetNounPractice()">New Practice</button>
                    </div>

                    <div class="results-panel" id="noun-results">
                        <div class="results-score" id="noun-score">0/12</div>
                        <div class="results-message" id="noun-message">Keep practising!</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VERBS TAB -->
        <div class="tab-content" id="verbs-tab">
            <div class="panel">
                <h2>Verb Conjugations</h2>
                <div class="selector-row">
                    <div class="selector-group">
                        <label for="verb-conjugation">Conjugation</label>
                        <select id="verb-conjugation">
                            <option value="">Select conjugation...</option>
                            <option value="1st">1st Conjugation (amō)</option>
                            <option value="2nd">2nd Conjugation (moneō)</option>
                            <option value="3rd">3rd Conjugation (regō)</option>
                            <option value="3rd_io">3rd -iō Conjugation (capiō)</option>
                            <option value="4th">4th Conjugation (audiō)</option>
                        </select>
                    </div>
                    <div class="selector-group">
                        <label for="verb-tense">Tense</label>
                        <select id="verb-tense">
                            <option value="">Select tense...</option>
                            <option value="present">Present</option>
                            <option value="imperfect">Imperfect</option>
                            <option value="future">Future</option>
                            <option value="perfect">Perfect</option>
                            <option value="pluperfect">Pluperfect</option>
                            <option value="futureperfect">Future Perfect</option>
                        </select>
                    </div>
                    <div class="selector-group">
                        <label for="verb-voice">Voice</label>
                        <select id="verb-voice">
                            <option value="active">Active</option>
                            <option value="passive">Passive</option>
                        </select>
                    </div>
                </div>

                <div id="verb-practice-area" style="display: none;">
                    <div class="model-word-display">
                        <div class="model-word" id="verb-model-word">amō</div>
                        <div class="model-word-info">
                            <span id="verb-tense-display">Present Active</span> -
                            Stem: <span id="verb-stem" class="stem-display">am-</span>
                        </div>
                    </div>

                    <div class="grammar-table-container">
                        <table class="grammar-table" id="verb-table">
                            <thead>
                                <tr>
                                    <th>Person</th>
                                    <th>Singular</th>
                                    <th>Plural</th>
                                </tr>
                            </thead>
                            <tbody id="verb-table-body">
                            </tbody>
                        </table>
                    </div>

                    <div class="btn-row">
                        <button class="btn btn-primary" onclick="checkVerbAnswers()">Check Answers</button>
                        <button class="btn btn-secondary" onclick="showVerbAnswers()">Show Answers</button>
                        <button class="btn btn-success" onclick="resetVerbPractice()">New Practice</button>
                    </div>

                    <div class="results-panel" id="verb-results">
                        <div class="results-score" id="verb-score">0/6</div>
                        <div class="results-message" id="verb-message">Keep practising!</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ADJECTIVES TAB -->
        <div class="tab-content" id="adjectives-tab">
            <div class="panel">
                <h2>Adjective Declensions</h2>
                <div class="selector-row">
                    <div class="selector-group">
                        <label for="adj-type">Adjective Type</label>
                        <select id="adj-type">
                            <option value="">Select type...</option>
                            <option value="2-1-2">2-1-2 Adjectives (bonus, -a, -um)</option>
                            <option value="3rd_2_termination">3rd Decl. 2-termination (tristis, -e)</option>
                            <option value="3rd_1_termination">3rd Decl. 1-termination (fēlīx)</option>
                        </select>
                    </div>
                    <div class="selector-group">
                        <label for="adj-gender">Gender</label>
                        <select id="adj-gender">
                            <option value="masculine">Masculine</option>
                            <option value="feminine">Feminine</option>
                            <option value="neuter">Neuter</option>
                        </select>
                    </div>
                </div>

                <div id="adj-practice-area" style="display: none;">
                    <div class="model-word-display">
                        <div class="model-word" id="adj-model-word">bonus, -a, -um</div>
                        <div class="model-word-info">
                            <span id="adj-gender-display">Masculine</span> -
                            Stem: <span id="adj-stem" class="stem-display">bon-</span>
                        </div>
                    </div>

                    <div class="grammar-table-container">
                        <table class="grammar-table" id="adj-table">
                            <thead>
                                <tr>
                                    <th>Case</th>
                                    <th>Singular</th>
                                    <th>Plural</th>
                                </tr>
                            </thead>
                            <tbody id="adj-table-body">
                            </tbody>
                        </table>
                    </div>

                    <div class="btn-row">
                        <button class="btn btn-primary" onclick="checkAdjAnswers()">Check Answers</button>
                        <button class="btn btn-secondary" onclick="showAdjAnswers()">Show Answers</button>
                        <button class="btn btn-success" onclick="resetAdjPractice()">New Practice</button>
                    </div>

                    <div class="results-panel" id="adj-results">
                        <div class="results-score" id="adj-score">0/12</div>
                        <div class="results-message" id="adj-message">Keep practising!</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PRONOUNS TAB -->
        <div class="tab-content" id="pronouns-tab">
            <div class="panel">
                <h2>Pronouns &amp; Demonstratives</h2>
                <div class="selector-row">
                    <div class="selector-group">
                        <label for="pronoun-type">Pronoun</label>
                        <select id="pronoun-type">
                            <option value="">Select pronoun...</option>
                            <option value="hic">hic, haec, hoc (this)</option>
                            <option value="ille">ille, illa, illud (that)</option>
                            <option value="is">is, ea, id (he/she/it)</option>
                            <option value="qui">quī, quae, quod (who/which)</option>
                        </select>
                    </div>
                    <div class="selector-group">
                        <label for="pronoun-gender">Gender</label>
                        <select id="pronoun-gender">
                            <option value="masculine">Masculine</option>
                            <option value="feminine">Feminine</option>
                            <option value="neuter">Neuter</option>
                        </select>
                    </div>
                </div>

                <div id="pronoun-practice-area" style="display: none;">
                    <div class="model-word-display">
                        <div class="model-word" id="pronoun-model-word">hic, haec, hoc</div>
                        <div class="model-word-info" id="pronoun-info">Masculine forms</div>
                    </div>

                    <div class="grammar-table-container">
                        <table class="grammar-table" id="pronoun-table">
                            <thead>
                                <tr>
                                    <th>Case</th>
                                    <th>Singular</th>
                                    <th>Plural</th>
                                </tr>
                            </thead>
                            <tbody id="pronoun-table-body">
                            </tbody>
                        </table>
                    </div>

                    <div class="btn-row">
                        <button class="btn btn-primary" onclick="checkPronounAnswers()">Check Answers</button>
                        <button class="btn btn-secondary" onclick="showPronounAnswers()">Show Answers</button>
                        <button class="btn btn-success" onclick="resetPronounPractice()">New Practice</button>
                    </div>

                    <div class="results-panel" id="pronoun-results">
                        <div class="results-score" id="pronoun-score">0/10</div>
                        <div class="results-message" id="pronoun-message">Keep practising!</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="data/grammar-data.js"></script>
    <script>
        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                document.getElementById(this.dataset.tab + '-tab').classList.add('active');
            });
        });

        // Enter key navigation - move to next input
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const inputs = Array.from(document.querySelectorAll('.ending-input:not([style*="display: none"]), .full-word-input:not([style*="display: none"])'));
                const visibleInputs = inputs.filter(input => {
                    const rect = input.getBoundingClientRect();
                    return rect.width > 0 && rect.height > 0;
                });
                const currentIndex = visibleInputs.indexOf(document.activeElement);
                if (currentIndex > -1 && currentIndex < visibleInputs.length - 1) {
                    visibleInputs[currentIndex + 1].focus();
                } else if (currentIndex === visibleInputs.length - 1) {
                    // Last input - could trigger check answers
                    document.activeElement.blur();
                }
            }
        });

        // Normalize text for comparison (handle macrons)
        function normalizeText(text) {
            return text.toLowerCase()
                .replace(/ā/g, 'a')
                .replace(/ē/g, 'e')
                .replace(/ī/g, 'i')
                .replace(/ō/g, 'o')
                .replace(/ū/g, 'u')
                .trim();
        }

        function compareAnswers(userAnswer, correctAnswer) {
            return normalizeText(userAnswer) === normalizeText(correctAnswer);
        }

        function getResultMessage(score, total) {
            const percentage = (score / total) * 100;
            if (percentage === 100) return 'Perfect! Excellent work!';
            if (percentage >= 80) return 'Great job! Almost there!';
            if (percentage >= 60) return 'Good effort! Keep practising!';
            return 'Keep studying - you can do it!';
        }

        // ========== NOUNS ==========
        let currentNounData = null;

        document.getElementById('noun-declension').addEventListener('change', function() {
            const declension = this.value;
            if (!declension) {
                document.getElementById('noun-practice-area').style.display = 'none';
                return;
            }

            currentNounData = grammarData.nouns[declension];
            document.getElementById('noun-model-word').textContent = currentNounData.modelWord;
            document.getElementById('noun-stem').textContent = currentNounData.stem + '-';

            // Show note if exists
            const noteEl = document.getElementById('noun-note');
            if (currentNounData.note) {
                noteEl.textContent = currentNounData.note;
                noteEl.style.display = 'block';
            } else {
                noteEl.style.display = 'none';
            }

            buildNounTable();
            document.getElementById('noun-practice-area').style.display = 'block';
            document.getElementById('noun-results').classList.remove('show');

            // Focus first input
            setTimeout(() => {
                const firstInput = document.querySelector('#noun-table-body .ending-input, #noun-table-body .full-word-input');
                if (firstInput) firstInput.focus();
            }, 100);
        });

        function buildNounTable() {
            const tbody = document.getElementById('noun-table-body');
            tbody.innerHTML = '';

            const cases = ['nominative', 'vocative', 'accusative', 'genitive', 'dative', 'ablative'];
            const caseLabels = ['Nominative', 'Vocative', 'Accusative', 'Genitive', 'Dative', 'Ablative'];

            cases.forEach((caseType, i) => {
                const row = document.createElement('tr');
                const sgEnding = currentNounData.endings.singular[caseType];
                const plEnding = currentNounData.endings.plural[caseType];

                // Check if this is a special form (full word stored in endings)
                const sgIsSpecialForm = sgEnding.length > 3 && !sgEnding.match(/^[āēīōū]/);
                const plIsSpecialForm = plEnding.length > 3 && !plEnding.match(/^[āēīōū]/);

                row.innerHTML = `
                    <td class="case-label">${caseLabels[i]}</td>
                    <td>
                        ${sgIsSpecialForm ? `
                            <input type="text" class="full-word-input" id="noun-sg-${caseType}" placeholder="...">
                        ` : `
                            <div class="ending-input-container">
                                <span class="stem-display">${currentNounData.stem}</span>
                                <input type="text" class="ending-input" id="noun-sg-${caseType}" placeholder="...">
                            </div>
                        `}
                    </td>
                    <td>
                        ${plIsSpecialForm ? `
                            <input type="text" class="full-word-input" id="noun-pl-${caseType}" placeholder="...">
                        ` : `
                            <div class="ending-input-container">
                                <span class="stem-display">${currentNounData.stem}</span>
                                <input type="text" class="ending-input" id="noun-pl-${caseType}" placeholder="...">
                            </div>
                        `}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function checkNounAnswers() {
            let correct = 0;
            const total = 12;
            const cases = ['nominative', 'vocative', 'accusative', 'genitive', 'dative', 'ablative'];

            cases.forEach(caseType => {
                ['sg', 'pl'].forEach(num => {
                    const input = document.getElementById(`noun-${num}-${caseType}`);
                    const number = num === 'sg' ? 'singular' : 'plural';
                    const correctEnding = currentNounData.endings[number][caseType];

                    input.classList.remove('correct', 'incorrect');

                    if (compareAnswers(input.value, correctEnding)) {
                        input.classList.add('correct');
                        correct++;
                    } else {
                        input.classList.add('incorrect');
                    }
                });
            });

            document.getElementById('noun-score').textContent = `${correct}/${total}`;
            document.getElementById('noun-message').textContent = getResultMessage(correct, total);
            document.getElementById('noun-results').classList.add('show');
        }

        function showNounAnswers() {
            const cases = ['nominative', 'vocative', 'accusative', 'genitive', 'dative', 'ablative'];

            cases.forEach(caseType => {
                ['sg', 'pl'].forEach(num => {
                    const input = document.getElementById(`noun-${num}-${caseType}`);
                    const number = num === 'sg' ? 'singular' : 'plural';
                    input.value = currentNounData.endings[number][caseType];
                    input.classList.remove('incorrect');
                    input.classList.add('correct');
                });
            });
        }

        function resetNounPractice() {
            document.getElementById('noun-declension').value = '';
            document.getElementById('noun-practice-area').style.display = 'none';
            document.getElementById('noun-results').classList.remove('show');
        }

        // ========== VERBS ==========
        let currentVerbData = null;
        let currentTense = null;
        let currentVoice = null;

        function updateVerbPractice() {
            const conjugation = document.getElementById('verb-conjugation').value;
            const tense = document.getElementById('verb-tense').value;
            const voice = document.getElementById('verb-voice').value;

            if (!conjugation || !tense) {
                document.getElementById('verb-practice-area').style.display = 'none';
                return;
            }

            currentVerbData = grammarData.verbs[conjugation];
            currentTense = tense;
            currentVoice = voice;

            const tenseData = currentVerbData.tenses[tense];
            if (!tenseData[voice]) {
                alert(`${grammarData.tenseLabels[tense]} ${voice} forms are compound (use participle + sum). Try a different tense.`);
                return;
            }

            document.getElementById('verb-model-word').textContent = currentVerbData.modelWord;

            const stem = ['perfect', 'pluperfect', 'futureperfect'].includes(tense)
                ? currentVerbData.stems.perfect
                : currentVerbData.stems.present;
            document.getElementById('verb-stem').textContent = stem + '-';

            const tenseLabel = grammarData.tenseLabels[tense];
            const voiceLabel = voice.charAt(0).toUpperCase() + voice.slice(1);
            document.getElementById('verb-tense-display').textContent = `${tenseLabel} ${voiceLabel}`;

            buildVerbTable(stem);
            document.getElementById('verb-practice-area').style.display = 'block';
            document.getElementById('verb-results').classList.remove('show');

            setTimeout(() => {
                const firstInput = document.querySelector('#verb-table-body .ending-input');
                if (firstInput) firstInput.focus();
            }, 100);
        }

        document.getElementById('verb-conjugation').addEventListener('change', updateVerbPractice);
        document.getElementById('verb-tense').addEventListener('change', updateVerbPractice);
        document.getElementById('verb-voice').addEventListener('change', updateVerbPractice);

        function buildVerbTable(stem) {
            const tbody = document.getElementById('verb-table-body');
            tbody.innerHTML = '';

            const persons = ['1st', '2nd', '3rd'];

            persons.forEach(person => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="case-label">${person} Person</td>
                    <td>
                        <div class="ending-input-container">
                            <span class="stem-display">${stem}</span>
                            <input type="text" class="ending-input" id="verb-sg-${person}" placeholder="...">
                        </div>
                    </td>
                    <td>
                        <div class="ending-input-container">
                            <span class="stem-display">${stem}</span>
                            <input type="text" class="ending-input" id="verb-pl-${person}" placeholder="...">
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function checkVerbAnswers() {
            let correct = 0;
            const total = 6;
            const persons = ['1st', '2nd', '3rd'];
            const tenseData = currentVerbData.tenses[currentTense][currentVoice];

            persons.forEach(person => {
                ['sg', 'pl'].forEach(num => {
                    const input = document.getElementById(`verb-${num}-${person}`);
                    const number = num === 'sg' ? 'singular' : 'plural';
                    const correctEnding = tenseData[number][person];

                    input.classList.remove('correct', 'incorrect');

                    if (compareAnswers(input.value, correctEnding)) {
                        input.classList.add('correct');
                        correct++;
                    } else {
                        input.classList.add('incorrect');
                    }
                });
            });

            document.getElementById('verb-score').textContent = `${correct}/${total}`;
            document.getElementById('verb-message').textContent = getResultMessage(correct, total);
            document.getElementById('verb-results').classList.add('show');
        }

        function showVerbAnswers() {
            const persons = ['1st', '2nd', '3rd'];
            const tenseData = currentVerbData.tenses[currentTense][currentVoice];

            persons.forEach(person => {
                ['sg', 'pl'].forEach(num => {
                    const input = document.getElementById(`verb-${num}-${person}`);
                    const number = num === 'sg' ? 'singular' : 'plural';
                    input.value = tenseData[number][person];
                    input.classList.remove('incorrect');
                    input.classList.add('correct');
                });
            });
        }

        function resetVerbPractice() {
            document.getElementById('verb-conjugation').value = '';
            document.getElementById('verb-tense').value = '';
            document.getElementById('verb-practice-area').style.display = 'none';
            document.getElementById('verb-results').classList.remove('show');
        }

        // ========== ADJECTIVES ==========
        let currentAdjData = null;
        let currentAdjGender = null;

        function updateAdjPractice() {
            const adjType = document.getElementById('adj-type').value;
            const gender = document.getElementById('adj-gender').value;

            if (!adjType) {
                document.getElementById('adj-practice-area').style.display = 'none';
                return;
            }

            currentAdjData = grammarData.adjectives[adjType];
            currentAdjGender = gender;

            document.getElementById('adj-model-word').textContent = currentAdjData.modelWord;
            document.getElementById('adj-stem').textContent = currentAdjData.stem + '-';
            document.getElementById('adj-gender-display').textContent =
                gender.charAt(0).toUpperCase() + gender.slice(1);

            buildAdjTable();
            document.getElementById('adj-practice-area').style.display = 'block';
            document.getElementById('adj-results').classList.remove('show');

            setTimeout(() => {
                const firstInput = document.querySelector('#adj-table-body .ending-input');
                if (firstInput) firstInput.focus();
            }, 100);
        }

        document.getElementById('adj-type').addEventListener('change', updateAdjPractice);
        document.getElementById('adj-gender').addEventListener('change', updateAdjPractice);

        function buildAdjTable() {
            const tbody = document.getElementById('adj-table-body');
            tbody.innerHTML = '';

            const cases = ['nominative', 'vocative', 'accusative', 'genitive', 'dative', 'ablative'];
            const caseLabels = ['Nominative', 'Vocative', 'Accusative', 'Genitive', 'Dative', 'Ablative'];

            cases.forEach((caseType, i) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="case-label">${caseLabels[i]}</td>
                    <td>
                        <div class="ending-input-container">
                            <span class="stem-display">${currentAdjData.stem}</span>
                            <input type="text" class="ending-input" id="adj-sg-${caseType}" placeholder="...">
                        </div>
                    </td>
                    <td>
                        <div class="ending-input-container">
                            <span class="stem-display">${currentAdjData.stem}</span>
                            <input type="text" class="ending-input" id="adj-pl-${caseType}" placeholder="...">
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function checkAdjAnswers() {
            let correct = 0;
            const total = 12;
            const cases = ['nominative', 'vocative', 'accusative', 'genitive', 'dative', 'ablative'];

            cases.forEach(caseType => {
                ['sg', 'pl'].forEach(num => {
                    const input = document.getElementById(`adj-${num}-${caseType}`);
                    const number = num === 'sg' ? 'singular' : 'plural';
                    const correctEnding = currentAdjData.endings[currentAdjGender][number][caseType];

                    input.classList.remove('correct', 'incorrect');

                    if (compareAnswers(input.value, correctEnding)) {
                        input.classList.add('correct');
                        correct++;
                    } else {
                        input.classList.add('incorrect');
                    }
                });
            });

            document.getElementById('adj-score').textContent = `${correct}/${total}`;
            document.getElementById('adj-message').textContent = getResultMessage(correct, total);
            document.getElementById('adj-results').classList.add('show');
        }

        function showAdjAnswers() {
            const cases = ['nominative', 'vocative', 'accusative', 'genitive', 'dative', 'ablative'];

            cases.forEach(caseType => {
                ['sg', 'pl'].forEach(num => {
                    const input = document.getElementById(`adj-${num}-${caseType}`);
                    const number = num === 'sg' ? 'singular' : 'plural';
                    input.value = currentAdjData.endings[currentAdjGender][number][caseType];
                    input.classList.remove('incorrect');
                    input.classList.add('correct');
                });
            });
        }

        function resetAdjPractice() {
            document.getElementById('adj-type').value = '';
            document.getElementById('adj-practice-area').style.display = 'none';
            document.getElementById('adj-results').classList.remove('show');
        }

        // ========== PRONOUNS ==========
        let currentPronounData = null;
        let currentPronounGender = null;

        function updatePronounPractice() {
            const pronounType = document.getElementById('pronoun-type').value;
            const gender = document.getElementById('pronoun-gender').value;

            if (!pronounType) {
                document.getElementById('pronoun-practice-area').style.display = 'none';
                return;
            }

            currentPronounData = grammarData.pronouns[pronounType];
            currentPronounGender = gender;

            document.getElementById('pronoun-model-word').textContent = currentPronounData.name.split('(')[0].trim();
            document.getElementById('pronoun-info').textContent =
                `${gender.charAt(0).toUpperCase() + gender.slice(1)} forms`;

            buildPronounTable();
            document.getElementById('pronoun-practice-area').style.display = 'block';
            document.getElementById('pronoun-results').classList.remove('show');

            setTimeout(() => {
                const firstInput = document.querySelector('#pronoun-table-body .full-word-input');
                if (firstInput) firstInput.focus();
            }, 100);
        }

        document.getElementById('pronoun-type').addEventListener('change', updatePronounPractice);
        document.getElementById('pronoun-gender').addEventListener('change', updatePronounPractice);

        function buildPronounTable() {
            const tbody = document.getElementById('pronoun-table-body');
            tbody.innerHTML = '';

            const cases = ['nominative', 'accusative', 'genitive', 'dative', 'ablative'];
            const caseLabels = ['Nominative', 'Accusative', 'Genitive', 'Dative', 'Ablative'];

            cases.forEach((caseType, i) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="case-label">${caseLabels[i]}</td>
                    <td>
                        <input type="text" class="full-word-input" id="pronoun-sg-${caseType}" placeholder="...">
                    </td>
                    <td>
                        <input type="text" class="full-word-input" id="pronoun-pl-${caseType}" placeholder="...">
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function checkPronounAnswers() {
            let correct = 0;
            const total = 10;
            const cases = ['nominative', 'accusative', 'genitive', 'dative', 'ablative'];
            const forms = currentPronounData.forms[currentPronounGender];

            cases.forEach(caseType => {
                ['sg', 'pl'].forEach(num => {
                    const input = document.getElementById(`pronoun-${num}-${caseType}`);
                    const number = num === 'sg' ? 'singular' : 'plural';
                    const correctForm = forms[number][caseType];

                    input.classList.remove('correct', 'incorrect');

                    if (compareAnswers(input.value, correctForm)) {
                        input.classList.add('correct');
                        correct++;
                    } else {
                        input.classList.add('incorrect');
                    }
                });
            });

            document.getElementById('pronoun-score').textContent = `${correct}/${total}`;
            document.getElementById('pronoun-message').textContent = getResultMessage(correct, total);
            document.getElementById('pronoun-results').classList.add('show');
        }

        function showPronounAnswers() {
            const cases = ['nominative', 'accusative', 'genitive', 'dative', 'ablative'];
            const forms = currentPronounData.forms[currentPronounGender];

            cases.forEach(caseType => {
                ['sg', 'pl'].forEach(num => {
                    const input = document.getElementById(`pronoun-${num}-${caseType}`);
                    const number = num === 'sg' ? 'singular' : 'plural';
                    input.value = forms[number][caseType];
                    input.classList.remove('incorrect');
                    input.classList.add('correct');
                });
            });
        }

        function resetPronounPractice() {
            document.getElementById('pronoun-type').value = '';
            document.getElementById('pronoun-practice-area').style.display = 'none';
            document.getElementById('pronoun-results').classList.remove('show');
        }
    </script>
</body>
</html>
