<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Messalina - Section 4</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #ffffff;
            color: #333;
            padding: 25px 45px;
            min-height: 100vh;
            margin: 0;
            font-size: 22px;
        }

        .header {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .header-left {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .logo {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #0066ff 0%, #4d94ff 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.5rem;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            text-decoration: none;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-top: 2px;
        }

        .logo:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 102, 255, 0.3);
        }

        .title-area {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        h1 {
            color: #222;
            margin: 0;
            font-size: 1.6em;
            font-weight: 600;
        }

        .subtitle {
            font-size: 1em;
            color: #666;
            margin: 0;
        }

        /* Compact controls */
        .controls-area {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            gap: 4px;
        }

        .controls {
            display: flex;
            gap: 6px;
            justify-content: flex-end;
        }

        .controls button {
            padding: 0.6rem 1rem;
            font-size: 0.9rem;
            font-weight: 500;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: rgba(0, 102, 255, 0.08);
            color: #0066ff;
            flex: 1;
            text-align: center;
        }

        .controls button:hover {
            background: rgba(0, 102, 255, 0.15);
            transform: translateY(-1px);
        }

        #showAllBtn {
            background: #0066ff;
            color: white;
        }

        #showAllBtn:hover {
            background: #0052cc;
        }

        #hideAllBtn {
            background: rgba(0, 102, 255, 0.08);
            color: #0066ff;
        }

        #toggleColoursBtn {
            background: rgba(0, 102, 255, 0.08);
            color: #0066ff;
        }

        #toggleStyleBtn {
            background: rgba(0, 102, 255, 0.08);
            color: #0066ff;
        }

        body.style-mode #toggleStyleBtn {
            background: #0066ff;
            color: white;
        }

        /* Key - compact squares in header */
        .key {
            display: flex;
            gap: 6px;
        }

        .key-item {
            padding: 0.6rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            color: #333;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
            text-align: center;
            border: none;
            flex: 1;
        }

        .key-item:hover {
            transform: translateY(-1px);
            filter: brightness(0.95);
        }

        .key-item.active {
            outline: 2px solid #333;
            outline-offset: 1px;
        }

        /* Main content area */
        .translation-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 60px;
        }

        .column-header {
            font-size: 0.9em;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 15px;
            padding-left: 0;
        }

        /* Each line row */
        .line-row {
            display: flex;
            align-items: flex-end;
            margin-bottom: 14px;
            flex-wrap: wrap;
        }

        .line-number {
            display: none;
            color: #0066ff;
            font-weight: bold;
            min-width: 45px;
            margin-right: 10px;
            font-size: 1.15em;
            align-self: flex-end;
            padding-bottom: 4px;
        }

        .words-container {
            display: flex;
            align-items: flex-end;
            gap: 3px;
            flex-wrap: wrap;
        }

        /* Word group with number above */
        .word-group {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }

        .word-order {
            font-size: 0.65em;
            color: #888;
            margin-bottom: 4px;
            height: 1em;
            font-weight: 600;
        }

        .latin-word, .english-word {
            padding: 3px 7px;
            border-radius: 3px;
            font-size: 1em;
            transition: background-color 0.3s, opacity 0.3s;
            cursor: pointer;
        }

        .latin-word {
            background-color: transparent;
        }

        .english-word {
            opacity: 0;
        }

        .english-word.revealed {
            opacity: 1;
        }

        /* Colours */
        .subject .latin-word { background-color: #ffb3b3; }
        .english-word.subject { background-color: #ffb3b3; }

        .verb .latin-word { background-color: #b3e6ff; }
        .english-word.verb { background-color: #b3e6ff; }

        .object .latin-word { background-color: #b3ffcc; }
        .english-word.object { background-color: #b3ffcc; }

        .genitive .latin-word { background-color: #ffd9b3; }
        .english-word.genitive { background-color: #ffd9b3; }

        .dative .latin-word { background-color: #e6b3ff; }
        .english-word.dative { background-color: #e6b3ff; }

        .ablative .latin-word { background-color: #ffffb3; }
        .english-word.ablative { background-color: #ffffb3; }

        .preposition .latin-word { background-color: #ffb3e6; }
        .english-word.preposition { background-color: #ffb3e6; }

        .conjunction .latin-word { background-color: #d9ffb3; }
        .english-word.conjunction { background-color: #d9ffb3; }

        .adverb .latin-word { background-color: #ccb3ff; }
        .english-word.adverb { background-color: #ccb3ff; }

        .gerundive .latin-word { background-color: #ffcbb3; }
        .english-word.gerundive { background-color: #ffcbb3; }

        /* Highlighting */
        .subject.highlighted .latin-word { background-color: #ffb3b3 !important; }
        .english-word.subject.highlighted { background-color: #ffb3b3 !important; }
        .verb.highlighted .latin-word { background-color: #b3e6ff !important; }
        .english-word.verb.highlighted { background-color: #b3e6ff !important; }
        .object.highlighted .latin-word { background-color: #b3ffcc !important; }
        .english-word.object.highlighted { background-color: #b3ffcc !important; }
        .genitive.highlighted .latin-word { background-color: #ffd9b3 !important; }
        .english-word.genitive.highlighted { background-color: #ffd9b3 !important; }
        .dative.highlighted .latin-word { background-color: #e6b3ff !important; }
        .english-word.dative.highlighted { background-color: #e6b3ff !important; }
        .ablative.highlighted .latin-word { background-color: #ffffb3 !important; }
        .english-word.ablative.highlighted { background-color: #ffffb3 !important; }
        .preposition.highlighted .latin-word { background-color: #ffb3e6 !important; }
        .english-word.preposition.highlighted { background-color: #ffb3e6 !important; }
        .conjunction.highlighted .latin-word { background-color: #d9ffb3 !important; }
        .english-word.conjunction.highlighted { background-color: #d9ffb3 !important; }
        .adverb.highlighted .latin-word { background-color: #ccb3ff !important; }
        .english-word.adverb.highlighted { background-color: #ccb3ff !important; }
        .gerundive.highlighted .latin-word { background-color: #ffcbb3 !important; }
        .english-word.gerundive.highlighted { background-color: #ffcbb3 !important; }

        /* Hide colours mode */
        body.hide-colours .subject .latin-word,
        body.hide-colours .english-word.subject.revealed,
        body.hide-colours .verb .latin-word,
        body.hide-colours .english-word.verb.revealed,
        body.hide-colours .object .latin-word,
        body.hide-colours .english-word.object.revealed,
        body.hide-colours .genitive .latin-word,
        body.hide-colours .english-word.genitive.revealed,
        body.hide-colours .dative .latin-word,
        body.hide-colours .english-word.dative.revealed,
        body.hide-colours .ablative .latin-word,
        body.hide-colours .english-word.ablative.revealed,
        body.hide-colours .preposition .latin-word,
        body.hide-colours .english-word.preposition.revealed,
        body.hide-colours .conjunction .latin-word,
        body.hide-colours .english-word.conjunction.revealed,
        body.hide-colours .adverb .latin-word,
        body.hide-colours .english-word.adverb.revealed,
        body.hide-colours .gerundive .latin-word,
        body.hide-colours .english-word.gerundive.revealed {
            background-color: #e0e0e0;
        }

        /* Style Mode */
        .style-highlight {
            position: relative;
        }

        .style-highlight.active-style .latin-word {
            outline: 2px solid #333;
            outline-offset: 1px;
        }

        /* Style panel at bottom */
        .style-panel {
            display: none;
            background: rgba(0, 102, 255, 0.03);
            border-top: 2px solid rgba(0, 102, 255, 0.15);
            padding: 18px 24px;
            margin-top: 20px;
        }

        body.style-mode .style-panel {
            display: block;
        }

        .style-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .style-panel h3 {
            margin: 0;
            color: #0066ff;
            font-size: 1rem;
            font-weight: 600;
        }

        .style-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .style-tag {
            padding: 8px 14px;
            background: white;
            border: 1px solid rgba(0, 102, 255, 0.25);
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #333;
        }

        .style-tag:hover {
            border-color: #0066ff;
            background: rgba(0, 102, 255, 0.05);
        }

        .style-tag.active {
            background: #0066ff;
            color: white;
            border-color: #0066ff;
        }

        .style-tag em {
            font-style: italic;
        }

        .style-analysis {
            display: none;
            padding: 16px 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid rgba(0, 102, 255, 0.15);
        }

        .style-analysis.active {
            display: block;
        }

        .style-analysis-title {
            font-weight: 600;
            color: #0066ff;
            margin-bottom: 6px;
            font-size: 1rem;
        }

        .style-analysis-lines {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }

        .style-analysis-effect {
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .style-analysis-effect strong {
            color: #0066ff;
        }

        .style-analysis-exam {
            padding-top: 12px;
            border-top: 1px dashed #ddd;
            font-size: 0.9rem;
            color: #555;
            line-height: 1.5;
        }

        .style-analysis-exam strong {
            color: #333;
        }

        .style-analysis em {
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-top">
            <div class="header-left">
                <a href="https://www.classicalia.co.uk" class="logo">C</a>
                <div class="title-area">
                    <h1>Messalina</h1>
                    <p class="subtitle">Section 4 (Lines 27-38): Widespread knowledge of the affair prompts Narcissus to take action</p>
                </div>
            </div>
            <div class="controls-area">
                <div class="controls">
                    <button id="showAllBtn">Show All</button>
                    <button id="hideAllBtn">Hide All</button>
                    <button id="toggleColoursBtn">Hide Colours</button>
                    <button id="toggleStyleBtn">Style Notes</button>
                </div>
                <div class="key">
                    <span class="key-item" data-category="subject" style="background-color: #ffb3b3;">Subj.</span>
                    <span class="key-item" data-category="object" style="background-color: #b3ffcc;">Obj.</span>
                    <span class="key-item" data-category="verb" style="background-color: #b3e6ff;">Verb</span>
                    <span class="key-item" data-category="genitive" style="background-color: #ffd9b3;">Gen.</span>
                    <span class="key-item" data-category="dative" style="background-color: #e6b3ff;">Dat.</span>
                    <span class="key-item" data-category="ablative" style="background-color: #ffffb3;">Abl.</span>
                    <span class="key-item" data-category="preposition" style="background-color: #ffb3e6;">Prep.</span>
                    <span class="key-item" data-category="conjunction" style="background-color: #d9ffb3;">Conj.</span>
                    <span class="key-item" data-category="adverb" style="background-color: #ccb3ff;">Adv.</span>
                    <span class="key-item" data-category="gerundive" style="background-color: #ffcbb3;">Gdv.</span>
                </div>
            </div>
        </div>
    </div>

    <div class="translation-area">
        <!-- LATIN COLUMN -->
        <div class="latin-column">
            <div class="column-header">Latin</div>

            <!-- Sentence 1: igitur domus principis inhorruit, maximeque ei qui potentiam habebant timuerunt ne res verterentur: -->
            <div class="line-row" data-line="1">
                <span class="line-number">1</span>
                <div class="words-container">
                    <span class="word-group conjunction" data-order="01-01"><span class="word-order">1</span><span class="latin-word">igitur</span></span>
                    <span class="word-group subject" data-order="01-02"><span class="word-order">2</span><span class="latin-word">domus</span></span>
                    <span class="word-group genitive" data-order="01-03"><span class="word-order">3</span><span class="latin-word">principis</span></span>
                    <span class="word-group verb style-highlight" data-order="01-04" data-style-feature="inhorruit"><span class="word-order">4</span><span class="latin-word">inhorruit,</span></span>
                    <span class="word-group adverb" data-order="01-05"><span class="word-order">5</span><span class="latin-word">maximeque</span></span>
                    <span class="word-group subject" data-order="01-06"><span class="word-order">6</span><span class="latin-word">ei</span></span>
                    <span class="word-group subject" data-order="01-07"><span class="word-order">7</span><span class="latin-word">qui</span></span>
                    <span class="word-group object" data-order="01-09"><span class="word-order">9</span><span class="latin-word">potentiam</span></span>
                    <span class="word-group verb" data-order="01-08"><span class="word-order">8</span><span class="latin-word">habebant</span></span>
                    <span class="word-group verb style-highlight" data-order="01-10" data-style-feature="ne-verterentur"><span class="word-order">10</span><span class="latin-word">timuerunt</span></span>
                    <span class="word-group conjunction style-highlight" data-order="01-11" data-style-feature="ne-verterentur"><span class="word-order">11</span><span class="latin-word">ne</span></span>
                    <span class="word-group subject" data-order="01-12"><span class="word-order">12</span><span class="latin-word">res</span></span>
                    <span class="word-group verb style-highlight" data-order="01-13" data-style-feature="ne-verterentur"><span class="word-order">13</span><span class="latin-word">verterentur:</span></span>
                </div>
            </div>

            <!-- Sentence 2: spem tamen habebant, si Claudio de atrocitate sceleris persuasissent, Messalinam posse opprimi sine quaestione damnatam; -->
            <div class="line-row" data-line="2">
                <span class="line-number">2</span>
                <div class="words-container">
                    <span class="word-group object" data-order="02-03"><span class="word-order">3</span><span class="latin-word">spem</span></span>
                    <span class="word-group conjunction" data-order="02-02"><span class="word-order">2</span><span class="latin-word">tamen</span></span>
                    <span class="word-group verb" data-order="02-01"><span class="word-order">1</span><span class="latin-word">habebant,</span></span>
                    <span class="word-group conjunction style-highlight" data-order="02-05" data-style-feature="si-persuasissent"><span class="word-order">5</span><span class="latin-word">si</span></span>
                    <span class="word-group dative" data-order="02-07"><span class="word-order">7</span><span class="latin-word">Claudio</span></span>
                    <span class="word-group preposition" data-order="02-08"><span class="word-order">8</span><span class="latin-word">de</span></span>
                    <span class="word-group ablative" data-order="02-09"><span class="word-order">9</span><span class="latin-word">atrocitate</span></span>
                    <span class="word-group genitive" data-order="02-10"><span class="word-order">10</span><span class="latin-word">sceleris</span></span>
                    <span class="word-group verb style-highlight" data-order="02-06" data-style-feature="si-persuasissent"><span class="word-order">6</span><span class="latin-word">persuasissent,</span></span>
                    <span class="word-group object" data-order="02-11"><span class="word-order">11</span><span class="latin-word">Messalinam</span></span>
                    <span class="word-group verb" data-order="02-12"><span class="word-order">12</span><span class="latin-word">posse</span></span>
                    <span class="word-group verb" data-order="02-13"><span class="word-order">13</span><span class="latin-word">opprimi</span></span>
                    <span class="word-group preposition" data-order="02-14"><span class="word-order">14</span><span class="latin-word">sine</span></span>
                    <span class="word-group ablative" data-order="02-15"><span class="word-order">15</span><span class="latin-word">quaestione</span></span>
                    <span class="word-group verb" data-order="02-04"><span class="word-order">4</span><span class="latin-word">damnatam;</span></span>
                </div>
            </div>

            <!-- Sentence 3: sed periculum esse ne ille defensionem audiret, neve clausae aures etiam confitenti non essent. -->
            <div class="line-row" data-line="3">
                <span class="line-number">3</span>
                <div class="words-container">
                    <span class="word-group conjunction" data-order="03-01"><span class="word-order">1</span><span class="latin-word">sed</span></span>
                    <span class="word-group object" data-order="03-03"><span class="word-order">3</span><span class="latin-word">periculum</span></span>
                    <span class="word-group verb" data-order="03-02"><span class="word-order">2</span><span class="latin-word">esse</span></span>
                    <span class="word-group conjunction" data-order="03-04"><span class="word-order">4</span><span class="latin-word">ne</span></span>
                    <span class="word-group subject" data-order="03-05"><span class="word-order">5</span><span class="latin-word">ille</span></span>
                    <span class="word-group object" data-order="03-07"><span class="word-order">7</span><span class="latin-word">defensionem</span></span>
                    <span class="word-group verb" data-order="03-06"><span class="word-order">6</span><span class="latin-word">audiret,</span></span>
                    <span class="word-group conjunction" data-order="03-08"><span class="word-order">8</span><span class="latin-word">neve</span></span>
                    <span class="word-group verb style-highlight" data-order="03-11" data-style-feature="clausae-confitenti"><span class="word-order">11</span><span class="latin-word">clausae</span></span>
                    <span class="word-group subject" data-order="03-09"><span class="word-order">9</span><span class="latin-word">aures</span></span>
                    <span class="word-group adverb style-highlight" data-order="03-12" data-style-feature="clausae-confitenti"><span class="word-order">12</span><span class="latin-word">etiam</span></span>
                    <span class="word-group dative style-highlight" data-order="03-13" data-style-feature="clausae-confitenti"><span class="word-order">13</span><span class="latin-word">confitenti</span></span>
                    <span class="word-group adverb" data-order="03-10"><span class="word-order">10</span><span class="latin-word">non</span></span>
                    <span class="word-group verb" data-order="03-14"><span class="word-order">14</span><span class="latin-word">essent.</span></span>
                </div>
            </div>

            <!-- Sentence 4: Narcissus, occasiones quaerens, cum Caesar diu apud Ostiam moraretur, duas eius paelices largitione et promissis perpulit delationem subire. -->
            <div class="line-row" data-line="4">
                <span class="line-number">4</span>
                <div class="words-container">
                    <span class="word-group subject" data-order="04-01"><span class="word-order">1</span><span class="latin-word">Narcissus,</span></span>
                    <span class="word-group object" data-order="04-03"><span class="word-order">3</span><span class="latin-word">occasiones</span></span>
                    <span class="word-group verb" data-order="04-02"><span class="word-order">2</span><span class="latin-word">quaerens,</span></span>
                    <span class="word-group conjunction" data-order="04-04"><span class="word-order">4</span><span class="latin-word">cum</span></span>
                    <span class="word-group subject" data-order="04-05"><span class="word-order">5</span><span class="latin-word">Caesar</span></span>
                    <span class="word-group adverb" data-order="04-07"><span class="word-order">7</span><span class="latin-word">diu</span></span>
                    <span class="word-group preposition" data-order="04-08"><span class="word-order">8</span><span class="latin-word">apud</span></span>
                    <span class="word-group object" data-order="04-09"><span class="word-order">9</span><span class="latin-word">Ostiam</span></span>
                    <span class="word-group verb" data-order="04-06"><span class="word-order">6</span><span class="latin-word">moraretur,</span></span>
                    <span class="word-group object" data-order="04-11"><span class="word-order">11</span><span class="latin-word">duas</span></span>
                    <span class="word-group genitive" data-order="04-12"><span class="word-order">12</span><span class="latin-word">eius</span></span>
                    <span class="word-group object" data-order="04-13"><span class="word-order">13</span><span class="latin-word">paelices</span></span>
                    <span class="word-group ablative" data-order="04-14"><span class="word-order">14</span><span class="latin-word">largitione</span></span>
                    <span class="word-group conjunction" data-order="04-15"><span class="word-order">15</span><span class="latin-word">et</span></span>
                    <span class="word-group ablative" data-order="04-16"><span class="word-order">16</span><span class="latin-word">promissis</span></span>
                    <span class="word-group verb" data-order="04-10"><span class="word-order">10</span><span class="latin-word">perpulit</span></span>
                    <span class="word-group object" data-order="04-17"><span class="word-order">17</span><span class="latin-word">delationem</span></span>
                    <span class="word-group verb" data-order="04-18"><span class="word-order">18</span><span class="latin-word">subire.</span></span>
                </div>
            </div>

            <!-- Sentence 5: exim Calpurnia (id alteri paelici nomen), ubi datum est secretum, ad genua Caesaris provoluta nupsisse Messalinam Silio exclamat; -->
            <div class="line-row" data-line="5">
                <span class="line-number">5</span>
                <div class="words-container">
                    <span class="word-group adverb" data-order="05-01"><span class="word-order">1</span><span class="latin-word">exim</span></span>
                    <span class="word-group subject" data-order="05-02"><span class="word-order">2</span><span class="latin-word">Calpurnia</span></span>
                    <span class="word-group subject" data-order="05-03"><span class="word-order">3</span><span class="latin-word">(id</span></span>
                    <span class="word-group dative" data-order="05-05"><span class="word-order">5</span><span class="latin-word">alteri</span></span>
                    <span class="word-group dative" data-order="05-06"><span class="word-order">6</span><span class="latin-word">paelici</span></span>
                    <span class="word-group subject" data-order="05-04"><span class="word-order">4</span><span class="latin-word">nomen),</span></span>
                    <span class="word-group conjunction" data-order="05-07"><span class="word-order">7</span><span class="latin-word">ubi</span></span>
                    <span class="word-group verb" data-order="05-08"><span class="word-order">8</span><span class="latin-word">datum est</span></span>
                    <span class="word-group object" data-order="05-09"><span class="word-order">9</span><span class="latin-word">secretum,</span></span>
                    <span class="word-group preposition" data-order="05-10"><span class="word-order">10</span><span class="latin-word">ad</span></span>
                    <span class="word-group object" data-order="05-11"><span class="word-order">11</span><span class="latin-word">genua</span></span>
                    <span class="word-group genitive" data-order="05-12"><span class="word-order">12</span><span class="latin-word">Caesaris</span></span>
                    <span class="word-group verb" data-order="05-13"><span class="word-order">13</span><span class="latin-word">provoluta</span></span>
                    <span class="word-group verb" data-order="05-16"><span class="word-order">16</span><span class="latin-word">nupsisse</span></span>
                    <span class="word-group object" data-order="05-14"><span class="word-order">14</span><span class="latin-word">Messalinam</span></span>
                    <span class="word-group dative" data-order="05-15"><span class="word-order">15</span><span class="latin-word">Silio</span></span>
                    <span class="word-group verb style-highlight" data-order="05-17" data-style-feature="exclamat-postulat"><span class="word-order">17</span><span class="latin-word">exclamat;</span></span>
                </div>
            </div>

            <!-- Sentence 6: altera paelice haec confirmante, Calpurnia cieri Narcissum postulat. -->
            <div class="line-row" data-line="6">
                <span class="line-number">6</span>
                <div class="words-container">
                    <span class="word-group ablative style-highlight" data-order="06-03" data-style-feature="abl-abs"><span class="word-order">3</span><span class="latin-word">altera</span></span>
                    <span class="word-group ablative style-highlight" data-order="06-04" data-style-feature="abl-abs"><span class="word-order">4</span><span class="latin-word">paelice</span></span>
                    <span class="word-group object" data-order="06-05"><span class="word-order">5</span><span class="latin-word">haec</span></span>
                    <span class="word-group ablative style-highlight" data-order="06-02" data-style-feature="abl-abs"><span class="word-order">2</span><span class="latin-word">confirmante,</span></span>
                    <span class="word-group subject" data-order="06-01"><span class="word-order">1</span><span class="latin-word">Calpurnia</span></span>
                    <span class="word-group verb" data-order="06-07"><span class="word-order">7</span><span class="latin-word">cieri</span></span>
                    <span class="word-group object" data-order="06-08"><span class="word-order">8</span><span class="latin-word">Narcissum</span></span>
                    <span class="word-group verb style-highlight" data-order="06-06" data-style-feature="exclamat-postulat"><span class="word-order">6</span><span class="latin-word">postulat.</span></span>
                </div>
            </div>
        </div>

        <!-- ENGLISH COLUMN -->
        <div class="english-column">
            <div class="column-header">English</div>

            <!-- Sentence 1 English -->
            <div class="line-row" data-line="1">
                <span class="line-number">1</span>
                <div class="words-container">
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="01-01">Therefore</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="01-02">the household</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word genitive" data-order="01-03">of the emperor</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="01-04">shuddered,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="01-05">and particularly</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="01-06">those</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="01-07">who</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="01-08">held</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="01-09">power</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="01-10">feared</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="01-11">lest</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="01-12">the state</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="01-13">be overturned:</span></span>
                </div>
            </div>

            <!-- Sentence 2 English -->
            <div class="line-row" data-line="2">
                <span class="line-number">2</span>
                <div class="words-container">
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="02-01">they had</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="02-02">Nevertheless</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="02-03">hope</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="02-04">(and) condemned;</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="02-05">that if</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="02-06">they convinced</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word dative" data-order="02-07">Claudius</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word preposition" data-order="02-08">about</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word ablative" data-order="02-09">the enormity</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word genitive" data-order="02-10">of the crime,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="02-11">Messalina</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="02-12">could be</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="02-13">overthrown</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word preposition" data-order="02-14">without</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word ablative" data-order="02-15">a trial</span></span>
                </div>
            </div>

            <!-- Sentence 3 English -->
            <div class="line-row" data-line="3">
                <span class="line-number">3</span>
                <div class="words-container">
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="03-01">But</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="03-02">there was</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="03-03">a danger</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="03-04">that</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="03-05">he (Claudius)</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="03-06">might listen to</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="03-07">her defence</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="03-08">or that</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="03-09">his ears</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="03-10">might not</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="03-11">closed</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="03-12">even</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word dative" data-order="03-13">if she confessed</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="03-14">be</span></span>
                </div>
            </div>

            <!-- Sentence 4 English -->
            <div class="line-row" data-line="4">
                <span class="line-number">4</span>
                <div class="words-container">
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="04-01">Narcissus,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="04-02">looking for</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="04-03">opportunities,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="04-04">since</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="04-05">Caesar</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="04-06">was delaying</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="04-07">for a long time</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word preposition" data-order="04-08">at</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="04-09">Ostia,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="04-10">compelled</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="04-11">two</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word genitive" data-order="04-12">of his</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="04-13">concubines</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word ablative" data-order="04-14">by largesse</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="04-15">and</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word ablative" data-order="04-16">promises</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="04-17">an accusation.</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="04-18">to submit</span></span>
                </div>
            </div>

            <!-- Sentence 5 English -->
            <div class="line-row" data-line="5">
                <span class="line-number">5</span>
                <div class="words-container">
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="05-01">Then</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="05-02">Calpurnia</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="05-03">(that (was)</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="05-04">the name</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word dative" data-order="05-05">of one</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word dative" data-order="05-06">of the concubines)</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="05-07">when</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="05-08">she was given</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="05-09">a secret audience,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word preposition" data-order="05-10">at</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="05-11">the knees</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word genitive" data-order="05-12">of Caesar</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="05-13">fell down</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="05-14">Messalina</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word dative" data-order="05-15">Silius</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="05-16">had married</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="05-17">(and) shouted (that);</span></span>
                </div>
            </div>

            <!-- Sentence 6 English -->
            <div class="line-row" data-line="6">
                <span class="line-number">6</span>
                <div class="words-container">
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="06-01">Calpurnia</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word ablative" data-order="06-02">confirming</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word ablative" data-order="06-03">the other</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word ablative" data-order="06-04">concubine</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="06-05">this,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="06-06">demanded (that)</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="06-07">be summoned.</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="06-08">Narcissus</span></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Style Panel -->
    <div class="style-panel">
        <div class="style-panel-header">
            <h3>Stylistic Features</h3>
        </div>
        <div class="style-list">
            <span class="style-tag" data-feature="inhorruit">Metaphor — <em>inhorruit</em></span>
            <span class="style-tag" data-feature="ne-verterentur">Fear Clause — <em>ne res verterentur</em></span>
            <span class="style-tag" data-feature="si-persuasissent">Conditional Hope — <em>si... persuasissent</em></span>
            <span class="style-tag" data-feature="clausae-confitenti">Paradox — <em>clausae aures... confitenti</em></span>
            <span class="style-tag" data-feature="exclamat-postulat">Historic Present — <em>exclamat, postulat</em></span>
            <span class="style-tag" data-feature="abl-abs">Ablative Absolute — <em>altera paelice... confirmante</em></span>
        </div>

        <div class="style-analysis" id="analysis-inhorruit">
            <div class="style-analysis-title">Metaphor — inhorruit</div>
            <div class="style-analysis-lines">Sentence 1</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> The household "shuddered" — Tacitus personifies the entire imperial palace as a living thing trembling with fear. <em>Inhorresco</em> literally means to bristle or shiver, like an animal whose fur stands on end. It's not just that individuals were afraid; the whole <em>domus principis</em> collectively trembled as one organism, from the most powerful freedmen down to the lowest slave. One word and suddenly the palace itself feels alive and terrified.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "The verb <em>inhorruit</em> ('shuddered') personifies the imperial household, creating a vivid metaphor in which the entire court trembles as a single entity. This conveys the universal and visceral nature of the fear provoked by Messalina's scandal."
            </div>
        </div>

        <div class="style-analysis" id="analysis-ne-verterentur">
            <div class="style-analysis-title">Fear Clause — ne res verterentur</div>
            <div class="style-analysis-lines">Sentence 1</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> <em>Timuerunt ne res verterentur</em> — "they feared lest the state be overturned." The subjunctive <em>verterentur</em> expresses what they dreaded might happen: not just a scandal, but a full political revolution. <em>Res</em> here means "the state of affairs" or even "the constitution." If Silius replaced Claudius, every powerful freedman in the palace would be swept away. The fear clause captures the courtiers' dread perfectly — it's not certainty but terrifying possibility.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "The fear clause <em>ne res verterentur</em> ('lest the state be overturned') employs the imperfect subjunctive to express the courtiers' dread of political revolution, revealing that their anxiety extends beyond personal scandal to existential threat to the regime."
            </div>
        </div>

        <div class="style-analysis" id="analysis-si-persuasissent">
            <div class="style-analysis-title">Conditional Hope — si... persuasissent</div>
            <div class="style-analysis-lines">Sentence 2</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> The pluperfect subjunctive <em>persuasissent</em> in a conditional clause shows just how carefully these courtiers were calculating. "If they had convinced Claudius..." — the tense implies this had to happen <em>first</em>, before anything else could follow. It's a conditional chain of hope: step one, convince the emperor; step two, crush Messalina quickly (<em>sine quaestione</em>) before she can defend herself. The grammar itself reveals their meticulous, cold-blooded planning.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "The pluperfect subjunctive <em>persuasissent</em> in the protasis reveals the courtiers' calculated strategy: the careful sequence of actions — first persuade Claudius, then condemn Messalina without trial — demonstrates their methodical approach to a political crisis."
            </div>
        </div>

        <div class="style-analysis" id="analysis-clausae-confitenti">
            <div class="style-analysis-title">Paradox — clausae aures... confitenti</div>
            <div class="style-analysis-lines">Sentence 3</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> Here's the devastating paradox: they feared that even if Messalina <em>confessed</em>, Claudius's ears might <em>still not be closed</em> to her. Think about that — even an admission of guilt might not be enough to make him act. The double negative (<em>non essent</em>) and the dative <em>confitenti</em> ("to one confessing") create a tortured, convoluted sentence that mirrors the courtiers' own anguished anxiety. Claudius's emotional weakness was so extreme that the normal rules of justice simply didn't apply.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "The paradoxical construction <em>neve clausae aures etiam confitenti non essent</em> ('and that his ears might not be closed even to one confessing') reveals Claudius's dangerous susceptibility. The convoluted double negative reflects the courtiers' anxiety about an emperor whose emotional weakness could override even a confession of guilt."
            </div>
        </div>

        <div class="style-analysis" id="analysis-exclamat-postulat">
            <div class="style-analysis-title">Historic Present — exclamat, postulat</div>
            <div class="style-analysis-lines">Sentences 5-6</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> After narrating in past tenses throughout, Tacitus suddenly switches to the present — <em>exclamat</em> ("she shouts"), <em>postulat</em> ("she demands"). The effect is electrifying. We're no longer hearing about events at a distance; we're <em>there</em>, watching Calpurnia throw herself at Caesar's feet, hearing her cry ring out. The historic present yanks us into the room for the most dramatic moment of the passage — the denunciation itself.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "The switch to historic present tense in <em>exclamat</em> and <em>postulat</em> creates dramatic immediacy at the climactic moment of denunciation. After sustained past-tense narration, the sudden present tense makes the reader a witness to the scene, heightening its theatrical impact."
            </div>
        </div>

        <div class="style-analysis" id="analysis-abl-abs">
            <div class="style-analysis-title">Ablative Absolute — altera paelice... confirmante</div>
            <div class="style-analysis-lines">Sentence 6</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> <em>Altera paelice haec confirmante</em> — "with the other concubine confirming these things." Tacitus packs the corroboration of the entire accusation into a tight ablative absolute, a grammatical structure that operates independently from the main clause. The brevity is the point: confirmation happens quickly, almost as an aside, because the real focus is on what Calpurnia does next — demand that Narcissus, the puppet-master, be summoned to take control.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "The ablative absolute <em>altera paelice haec confirmante</em> ('with the other concubine confirming these things') efficiently compresses the corroboration into a subordinate grammatical structure, maintaining narrative pace while establishing the credibility of the accusation through dual testimony."
            </div>
        </div>
    </div>

    <script>
        let currentStep = 0;
        let coloursHidden = false;
        const activeCategories = new Set();

        const wordOrders = [];
        document.querySelectorAll('.latin-column .word-group').forEach(group => {
            if (group.dataset.order) {
                wordOrders.push(group.dataset.order);
            }
        });
        wordOrders.sort((a, b) => {
            const [lineA, numA] = a.split('-');
            const [lineB, numB] = b.split('-');
            if (lineA !== lineB) return parseInt(lineA) - parseInt(lineB);
            return parseInt(numA) - parseInt(numB);
        });

        function revealWord(order) {
            const latinGroup = document.querySelector(`.latin-column .word-group[data-order="${order}"]`);
            if (latinGroup) {
                latinGroup.classList.add('revealed');
            }

            document.querySelectorAll(`.english-word`).forEach(word => {
                if (word.dataset.order) {
                    const orders = word.dataset.order.split(',');
                    if (orders.includes(order)) {
                        word.classList.add('revealed');
                    }
                }
            });
        }

        function hideWord(order) {
            const latinGroup = document.querySelector(`.latin-column .word-group[data-order="${order}"]`);
            if (latinGroup) {
                latinGroup.classList.remove('revealed');
            }

            document.querySelectorAll(`.english-word`).forEach(word => {
                if (word.dataset.order) {
                    const orders = word.dataset.order.split(',');
                    if (orders.includes(order)) {
                        word.classList.remove('revealed');
                    }
                }
            });
        }

        function toggleWord(order) {
            const latinGroup = document.querySelector(`.latin-column .word-group[data-order="${order}"]`);
            if (latinGroup && latinGroup.classList.contains('revealed')) {
                hideWord(order);
            } else {
                revealWord(order);
            }
        }

        function stepForward() {
            if (currentStep < wordOrders.length) {
                revealWord(wordOrders[currentStep]);
                currentStep++;
            }
        }

        function stepBackward() {
            if (currentStep > 0) {
                currentStep--;
                hideWord(wordOrders[currentStep]);
            }
        }

        function toggleCategory(category) {
            const keyItem = document.querySelector(`.key-item[data-category="${category}"]`);

            if (activeCategories.has(category)) {
                activeCategories.delete(category);
                keyItem.classList.remove('active');

                document.querySelectorAll(`.latin-column .word-group.${category}`).forEach(group => {
                    group.classList.remove('highlighted');
                });

                document.querySelectorAll(`.english-word.${category}`).forEach(word => {
                    word.classList.remove('highlighted');
                });
            } else {
                activeCategories.add(category);
                keyItem.classList.add('active');

                document.querySelectorAll(`.latin-column .word-group.${category}`).forEach(group => {
                    group.classList.add('highlighted');
                });

                document.querySelectorAll(`.english-word.${category}`).forEach(word => {
                    word.classList.add('highlighted');
                });
            }
        }

        document.getElementById('showAllBtn').addEventListener('click', () => {
            document.querySelectorAll('.latin-column .word-group').forEach(group => {
                if (group.dataset.order) {
                    revealWord(group.dataset.order);
                }
            });
            currentStep = wordOrders.length;
        });

        document.getElementById('hideAllBtn').addEventListener('click', () => {
            document.querySelectorAll('.revealed').forEach(el => {
                el.classList.remove('revealed');
            });
            document.querySelectorAll('.english-word').forEach(el => {
                el.classList.remove('revealed');
            });
            document.querySelectorAll('.highlighted').forEach(el => {
                el.classList.remove('highlighted');
            });
            document.querySelectorAll('.key-item').forEach(el => {
                el.classList.remove('active');
            });
            activeCategories.clear();
            currentStep = 0;
        });

        document.getElementById('toggleColoursBtn').addEventListener('click', () => {
            coloursHidden = !coloursHidden;
            document.body.classList.toggle('hide-colours', coloursHidden);
            document.getElementById('toggleColoursBtn').textContent =
                coloursHidden ? 'Show Colours' : 'Hide Colours';
        });

        document.querySelectorAll('.key-item').forEach(item => {
            item.addEventListener('click', () => {
                toggleCategory(item.dataset.category);
            });
        });

        document.querySelectorAll('.latin-column .word-group').forEach(group => {
            group.addEventListener('click', () => {
                if (group.dataset.order) {
                    toggleWord(group.dataset.order);
                }
            });
        });

        document.querySelectorAll('.english-word').forEach(word => {
            word.addEventListener('click', () => {
                if (word.dataset.order) {
                    const order = word.dataset.order.split(',')[0];
                    toggleWord(order);
                }
            });
        });

        document.querySelectorAll('.english-column .line-number').forEach(lineNum => {
            lineNum.style.cursor = 'pointer';
            lineNum.addEventListener('click', () => {
                const lineRow = lineNum.closest('.line-row');
                const lineOrders = [];
                lineRow.querySelectorAll('.english-word').forEach(word => {
                    if (word.dataset.order) {
                        word.dataset.order.split(',').forEach(order => {
                            if (!lineOrders.includes(order)) {
                                lineOrders.push(order);
                            }
                        });
                    }
                });

                const firstWord = lineRow.querySelector('.english-word');
                const isRevealed = firstWord && firstWord.classList.contains('revealed');

                lineOrders.forEach(order => {
                    if (isRevealed) {
                        hideWord(order);
                    } else {
                        revealWord(order);
                    }
                });
            });
        });

        document.getElementById('toggleStyleBtn').addEventListener('click', () => {
            document.body.classList.toggle('style-mode');
            const isStyleMode = document.body.classList.contains('style-mode');
            document.getElementById('toggleStyleBtn').textContent =
                isStyleMode ? 'Hide Style' : 'Style Notes';

            if (!isStyleMode) {
                document.querySelectorAll('.style-tag.active').forEach(tag => {
                    tag.classList.remove('active');
                });
                document.querySelectorAll('.style-analysis.active').forEach(analysis => {
                    analysis.classList.remove('active');
                });
                document.querySelectorAll('.active-style').forEach(el => {
                    el.classList.remove('active-style');
                });
            }
        });

        document.querySelectorAll('.style-tag').forEach(tag => {
            tag.addEventListener('click', () => {
                const featureId = tag.dataset.feature;
                const isActive = tag.classList.contains('active');

                document.querySelectorAll('.style-tag.active').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.style-analysis.active').forEach(a => a.classList.remove('active'));
                document.querySelectorAll('.active-style').forEach(el => el.classList.remove('active-style'));

                if (!isActive) {
                    tag.classList.add('active');

                    const analysis = document.getElementById('analysis-' + featureId);
                    if (analysis) {
                        analysis.classList.add('active');
                    }

                    document.querySelectorAll('[data-style-feature]').forEach(el => {
                        const features = el.dataset.styleFeature.split(' ');
                        if (features.includes(featureId)) {
                            el.classList.add('active-style');
                        }
                    });
                }
            });
        });

        document.addEventListener('keydown', (e) => {
            if (e.code === 'ArrowRight' || e.code === 'ArrowDown' || e.code === 'PageDown' || e.code === 'Space' || e.code === 'Enter') {
                e.preventDefault();
                stepForward();
            }
            else if (e.code === 'ArrowLeft' || e.code === 'ArrowUp' || e.code === 'PageUp' || e.code === 'Backspace') {
                e.preventDefault();
                stepBackward();
            }
            else if (e.code === 'Escape' || e.code === 'KeyR') {
                document.getElementById('hideAllBtn').click();
            }
        });
    </script>
</body>
</html>
