<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Messalina - Section 8 (Lines 70-79)</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #ffffff;
            color: #333;
            padding: 25px 45px;
            min-height: 100vh;
            margin: 0;
            font-size: 22px;
        }

        .header {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .header-left {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .logo {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #0066ff 0%, #4d94ff 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.5rem;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            text-decoration: none;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-top: 2px;
        }

        .logo:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 102, 255, 0.3);
        }

        .title-area {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        h1 {
            color: #222;
            margin: 0;
            font-size: 1.6em;
            font-weight: 600;
        }

        .subtitle {
            font-size: 1em;
            color: #666;
            margin: 0;
        }

        /* Compact controls */
        .controls-area {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            gap: 4px;
        }

        .controls {
            display: flex;
            gap: 6px;
            justify-content: flex-end;
        }

        .controls button {
            padding: 0.6rem 1rem;
            font-size: 0.9rem;
            font-weight: 500;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: rgba(0, 102, 255, 0.08);
            color: #0066ff;
            flex: 1;
            text-align: center;
        }

        .controls button:hover {
            background: rgba(0, 102, 255, 0.15);
            transform: translateY(-1px);
        }

        #showAllBtn {
            background: #0066ff;
            color: white;
        }

        #showAllBtn:hover {
            background: #0052cc;
        }

        #hideAllBtn {
            background: rgba(0, 102, 255, 0.08);
            color: #0066ff;
        }

        #toggleColoursBtn {
            background: rgba(0, 102, 255, 0.08);
            color: #0066ff;
        }

        #toggleStyleBtn {
            background: rgba(0, 102, 255, 0.08);
            color: #0066ff;
        }

        body.style-mode #toggleStyleBtn {
            background: #0066ff;
            color: white;
        }

        /* Key - compact squares in header */
        .key {
            display: flex;
            gap: 6px;
        }

        .key-item {
            padding: 0.6rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            color: #333;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
            text-align: center;
            border: none;
            flex: 1;
        }

        .key-item:hover {
            transform: translateY(-1px);
            filter: brightness(0.95);
        }

        .key-item.active {
            outline: 2px solid #333;
            outline-offset: 1px;
        }

        /* Main content area */
        .translation-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 60px;
        }

        .column-header {
            font-size: 0.9em;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 15px;
            padding-left: 0;
        }

        /* Each line row */
        .line-row {
            display: flex;
            align-items: flex-end;
            margin-bottom: 14px;
            flex-wrap: wrap;
        }

        .line-number {
            display: none;
            color: #0066ff;
            font-weight: bold;
            min-width: 45px;
            margin-right: 10px;
            font-size: 1.15em;
            align-self: flex-end;
            padding-bottom: 4px;
        }

        .words-container {
            display: flex;
            align-items: flex-end;
            gap: 3px;
            flex-wrap: wrap;
        }

        /* Word group with number above */
        .word-group {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }

        .word-order {
            font-size: 0.65em;
            color: #888;
            margin-bottom: 4px;
            height: 1em;
            font-weight: 600;
        }

        .latin-word, .english-word {
            padding: 3px 7px;
            border-radius: 3px;
            font-size: 1em;
            transition: background-color 0.3s, opacity 0.3s;
            cursor: pointer;
        }

        .latin-word {
            background-color: transparent;
        }

        .english-word {
            opacity: 0;
        }

        .english-word.revealed {
            opacity: 1;
        }

        /* Colours */
        .subject .latin-word { background-color: #ffb3b3; }
        .english-word.subject { background-color: #ffb3b3; }

        .verb .latin-word { background-color: #b3e6ff; }
        .english-word.verb { background-color: #b3e6ff; }

        .object .latin-word { background-color: #b3ffcc; }
        .english-word.object { background-color: #b3ffcc; }

        .genitive .latin-word { background-color: #ffd9b3; }
        .english-word.genitive { background-color: #ffd9b3; }

        .dative .latin-word { background-color: #e6b3ff; }
        .english-word.dative { background-color: #e6b3ff; }

        .ablative .latin-word { background-color: #ffffb3; }
        .english-word.ablative { background-color: #ffffb3; }

        .preposition .latin-word { background-color: #ffb3e6; }
        .english-word.preposition { background-color: #ffb3e6; }

        .conjunction .latin-word { background-color: #d9ffb3; }
        .english-word.conjunction { background-color: #d9ffb3; }

        .adverb .latin-word { background-color: #ccb3ff; }
        .english-word.adverb { background-color: #ccb3ff; }

        .gerundive .latin-word { background-color: #ffcbb3; }
        .english-word.gerundive { background-color: #ffcbb3; }

        /* Highlighting */
        .subject.highlighted .latin-word { background-color: #ffb3b3 !important; }
        .english-word.subject.highlighted { background-color: #ffb3b3 !important; }
        .verb.highlighted .latin-word { background-color: #b3e6ff !important; }
        .english-word.verb.highlighted { background-color: #b3e6ff !important; }
        .object.highlighted .latin-word { background-color: #b3ffcc !important; }
        .english-word.object.highlighted { background-color: #b3ffcc !important; }
        .genitive.highlighted .latin-word { background-color: #ffd9b3 !important; }
        .english-word.genitive.highlighted { background-color: #ffd9b3 !important; }
        .dative.highlighted .latin-word { background-color: #e6b3ff !important; }
        .english-word.dative.highlighted { background-color: #e6b3ff !important; }
        .ablative.highlighted .latin-word { background-color: #ffffb3 !important; }
        .english-word.ablative.highlighted { background-color: #ffffb3 !important; }
        .preposition.highlighted .latin-word { background-color: #ffb3e6 !important; }
        .english-word.preposition.highlighted { background-color: #ffb3e6 !important; }
        .conjunction.highlighted .latin-word { background-color: #d9ffb3 !important; }
        .english-word.conjunction.highlighted { background-color: #d9ffb3 !important; }
        .adverb.highlighted .latin-word { background-color: #ccb3ff !important; }
        .english-word.adverb.highlighted { background-color: #ccb3ff !important; }
        .gerundive.highlighted .latin-word { background-color: #ffcbb3 !important; }
        .english-word.gerundive.highlighted { background-color: #ffcbb3 !important; }

        /* Hide colours mode */
        body.hide-colours .subject .latin-word,
        body.hide-colours .english-word.subject.revealed,
        body.hide-colours .verb .latin-word,
        body.hide-colours .english-word.verb.revealed,
        body.hide-colours .object .latin-word,
        body.hide-colours .english-word.object.revealed,
        body.hide-colours .genitive .latin-word,
        body.hide-colours .english-word.genitive.revealed,
        body.hide-colours .dative .latin-word,
        body.hide-colours .english-word.dative.revealed,
        body.hide-colours .ablative .latin-word,
        body.hide-colours .english-word.ablative.revealed,
        body.hide-colours .preposition .latin-word,
        body.hide-colours .english-word.preposition.revealed,
        body.hide-colours .conjunction .latin-word,
        body.hide-colours .english-word.conjunction.revealed,
        body.hide-colours .adverb .latin-word,
        body.hide-colours .english-word.adverb.revealed,
        body.hide-colours .gerundive .latin-word,
        body.hide-colours .english-word.gerundive.revealed {
            background-color: #e0e0e0;
        }

        /* Style Mode */
        .style-highlight {
            position: relative;
        }

        .style-highlight.active-style .latin-word {
            outline: 2px solid #333;
            outline-offset: 1px;
        }

        /* Style panel at bottom */
        .style-panel {
            display: none;
            background: rgba(0, 102, 255, 0.03);
            border-top: 2px solid rgba(0, 102, 255, 0.15);
            padding: 18px 24px;
            margin-top: 20px;
        }

        body.style-mode .style-panel {
            display: block;
        }

        .style-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .style-panel h3 {
            margin: 0;
            color: #0066ff;
            font-size: 1rem;
            font-weight: 600;
        }

        .style-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .style-tag {
            padding: 8px 14px;
            background: white;
            border: 1px solid rgba(0, 102, 255, 0.25);
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #333;
        }

        .style-tag:hover {
            border-color: #0066ff;
            background: rgba(0, 102, 255, 0.05);
        }

        .style-tag.active {
            background: #0066ff;
            color: white;
            border-color: #0066ff;
        }

        .style-tag em {
            font-style: italic;
        }

        .style-analysis {
            display: none;
            padding: 16px 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid rgba(0, 102, 255, 0.15);
        }

        .style-analysis.active {
            display: block;
        }

        .style-analysis-title {
            font-weight: 600;
            color: #0066ff;
            margin-bottom: 6px;
            font-size: 1rem;
        }

        .style-analysis-lines {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }

        .style-analysis-effect {
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .style-analysis-effect strong {
            color: #0066ff;
        }

        .style-analysis-exam {
            padding-top: 12px;
            border-top: 1px dashed #ddd;
            font-size: 0.9rem;
            color: #555;
            line-height: 1.5;
        }

        .style-analysis-exam strong {
            color: #333;
        }

        .style-analysis em {
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-top">
            <div class="header-left">
                <a href="https://www.classicalia.co.uk" class="logo">C</a>
                <div class="title-area">
                    <h1>Messalina</h1>
                    <p class="subtitle">Section 8 (Lines 70-79): Narcissus orders a tribune to murder Messalina</p>
                </div>
            </div>
            <div class="controls-area">
                <div class="controls">
                    <button id="showAllBtn">Show All</button>
                    <button id="hideAllBtn">Hide All</button>
                    <button id="toggleColoursBtn">Hide Colours</button>
                    <button id="toggleStyleBtn">Style Notes</button>
                </div>
                <div class="key">
                    <span class="key-item" data-category="subject" style="background-color: #ffb3b3;">Subj.</span>
                    <span class="key-item" data-category="object" style="background-color: #b3ffcc;">Obj.</span>
                    <span class="key-item" data-category="verb" style="background-color: #b3e6ff;">Verb</span>
                    <span class="key-item" data-category="genitive" style="background-color: #ffd9b3;">Gen.</span>
                    <span class="key-item" data-category="dative" style="background-color: #e6b3ff;">Dat.</span>
                    <span class="key-item" data-category="ablative" style="background-color: #ffffb3;">Abl.</span>
                    <span class="key-item" data-category="preposition" style="background-color: #ffb3e6;">Prep.</span>
                    <span class="key-item" data-category="conjunction" style="background-color: #d9ffb3;">Conj.</span>
                    <span class="key-item" data-category="adverb" style="background-color: #ccb3ff;">Adv.</span>
                    <span class="key-item" data-category="gerundive" style="background-color: #ffcbb3;">Gdv.</span>
                </div>
            </div>
        </div>
    </div>

    <div class="translation-area">
        <!-- LATIN COLUMN -->
        <div class="latin-column">
            <div class="column-header">Latin</div>

            <!-- Sentence 1: nam Claudius domum regressus, ubi cena vinoque incaluit, imperavit ut femina misera (hoc enim verbo Claudium usum esse ferunt) ad causam dicendam postridie adesset. -->
            <div class="line-row" data-line="1">
                <span class="line-number">1</span>
                <div class="words-container">
                    <span class="word-group conjunction" data-order="01-01"><span class="word-order">1</span><span class="latin-word">nam</span></span>
                    <span class="word-group subject style-highlight" data-order="01-02" data-style-feature="femina-misera"><span class="word-order">2</span><span class="latin-word">Claudius</span></span>
                    <span class="word-group object" data-order="01-04"><span class="word-order">4</span><span class="latin-word">domum</span></span>
                    <span class="word-group verb" data-order="01-03"><span class="word-order">3</span><span class="latin-word">regressus,</span></span>
                    <span class="word-group conjunction" data-order="01-05"><span class="word-order">5</span><span class="latin-word">ubi</span></span>
                    <span class="word-group ablative style-highlight" data-order="01-07" data-style-feature="cena-vino"><span class="word-order">7</span><span class="latin-word">cena</span></span>
                    <span class="word-group ablative style-highlight" data-order="01-08" data-style-feature="cena-vino"><span class="word-order">8</span><span class="latin-word">vinoque</span></span>
                    <span class="word-group verb" data-order="01-06"><span class="word-order">6</span><span class="latin-word">incaluit,</span></span>
                    <span class="word-group verb" data-order="01-09"><span class="word-order">9</span><span class="latin-word">imperavit</span></span>
                    <span class="word-group conjunction" data-order="01-10"><span class="word-order">10</span><span class="latin-word">ut</span></span>
                    <span class="word-group subject style-highlight" data-order="01-12" data-style-feature="femina-misera"><span class="word-order">12</span><span class="latin-word">femina</span></span>
                    <span class="word-group subject style-highlight" data-order="01-11" data-style-feature="femina-misera"><span class="word-order">11</span><span class="latin-word">misera</span></span>
                    <span class="word-group ablative style-highlight" data-order="01-14" data-style-feature="hoc-verbo"><span class="word-order">14</span><span class="latin-word">(hoc</span></span>
                    <span class="word-group conjunction style-highlight" data-order="01-13" data-style-feature="hoc-verbo"><span class="word-order">13</span><span class="latin-word">enim</span></span>
                    <span class="word-group ablative style-highlight" data-order="01-15" data-style-feature="hoc-verbo"><span class="word-order">15</span><span class="latin-word">verbo</span></span>
                    <span class="word-group object style-highlight" data-order="01-16" data-style-feature="hoc-verbo"><span class="word-order">16</span><span class="latin-word">Claudium</span></span>
                    <span class="word-group verb style-highlight" data-order="01-17" data-style-feature="hoc-verbo"><span class="word-order">17</span><span class="latin-word">usum esse</span></span>
                    <span class="word-group verb style-highlight" data-order="01-18" data-style-feature="hoc-verbo"><span class="word-order">18</span><span class="latin-word">ferunt)</span></span>
                    <span class="word-group preposition style-highlight" data-order="01-19" data-style-feature="ad-causam-dicendam"><span class="word-order">19</span><span class="latin-word">ad</span></span>
                    <span class="word-group object style-highlight" data-order="01-20" data-style-feature="ad-causam-dicendam"><span class="word-order">20</span><span class="latin-word">causam</span></span>
                    <span class="word-group gerundive style-highlight" data-order="01-21" data-style-feature="ad-causam-dicendam"><span class="word-order">21</span><span class="latin-word">dicendam</span></span>
                    <span class="word-group adverb" data-order="01-22"><span class="word-order">22</span><span class="latin-word">postridie</span></span>
                    <span class="word-group verb" data-order="01-23"><span class="word-order">23</span><span class="latin-word">adesset.</span></span>
                </div>
            </div>

            <!-- Sentence 2: quod ubi Narcissus audivit et languescere iram redire amorem vidit, timebat, si moraretur, propinquam noctem et uxorii cubiculi memoriam; -->
            <div class="line-row" data-line="2">
                <span class="line-number">2</span>
                <div class="words-container">
                    <span class="word-group object" data-order="02-02"><span class="word-order">2</span><span class="latin-word">quod</span></span>
                    <span class="word-group conjunction" data-order="02-03"><span class="word-order">3</span><span class="latin-word">ubi</span></span>
                    <span class="word-group subject" data-order="02-01"><span class="word-order">1</span><span class="latin-word">Narcissus</span></span>
                    <span class="word-group verb" data-order="02-04"><span class="word-order">4</span><span class="latin-word">audivit</span></span>
                    <span class="word-group conjunction" data-order="02-05"><span class="word-order">5</span><span class="latin-word">et</span></span>
                    <span class="word-group verb style-highlight" data-order="02-08" data-style-feature="chiasmus"><span class="word-order">8</span><span class="latin-word">languescere</span></span>
                    <span class="word-group object style-highlight" data-order="02-07" data-style-feature="chiasmus"><span class="word-order">7</span><span class="latin-word">iram</span></span>
                    <span class="word-group verb style-highlight" data-order="02-09" data-style-feature="chiasmus"><span class="word-order">9</span><span class="latin-word">redire</span></span>
                    <span class="word-group object style-highlight" data-order="02-06" data-style-feature="chiasmus"><span class="word-order">6</span><span class="latin-word">amorem</span></span>
                    <span class="word-group verb" data-order="02-10"><span class="word-order">10</span><span class="latin-word">vidit,</span></span>
                    <span class="word-group verb" data-order="02-11"><span class="word-order">11</span><span class="latin-word">timebat,</span></span>
                    <span class="word-group conjunction" data-order="02-12"><span class="word-order">12</span><span class="latin-word">si</span></span>
                    <span class="word-group verb" data-order="02-13"><span class="word-order">13</span><span class="latin-word">moraretur,</span></span>
                    <span class="word-group object style-highlight" data-order="02-14" data-style-feature="propinquam-noctem"><span class="word-order">14</span><span class="latin-word">propinquam</span></span>
                    <span class="word-group object style-highlight" data-order="02-15" data-style-feature="propinquam-noctem"><span class="word-order">15</span><span class="latin-word">noctem</span></span>
                    <span class="word-group conjunction" data-order="02-16"><span class="word-order">16</span><span class="latin-word">et</span></span>
                    <span class="word-group genitive style-highlight" data-order="02-18" data-style-feature="uxorii-cubiculi"><span class="word-order">18</span><span class="latin-word">uxorii</span></span>
                    <span class="word-group genitive style-highlight" data-order="02-19" data-style-feature="uxorii-cubiculi"><span class="word-order">19</span><span class="latin-word">cubiculi</span></span>
                    <span class="word-group object style-highlight" data-order="02-17" data-style-feature="uxorii-cubiculi"><span class="word-order">17</span><span class="latin-word">memoriam;</span></span>
                </div>
            </div>

            <!-- Sentence 3: igitur prorumpit denuntiatque centurionibus et tribuno, qui aderat, exsequi caedem: ita imperatorem iubere. -->
            <div class="line-row" data-line="3">
                <span class="line-number">3</span>
                <div class="words-container">
                    <span class="word-group conjunction" data-order="03-01"><span class="word-order">1</span><span class="latin-word">igitur</span></span>
                    <span class="word-group verb style-highlight" data-order="03-02" data-style-feature="prorumpit-denuntiatque"><span class="word-order">2</span><span class="latin-word">prorumpit</span></span>
                    <span class="word-group verb style-highlight" data-order="03-03" data-style-feature="prorumpit-denuntiatque"><span class="word-order">3</span><span class="latin-word">denuntiatque</span></span>
                    <span class="word-group dative" data-order="03-04"><span class="word-order">4</span><span class="latin-word">centurionibus</span></span>
                    <span class="word-group conjunction" data-order="03-05"><span class="word-order">5</span><span class="latin-word">et</span></span>
                    <span class="word-group dative" data-order="03-06"><span class="word-order">6</span><span class="latin-word">tribuno,</span></span>
                    <span class="word-group subject" data-order="03-07"><span class="word-order">7</span><span class="latin-word">qui</span></span>
                    <span class="word-group verb" data-order="03-08"><span class="word-order">8</span><span class="latin-word">aderat,</span></span>
                    <span class="word-group verb" data-order="03-09"><span class="word-order">9</span><span class="latin-word">exsequi</span></span>
                    <span class="word-group object" data-order="03-10"><span class="word-order">10</span><span class="latin-word">caedem:</span></span>
                    <span class="word-group adverb style-highlight" data-order="03-11" data-style-feature="ita-imperatorem-iubere"><span class="word-order">11</span><span class="latin-word">ita</span></span>
                    <span class="word-group object style-highlight" data-order="03-12" data-style-feature="ita-imperatorem-iubere"><span class="word-order">12</span><span class="latin-word">imperatorem</span></span>
                    <span class="word-group verb style-highlight" data-order="03-13" data-style-feature="ita-imperatorem-iubere"><span class="word-order">13</span><span class="latin-word">iubere.</span></span>
                </div>
            </div>

            <!-- Sentence 4: missus quoque unus e libertis: is raptim in hortos praegressus repperit Messalinam, humi fusam; -->
            <div class="line-row" data-line="4">
                <span class="line-number">4</span>
                <div class="words-container">
                    <span class="word-group verb" data-order="04-02"><span class="word-order">2</span><span class="latin-word">missus</span></span>
                    <span class="word-group adverb" data-order="04-03"><span class="word-order">3</span><span class="latin-word">quoque</span></span>
                    <span class="word-group subject" data-order="04-01"><span class="word-order">1</span><span class="latin-word">unus</span></span>
                    <span class="word-group preposition" data-order="04-04"><span class="word-order">4</span><span class="latin-word">e</span></span>
                    <span class="word-group ablative" data-order="04-05"><span class="word-order">5</span><span class="latin-word">libertis:</span></span>
                    <span class="word-group subject" data-order="04-06"><span class="word-order">6</span><span class="latin-word">is</span></span>
                    <span class="word-group adverb" data-order="04-08"><span class="word-order">8</span><span class="latin-word">raptim</span></span>
                    <span class="word-group preposition" data-order="04-09"><span class="word-order">9</span><span class="latin-word">in</span></span>
                    <span class="word-group object" data-order="04-10"><span class="word-order">10</span><span class="latin-word">hortos</span></span>
                    <span class="word-group verb" data-order="04-07"><span class="word-order">7</span><span class="latin-word">praegressus</span></span>
                    <span class="word-group verb" data-order="04-11"><span class="word-order">11</span><span class="latin-word">repperit</span></span>
                    <span class="word-group object" data-order="04-12"><span class="word-order">12</span><span class="latin-word">Messalinam,</span></span>
                    <span class="word-group ablative style-highlight" data-order="04-13" data-style-feature="humi-fusam"><span class="word-order">13</span><span class="latin-word">humi</span></span>
                    <span class="word-group verb style-highlight" data-order="04-14" data-style-feature="humi-fusam"><span class="word-order">14</span><span class="latin-word">fusam;</span></span>
                </div>
            </div>
        </div>

        <!-- ENGLISH COLUMN -->
        <div class="english-column">
            <div class="column-header">English</div>

            <!-- Sentence 1 English -->
            <div class="line-row" data-line="1">
                <span class="line-number">1</span>
                <div class="words-container">
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="01-01">For</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="01-02">Claudius,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="01-03">having returned</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="01-04">home,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="01-05">when</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="01-06">was heated</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word ablative" data-order="01-07">with the meal</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word ablative" data-order="01-08">and wine,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="01-09">he ordered</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="01-10">that</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="01-11">the wretched</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="01-12">woman</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="01-13">(for</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word ablative" data-order="01-14">this (is)</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word ablative" data-order="01-15">the word</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="01-16">Claudius</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="01-17">used,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="01-18">they say)</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word preposition" data-order="01-19">to</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="01-20">her case</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word gerundive" data-order="01-21">to plead</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="01-22">the next day.</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="01-23">should be present</span></span>
                </div>
            </div>

            <!-- Sentence 2 English -->
            <div class="line-row" data-line="2">
                <span class="line-number">2</span>
                <div class="words-container">
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="02-01">Narcissus</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="02-02">this</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="02-03">When</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="02-04">heard</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="02-05">and</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="02-06">(his) love</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="02-07">(his) anger</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="02-08">was declining</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="02-09">was returning,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="02-10">saw (that)</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="02-11">he began to fear,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="02-12">if</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="02-13">he delayed,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="02-14">the approaching</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="02-15">night</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="02-16">and</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="02-17">the memory</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word genitive" data-order="02-18">of his wife's</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word genitive" data-order="02-19">bedroom;</span></span>
                </div>
            </div>

            <!-- Sentence 3 English -->
            <div class="line-row" data-line="3">
                <span class="line-number">3</span>
                <div class="words-container">
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="03-01">therefore,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="03-02">he burst forth</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="03-03">and ordered</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word dative" data-order="03-04">the centurions</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="03-05">and</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word dative" data-order="03-06">a tribune,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="03-07">who</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="03-08">was present,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="03-09">to carry out</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="03-10">the slaughter:</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="03-11">this is what</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="03-12">the emperor</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="03-13">was ordering.</span></span>
                </div>
            </div>

            <!-- Sentence 4 English -->
            <div class="line-row" data-line="4">
                <span class="line-number">4</span>
                <div class="words-container">
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="04-01">One</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="04-02">was ... sent;</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="04-03">also</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word preposition" data-order="04-04">of</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word ablative" data-order="04-05">the freedmen</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="04-06">he,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="04-07">having gone before (the rest),</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="04-08">swiftly</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word preposition" data-order="04-09">to</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="04-10">the gardens</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="04-11">found</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="04-12">Messalina,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word ablative" data-order="04-13">on the ground;</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="04-14">prostrate</span></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Style Panel -->
    <div class="style-panel">
        <div class="style-panel-header">
            <h3>Stylistic Features</h3>
        </div>
        <div class="style-list">
            <span class="style-tag" data-feature="femina-misera">Parenthetical — <em>hoc enim verbo Claudium usum esse ferunt</em></span>
            <span class="style-tag" data-feature="ad-causam-dicendam">Gerundive of Purpose — <em>ad causam dicendam</em></span>
            <span class="style-tag" data-feature="chiasmus">Chiasmus — <em>languescere iram redire amorem</em></span>
            <span class="style-tag" data-feature="propinquam-noctem">Fear Motif — <em>propinquam noctem et... cubiculi memoriam</em></span>
            <span class="style-tag" data-feature="prorumpit-denuntiatque">Historic Present — <em>prorumpit, denuntiatque</em></span>
            <span class="style-tag" data-feature="humi-fusam">Pathos — <em>humi fusam</em></span>
            <span class="style-tag" data-feature="cena-vino">Implied Indulgence — <em>cena vinoque</em></span>
            <span class="style-tag" data-feature="hoc-verbo">Authorial Distance — <em>ferunt</em></span>
            <span class="style-tag" data-feature="uxorii-cubiculi">Intimate Detail — <em>uxorii cubiculi memoriam</em></span>
            <span class="style-tag" data-feature="ita-imperatorem-iubere">Imperial Title — <em>ita imperatorem iubere</em></span>
        </div>

        <div class="style-analysis" id="analysis-femina-misera">
            <div class="style-analysis-title">Parenthetical — hoc enim verbo Claudium usum esse ferunt</div>
            <div class="style-analysis-lines">Sentence 1</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> Tacitus breaks the narrative flow to insert a devastating parenthetical aside: "for they say this is the word Claudius used." He's telling us that Claudius actually called Messalina <em>misera</em> — "wretched." This one word reveals everything about Claudius's emotional state. He's not furious. He's not vengeful. He <em>pities</em> her. The man whose wife publicly married another man while he was still emperor feels sorry for her. Narcissus hears "misera" and immediately knows the whole plan is in danger — because an emperor who pities his treacherous wife is an emperor about to forgive her.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "The parenthetical <em>hoc enim verbo Claudium usum esse ferunt</em> interrupts the narrative to preserve a telling detail: Claudius's use of <em>misera</em> reveals his softening attitude and foreshadows the danger Narcissus perceives in the emperor's wavering resolve."
            </div>
        </div>

        <div class="style-analysis" id="analysis-ad-causam-dicendam">
            <div class="style-analysis-title">Gerundive of Purpose — ad causam dicendam</div>
            <div class="style-analysis-lines">Sentence 1</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> Legal language — "to plead her case." This is the formal terminology of the Roman courts, which makes it sound like Claudius is being proper and fair. He's ordering a trial, due process, the chance to speak in her own defence. Except we know — and Narcissus certainly knows — that this "trial" would never happen. If Messalina got to speak, she might win Claudius back. The legal language is deeply ironic: the forms of justice are being invoked, but Narcissus will ensure they're never carried out. Roman law says she deserves a hearing; Narcissus says she deserves a sword.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "The gerundive of purpose <em>ad causam dicendam</em> employs formal legal language, creating dramatic irony: Claudius offers due process that Narcissus will ensure is never fulfilled, exposing the gap between legal propriety and political reality."
            </div>
        </div>

        <div class="style-analysis" id="analysis-chiasmus">
            <div class="style-analysis-title">Chiasmus — languescere iram redire amorem</div>
            <div class="style-analysis-lines">Sentence 2</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> This is a perfect ABBA chiasmus: verb (<em>languescere</em>) — noun (<em>iram</em>) — verb (<em>redire</em>) — noun (<em>amorem</em>). The pattern mirrors the reversal of emotions it describes. Anger is declining (A-B), love is returning (B-A) — and the crossed structure literally shows these emotions crossing over, switching places. What was dominant (anger) fades; what was suppressed (love) returns. Tacitus doesn't just tell us Claudius's feelings are changing — the word order itself enacts the change. It's like watching a set of scales tip in real time.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "The chiastic arrangement <em>languescere iram redire amorem</em> (verb-noun-verb-noun: ABBA) formally enacts the reversal of Claudius's emotions, with the crossed word order mirroring the inversion from anger to love that so alarms Narcissus."
            </div>
        </div>

        <div class="style-analysis" id="analysis-propinquam-noctem">
            <div class="style-analysis-title">Fear Motif — propinquam noctem et... cubiculi memoriam</div>
            <div class="style-analysis-lines">Sentence 2</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> Narcissus fears two specific things: the approaching night and the memory of the marriage bed. These aren't random fears — they're terrifyingly precise. Night means privacy, darkness, the intimacy of the bedroom. And "the memory of the marriage bed" (<em>uxorii cubiculi memoriam</em>) makes explicit what Narcissus dreads most: that physical closeness will undo everything. Claudius, already softening, might lie in their shared bed and remember not the betrayal but the love. The bedroom becomes a political weapon — intimacy as the ultimate tool of persuasion that no freedman's scheming can counter.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "Narcissus's fear of <em>propinquam noctem et uxorii cubiculi memoriam</em> reveals the intersection of the personal and the political: physical intimacy threatens to override political calculation, making the marital bedroom the site of potential reversal."
            </div>
        </div>

        <div class="style-analysis" id="analysis-prorumpit-denuntiatque">
            <div class="style-analysis-title">Historic Present — prorumpit, denuntiatque</div>
            <div class="style-analysis-lines">Sentence 3</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> After a sequence of past tenses (<em>audivit</em>, <em>vidit</em>, <em>timebat</em>), Tacitus suddenly switches to the present: <em>prorumpit</em> ("he bursts forth"), <em>denuntiatque</em> ("and he orders"). The shift is electric. We're yanked from narration into the moment itself. <em>Prorumpit</em> is a violent word — the kind Virgil uses for the sea surging forth or warriors erupting from ambush. Narcissus doesn't walk out calmly; he explodes into action. The historic present makes us witnesses to this frantic, desperate moment: a freedman seizing control of the Roman Empire because the emperor can't be trusted to stay angry at his own wife.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "The shift to historic present in <em>prorumpit denuntiatque</em> creates vivid immediacy after the imperfect <em>timebat</em>, dramatising Narcissus's explosive transition from fear to decisive action at this critical moment."
            </div>
        </div>

        <div class="style-analysis" id="analysis-humi-fusam">
            <div class="style-analysis-title">Pathos — humi fusam</div>
            <div class="style-analysis-lines">Sentence 4</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> "Prostrate on the ground." Two words, and the empress is reduced to her lowest point — literally and metaphorically. <em>Humi fusam</em> is stark, brutal, almost clinical in its brevity. No elaborate description, no editorial comment. Just: she was on the ground. The woman who paraded with attendants, who maintained <em>tantam superbiam</em> ("such arrogance"), who publicly married another man while her husband was still emperor — she's now face-down in the dirt of her own gardens. Tacitus doesn't need to comment. The image does all the work. It's the visual summary of an entire fall from power, compressed into two devastating words.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "The terse phrase <em>humi fusam</em> ('prostrate on the ground') conveys Messalina's complete fall from imperial power with devastating economy, the physical image of prostration symbolising her utter political and personal destruction."
            </div>
        </div>

        <div class="style-analysis" id="analysis-cena-vino">
            <div class="style-analysis-title">Implied Indulgence — cena vinoque</div>
            <div class="style-analysis-lines">Sentence 1</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> Tacitus isn't just describing a meal — he's implying a binge. Claudius, after one of the most dramatic days of his reign, sits down and gets warm with food and wine. <em>Incaluit</em> ("he grew warm/heated up") suggests more than a casual sip; the man is mellowing, his edge dulling, his resolve softening. In Roman political contexts, dining and drinking often led to disastrous decisions. Tacitus is showing us an emperor who is not in control — drunk, comfortable, and dangerously sentimental. The very thing that should sharpen his judgment (the crisis) is being dissolved by the very Roman combination of <em>cena</em> and <em>vinum</em>.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "The ablatives <em>cena vinoque</em> with <em>incaluit</em> characterise Claudius as weakened by indulgence, his political resolve dissolving through physical comfort — a devastating portrait of imperial inadequacy at a moment of crisis."
            </div>
        </div>

        <div class="style-analysis" id="analysis-hoc-verbo">
            <div class="style-analysis-title">Authorial Distance — ferunt</div>
            <div class="style-analysis-lines">Sentence 1</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> "They say" — <em>ferunt</em>. Tacitus isn't committing himself to the claim. He didn't hear Claudius say <em>misera</em> himself; he's citing unnamed sources. This is classic Tacitean technique: by saying "they say," he appears neutral and objective, a careful historian citing his evidence. But in practice, the effect is sly and devastating. He gets to include the damaging detail — Claudius pitied his treacherous wife — while maintaining plausible deniability. It's like a journalist writing "sources close to the president say..." The distance is formal, not real.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "The verb <em>ferunt</em> ('they say') creates authorial distance, allowing Tacitus to include the politically revealing detail of Claudius's word choice while maintaining the appearance of historiographical objectivity."
            </div>
        </div>

        <div class="style-analysis" id="analysis-uxorii-cubiculi">
            <div class="style-analysis-title">Intimate Detail — uxorii cubiculi memoriam</div>
            <div class="style-analysis-lines">Sentence 2</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> "The memory of the marriage bed." This is a deliberately uncomfortable phrase. <em>Uxorii cubiculi</em> — the bedroom specifically associated with a wife, the marital chamber — takes us right into the most private space of the imperial household. Narcissus isn't just worried about abstract "reconciliation"; he's worried about what happens when Claudius lies in the bed he shared with Messalina and remembers their physical intimacy. The detail is visceral and deeply personal. Tacitus shows us a freedman who understands human nature with terrifying precision: memories of physical closeness could override months of political scheming in a single night.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "The phrase <em>uxorii cubiculi memoriam</em> ('the memory of the marriage bed') introduces the private sphere into the political narrative, suggesting that physical intimacy could subvert political calculation and undo Narcissus's machinations."
            </div>
        </div>

        <div class="style-analysis" id="analysis-ita-imperatorem-iubere">
            <div class="style-analysis-title">Imperial Title — ita imperatorem iubere</div>
            <div class="style-analysis-lines">Sentence 3</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> "Thus the emperor was ordering." <em>Imperatorem</em> — emperor — is a rare word for Claudius in Tacitus, who usually calls him <em>princeps</em> (first citizen). The choice is deeply ironic. Narcissus invokes the most militaristic, most authoritative title available to claim an order that Claudius almost certainly never gave. The brief, clipped phrase in indirect speech — just three words — has a suspicious brevity. Real imperial commands came with context, justification, ceremony. This sounds like a freedman making it up on the spot and hoping the soldiers don't ask questions. The irony cuts both ways: Claudius is finally described as an emperor (<em>imperator</em>) at exactly the moment when someone else is pulling his strings.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "The rare use of <em>imperatorem</em> (rather than the usual <em>princeps</em>) creates bitter irony: Claudius is accorded the most authoritative imperial title precisely when his authority is being usurped by a freedman fabricating orders in his name."
            </div>
        </div>
    </div>

    <script>
        let currentStep = 0;
        let coloursHidden = false;
        const activeCategories = new Set();

        const wordOrders = [];
        document.querySelectorAll('.latin-column .word-group').forEach(group => {
            if (group.dataset.order) {
                wordOrders.push(group.dataset.order);
            }
        });
        wordOrders.sort((a, b) => {
            const [lineA, numA] = a.split('-');
            const [lineB, numB] = b.split('-');
            if (lineA !== lineB) return parseInt(lineA) - parseInt(lineB);
            return parseInt(numA) - parseInt(numB);
        });

        function revealWord(order) {
            const latinGroup = document.querySelector(`.latin-column .word-group[data-order="${order}"]`);
            if (latinGroup) {
                latinGroup.classList.add('revealed');
            }

            document.querySelectorAll(`.english-word`).forEach(word => {
                if (word.dataset.order) {
                    const orders = word.dataset.order.split(',');
                    if (orders.includes(order)) {
                        word.classList.add('revealed');
                    }
                }
            });
        }

        function hideWord(order) {
            const latinGroup = document.querySelector(`.latin-column .word-group[data-order="${order}"]`);
            if (latinGroup) {
                latinGroup.classList.remove('revealed');
            }

            document.querySelectorAll(`.english-word`).forEach(word => {
                if (word.dataset.order) {
                    const orders = word.dataset.order.split(',');
                    if (orders.includes(order)) {
                        word.classList.remove('revealed');
                    }
                }
            });
        }

        function toggleWord(order) {
            const latinGroup = document.querySelector(`.latin-column .word-group[data-order="${order}"]`);
            if (latinGroup && latinGroup.classList.contains('revealed')) {
                hideWord(order);
            } else {
                revealWord(order);
            }
        }

        function stepForward() {
            if (currentStep < wordOrders.length) {
                revealWord(wordOrders[currentStep]);
                currentStep++;
            }
        }

        function stepBackward() {
            if (currentStep > 0) {
                currentStep--;
                hideWord(wordOrders[currentStep]);
            }
        }

        function toggleCategory(category) {
            const keyItem = document.querySelector(`.key-item[data-category="${category}"]`);

            if (activeCategories.has(category)) {
                activeCategories.delete(category);
                keyItem.classList.remove('active');

                document.querySelectorAll(`.latin-column .word-group.${category}`).forEach(group => {
                    group.classList.remove('highlighted');
                });

                document.querySelectorAll(`.english-word.${category}`).forEach(word => {
                    word.classList.remove('highlighted');
                });
            } else {
                activeCategories.add(category);
                keyItem.classList.add('active');

                document.querySelectorAll(`.latin-column .word-group.${category}`).forEach(group => {
                    group.classList.add('highlighted');
                });

                document.querySelectorAll(`.english-word.${category}`).forEach(word => {
                    word.classList.add('highlighted');
                });
            }
        }

        document.getElementById('showAllBtn').addEventListener('click', () => {
            document.querySelectorAll('.latin-column .word-group').forEach(group => {
                if (group.dataset.order) {
                    revealWord(group.dataset.order);
                }
            });
            currentStep = wordOrders.length;
        });

        document.getElementById('hideAllBtn').addEventListener('click', () => {
            document.querySelectorAll('.revealed').forEach(el => {
                el.classList.remove('revealed');
            });
            document.querySelectorAll('.english-word').forEach(el => {
                el.classList.remove('revealed');
            });
            document.querySelectorAll('.highlighted').forEach(el => {
                el.classList.remove('highlighted');
            });
            document.querySelectorAll('.key-item').forEach(el => {
                el.classList.remove('active');
            });
            activeCategories.clear();
            currentStep = 0;
        });

        document.getElementById('toggleColoursBtn').addEventListener('click', () => {
            coloursHidden = !coloursHidden;
            document.body.classList.toggle('hide-colours', coloursHidden);
            document.getElementById('toggleColoursBtn').textContent =
                coloursHidden ? 'Show Colours' : 'Hide Colours';
        });

        document.querySelectorAll('.key-item').forEach(item => {
            item.addEventListener('click', () => {
                toggleCategory(item.dataset.category);
            });
        });

        document.querySelectorAll('.latin-column .word-group').forEach(group => {
            group.addEventListener('click', () => {
                if (group.dataset.order) {
                    toggleWord(group.dataset.order);
                }
            });
        });

        document.querySelectorAll('.english-word').forEach(word => {
            word.addEventListener('click', () => {
                if (word.dataset.order) {
                    const order = word.dataset.order.split(',')[0];
                    toggleWord(order);
                }
            });
        });

        document.querySelectorAll('.english-column .line-number').forEach(lineNum => {
            lineNum.style.cursor = 'pointer';
            lineNum.addEventListener('click', () => {
                const lineRow = lineNum.closest('.line-row');
                const lineOrders = [];
                lineRow.querySelectorAll('.english-word').forEach(word => {
                    if (word.dataset.order) {
                        word.dataset.order.split(',').forEach(order => {
                            if (!lineOrders.includes(order)) {
                                lineOrders.push(order);
                            }
                        });
                    }
                });

                const firstWord = lineRow.querySelector('.english-word');
                const isRevealed = firstWord && firstWord.classList.contains('revealed');

                lineOrders.forEach(order => {
                    if (isRevealed) {
                        hideWord(order);
                    } else {
                        revealWord(order);
                    }
                });
            });
        });

        document.getElementById('toggleStyleBtn').addEventListener('click', () => {
            document.body.classList.toggle('style-mode');
            const isStyleMode = document.body.classList.contains('style-mode');
            document.getElementById('toggleStyleBtn').textContent =
                isStyleMode ? 'Hide Style' : 'Style Notes';

            if (!isStyleMode) {
                document.querySelectorAll('.style-tag.active').forEach(tag => {
                    tag.classList.remove('active');
                });
                document.querySelectorAll('.style-analysis.active').forEach(analysis => {
                    analysis.classList.remove('active');
                });
                document.querySelectorAll('.active-style').forEach(el => {
                    el.classList.remove('active-style');
                });
            }
        });

        document.querySelectorAll('.style-tag').forEach(tag => {
            tag.addEventListener('click', () => {
                const featureId = tag.dataset.feature;
                const isActive = tag.classList.contains('active');

                document.querySelectorAll('.style-tag.active').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.style-analysis.active').forEach(a => a.classList.remove('active'));
                document.querySelectorAll('.active-style').forEach(el => el.classList.remove('active-style'));

                if (!isActive) {
                    tag.classList.add('active');

                    const analysis = document.getElementById('analysis-' + featureId);
                    if (analysis) {
                        analysis.classList.add('active');
                    }

                    document.querySelectorAll('[data-style-feature]').forEach(el => {
                        const features = el.dataset.styleFeature.split(' ');
                        if (features.includes(featureId)) {
                            el.classList.add('active-style');
                        }
                    });
                }
            });
        });

        document.addEventListener('keydown', (e) => {
            if (e.code === 'ArrowRight' || e.code === 'ArrowDown' || e.code === 'PageDown' || e.code === 'Space' || e.code === 'Enter') {
                e.preventDefault();
                stepForward();
            }
            else if (e.code === 'ArrowLeft' || e.code === 'ArrowUp' || e.code === 'PageUp' || e.code === 'Backspace') {
                e.preventDefault();
                stepBackward();
            }
            else if (e.code === 'Escape' || e.code === 'KeyR') {
                document.getElementById('hideAllBtn').click();
            }
        });
    </script>
</body>
</html>
