<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classicalia - Tacitus Annals 12.68</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 240px;
            background: white;
            border-right: 1px solid #e5e7eb;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }
        .logo-section {
            padding: 1.5rem 1.25rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }
        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #0066ff 0%, #4d94ff 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.1rem;
        }
        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
        }
        .nav-section {
            padding: 1rem 0.5rem;
        }
        .nav-title {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #9ca3af;
            letter-spacing: 0.05em;
            padding: 0 0.75rem;
            margin-bottom: 0.5rem;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.625rem 0.75rem;
            margin: 0.125rem 0;
            border-radius: 8px;
            text-decoration: none;
            color: #4b5563;
            font-size: 0.9rem;
            transition: all 0.15s ease;
            cursor: pointer;
        }
        .nav-item:hover {
            background: #f3f4f6;
            color: #1f2937;
        }
        .nav-item.active {
            background: #eef2ff;
            color: #0066ff;
            font-weight: 500;
        }
        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }
        .main-content {
            margin-left: 240px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .top-bar {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0.875rem 2rem;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .content-wrapper {
            flex: 1;
            overflow-y: auto;
        }
        .content-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }
        .lesson-header {
            margin-bottom: 2rem;
        }
        .lesson-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        .lesson-meta {
            display: flex;
            gap: 1.5rem;
            font-size: 0.875rem;
            color: #6b7280;
        }
        .card {
            background: white;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }
        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
        }
        .card-body {
            padding: 2rem;
        }
        .latin-text {
            font-size: 1.5rem;
            line-height: 2.4;
            color: #1f2937;
        }
        .word {
            cursor: pointer;
            padding: 2px 4px;
            margin: 0 1px;
            border-radius: 4px;
            transition: all 0.15s ease;
            display: inline;
        }
        .word:hover {
            background: rgba(0, 102, 255, 0.15);
        }
        .word.active {
            background: rgba(0, 102, 255, 0.25);
        }

        /* Popup styles */
        .vocab-popup {
            position: fixed;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05);
            padding: 1rem 1.25rem;
            z-index: 1000;
            max-width: 350px;
            min-width: 250px;
            display: none;
            animation: popIn 0.2s ease;
        }
        .vocab-popup::before {
            content: '';
            position: absolute;
            top: -8px;
            left: var(--arrow-left, 50%);
            transform: translateX(-50%);
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid white;
        }
        .vocab-popup.arrow-bottom::before {
            top: auto;
            bottom: -8px;
            border-bottom: none;
            border-top: 8px solid white;
        }
        body.dark-mode .vocab-popup::before {
            border-bottom-color: #4f0c28;
        }
        body.dark-mode .vocab-popup.arrow-bottom::before {
            border-bottom-color: transparent;
            border-top-color: #4f0c28;
        }
        @keyframes popIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .vocab-popup.visible {
            display: block;
        }
        .vocab-popup h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #0066ff;
            margin-bottom: 0.5rem;
        }
        .vocab-popup .parsing {
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
            font-style: italic;
        }
        .vocab-popup .meaning {
            font-size: 0.95rem;
            color: #1f2937;
            line-height: 1.5;
        }
        .vocab-popup .principal-parts {
            font-size: 0.85rem;
            color: #4b5563;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid #e5e7eb;
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }
        .btn {
            padding: 0.625rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        .btn:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }
        .btn.active {
            background: #0066ff;
            color: white;
            border-color: #0066ff;
        }

        /* Dark mode styles */
        body.dark-mode {
            background: #2d0818;
        }
        body.dark-mode .sidebar {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .logo-icon {
            background: linear-gradient(135deg, #8b5a8a 0%, #a67aa6 100%);
        }
        body.dark-mode .logo-text {
            color: #c5d2f8;
        }
        body.dark-mode .nav-title {
            color: #9a8a9a;
        }
        body.dark-mode .nav-item {
            color: #b8a8b8;
        }
        body.dark-mode .nav-item:hover {
            background: #4f0c28;
            color: #c5d2f8;
        }
        body.dark-mode .nav-item.active {
            background: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .top-bar {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .card {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .card-header {
            border-color: #5a1a3a;
        }
        body.dark-mode .card-title {
            color: #c5d2f8;
        }
        body.dark-mode .lesson-title {
            color: #c5d2f8;
        }
        body.dark-mode .lesson-meta {
            color: #b8a8b8;
        }
        body.dark-mode .latin-text {
            color: #c5d2f8;
            text-shadow: 0 0 20px rgba(197, 210, 248, 0.15);
        }
        body.dark-mode .word:hover {
            background: rgba(232, 212, 168, 0.25);
        }
        body.dark-mode .word.active {
            background: rgba(232, 212, 168, 0.35);
        }
        body.dark-mode .btn {
            background: #4f0c28;
            border-color: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .btn:hover {
            background: #5a1a3a;
        }
        body.dark-mode .btn.active {
            background: #7a3a5a;
            border-color: #8a4a6a;
        }
        body.dark-mode .resource-card {
            background: #4f0c28;
            border-color: #5a1a3a;
        }
        body.dark-mode .resource-card h4 {
            color: #c5d2f8;
        }
        body.dark-mode .resource-card p {
            color: #b8c8e8;
        }
        body.dark-mode .vocab-popup {
            background: #4f0c28;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        body.dark-mode .vocab-popup h4 {
            color: #e8d4a8;
        }
        body.dark-mode .vocab-popup .parsing {
            color: #b8a8b8;
        }
        body.dark-mode .vocab-popup .meaning {
            color: #c5d2f8;
        }
        body.dark-mode .vocab-popup .principal-parts {
            color: #a8b8d8;
            border-color: #5a1a3a;
        }

        /* Sentence hover highlight */
        .latin-text p {
            padding: 0.5rem 0.75rem;
            margin: 0 -0.75rem 1.5rem -0.75rem;
            border-radius: 6px;
            transition: background 0.2s ease;
        }
        .latin-text p:hover {
            background: rgba(59, 130, 246, 0.08);
        }
        body.dark-mode .latin-text p:hover {
            background: rgba(197, 210, 248, 0.1);
        }

        /* Sentence-by-sentence mode */
        .latin-text.sentence-mode p {
            display: none;
        }
        .latin-text.sentence-mode p.current-sentence {
            display: block;
        }
        .latin-text.sentence-mode p:hover {
            background: transparent;
        }

        .sentence-nav {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }
        .sentence-nav.visible {
            display: flex;
        }
        body.dark-mode .sentence-nav {
            border-color: #5a1a3a;
        }
        .sentence-nav button {
            padding: 0.5rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        .sentence-nav button:hover:not(:disabled) {
            background: #f3f4f6;
        }
        .sentence-nav button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        body.dark-mode .sentence-nav button {
            background: #4f0c28;
            border-color: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .sentence-nav button:hover:not(:disabled) {
            background: #5a1a3a;
        }
        .sentence-counter {
            font-size: 0.875rem;
            color: #6b7280;
            min-width: 80px;
            text-align: center;
        }
        body.dark-mode .sentence-counter {
            color: #b8a8b8;
        }

        /* Full-screen mode */
        body.full-screen .sidebar {
            display: none;
        }
        body.full-screen .main-content {
            margin-left: 0;
        }
        body.full-screen .lesson-header {
            display: none;
        }
        body.full-screen .content-container {
            max-width: 100%;
            padding: 1rem 2rem;
        }
        body.full-screen .card {
            border: none;
            border-radius: 0;
            background: transparent;
        }
        body.full-screen .card-header {
            display: none;
        }
        body.full-screen .card-body {
            padding: 1rem 2rem;
        }
        body.full-screen .latin-text {
            font-size: 2rem;
            line-height: 2.6;
        }
        body.full-screen .btn-group {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            background: white;
            padding: 0.75rem;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 200;
        }
        body.full-screen.dark-mode .btn-group {
            background: #3a0a1f;
        }
        body.full-screen .resource-card {
            display: none !important;
        }
        body.full-screen .sentence-nav {
            border: none;
            padding-top: 0;
        }
        body.full-screen .top-bar {
            display: none;
        }

        /* Line numbers */
        .latin-text.show-lines p {
            display: flex;
            align-items: flex-start;
        }
        .line-number {
            display: none;
            min-width: 2.5rem;
            color: #9ca3af;
            font-size: 0.875rem;
            padding-top: 0.3rem;
            user-select: none;
        }
        .latin-text.show-lines .line-number {
            display: block;
        }
        body.dark-mode .line-number {
            color: #7a6a7a;
        }
        .line-content {
            flex: 1;
        }

        /* Pointer/highlight mode */
        .word.pointed {
            background: rgba(255, 200, 50, 0.5) !important;
            box-shadow: 0 0 12px rgba(255, 200, 50, 0.6);
            border-radius: 4px;
        }
        body.dark-mode .word.pointed {
            background: rgba(232, 212, 168, 0.5) !important;
            box-shadow: 0 0 15px rgba(232, 212, 168, 0.5);
        }

        /* Pointer mode indicator */
        body.pointer-mode .word {
            cursor: crosshair;
        }
        .mode-indicator {
            display: none;
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: #fef3c7;
            color: #92400e;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            z-index: 200;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        body.pointer-mode .mode-indicator {
            display: block;
        }
        body.dark-mode .mode-indicator {
            background: #4f0c28;
            color: #e8d4a8;
        }

        .resource-card {
            background: #f9fafb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px solid #e5e7eb;
            display: none;
        }
        .resource-card.active {
            display: block;
        }
        .resource-card h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.75rem;
        }
        .resource-card p {
            font-size: 0.95rem;
            line-height: 1.8;
            color: #374151;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
            }
            .latin-text {
                font-size: 1.25rem;
                line-height: 2.2;
            }
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="logo-section">
            <a href="../../../index.html" class="logo">
                <div class="logo-icon">C</div>
                <span class="logo-text">Classicalia</span>
            </a>
        </div>
        <nav class="nav-section">
            <div class="nav-title">Resources</div>
            <div class="nav-item active" onclick="showView('text')">
                <span class="nav-icon">üìñ</span>
                <span>Read</span>
            </div>
            <div class="nav-item" onclick="showView('summary')">
                <span class="nav-icon">üìã</span>
                <span>Summary</span>
            </div>
            <div class="nav-item" onclick="showView('context')">
                <span class="nav-icon">üèõÔ∏è</span>
                <span>Context</span>
            </div>
            <div class="nav-item" onclick="showView('comprehension')">
                <span class="nav-icon">‚ùì</span>
                <span>Comprehension</span>
            </div>
        </nav>
    </aside>

    <main class="main-content">
        <div class="top-bar"></div>
        <div class="content-wrapper">
            <div class="content-container">
                <header class="lesson-header">
                    <h1 class="lesson-title">The Death of Claudius</h1>
                    <div class="lesson-meta">
                        <span>üìï Tacitus Annals 12.68</span>
                        <span>‚è±Ô∏è 45 min</span>
                        <span>üìä A-Level</span>
                    </div>
                </header>

                <div class="card" id="textCard">
                    <div class="card-header">
                        <h3 class="card-title">Latin Text</h3>
                    </div>
                    <div class="card-body">
                        <div class="latin-text" id="latinText"></div>
                        <div class="btn-group">
                            <button class="btn" onclick="toggleTranslation()">Translation</button>
                            <button class="btn" onclick="toggleSentenceMode()">Sentence Mode</button>
                            <button class="btn" onclick="toggleLineNumbers()">Line Numbers</button>
                            <button class="btn" onclick="togglePointerMode()">Pointer Mode</button>
                            <button class="btn" onclick="toggleDarkMode()">üåô Dark</button>
                            <button class="btn" onclick="toggleFullScreen()">‚õ∂ Full Screen</button>
                        </div>
                        <div class="sentence-nav" id="sentenceNav">
                            <button onclick="prevSentence()">‚Üê Previous</button>
                            <span class="sentence-counter" id="sentenceCounter">1 / 6</span>
                            <button onclick="nextSentence()">Next ‚Üí</button>
                        </div>
                        <div class="resource-card" id="translationBox">
                            <h4>Translation</h4>
                            <p>Meanwhile the Senate was being summoned and the consuls and priests were announcing vows for the emperor's safety, when already lifeless he was being covered with blankets and warm compresses, while measures that would be for strengthening Nero's power were being arranged. First of all, Agrippina, as if overcome by grief and seeking comfort, held Britannicus in an embrace, called him the true likeness of his father's face, and by various tricks delayed him so he would not leave the room. She also detained Antonia and Octavia, his sisters, and had closed all entrances with guards, and frequently announced that the emperor's health was improving, so that the soldiers would remain in good hope and the propitious time from the predictions of the astrologers would arrive.</p>
                        </div>
                    </div>
                </div>

                <div class="card" id="resourceCard" style="display: none; margin-top: 1.5rem;">
                    <div class="card-header">
                        <h3 class="card-title" id="resourceTitle">Summary</h3>
                    </div>
                    <div class="card-body" id="resourceContent"></div>
                </div>
            </div>
        </div>
    </main>

    <div class="vocab-popup" id="vocabPopup"></div>
    <div class="mode-indicator">üìç Pointer Mode (click words to highlight, click again to remove)</div>

    <script>
const vocab = {
    "vocabatur": { lemma: "voco, -are, -avi, -atum", parsing: "3rd sing. imperf. pass. ind.", meaning: "was being summoned" },
    "interim": { lemma: "interim", parsing: "adverb", meaning: "meanwhile" },
    "senatus": { lemma: "senatus, -us (m.)", parsing: "nom. sing.", meaning: "the Senate" },
    "votaque": { lemma: "votum, -i (n.) + -que", parsing: "nom./acc. pl. + and", meaning: "and vows" },
    "vota": { lemma: "votum, -i (n.)", parsing: "nom./acc. pl.", meaning: "vows" },
    "pro": { lemma: "pro", parsing: "preposition + abl.", meaning: "for, on behalf of" },
    "incolumitate": { lemma: "incolumitas, -atis (f.)", parsing: "abl. sing.", meaning: "safety, well-being" },
    "principis": { lemma: "princeps, principis (m.)", parsing: "gen. sing.", meaning: "of the emperor" },
    "consules": { lemma: "consul, consulis (m.)", parsing: "nom. pl.", meaning: "the consuls" },
    "et": { lemma: "et", parsing: "conjunction", meaning: "and" },
    "sacerdotes": { lemma: "sacerdos, -otis (m./f.)", parsing: "nom. pl.", meaning: "priests" },
    "nuncupabant": { lemma: "nuncupo, -are, -avi, -atum", parsing: "3rd pl. imperf. act. ind.", meaning: "were announcing, were making" },
    "cum": { lemma: "cum", parsing: "conjunction + subj.", meaning: "when, although" },
    "iam": { lemma: "iam", parsing: "adverb", meaning: "already, now" },
    "exanimis": { lemma: "exanimis, -e", parsing: "nom. sing. masc.", meaning: "lifeless, dead" },
    "vestibus": { lemma: "vestis, -is (f.)", parsing: "abl. pl.", meaning: "with clothes, blankets" },
    "fomentis": { lemma: "fomentum, -i (n.)", parsing: "abl. pl.", meaning: "with warm compresses, poultices" },
    "obtegeretur": { lemma: "obtego, -ere, -texi, -tectum", parsing: "3rd sing. imperf. subj. pass.", meaning: "was being covered" },
    "dum": { lemma: "dum", parsing: "conjunction", meaning: "while" },
    "quae": { lemma: "qui, quae, quod", parsing: "nom. pl. fem.", meaning: "which" },
    "res": { lemma: "res, rei (f.)", parsing: "nom. pl.", meaning: "things, measures" },
    "forent": { lemma: "sum, esse, fui", parsing: "3rd pl. imperf. subj.", meaning: "would be" },
    "firmando": { lemma: "firmo, -are, -avi, -atum", parsing: "gerundive, dat.", meaning: "for strengthening" },
    "neronis": { lemma: "Nero, Neronis (m.)", parsing: "gen. sing.", meaning: "of Nero" },
    "imperio": { lemma: "imperium, -i (n.)", parsing: "dat. sing.", meaning: "power, rule" },
    "componuntur": { lemma: "compono, -ere, -posui, -positum", parsing: "3rd pl. pres. pass. ind.", meaning: "are being arranged" },
    "primum": { lemma: "primum", parsing: "adverb", meaning: "first, first of all" },
    "agrippina": { lemma: "Agrippina, -ae (f.)", parsing: "nom. sing.", meaning: "Agrippina" },
    "velut": { lemma: "velut", parsing: "adverb", meaning: "as if" },
    "dolore": { lemma: "dolor, -oris (m.)", parsing: "abl. sing.", meaning: "by grief" },
    "victa": { lemma: "vinco, -ere, vici, victum", parsing: "nom. sing. fem. perf. pass. part.", meaning: "overcome, conquered" },
    "solacia": { lemma: "solacium, -i (n.)", parsing: "acc. pl.", meaning: "comfort, consolation" },
    "conquirens": { lemma: "conquiro, -ere, -quisivi, -quisitum", parsing: "nom. sing. pres. act. part.", meaning: "seeking" },
    "tenere": { lemma: "teneo, -ere, tenui, tentum", parsing: "pres. inf. (historic)", meaning: "to hold, held" },
    "amplexu": { lemma: "amplexus, -us (m.)", parsing: "abl. sing.", meaning: "in an embrace" },
    "britannicum": { lemma: "Britannicus, -i (m.)", parsing: "acc. sing.", meaning: "Britannicus" },
    "veram": { lemma: "verus, -a, -um", parsing: "acc. sing. fem.", meaning: "true, genuine" },
    "paterni": { lemma: "paternus, -a, -um", parsing: "gen. sing. masc.", meaning: "of his father, paternal" },
    "oris": { lemma: "os, oris (n.)", parsing: "gen. sing.", meaning: "of the face" },
    "effigiem": { lemma: "effigies, -ei (f.)", parsing: "acc. sing.", meaning: "likeness, image" },
    "appellare": { lemma: "appello, -are, -avi, -atum", parsing: "pres. inf. (historic)", meaning: "to call, called" },
    "ac": { lemma: "ac / atque", parsing: "conjunction", meaning: "and" },
    "variis": { lemma: "varius, -a, -um", parsing: "abl. pl.", meaning: "various, different" },
    "artibus": { lemma: "ars, artis (f.)", parsing: "abl. pl.", meaning: "by tricks, by devices" },
    "demorari": { lemma: "demoror, -ari, -atus sum", parsing: "pres. inf. (historic)", meaning: "to delay, delayed" },
    "ne": { lemma: "ne", parsing: "conjunction + subj.", meaning: "so that... not, lest" },
    "cubiculo": { lemma: "cubiculum, -i (n.)", parsing: "abl. sing.", meaning: "from the room" },
    "egrederetur": { lemma: "egredior, egredi, egressus sum", parsing: "3rd sing. imperf. subj.", meaning: "he might leave" },
    "antoniam": { lemma: "Antonia, -ae (f.)", parsing: "acc. sing.", meaning: "Antonia" },
    "quoque": { lemma: "quoque", parsing: "adverb", meaning: "also" },
    "octaviam": { lemma: "Octavia, -ae (f.)", parsing: "acc. sing.", meaning: "Octavia" },
    "sorores": { lemma: "soror, -oris (f.)", parsing: "acc. pl.", meaning: "sisters" },
    "eius": { lemma: "is, ea, id", parsing: "gen. sing.", meaning: "his" },
    "attinuit": { lemma: "attineo, -ere, -tinui, -tentum", parsing: "3rd sing. perf. act. ind.", meaning: "she detained, she held back" },
    "cunctos": { lemma: "cunctus, -a, -um", parsing: "acc. pl. masc.", meaning: "all" },
    "aditus": { lemma: "aditus, -us (m.)", parsing: "acc. pl.", meaning: "entrances, approaches" },
    "custodiis": { lemma: "custodia, -ae (f.)", parsing: "abl. pl.", meaning: "with guards" },
    "clauserat": { lemma: "claudo, -ere, clausi, clausum", parsing: "3rd sing. pluperf. act. ind.", meaning: "she had closed" },
    "crebroque": { lemma: "crebro + -que", parsing: "adverb + and", meaning: "and frequently" },
    "crebro": { lemma: "crebro", parsing: "adverb", meaning: "frequently" },
    "vulgabat": { lemma: "vulgo, -are, -avi, -atum", parsing: "3rd sing. imperf. act. ind.", meaning: "she was announcing, spreading" },
    "ire": { lemma: "eo, ire, ii/ivi, itum", parsing: "pres. inf.", meaning: "to go, was going" },
    "in": { lemma: "in", parsing: "preposition + acc.", meaning: "into, to" },
    "melius": { lemma: "bonus, -a, -um", parsing: "comparative adv./adj.", meaning: "better, for the better" },
    "valetudinem": { lemma: "valetudo, -inis (f.)", parsing: "acc. sing.", meaning: "health" },
    "quo": { lemma: "quo", parsing: "conjunction + subj.", meaning: "so that (purpose)" },
    "miles": { lemma: "miles, militis (m.)", parsing: "nom. sing.", meaning: "the soldier, soldiers" },
    "bona": { lemma: "bonus, -a, -um", parsing: "abl. sing. fem.", meaning: "good" },
    "spe": { lemma: "spes, spei (f.)", parsing: "abl. sing.", meaning: "in hope" },
    "ageret": { lemma: "ago, -ere, egi, actum", parsing: "3rd sing. imperf. subj.", meaning: "might remain, might be" },
    "tempusque": { lemma: "tempus, -oris (n.) + -que", parsing: "nom. sing. + and", meaning: "and time" },
    "tempus": { lemma: "tempus, -oris (n.)", parsing: "nom. sing.", meaning: "time" },
    "prosperum": { lemma: "prosperus, -a, -um", parsing: "nom. sing. neut.", meaning: "propitious, favourable" },
    "ex": { lemma: "ex / e", parsing: "preposition + abl.", meaning: "from, according to" },
    "monitis": { lemma: "monitum, -i (n.)", parsing: "abl. pl.", meaning: "predictions, warnings" },
    "chaldaeorum": { lemma: "Chaldaei, -orum (m. pl.)", parsing: "gen. pl.", meaning: "of the Chaldaeans, of the astrologers" },
    "adventaret": { lemma: "advento, -are, -avi, -atum", parsing: "3rd sing. imperf. subj.", meaning: "might arrive" }
};

const latinSentences = [
    "vocabatur interim senatus votaque pro incolumitate principis consules et sacerdotes nuncupabant,",
    "cum iam exanimis vestibus et fomentis obtegeretur, dum quae res forent firmando Neronis imperio componuntur.",
    "iam primum Agrippina, velut dolore victa et solacia conquirens, tenere amplexu Britannicum, veram paterni oris effigiem appellare",
    "ac variis artibus demorari ne cubiculo egrederetur.",
    "Antoniam quoque et Octaviam sorores eius attinuit, et cunctos aditus custodiis clauserat,",
    "crebroque vulgabat ire in melius valetudinem principis, quo miles bona in spe ageret tempusque prosperum ex monitis Chaldaeorum adventaret."
];

const resources = {
    summary: `<h4>Summary</h4>
<p>This passage describes the immediate aftermath of Claudius' death (probably by poisoning). While the Senate is summoned and officials pray for the emperor's recovery, Claudius already lies dead, covered to conceal his condition.</p>
<p>Agrippina takes control, pretending grief while physically restraining Britannicus and his sisters. She seals all exits with guards and spreads false reports of improvement, waiting for the astrologers' propitious moment to announce Nero's accession.</p>`,
    context: `<h4>Historical Context</h4>
<p><strong>The Death of Claudius:</strong> Claudius died on 13 October 54 CE, almost certainly poisoned. Ancient sources blame Agrippina, who allegedly used the poisoner Locusta. The famous story involves poisoned mushrooms.</p>
<p><strong>Britannicus:</strong> Claudius' natural son and rightful heir, born in 41 CE. He was about 13 at his father's death. Agrippina needed to keep him isolated until Nero's position was secure. He would be poisoned in 55 CE.</p>
<p><strong>The Praetorian Guard:</strong> The 'miles' (soldiers) here refers primarily to the Praetorians. Their support was essential for any emperor's accession. Agrippina's false bulletins kept them loyal until the right moment.</p>
<p><strong>Chaldaean Astrologers:</strong> Babylonian astrologers were influential in Rome despite periodic expulsions. Agrippina used their predictions to choose the most auspicious hour for Nero's proclamation.</p>`,
    comprehension: `<h4>Comprehension Questions</h4>
<p><strong>Line 1:</strong> What was the Senate doing while Claudius lay dead? What were the consuls and priests announcing?</p>
<p><strong>Line 2:</strong> How was Claudius' body being concealed? What does 'iam exanimis' tell us about his condition?</p>
<p><strong>Line 2:</strong> What was being arranged 'in the meantime'? What does 'firmando Neronis imperio' reveal about the purpose?</p>
<p><strong>Lines 3-4:</strong> How did Agrippina pretend to feel? What word signals that this was an act?</p>
<p><strong>Lines 3-4:</strong> What did she call Britannicus? Why is this ironic?</p>
<p><strong>Line 4:</strong> Why did she prevent him from leaving the room? What phrase describes her methods?</p>
<p><strong>Line 5:</strong> Who else did she detain? What had she done to the entrances?</p>
<p><strong>Line 6:</strong> What false information did she spread about the emperor's health?</p>
<p><strong>Line 6:</strong> What two things was she waiting for? What role did the astrologers play?</p>
<p><strong>Overall:</strong> How does Tacitus reveal the gap between public ceremony and private reality in this passage?</p>`
};

let currentPopup = null;
let sentenceModeActive = false;
let currentSentenceIndex = 0;
let pointerModeActive = false;

function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    const isDark = document.body.classList.contains('dark-mode');
    savePreference('darkMode', isDark);

    const btn = event.currentTarget;
    if (isDark) {
        btn.textContent = '‚òÄÔ∏è Light';
        btn.classList.add('active');
    } else {
        btn.textContent = 'üåô Dark';
        btn.classList.remove('active');
    }
}

function toggleFullScreen() {
    document.body.classList.toggle('full-screen');
    const btn = event.currentTarget;
    if (document.body.classList.contains('full-screen')) {
        btn.textContent = '‚õ∂ Exit Full Screen';
        btn.classList.add('active');
    } else {
        btn.textContent = '‚õ∂ Full Screen';
        btn.classList.remove('active');
    }
}

function toggleLineNumbers() {
    const latinText = document.getElementById('latinText');
    latinText.classList.toggle('show-lines');
    const showLines = latinText.classList.contains('show-lines');
    savePreference('lineNumbers', showLines);

    const btn = event.currentTarget;
    btn.classList.toggle('active');
}

function togglePointerMode() {
    pointerModeActive = !pointerModeActive;
    document.body.classList.toggle('pointer-mode');
    const btn = event.currentTarget;
    btn.classList.toggle('active');

    if (!pointerModeActive) {
        // Clear all pointed words when exiting pointer mode
        document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
    }

    // Hide vocab popup when entering pointer mode
    if (pointerModeActive) {
        hidePopup();
    }
}

function toggleSentenceMode() {
    const latinText = document.getElementById('latinText');
    const sentenceNav = document.getElementById('sentenceNav');
    const btn = event.currentTarget;

    sentenceModeActive = !sentenceModeActive;

    if (sentenceModeActive) {
        latinText.classList.add('sentence-mode');
        sentenceNav.classList.add('visible');
        btn.classList.add('active');
        btn.textContent = 'Full Text';
        currentSentenceIndex = 0;
        updateSentenceDisplay();
    } else {
        latinText.classList.remove('sentence-mode');
        sentenceNav.classList.remove('visible');
        btn.classList.remove('active');
        btn.textContent = 'Sentence Mode';
        // Remove current-sentence class from all
        document.querySelectorAll('.latin-text p').forEach(p => p.classList.remove('current-sentence'));
    }
}

function updateSentenceDisplay() {
    const paragraphs = document.querySelectorAll('.latin-text p');
    paragraphs.forEach((p, i) => {
        if (i === currentSentenceIndex) {
            p.classList.add('current-sentence');
        } else {
            p.classList.remove('current-sentence');
        }
    });
    document.getElementById('sentenceCounter').textContent = `${currentSentenceIndex + 1} / ${paragraphs.length}`;

    // Update button states
    const navButtons = document.querySelectorAll('.sentence-nav button');
    navButtons[0].disabled = currentSentenceIndex === 0;
    navButtons[1].disabled = currentSentenceIndex === paragraphs.length - 1;
}

function prevSentence() {
    if (currentSentenceIndex > 0) {
        currentSentenceIndex--;
        updateSentenceDisplay();
        hidePopup();
    }
}

function nextSentence() {
    const paragraphs = document.querySelectorAll('.latin-text p');
    if (currentSentenceIndex < paragraphs.length - 1) {
        currentSentenceIndex++;
        updateSentenceDisplay();
        hidePopup();
    }
}

function generateLatinHTML() {
    let html = '';
    latinSentences.forEach((sentence, index) => {
        // Split into tokens, keeping punctuation attached to words
        const tokens = sentence.match(/[a-zA-Z]+[.,;:]*|[.,;:]+/g);
        html += '<p style="margin-bottom: 1.5rem;">';
        html += `<span class="line-number">${index + 1}</span>`;
        html += '<span class="line-content">';
        tokens.forEach((token, i) => {
            // Separate word from trailing punctuation
            const match = token.match(/^([a-zA-Z]+)([.,;:]*)$/);
            if (match) {
                const word = match[1];
                const punct = match[2];
                const lookupWord = word.toLowerCase();
                html += `<span class="word" data-word="${lookupWord}">${word}</span>${punct}`;
                // Add space after unless it's the last token
                if (i < tokens.length - 1) html += ' ';
            } else {
                // Just punctuation
                html += token + ' ';
            }
        });
        html += '</span></p>';
    });
    return html;
}

function showVocabPopup(event, word) {
    const popup = document.getElementById('vocabPopup');
    const wordData = vocab[word.toLowerCase()];

    // Remove active class from all words
    document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active'));

    if (!wordData) {
        popup.classList.remove('visible');
        return;
    }

    // Add active class to clicked word
    event.target.classList.add('active');

    popup.innerHTML = `
        <h4>${word}</h4>
        <div class="parsing">${wordData.parsing}</div>
        <div class="meaning">${wordData.meaning}</div>
        <div class="principal-parts">${wordData.lemma}</div>
    `;

    // Position popup near the word
    const rect = event.target.getBoundingClientRect();
    const popupWidth = 300;
    const popupHeight = 150;

    let left = rect.left + (rect.width / 2) - (popupWidth / 2);
    let top = rect.bottom + 12;
    let arrowBottom = false;

    // Keep popup within viewport horizontally
    if (left < 10) left = 10;
    if (left + popupWidth > window.innerWidth - 10) {
        left = window.innerWidth - popupWidth - 10;
    }

    // If popup would go below viewport, show above word
    if (top + popupHeight > window.innerHeight) {
        top = rect.top - popupHeight - 12;
        arrowBottom = true;
    }

    // Calculate arrow position relative to popup
    const wordCenterX = rect.left + (rect.width / 2);
    const arrowLeft = Math.max(20, Math.min(popupWidth - 20, wordCenterX - left));

    popup.style.left = left + 'px';
    popup.style.top = top + 'px';
    popup.style.setProperty('--arrow-left', arrowLeft + 'px');
    popup.classList.toggle('arrow-bottom', arrowBottom);
    popup.classList.add('visible');

    currentPopup = popup;
}

function hidePopup() {
    const popup = document.getElementById('vocabPopup');
    popup.classList.remove('visible');
    document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active'));
}

function toggleTranslation() {
    const box = document.getElementById('translationBox');
    const btn = event.currentTarget;

    if (box.classList.contains('active')) {
        box.classList.remove('active');
        btn.textContent = 'Show Translation';
        btn.classList.remove('active');
    } else {
        box.classList.add('active');
        btn.textContent = 'Hide Translation';
        btn.classList.add('active');
    }
}

function showView(view) {
    // Update nav
    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
    event.currentTarget.classList.add('active');

    const textCard = document.getElementById('textCard');
    const resourceCard = document.getElementById('resourceCard');

    if (view === 'text') {
        textCard.style.display = 'block';
        resourceCard.style.display = 'none';
    } else {
        textCard.style.display = 'none';
        resourceCard.style.display = 'block';
        document.getElementById('resourceTitle').textContent = view.charAt(0).toUpperCase() + view.slice(1);
        document.getElementById('resourceContent').innerHTML = resources[view];
    }
}

// Initialise
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('latinText').innerHTML = generateLatinHTML();

    // Load saved preferences
    loadPreferences();

    // Add click handlers to words
    document.querySelectorAll('.word').forEach(word => {
        word.addEventListener('click', function(e) {
            e.stopPropagation();

            if (pointerModeActive) {
                // Toggle pointed class
                this.classList.toggle('pointed');
            } else {
                showVocabPopup(e, this.dataset.word);
            }
        });
    });

    // Hide popup when clicking elsewhere, clear pointer highlights on background click
    document.addEventListener('click', function(e) {
        if (!e.target.classList.contains('word')) {
            hidePopup();

            // If in pointer mode and clicking background (not buttons), clear all highlights
            if (pointerModeActive && !e.target.closest('.btn-group') && !e.target.closest('.sentence-nav')) {
                document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
            }
        }
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Escape to exit full screen
        if (e.key === 'Escape') {
            if (document.body.classList.contains('full-screen')) {
                document.body.classList.remove('full-screen');
                const btn = document.querySelector('.btn-group .btn:last-child');
                if (btn) {
                    btn.textContent = '‚õ∂ Full Screen';
                    btn.classList.remove('active');
                }
            }
            // Also exit pointer mode on escape
            if (pointerModeActive) {
                pointerModeActive = false;
                document.body.classList.remove('pointer-mode');
                document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
                document.querySelectorAll('.btn').forEach(btn => {
                    if (btn.textContent === 'Pointer Mode') btn.classList.remove('active');
                });
            }
        }

        // Arrow keys for sentence navigation
        if (sentenceModeActive) {
            if (e.key === 'ArrowLeft') {
                prevSentence();
            } else if (e.key === 'ArrowRight') {
                nextSentence();
            }
        }
    });
});

function loadPreferences() {
    // Dark mode
    if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
        setTimeout(() => {
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent.includes('Dark')) {
                    btn.textContent = '‚òÄÔ∏è Light';
                    btn.classList.add('active');
                }
            });
        }, 0);
    }

    // Line numbers
    if (localStorage.getItem('lineNumbers') === 'true') {
        document.getElementById('latinText').classList.add('show-lines');
        setTimeout(() => {
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent === 'Line Numbers') {
                    btn.classList.add('active');
                }
            });
        }, 0);
    }
}

function savePreference(key, value) {
    localStorage.setItem(key, value);
}
    </script>
</body>
</html>
