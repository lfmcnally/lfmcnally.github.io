<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classicalia - Tacitus Annals 12.56</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 240px;
            background: white;
            border-right: 1px solid #e5e7eb;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }
        .logo-section {
            padding: 1.5rem 1.25rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }
        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #0066ff 0%, #4d94ff 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.1rem;
        }
        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
        }
        .nav-section {
            padding: 1rem 0.5rem;
        }
        .nav-title {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #9ca3af;
            letter-spacing: 0.05em;
            padding: 0 0.75rem;
            margin-bottom: 0.5rem;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.625rem 0.75rem;
            margin: 0.125rem 0;
            border-radius: 8px;
            text-decoration: none;
            color: #4b5563;
            font-size: 0.9rem;
            transition: all 0.15s ease;
            cursor: pointer;
        }
        .nav-item:hover {
            background: #f3f4f6;
            color: #1f2937;
        }
        .nav-item.active {
            background: #eef2ff;
            color: #0066ff;
            font-weight: 500;
        }
        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }
        .main-content {
            margin-left: 240px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .top-bar {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0.875rem 2rem;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .content-wrapper {
            flex: 1;
            overflow-y: auto;
        }
        .content-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }
        .lesson-header {
            margin-bottom: 2rem;
        }
        .lesson-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        .lesson-meta {
            display: flex;
            gap: 1.5rem;
            font-size: 0.875rem;
            color: #6b7280;
        }
        .card {
            background: white;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }
        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
        }
        .card-body {
            padding: 2rem;
        }
        .latin-text {
            font-size: 1.5rem;
            line-height: 2.4;
            color: #1f2937;
        }
        .word {
            cursor: pointer;
            padding: 2px 4px;
            margin: 0 1px;
            border-radius: 4px;
            transition: all 0.15s ease;
            display: inline;
        }
        .word:hover {
            background: rgba(0, 102, 255, 0.15);
        }
        .word.active {
            background: rgba(0, 102, 255, 0.25);
        }

        /* Popup styles */
        .vocab-popup {
            position: fixed;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05);
            padding: 1rem 1.25rem;
            z-index: 1000;
            max-width: 350px;
            min-width: 250px;
            display: none;
            animation: popIn 0.2s ease;
        }
        .vocab-popup::before {
            content: '';
            position: absolute;
            top: -8px;
            left: var(--arrow-left, 50%);
            transform: translateX(-50%);
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid white;
        }
        .vocab-popup.arrow-bottom::before {
            top: auto;
            bottom: -8px;
            border-bottom: none;
            border-top: 8px solid white;
        }
        body.dark-mode .vocab-popup::before {
            border-bottom-color: #4f0c28;
        }
        body.dark-mode .vocab-popup.arrow-bottom::before {
            border-bottom-color: transparent;
            border-top-color: #4f0c28;
        }
        @keyframes popIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .vocab-popup.visible {
            display: block;
        }
        .vocab-popup h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #0066ff;
            margin-bottom: 0.5rem;
        }
        .vocab-popup .parsing {
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
            font-style: italic;
        }
        .vocab-popup .meaning {
            font-size: 0.95rem;
            color: #1f2937;
            line-height: 1.5;
        }
        .vocab-popup .principal-parts {
            font-size: 0.85rem;
            color: #4b5563;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid #e5e7eb;
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }
        .btn {
            padding: 0.625rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        .btn:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }
        .btn.active {
            background: #0066ff;
            color: white;
            border-color: #0066ff;
        }

        /* Dark mode styles */
        body.dark-mode {
            background: #2d0818;
        }
        body.dark-mode .sidebar {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .logo-icon {
            background: linear-gradient(135deg, #8b5a8a 0%, #a67aa6 100%);
        }
        body.dark-mode .logo-text {
            color: #c5d2f8;
        }
        body.dark-mode .nav-title {
            color: #9a8a9a;
        }
        body.dark-mode .nav-item {
            color: #b8a8b8;
        }
        body.dark-mode .nav-item:hover {
            background: #4f0c28;
            color: #c5d2f8;
        }
        body.dark-mode .nav-item.active {
            background: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .top-bar {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .card {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .card-header {
            border-color: #5a1a3a;
        }
        body.dark-mode .card-title {
            color: #c5d2f8;
        }
        body.dark-mode .lesson-title {
            color: #c5d2f8;
        }
        body.dark-mode .lesson-meta {
            color: #b8a8b8;
        }
        body.dark-mode .latin-text {
            color: #c5d2f8;
            text-shadow: 0 0 20px rgba(197, 210, 248, 0.15);
        }
        body.dark-mode .word:hover {
            background: rgba(232, 212, 168, 0.25);
        }
        body.dark-mode .word.active {
            background: rgba(232, 212, 168, 0.35);
        }
        body.dark-mode .btn {
            background: #4f0c28;
            border-color: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .btn:hover {
            background: #5a1a3a;
        }
        body.dark-mode .btn.active {
            background: #7a3a5a;
            border-color: #8a4a6a;
        }
        body.dark-mode .resource-card {
            background: #4f0c28;
            border-color: #5a1a3a;
        }
        body.dark-mode .resource-card h4 {
            color: #c5d2f8;
        }
        body.dark-mode .resource-card p {
            color: #b8c8e8;
        }
        body.dark-mode .vocab-popup {
            background: #4f0c28;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        body.dark-mode .vocab-popup h4 {
            color: #e8d4a8;
        }
        body.dark-mode .vocab-popup .parsing {
            color: #b8a8b8;
        }
        body.dark-mode .vocab-popup .meaning {
            color: #c5d2f8;
        }
        body.dark-mode .vocab-popup .principal-parts {
            color: #a8b8d8;
            border-color: #5a1a3a;
        }

        /* Sentence hover highlight */
        .latin-text p {
            padding: 0.5rem 0.75rem;
            margin: 0 -0.75rem 1.5rem -0.75rem;
            border-radius: 6px;
            transition: background 0.2s ease;
        }
        .latin-text p:hover {
            background: rgba(59, 130, 246, 0.08);
        }
        body.dark-mode .latin-text p:hover {
            background: rgba(197, 210, 248, 0.1);
        }

        /* Sentence-by-sentence mode */
        .latin-text.sentence-mode p {
            display: none;
        }
        .latin-text.sentence-mode p.current-sentence {
            display: block;
        }
        .latin-text.sentence-mode p:hover {
            background: transparent;
        }

        .sentence-nav {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }
        .sentence-nav.visible {
            display: flex;
        }
        body.dark-mode .sentence-nav {
            border-color: #5a1a3a;
        }
        .sentence-nav button {
            padding: 0.5rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        .sentence-nav button:hover:not(:disabled) {
            background: #f3f4f6;
        }
        .sentence-nav button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        body.dark-mode .sentence-nav button {
            background: #4f0c28;
            border-color: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .sentence-nav button:hover:not(:disabled) {
            background: #5a1a3a;
        }
        .sentence-counter {
            font-size: 0.875rem;
            color: #6b7280;
            min-width: 80px;
            text-align: center;
        }
        body.dark-mode .sentence-counter {
            color: #b8a8b8;
        }

        /* Full-screen mode */
        body.full-screen .sidebar {
            display: none;
        }
        body.full-screen .main-content {
            margin-left: 0;
        }
        body.full-screen .lesson-header {
            display: none;
        }
        body.full-screen .content-container {
            max-width: 100%;
            padding: 1rem 2rem;
        }
        body.full-screen .card {
            border: none;
            border-radius: 0;
            background: transparent;
        }
        body.full-screen .card-header {
            display: none;
        }
        body.full-screen .card-body {
            padding: 1rem 2rem;
        }
        body.full-screen .latin-text {
            font-size: 2rem;
            line-height: 2.6;
        }
        body.full-screen .btn-group {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            background: white;
            padding: 0.75rem;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 200;
        }
        body.full-screen.dark-mode .btn-group {
            background: #3a0a1f;
        }
        body.full-screen .resource-card {
            display: none !important;
        }
        body.full-screen .sentence-nav {
            border: none;
            padding-top: 0;
        }
        body.full-screen .top-bar {
            display: none;
        }

        /* Line numbers */
        .latin-text.show-lines p {
            display: flex;
            align-items: flex-start;
        }
        .line-number {
            display: none;
            min-width: 2.5rem;
            color: #9ca3af;
            font-size: 0.875rem;
            padding-top: 0.3rem;
            user-select: none;
        }
        .latin-text.show-lines .line-number {
            display: block;
        }
        body.dark-mode .line-number {
            color: #7a6a7a;
        }
        .line-content {
            flex: 1;
        }

        /* Pointer/highlight mode */
        .word.pointed {
            background: rgba(255, 200, 50, 0.5) !important;
            box-shadow: 0 0 12px rgba(255, 200, 50, 0.6);
            border-radius: 4px;
        }
        body.dark-mode .word.pointed {
            background: rgba(232, 212, 168, 0.5) !important;
            box-shadow: 0 0 15px rgba(232, 212, 168, 0.5);
        }

        /* Pointer mode indicator */
        body.pointer-mode .word {
            cursor: crosshair;
        }
        .mode-indicator {
            display: none;
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: #fef3c7;
            color: #92400e;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            z-index: 200;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        body.pointer-mode .mode-indicator {
            display: block;
        }
        body.dark-mode .mode-indicator {
            background: #4f0c28;
            color: #e8d4a8;
        }

        .resource-card {
            background: #f9fafb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px solid #e5e7eb;
            display: none;
        }
        .resource-card.active {
            display: block;
        }
        .resource-card h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.75rem;
        }
        .resource-card p {
            font-size: 0.95rem;
            line-height: 1.8;
            color: #374151;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
            }
            .latin-text {
                font-size: 1.25rem;
                line-height: 2.2;
            }
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="logo-section">
            <a href="../../../index.html" class="logo">
                <div class="logo-icon">C</div>
                <span class="logo-text">Classicalia</span>
            </a>
        </div>
        <nav class="nav-section">
            <div class="nav-title">Resources</div>
            <div class="nav-item active" onclick="showView('text')">
                <span class="nav-icon">üìñ</span>
                <span>Read</span>
            </div>
            <div class="nav-item" onclick="showView('summary')">
                <span class="nav-icon">üìã</span>
                <span>Summary</span>
            </div>
            <div class="nav-item" onclick="showView('context')">
                <span class="nav-icon">üèõÔ∏è</span>
                <span>Context</span>
            </div>
            <div class="nav-item" onclick="showView('comprehension')">
                <span class="nav-icon">‚ùì</span>
                <span>Comprehension</span>
            </div>
        </nav>
    </aside>

    <main class="main-content">
        <div class="top-bar"></div>
        <div class="content-wrapper">
            <div class="content-container">
                <header class="lesson-header">
                    <h1 class="lesson-title">The Naumachia on Lake Fucinus</h1>
                    <div class="lesson-meta">
                        <span>üìï Tacitus Annals 12.56</span>
                        <span>‚è±Ô∏è 45 min</span>
                        <span>üìä A-Level</span>
                    </div>
                </header>

                <div class="card" id="textCard">
                    <div class="card-header">
                        <h3 class="card-title">Latin Text</h3>
                    </div>
                    <div class="card-body">
                        <div class="latin-text" id="latinText"></div>
                        <div class="btn-group">
                            <button class="btn" onclick="toggleTranslation()">Translation</button>
                            <button class="btn" onclick="toggleSentenceMode()">Sentence Mode</button>
                            <button class="btn" onclick="toggleLineNumbers()">Line Numbers</button>
                            <button class="btn" onclick="togglePointerMode()">Pointer Mode</button>
                            <button class="btn" onclick="toggleDarkMode()">üåô Dark</button>
                            <button class="btn" onclick="toggleFullScreen()">‚õ∂ Full Screen</button>
                        </div>
                        <div class="sentence-nav" id="sentenceNav">
                            <button onclick="prevSentence()">‚Üê Previous</button>
                            <span class="sentence-counter" id="sentenceCounter">1 / 7</span>
                            <button onclick="nextSentence()">Next ‚Üí</button>
                        </div>
                        <div class="resource-card" id="translationBox">
                            <h4>Translation</h4>
                            <p>Around the same time, with the mountain between Lake Fucinus and the river Liris having been pierced through, so that the magnificence of the work might be viewed by more people, a naval battle was staged on the lake itself, just as Augustus had once produced one on a pool constructed across the Tiber, but with light vessels and a smaller force. Claudius armed triremes and quadriremes and nineteen thousand men, with the perimeter enclosed by rafts, so that there might be no stray escapes, yet having embraced enough space for the force of the rowing, the skills of the helmsmen, the charges of ships, and things customary in battle. On the rafts stood companies and squadrons of the praetorian cohorts, with ramparts placed in front from which catapults and ballistae might be aimed. Marines occupied the rest of the lake with decked ships. The banks and hills and heights of the mountains were filled in the manner of a theatre by an innumerable crowd, from the nearest towns and others from the city itself, from a desire to see or from duty to the emperor. He himself presided in a splendid military cloak, and Agrippina, not far off, in a golden mantle. Although the fight was among criminals, they fought with the spirit of brave men, and after many wounds they were spared from slaughter.</p>
                        </div>
                    </div>
                </div>

                <div class="card" id="resourceCard" style="display: none; margin-top: 1.5rem;">
                    <div class="card-header">
                        <h3 class="card-title" id="resourceTitle">Summary</h3>
                    </div>
                    <div class="card-body" id="resourceContent"></div>
                </div>
            </div>
        </div>
    </main>

    <div class="vocab-popup" id="vocabPopup"></div>
    <div class="mode-indicator">üìç Pointer Mode (click words to highlight, click again to remove)</div>

    <script>
const vocab = {
    "sub": { lemma: "sub (+ accusative)", parsing: "preposition", meaning: "around, about, towards (of time)" },
    "idem": { lemma: "idem, eadem, idem", parsing: "acc. neut. sing.", meaning: "the same" },
    "tempus": { lemma: "tempus, temporis (n.)", parsing: "acc. sing.", meaning: "time" },
    "inter": { lemma: "inter (+ accusative)", parsing: "preposition", meaning: "between" },
    "lacum": { lemma: "lacus, -us (m.)", parsing: "acc. sing.", meaning: "lake" },
    "fucinum": { lemma: "Fucinus, -i (m.)", parsing: "acc. sing.", meaning: "Fucinus (a lake in central Italy)" },
    "amnemque": { lemma: "amnis, amnis (m.) + -que", parsing: "acc. sing. + and", meaning: "river, stream" },
    "lirim": { lemma: "Liris, Liris (m.)", parsing: "acc. sing.", meaning: "the Liris (a river in central Italy)" },
    "perrupto": { lemma: "perrumpo, perrumpere, perrupi, perruptum", parsing: "abl. sing. masc./neut. perf. pass. part.", meaning: "pierced through, broken through" },
    "monte": { lemma: "mons, montis (m.)", parsing: "abl. sing.", meaning: "mountain" },
    "quo": { lemma: "quo", parsing: "conjunction (purpose)", meaning: "so that, in order that" },
    "magnificentia": { lemma: "magnificentia, -ae (f.)", parsing: "nom. sing.", meaning: "magnificence, grandeur, splendour" },
    "operis": { lemma: "opus, operis (n.)", parsing: "gen. sing.", meaning: "work, construction, engineering project" },
    "a": { lemma: "a/ab (+ ablative)", parsing: "preposition", meaning: "by (agent with passive)" },
    "pluribus": { lemma: "plures, plura", parsing: "abl. pl.", meaning: "more people, a greater number" },
    "viseretur": { lemma: "viso, visere, visi, visum", parsing: "3rd sing. imperf. pass. subj.", meaning: "might be viewed, might be seen" },
    "lacu": { lemma: "lacus, -us (m.)", parsing: "abl. sing.", meaning: "lake" },
    "in": { lemma: "in", parsing: "preposition", meaning: "in, on (+ abl.); into (+ acc.)" },
    "ipso": { lemma: "ipse, ipsa, ipsum", parsing: "abl. masc./neut. sing.", meaning: "itself, himself, the very" },
    "navale": { lemma: "navalis, -e", parsing: "nom./acc. neut. sing.", meaning: "naval, of ships" },
    "proelium": { lemma: "proelium, -i (n.)", parsing: "nom./acc. sing.", meaning: "battle, combat" },
    "adornatur": { lemma: "adorno, adornare", parsing: "3rd sing. pres. pass. ind.", meaning: "is prepared, is staged" },
    "ut": { lemma: "ut", parsing: "conjunction", meaning: "just as, as (comparative)" },
    "quondam": { lemma: "quondam", parsing: "adverb", meaning: "once, formerly, at one time" },
    "augustus": { lemma: "Augustus, -i (m.)", parsing: "nom. sing.", meaning: "Augustus (the first emperor)" },
    "structo": { lemma: "struo, struere, struxi, structum", parsing: "abl. sing. masc./neut. perf. pass. part.", meaning: "built, constructed" },
    "trans": { lemma: "trans (+ accusative)", parsing: "preposition", meaning: "across, beyond" },
    "tiberim": { lemma: "Tiberis, Tiberis (m.)", parsing: "acc. sing.", meaning: "the Tiber (Rome's river)" },
    "stagno": { lemma: "stagnum, -i (n.)", parsing: "abl. sing.", meaning: "pool, artificial lake, pond" },
    "sed": { lemma: "sed", parsing: "conjunction", meaning: "but" },
    "levibus": { lemma: "levis, -e", parsing: "abl. pl.", meaning: "light, small (of vessels)" },
    "navigiis": { lemma: "navigium, -i (n.)", parsing: "abl. pl.", meaning: "vessel, boat, ship" },
    "et": { lemma: "et", parsing: "conjunction", meaning: "and" },
    "minore": { lemma: "minor, minus", parsing: "abl. sing.", meaning: "smaller, lesser" },
    "copia": { lemma: "copia, -ae (f.)", parsing: "abl. sing.", meaning: "force, supply, abundance" },
    "ediderat": { lemma: "edo, edere, edidi, editum", parsing: "3rd sing. pluperf. act. ind.", meaning: "had staged, had produced" },
    "claudius": { lemma: "Claudius, -i (m.)", parsing: "nom. sing.", meaning: "Claudius (the emperor)" },
    "triremes": { lemma: "triremis, -is (f.)", parsing: "acc. pl.", meaning: "trireme (ship with three banks of oars)" },
    "quadriremesque": { lemma: "quadriremis, -is (f.) + -que", parsing: "acc. pl. + and", meaning: "quadrireme (ship with four banks of oars)" },
    "undeviginti": { lemma: "undeviginti", parsing: "indeclinable numeral", meaning: "nineteen" },
    "hominum": { lemma: "homo, hominis (m.)", parsing: "gen. pl.", meaning: "of men, of people" },
    "milia": { lemma: "milia, milium (n. pl.)", parsing: "acc. pl.", meaning: "thousands" },
    "armavit": { lemma: "armo, armare", parsing: "3rd sing. perf. act. ind.", meaning: "armed, equipped" },
    "cincto": { lemma: "cingo, cingere, cinxi, cinctum", parsing: "abl. sing. masc./neut. perf. pass. part.", meaning: "surrounded, enclosed" },
    "ratibus": { lemma: "ratis, ratis (f.)", parsing: "abl. pl.", meaning: "rafts" },
    "ambitu": { lemma: "ambitus, -us (m.)", parsing: "abl. sing.", meaning: "circuit, perimeter, circumference" },
    "ne": { lemma: "ne", parsing: "conjunction", meaning: "so that... not, lest" },
    "vaga": { lemma: "vagus, -a, -um", parsing: "nom./acc. neut. pl.", meaning: "wandering, stray, random" },
    "effugia": { lemma: "effugium, -i (n.)", parsing: "nom./acc. pl.", meaning: "escape, flight, means of escape" },
    "forent": { lemma: "sum, esse, fui", parsing: "3rd pl. imperf. subj. (archaic)", meaning: "might be (= essent)" },
    "ac": { lemma: "ac / atque", parsing: "conjunction", meaning: "and, and yet" },
    "tamen": { lemma: "tamen", parsing: "adverb", meaning: "nevertheless, yet, however" },
    "spatium": { lemma: "spatium, -i (n.)", parsing: "acc. sing.", meaning: "space, room, extent" },
    "amplexus": { lemma: "amplector, amplecti, amplexus sum", parsing: "nom. sing. masc. perf. part. (deponent)", meaning: "having embraced, having included" },
    "ad": { lemma: "ad (+ accusative)", parsing: "preposition", meaning: "for, towards" },
    "vim": { lemma: "vis, vis (f.)", parsing: "acc. sing.", meaning: "force, power, strength" },
    "remigii": { lemma: "remigium, -i (n.)", parsing: "gen. sing.", meaning: "of rowing, of the action of oars" },
    "gubernantium": { lemma: "guberno, gubernare", parsing: "gen. pl. pres. act. part.", meaning: "of those steering, of helmsmen" },
    "artes": { lemma: "ars, artis (f.)", parsing: "acc. pl.", meaning: "skills, arts, techniques" },
    "impetus": { lemma: "impetus, -us (m.)", parsing: "acc. pl.", meaning: "attacks, charges, onsets" },
    "navium": { lemma: "navis, navis (f.)", parsing: "gen. pl.", meaning: "of ships" },
    "proelio": { lemma: "proelium, -i (n.)", parsing: "dat./abl. sing.", meaning: "in battle" },
    "solita": { lemma: "solitus, -a, -um", parsing: "nom./acc. neut. pl.", meaning: "customary, usual things" },
    "praetoriarum": { lemma: "praetorius, -a, -um", parsing: "gen. pl. fem.", meaning: "praetorian, of the Praetorian Guard" },
    "cohortium": { lemma: "cohors, cohortis (f.)", parsing: "gen. pl.", meaning: "of cohorts" },
    "manipuli": { lemma: "manipulus, -i (m.)", parsing: "nom. pl.", meaning: "maniples, companies" },
    "turmaeque": { lemma: "turma, -ae (f.) + -que", parsing: "nom. pl. + and", meaning: "squadrons (cavalry units)" },
    "adstiterant": { lemma: "adsto, adstare, adstiti", parsing: "3rd pl. pluperf. act. ind.", meaning: "had stood, had taken position" },
    "antepositis": { lemma: "antepono, anteponere, anteposui, antepositum", parsing: "abl. pl. perf. pass. part.", meaning: "placed before, set in front" },
    "propugnaculis": { lemma: "propugnaculum, -i (n.)", parsing: "abl. pl.", meaning: "ramparts, bulwarks, fortifications" },
    "ex": { lemma: "ex (+ ablative)", parsing: "preposition", meaning: "from, out of" },
    "quis": { lemma: "qui, quae, quod", parsing: "abl. pl. (archaic for quibus)", meaning: "from which" },
    "catapultae": { lemma: "catapulta, -ae (f.)", parsing: "nom. pl.", meaning: "catapults" },
    "ballistaeque": { lemma: "ballista, -ae (f.) + -que", parsing: "nom. pl. + and", meaning: "ballistae (torsion artillery)" },
    "tenderentur": { lemma: "tendo, tendere, tetendi, tentum", parsing: "3rd pl. imperf. pass. subj.", meaning: "might be aimed, might be directed" },
    "reliqua": { lemma: "reliquus, -a, -um", parsing: "acc. neut. pl.", meaning: "the remaining parts, the rest" },
    "lacus": { lemma: "lacus, -us (m.)", parsing: "gen. sing.", meaning: "of the lake" },
    "classiarii": { lemma: "classiarius, -i (m.)", parsing: "nom. pl.", meaning: "marines, sailors" },
    "tectis": { lemma: "tectus, -a, -um", parsing: "abl. pl.", meaning: "covered, decked" },
    "navibus": { lemma: "navis, navis (f.)", parsing: "abl. pl.", meaning: "with ships" },
    "obtinebant": { lemma: "obtineo, obtinere, obtinui, obtentum", parsing: "3rd pl. imperf. act. ind.", meaning: "occupied, held" },
    "ripas": { lemma: "ripa, -ae (f.)", parsing: "acc. pl.", meaning: "banks, shores" },
    "collis": { lemma: "collis, collis (m.)", parsing: "acc. pl.", meaning: "hills" },
    "montiumque": { lemma: "mons, montis (m.) + -que", parsing: "gen. pl. + and", meaning: "of the mountains" },
    "edita": { lemma: "editus, -a, -um", parsing: "acc. neut. pl.", meaning: "elevated places, heights" },
    "modum": { lemma: "modus, -i (m.)", parsing: "acc. sing.", meaning: "manner, way" },
    "theatri": { lemma: "theatrum, -i (n.)", parsing: "gen. sing.", meaning: "of a theatre" },
    "multitudo": { lemma: "multitudo, multitudinis (f.)", parsing: "nom. sing.", meaning: "crowd, multitude" },
    "innumera": { lemma: "innumerus, -a, -um", parsing: "nom. sing. fem.", meaning: "countless, innumerable" },
    "complevit": { lemma: "compleo, complere, complevi, completum", parsing: "3rd sing. perf. act. ind.", meaning: "filled" },
    "proximis": { lemma: "proximus, -a, -um", parsing: "abl. pl.", meaning: "nearest, closest" },
    "e": { lemma: "e/ex (+ ablative)", parsing: "preposition", meaning: "from, out of" },
    "municipiis": { lemma: "municipium, -i (n.)", parsing: "abl. pl.", meaning: "towns, municipalities" },
    "alii": { lemma: "alius, alia, aliud", parsing: "nom. pl. masc.", meaning: "others" },
    "urbe": { lemma: "urbs, urbis (f.)", parsing: "abl. sing.", meaning: "city (specifically Rome)" },
    "ipsa": { lemma: "ipse, ipsa, ipsum", parsing: "abl. sing. fem.", meaning: "itself, the very" },
    "visendi": { lemma: "viso, visere", parsing: "gerund, gen.", meaning: "of seeing, of viewing" },
    "cupidine": { lemma: "cupido, cupidinis (f.)", parsing: "abl. sing.", meaning: "desire, longing, eagerness" },
    "aut": { lemma: "aut", parsing: "conjunction", meaning: "or" },
    "officio": { lemma: "officium, -i (n.)", parsing: "abl. sing.", meaning: "duty, service, obligation" },
    "principem": { lemma: "princeps, principis (m.)", parsing: "acc. sing.", meaning: "emperor, first citizen, leader" },
    "ipse": { lemma: "ipse, ipsa, ipsum", parsing: "nom. sing. masc.", meaning: "he himself" },
    "insigni": { lemma: "insignis, -e", parsing: "abl. sing.", meaning: "distinguished, splendid, remarkable" },
    "paludamento": { lemma: "paludamentum, -i (n.)", parsing: "abl. sing.", meaning: "military cloak, general's cloak" },
    "neque": { lemma: "neque", parsing: "conjunction", meaning: "and... not, nor; and (here)" },
    "procul": { lemma: "procul", parsing: "adverb", meaning: "far off, at a distance" },
    "agrippina": { lemma: "Agrippina, -ae (f.)", parsing: "nom. sing.", meaning: "Agrippina (the Younger, Claudius' wife)" },
    "chlamyde": { lemma: "chlamys, chlamydis (f.)", parsing: "abl. sing.", meaning: "chlamys (Greek-style military cloak)" },
    "aurata": { lemma: "auratus, -a, -um", parsing: "abl. sing. fem.", meaning: "gilded, golden" },
    "praesedere": { lemma: "praesideo, praesidere, praesedi", parsing: "historic infinitive (= praesederunt)", meaning: "presided, sat in front" },
    "pugnatum": { lemma: "pugno, pugnare", parsing: "perf. pass. part. (impersonal)", meaning: "it was fought, there was fighting" },
    "quamquam": { lemma: "quamquam", parsing: "conjunction", meaning: "although, even though" },
    "sontes": { lemma: "sons, sontis", parsing: "acc. pl.", meaning: "guilty persons, criminals" },
    "fortium": { lemma: "fortis, -e", parsing: "gen. pl.", meaning: "of brave, of courageous" },
    "virorum": { lemma: "vir, viri (m.)", parsing: "gen. pl.", meaning: "of men" },
    "animo": { lemma: "animus, -i (m.)", parsing: "abl. sing.", meaning: "with spirit, with courage" },
    "post": { lemma: "post (+ accusative)", parsing: "preposition", meaning: "after" },
    "multum": { lemma: "multum", parsing: "acc. neut. sing. (+ gen.)", meaning: "much of, a great deal of" },
    "vulnerum": { lemma: "vulnus, vulneris (n.)", parsing: "gen. pl.", meaning: "of wounds" },
    "occidioni": { lemma: "occidio, occidionis (f.)", parsing: "dat. sing.", meaning: "slaughter, massacre" },
    "exempti": { lemma: "eximo, eximere, exemi, exemptum", parsing: "nom. pl. masc. perf. pass. part.", meaning: "spared, exempted, removed" },
    "sunt": { lemma: "sum, esse, fui", parsing: "3rd pl. pres. act. ind.", meaning: "are, they are" }
};

const latinSentences = [
    "sub idem tempus inter lacum Fucinum amnemque Lirim perrupto monte, quo magnificentia operis a pluribus viseretur, lacu in ipso navale proelium adornatur, ut quondam Augustus structo trans Tiberim stagno, sed levibus navigiis et minore copia ediderat.",
    "Claudius triremes quadriremesque et undeviginti hominum milia armavit, cincto ratibus ambitu, ne vaga effugia forent, ac tamen spatium amplexus ad vim remigii, gubernantium artes, impetus navium et proelio solita.",
    "in ratibus praetoriarum cohortium manipuli turmaeque adstiterant, antepositis propugnaculis ex quis catapultae ballistaeque tenderentur.",
    "reliqua lacus classiarii tectis navibus obtinebant.",
    "ripas et collis montiumque edita in modum theatri multitudo innumera complevit, proximis e municipiis et alii urbe ex ipsa, visendi cupidine aut officio in principem.",
    "ipse insigni paludamento neque procul Agrippina chlamyde aurata praesedere.",
    "pugnatum quamquam inter sontes fortium virorum animo, ac post multum vulnerum occidioni exempti sunt."
];

const resources = {
    summary: `<h4>Summary</h4>
<p>To celebrate the completion of the tunnel draining Lake Fucinus, Claudius stages a massive naval battle (<em>naumachia</em>) on the lake itself. The spectacle surpasses even Augustus' famous naumachia in scale.</p>
<p>Claudius arms triremes and quadriremes with 19,000 men. Rafts surround the combat zone to prevent escape, while Praetorian Guards man artillery positions. An enormous crowd fills the natural amphitheatre of the surrounding hills.</p>
<p>Claudius presides in military dress, with Agrippina nearby in golden robes. Despite being condemned criminals, the combatants fight bravely, and after sustaining many wounds, the survivors are ultimately spared.</p>`,
    context: `<h4>Historical Context</h4>
<p><strong>The Lake Fucinus Tunnel:</strong> This was one of the greatest engineering projects of antiquity. Lake Fucinus (modern Fucino basin in the Abruzzo region) was the largest lake in central Italy but had no natural outlet, causing periodic flooding. Claudius employed 30,000 workers for 11 years (41-52 AD) to dig a tunnel 5.6 km through Monte Salviano to drain the lake into the river Liris.</p>
<p><strong>Naumachiae:</strong> Staged naval battles were among the most spectacular and expensive forms of Roman entertainment. Augustus' naumachia of 2 BC used an artificial basin and was considered the benchmark. Claudius' use of a real lake with full-sized warships represented an unprecedented escalation.</p>
<p><strong>The Combatants:</strong> Naval battles used condemned criminals (<em>noxii</em> or <em>sontes</em>) who were expected to fight to the death. The famous cry 'Ave Caesar, morituri te salutant' ('Hail Caesar, those about to die salute you') reportedly originated at this very event.</p>
<p><strong>Agrippina the Younger:</strong> Claudius' fourth wife and mother of the future emperor Nero, Agrippina was one of the most powerful women in Roman history. Her prominent placement and golden dress at this event signals her influence - she would later be suspected of poisoning Claudius in 54 AD.</p>`,
    comprehension: `<h4>Comprehension Questions</h4>
<p><strong>Lines 1:</strong> What engineering project had just been completed? Why was the naval battle staged at this particular location?</p>
<p><strong>Lines 1:</strong> How did Claudius' spectacle compare to Augustus' earlier naumachia?</p>
<p><strong>Lines 2:</strong> What types of ships were used, and how many men participated?</p>
<p><strong>Lines 2:</strong> What was the purpose of the rafts surrounding the combat area?</p>
<p><strong>Lines 3:</strong> Who was positioned on the rafts, and what equipment did they have?</p>
<p><strong>Lines 4-5:</strong> Where did the spectators come from? What were the two motives for attending mentioned by Tacitus?</p>
<p><strong>Lines 6:</strong> How were Claudius and Agrippina dressed? What might this suggest?</p>
<p><strong>Lines 7:</strong> What happened to the combatants at the end of the battle? What paradox does Tacitus highlight?</p>`
};

let currentPopup = null;
let sentenceModeActive = false;
let currentSentenceIndex = 0;
let pointerModeActive = false;

function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    const isDark = document.body.classList.contains('dark-mode');
    savePreference('darkMode', isDark);

    const btn = event.currentTarget;
    if (isDark) {
        btn.textContent = '‚òÄÔ∏è Light';
        btn.classList.add('active');
    } else {
        btn.textContent = 'üåô Dark';
        btn.classList.remove('active');
    }
}

function toggleFullScreen() {
    document.body.classList.toggle('full-screen');
    const btn = event.currentTarget;
    if (document.body.classList.contains('full-screen')) {
        btn.textContent = '‚õ∂ Exit Full Screen';
        btn.classList.add('active');
    } else {
        btn.textContent = '‚õ∂ Full Screen';
        btn.classList.remove('active');
    }
}

function toggleLineNumbers() {
    const latinText = document.getElementById('latinText');
    latinText.classList.toggle('show-lines');
    const showLines = latinText.classList.contains('show-lines');
    savePreference('lineNumbers', showLines);

    const btn = event.currentTarget;
    btn.classList.toggle('active');
}

function togglePointerMode() {
    pointerModeActive = !pointerModeActive;
    document.body.classList.toggle('pointer-mode');
    const btn = event.currentTarget;
    btn.classList.toggle('active');

    if (!pointerModeActive) {
        // Clear all pointed words when exiting pointer mode
        document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
    }

    // Hide vocab popup when entering pointer mode
    if (pointerModeActive) {
        hidePopup();
    }
}

function toggleSentenceMode() {
    const latinText = document.getElementById('latinText');
    const sentenceNav = document.getElementById('sentenceNav');
    const btn = event.currentTarget;

    sentenceModeActive = !sentenceModeActive;

    if (sentenceModeActive) {
        latinText.classList.add('sentence-mode');
        sentenceNav.classList.add('visible');
        btn.classList.add('active');
        btn.textContent = 'Full Text';
        currentSentenceIndex = 0;
        updateSentenceDisplay();
    } else {
        latinText.classList.remove('sentence-mode');
        sentenceNav.classList.remove('visible');
        btn.classList.remove('active');
        btn.textContent = 'Sentence Mode';
        // Remove current-sentence class from all
        document.querySelectorAll('.latin-text p').forEach(p => p.classList.remove('current-sentence'));
    }
}

function updateSentenceDisplay() {
    const paragraphs = document.querySelectorAll('.latin-text p');
    paragraphs.forEach((p, i) => {
        if (i === currentSentenceIndex) {
            p.classList.add('current-sentence');
        } else {
            p.classList.remove('current-sentence');
        }
    });
    document.getElementById('sentenceCounter').textContent = `${currentSentenceIndex + 1} / ${paragraphs.length}`;

    // Update button states
    const navButtons = document.querySelectorAll('.sentence-nav button');
    navButtons[0].disabled = currentSentenceIndex === 0;
    navButtons[1].disabled = currentSentenceIndex === paragraphs.length - 1;
}

function prevSentence() {
    if (currentSentenceIndex > 0) {
        currentSentenceIndex--;
        updateSentenceDisplay();
        hidePopup();
    }
}

function nextSentence() {
    const paragraphs = document.querySelectorAll('.latin-text p');
    if (currentSentenceIndex < paragraphs.length - 1) {
        currentSentenceIndex++;
        updateSentenceDisplay();
        hidePopup();
    }
}

function generateLatinHTML() {
    let html = '';
    latinSentences.forEach((sentence, index) => {
        // Split into tokens, keeping punctuation attached to words
        const tokens = sentence.match(/[a-zA-Z]+[.,;:]*|[.,;:]+/g);
        html += '<p style="margin-bottom: 1.5rem;">';
        html += `<span class="line-number">${index + 1}</span>`;
        html += '<span class="line-content">';
        tokens.forEach((token, i) => {
            // Separate word from trailing punctuation
            const match = token.match(/^([a-zA-Z]+)([.,;:]*)$/);
            if (match) {
                const word = match[1];
                const punct = match[2];
                const lookupWord = word.toLowerCase();
                html += `<span class="word" data-word="${lookupWord}">${word}</span>${punct}`;
                // Add space after unless it's the last token
                if (i < tokens.length - 1) html += ' ';
            } else {
                // Just punctuation
                html += token + ' ';
            }
        });
        html += '</span></p>';
    });
    return html;
}

function showVocabPopup(event, word) {
    const popup = document.getElementById('vocabPopup');
    const wordData = vocab[word.toLowerCase()];

    // Remove active class from all words
    document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active'));

    if (!wordData) {
        popup.classList.remove('visible');
        return;
    }

    // Add active class to clicked word
    event.target.classList.add('active');

    popup.innerHTML = `
        <h4>${word}</h4>
        <div class="parsing">${wordData.parsing}</div>
        <div class="meaning">${wordData.meaning}</div>
        <div class="principal-parts">${wordData.lemma}</div>
    `;

    // Position popup near the word
    const rect = event.target.getBoundingClientRect();
    const popupWidth = 300;
    const popupHeight = 150;

    let left = rect.left + (rect.width / 2) - (popupWidth / 2);
    let top = rect.bottom + 12;
    let arrowBottom = false;

    // Keep popup within viewport horizontally
    if (left < 10) left = 10;
    if (left + popupWidth > window.innerWidth - 10) {
        left = window.innerWidth - popupWidth - 10;
    }

    // If popup would go below viewport, show above word
    if (top + popupHeight > window.innerHeight) {
        top = rect.top - popupHeight - 12;
        arrowBottom = true;
    }

    // Calculate arrow position relative to popup
    const wordCenterX = rect.left + (rect.width / 2);
    const arrowLeft = Math.max(20, Math.min(popupWidth - 20, wordCenterX - left));

    popup.style.left = left + 'px';
    popup.style.top = top + 'px';
    popup.style.setProperty('--arrow-left', arrowLeft + 'px');
    popup.classList.toggle('arrow-bottom', arrowBottom);
    popup.classList.add('visible');

    currentPopup = popup;
}

function hidePopup() {
    const popup = document.getElementById('vocabPopup');
    popup.classList.remove('visible');
    document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active'));
}

function toggleTranslation() {
    const box = document.getElementById('translationBox');
    const btn = event.currentTarget;

    if (box.classList.contains('active')) {
        box.classList.remove('active');
        btn.textContent = 'Show Translation';
        btn.classList.remove('active');
    } else {
        box.classList.add('active');
        btn.textContent = 'Hide Translation';
        btn.classList.add('active');
    }
}

function showView(view) {
    // Update nav
    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
    event.currentTarget.classList.add('active');

    const textCard = document.getElementById('textCard');
    const resourceCard = document.getElementById('resourceCard');

    if (view === 'text') {
        textCard.style.display = 'block';
        resourceCard.style.display = 'none';
    } else {
        textCard.style.display = 'none';
        resourceCard.style.display = 'block';
        document.getElementById('resourceTitle').textContent = view.charAt(0).toUpperCase() + view.slice(1);
        document.getElementById('resourceContent').innerHTML = resources[view];
    }
}

// Initialise
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('latinText').innerHTML = generateLatinHTML();

    // Load saved preferences
    loadPreferences();

    // Add click handlers to words
    document.querySelectorAll('.word').forEach(word => {
        word.addEventListener('click', function(e) {
            e.stopPropagation();

            if (pointerModeActive) {
                // Toggle pointed class
                this.classList.toggle('pointed');
            } else {
                showVocabPopup(e, this.dataset.word);
            }
        });
    });

    // Hide popup when clicking elsewhere, clear pointer highlights on background click
    document.addEventListener('click', function(e) {
        if (!e.target.classList.contains('word')) {
            hidePopup();

            // If in pointer mode and clicking background (not buttons), clear all highlights
            if (pointerModeActive && !e.target.closest('.btn-group') && !e.target.closest('.sentence-nav')) {
                document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
            }
        }
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Escape to exit full screen
        if (e.key === 'Escape') {
            if (document.body.classList.contains('full-screen')) {
                document.body.classList.remove('full-screen');
                const btn = document.querySelector('.btn-group .btn:last-child');
                if (btn) {
                    btn.textContent = '‚õ∂ Full Screen';
                    btn.classList.remove('active');
                }
            }
            // Also exit pointer mode on escape
            if (pointerModeActive) {
                pointerModeActive = false;
                document.body.classList.remove('pointer-mode');
                document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
                document.querySelectorAll('.btn').forEach(btn => {
                    if (btn.textContent === 'Pointer Mode') btn.classList.remove('active');
                });
            }
        }

        // Arrow keys for sentence navigation
        if (sentenceModeActive) {
            if (e.key === 'ArrowLeft') {
                prevSentence();
            } else if (e.key === 'ArrowRight') {
                nextSentence();
            }
        }
    });
});

function loadPreferences() {
    // Dark mode
    if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
        setTimeout(() => {
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent.includes('Dark')) {
                    btn.textContent = '‚òÄÔ∏è Light';
                    btn.classList.add('active');
                }
            });
        }, 0);
    }

    // Line numbers
    if (localStorage.getItem('lineNumbers') === 'true') {
        document.getElementById('latinText').classList.add('show-lines');
        setTimeout(() => {
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent === 'Line Numbers') {
                    btn.classList.add('active');
                }
            });
        }, 0);
    }
}

function savePreference(key, value) {
    localStorage.setItem(key, value);
}
    </script>
</body>
</html>
