<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classicalia - Tacitus Annals 12.65</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 240px;
            background: white;
            border-right: 1px solid #e5e7eb;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }
        .logo-section {
            padding: 1.5rem 1.25rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }
        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #0066ff 0%, #4d94ff 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.1rem;
        }
        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
        }
        .nav-section {
            padding: 1rem 0.5rem;
        }
        .nav-title {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #9ca3af;
            letter-spacing: 0.05em;
            padding: 0 0.75rem;
            margin-bottom: 0.5rem;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.625rem 0.75rem;
            margin: 0.125rem 0;
            border-radius: 8px;
            text-decoration: none;
            color: #4b5563;
            font-size: 0.9rem;
            transition: all 0.15s ease;
            cursor: pointer;
        }
        .nav-item:hover {
            background: #f3f4f6;
            color: #1f2937;
        }
        .nav-item.active {
            background: #eef2ff;
            color: #0066ff;
            font-weight: 500;
        }
        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }
        .main-content {
            margin-left: 240px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .top-bar {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0.875rem 2rem;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .content-wrapper {
            flex: 1;
            overflow-y: auto;
        }
        .content-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }
        .lesson-header {
            margin-bottom: 2rem;
        }
        .lesson-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        .lesson-meta {
            display: flex;
            gap: 1.5rem;
            font-size: 0.875rem;
            color: #6b7280;
        }
        .card {
            background: white;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }
        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
        }
        .card-body {
            padding: 2rem;
        }
        .latin-text {
            font-size: 1.5rem;
            line-height: 2.4;
            color: #1f2937;
        }
        .word {
            cursor: pointer;
            padding: 2px 4px;
            margin: 0 1px;
            border-radius: 4px;
            transition: all 0.15s ease;
            display: inline;
        }
        .word:hover {
            background: rgba(0, 102, 255, 0.15);
        }
        .word.active {
            background: rgba(0, 102, 255, 0.25);
        }

        /* Popup styles */
        .vocab-popup {
            position: fixed;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05);
            padding: 1rem 1.25rem;
            z-index: 1000;
            max-width: 350px;
            min-width: 250px;
            display: none;
            animation: popIn 0.2s ease;
        }
        .vocab-popup::before {
            content: '';
            position: absolute;
            top: -8px;
            left: var(--arrow-left, 50%);
            transform: translateX(-50%);
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid white;
        }
        .vocab-popup.arrow-bottom::before {
            top: auto;
            bottom: -8px;
            border-bottom: none;
            border-top: 8px solid white;
        }
        body.dark-mode .vocab-popup::before {
            border-bottom-color: #4f0c28;
        }
        body.dark-mode .vocab-popup.arrow-bottom::before {
            border-bottom-color: transparent;
            border-top-color: #4f0c28;
        }
        @keyframes popIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .vocab-popup.visible {
            display: block;
        }
        .vocab-popup h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #0066ff;
            margin-bottom: 0.5rem;
        }
        .vocab-popup .parsing {
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
            font-style: italic;
        }
        .vocab-popup .meaning {
            font-size: 0.95rem;
            color: #1f2937;
            line-height: 1.5;
        }
        .vocab-popup .principal-parts {
            font-size: 0.85rem;
            color: #4b5563;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid #e5e7eb;
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }
        .btn {
            padding: 0.625rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        .btn:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }
        .btn.active {
            background: #0066ff;
            color: white;
            border-color: #0066ff;
        }

        /* Dark mode styles */
        body.dark-mode {
            background: #2d0818;
        }
        body.dark-mode .sidebar {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .logo-icon {
            background: linear-gradient(135deg, #8b5a8a 0%, #a67aa6 100%);
        }
        body.dark-mode .logo-text {
            color: #c5d2f8;
        }
        body.dark-mode .nav-title {
            color: #9a8a9a;
        }
        body.dark-mode .nav-item {
            color: #b8a8b8;
        }
        body.dark-mode .nav-item:hover {
            background: #4f0c28;
            color: #c5d2f8;
        }
        body.dark-mode .nav-item.active {
            background: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .top-bar {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .card {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .card-header {
            border-color: #5a1a3a;
        }
        body.dark-mode .card-title {
            color: #c5d2f8;
        }
        body.dark-mode .lesson-title {
            color: #c5d2f8;
        }
        body.dark-mode .lesson-meta {
            color: #b8a8b8;
        }
        body.dark-mode .latin-text {
            color: #c5d2f8;
            text-shadow: 0 0 20px rgba(197, 210, 248, 0.15);
        }
        body.dark-mode .word:hover {
            background: rgba(232, 212, 168, 0.25);
        }
        body.dark-mode .word.active {
            background: rgba(232, 212, 168, 0.35);
        }
        body.dark-mode .btn {
            background: #4f0c28;
            border-color: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .btn:hover {
            background: #5a1a3a;
        }
        body.dark-mode .btn.active {
            background: #7a3a5a;
            border-color: #8a4a6a;
        }
        body.dark-mode .resource-card {
            background: #4f0c28;
            border-color: #5a1a3a;
        }
        body.dark-mode .resource-card h4 {
            color: #c5d2f8;
        }
        body.dark-mode .resource-card p {
            color: #b8c8e8;
        }
        body.dark-mode .vocab-popup {
            background: #4f0c28;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        body.dark-mode .vocab-popup h4 {
            color: #e8d4a8;
        }
        body.dark-mode .vocab-popup .parsing {
            color: #b8a8b8;
        }
        body.dark-mode .vocab-popup .meaning {
            color: #c5d2f8;
        }
        body.dark-mode .vocab-popup .principal-parts {
            color: #a8b8d8;
            border-color: #5a1a3a;
        }

        /* Sentence hover highlight */
        .latin-text p {
            padding: 0.5rem 0.75rem;
            margin: 0 -0.75rem 1.5rem -0.75rem;
            border-radius: 6px;
            transition: background 0.2s ease;
        }
        .latin-text p:hover {
            background: rgba(59, 130, 246, 0.08);
        }
        body.dark-mode .latin-text p:hover {
            background: rgba(197, 210, 248, 0.1);
        }

        /* Sentence-by-sentence mode */
        .latin-text.sentence-mode p {
            display: none;
        }
        .latin-text.sentence-mode p.current-sentence {
            display: block;
        }
        .latin-text.sentence-mode p:hover {
            background: transparent;
        }

        .sentence-nav {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }
        .sentence-nav.visible {
            display: flex;
        }
        body.dark-mode .sentence-nav {
            border-color: #5a1a3a;
        }
        .sentence-nav button {
            padding: 0.5rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        .sentence-nav button:hover:not(:disabled) {
            background: #f3f4f6;
        }
        .sentence-nav button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        body.dark-mode .sentence-nav button {
            background: #4f0c28;
            border-color: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .sentence-nav button:hover:not(:disabled) {
            background: #5a1a3a;
        }
        .sentence-counter {
            font-size: 0.875rem;
            color: #6b7280;
            min-width: 80px;
            text-align: center;
        }
        body.dark-mode .sentence-counter {
            color: #b8a8b8;
        }

        /* Full-screen mode */
        body.full-screen .sidebar {
            display: none;
        }
        body.full-screen .main-content {
            margin-left: 0;
        }
        body.full-screen .lesson-header {
            display: none;
        }
        body.full-screen .content-container {
            max-width: 100%;
            padding: 1rem 2rem;
        }
        body.full-screen .card {
            border: none;
            border-radius: 0;
            background: transparent;
        }
        body.full-screen .card-header {
            display: none;
        }
        body.full-screen .card-body {
            padding: 1rem 2rem;
        }
        body.full-screen .latin-text {
            font-size: 2rem;
            line-height: 2.6;
        }
        body.full-screen .btn-group {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            background: white;
            padding: 0.75rem;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 200;
        }
        body.full-screen.dark-mode .btn-group {
            background: #3a0a1f;
        }
        body.full-screen .resource-card {
            display: none !important;
        }
        body.full-screen .sentence-nav {
            border: none;
            padding-top: 0;
        }
        body.full-screen .top-bar {
            display: none;
        }

        /* Line numbers */
        .latin-text.show-lines p {
            display: flex;
            align-items: flex-start;
        }
        .line-number {
            display: none;
            min-width: 2.5rem;
            color: #9ca3af;
            font-size: 0.875rem;
            padding-top: 0.3rem;
            user-select: none;
        }
        .latin-text.show-lines .line-number {
            display: block;
        }
        body.dark-mode .line-number {
            color: #7a6a7a;
        }
        .line-content {
            flex: 1;
        }

        /* Pointer/highlight mode */
        .word.pointed {
            background: rgba(255, 200, 50, 0.5) !important;
            box-shadow: 0 0 12px rgba(255, 200, 50, 0.6);
            border-radius: 4px;
        }
        body.dark-mode .word.pointed {
            background: rgba(232, 212, 168, 0.5) !important;
            box-shadow: 0 0 15px rgba(232, 212, 168, 0.5);
        }

        /* Pointer mode indicator */
        body.pointer-mode .word {
            cursor: crosshair;
        }
        .mode-indicator {
            display: none;
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: #fef3c7;
            color: #92400e;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            z-index: 200;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        body.pointer-mode .mode-indicator {
            display: block;
        }
        body.dark-mode .mode-indicator {
            background: #4f0c28;
            color: #e8d4a8;
        }

        .resource-card {
            background: #f9fafb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px solid #e5e7eb;
            display: none;
        }
        .resource-card.active {
            display: block;
        }
        .resource-card h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.75rem;
        }
        .resource-card p {
            font-size: 0.95rem;
            line-height: 1.8;
            color: #374151;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
            }
            .latin-text {
                font-size: 1.25rem;
                line-height: 2.2;
            }
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="logo-section">
            <a href="../../../index.html" class="logo">
                <div class="logo-icon">C</div>
                <span class="logo-text">Classicalia</span>
            </a>
        </div>
        <nav class="nav-section">
            <div class="nav-title">Resources</div>
            <div class="nav-item active" onclick="showView('text')">
                <span class="nav-icon">üìñ</span>
                <span>Read</span>
            </div>
            <div class="nav-item" onclick="showView('summary')">
                <span class="nav-icon">üìã</span>
                <span>Summary</span>
            </div>
            <div class="nav-item" onclick="showView('context')">
                <span class="nav-icon">üèõÔ∏è</span>
                <span>Context</span>
            </div>
            <div class="nav-item" onclick="showView('comprehension')">
                <span class="nav-icon">‚ùì</span>
                <span>Comprehension</span>
            </div>
        </nav>
    </aside>

    <main class="main-content">
        <div class="top-bar"></div>
        <div class="content-wrapper">
            <div class="content-container">
                <header class="lesson-header">
                    <h1 class="lesson-title">Narcissus's Warning</h1>
                    <div class="lesson-meta">
                        <span>üìï Tacitus Annals 12.65</span>
                        <span>‚è±Ô∏è 45 min</span>
                        <span>üìä A-Level</span>
                    </div>
                </header>

                <div class="card" id="textCard">
                    <div class="card-header">
                        <h3 class="card-title">Latin Text</h3>
                    </div>
                    <div class="card-body">
                        <div class="latin-text" id="latinText"></div>
                        <div class="btn-group">
                            <button class="btn" onclick="toggleTranslation()">Translation</button>
                            <button class="btn" onclick="toggleSentenceMode()">Sentence Mode</button>
                            <button class="btn" onclick="toggleLineNumbers()">Line Numbers</button>
                            <button class="btn" onclick="togglePointerMode()">Pointer Mode</button>
                            <button class="btn" onclick="toggleDarkMode()">üåô Dark</button>
                            <button class="btn" onclick="toggleFullScreen()">‚õ∂ Full Screen</button>
                        </div>
                        <div class="sentence-nav" id="sentenceNav">
                            <button onclick="prevSentence()">‚Üê Previous</button>
                            <span class="sentence-counter" id="sentenceCounter">1 / 5</span>
                            <button onclick="nextSentence()">Next ‚Üí</button>
                        </div>
                        <div class="resource-card" id="translationBox">
                            <h4>Translation</h4>
                            <p>However, the charges were that she had attacked the emperor's wife with curses and that, with her bands of slaves insufficiently restrained throughout Calabria, she was disturbing the peace of Italy. On account of these charges death was decreed, with Narcissus strongly opposing. He, suspecting Agrippina more and more, was reported to have declared among his close associates that his own destruction was certain, whether Britannicus or Nero gained power; but Caesar had deserved so well of him that he would sacrifice his life for his service. Messalina and Silius had been convicted; equal grounds for accusation existed again if Nero should rule; if Britannicus succeeded, the emperor had nothing to fear: but the whole household was being shaken by the stepmother's plots, a greater disgrace than if he had kept silent about the shamelessness of his former wife. And indeed shamelessness was not absent even now with Pallas as her adulterer, so that no one might doubt that she held honour, modesty, her body - everything - cheaper than power. Saying these things and more, he would embrace Britannicus, praying that he reach the strength of manhood as quickly as possible, now stretching out his hands to the gods, now to Britannicus himself: let him grow up, drive out his father's enemies, and even avenge the killers of his mother.</p>
                        </div>
                    </div>
                </div>

                <div class="card" id="resourceCard" style="display: none; margin-top: 1.5rem;">
                    <div class="card-header">
                        <h3 class="card-title" id="resourceTitle">Summary</h3>
                    </div>
                    <div class="card-body" id="resourceContent"></div>
                </div>
            </div>
        </div>
    </main>

    <div class="vocab-popup" id="vocabPopup"></div>
    <div class="mode-indicator">üìç Pointer Mode (click words to highlight, click again to remove)</div>

    <script>
const vocab = {
    "ceterum": { lemma: "ceterum", parsing: "adverb", meaning: "however, but, moreover" },
    "obiecta": { lemma: "obicio, obicere, obieci, obiectum", parsing: "nom./acc. neut. pl. perf. pass. part.", meaning: "charges, accusations (lit. things thrown against)" },
    "sunt": { lemma: "sum, esse, fui", parsing: "3rd pl. pres. act. ind.", meaning: "are, were" },
    "quod": { lemma: "quod", parsing: "conjunction", meaning: "that, because" },
    "coniugem": { lemma: "coniunx, coniugis (m./f.)", parsing: "acc. sing.", meaning: "wife, spouse" },
    "principis": { lemma: "princeps, principis (m.)", parsing: "gen. sing.", meaning: "of the emperor, of the first citizen" },
    "devotionibus": { lemma: "devotio, devotionis (f.)", parsing: "abl. pl.", meaning: "with curses, with spells" },
    "petivisset": { lemma: "peto, petere, petivi, petitum", parsing: "3rd sing. pluperf. subj. act.", meaning: "she had attacked, she had assailed" },
    "quodque": { lemma: "quod + -que", parsing: "conjunction", meaning: "and that" },
    "parum": { lemma: "parum", parsing: "adverb", meaning: "insufficiently, too little" },
    "coercitis": { lemma: "coerceo, coercere, coercui, coercitum", parsing: "abl. pl. perf. pass. part.", meaning: "restrained, controlled" },
    "per": { lemma: "per", parsing: "preposition + acc.", meaning: "throughout, through" },
    "Calabriam": { lemma: "Calabria, -ae (f.)", parsing: "acc. sing.", meaning: "Calabria (region in southern Italy)" },
    "servorum": { lemma: "servus, -i (m.)", parsing: "gen. pl.", meaning: "of slaves" },
    "agminibus": { lemma: "agmen, agminis (n.)", parsing: "abl. pl.", meaning: "bands, columns, troops" },
    "pacem": { lemma: "pax, pacis (f.)", parsing: "acc. sing.", meaning: "peace" },
    "Italiae": { lemma: "Italia, -ae (f.)", parsing: "gen. sing.", meaning: "of Italy" },
    "turbaret": { lemma: "turbo, turbare, turbavi, turbatum", parsing: "3rd sing. imperf. subj. act.", meaning: "she was disturbing" },
    "ob": { lemma: "ob", parsing: "preposition + acc.", meaning: "on account of, because of" },
    "haec": { lemma: "hic, haec, hoc", parsing: "acc. neut. pl.", meaning: "these things" },
    "mors": { lemma: "mors, mortis (f.)", parsing: "nom. sing.", meaning: "death" },
    "indicta": { lemma: "indico, indicere, indixi, indictum", parsing: "nom. sing. fem. perf. pass. part.", meaning: "was decreed, was declared" },
    "multum": { lemma: "multum", parsing: "adverb", meaning: "greatly, much" },
    "adversante": { lemma: "adversor, adversari, adversatus sum", parsing: "abl. sing. pres. part.", meaning: "opposing, resisting" },
    "Narcisso": { lemma: "Narcissus, -i (m.)", parsing: "abl. sing.", meaning: "Narcissus (Claudius's freedman secretary)" },
    "qui": { lemma: "qui, quae, quod", parsing: "nom. sing. masc. rel. pron.", meaning: "who" },
    "Agrippinam": { lemma: "Agrippina, -ae (f.)", parsing: "acc. sing.", meaning: "Agrippina (the empress)" },
    "magis": { lemma: "magis", parsing: "comparative adverb", meaning: "more" },
    "magisque": { lemma: "magis + -que", parsing: "adverb", meaning: "and more" },
    "suspectans": { lemma: "suspecto, suspectare", parsing: "nom. sing. masc. pres. act. part.", meaning: "suspecting" },
    "prompsisse": { lemma: "promo, promere, prompsi, promptum", parsing: "perf. act. inf.", meaning: "to have declared, to have brought forth" },
    "inter": { lemma: "inter", parsing: "preposition + acc.", meaning: "among" },
    "proximos": { lemma: "proximus, -a, -um", parsing: "acc. pl. masc.", meaning: "closest associates, nearest friends" },
    "ferebatur": { lemma: "fero, ferre, tuli, latum", parsing: "3rd sing. imperf. pass. ind.", meaning: "was reported, was said" },
    "certam": { lemma: "certus, -a, -um", parsing: "acc. sing. fem.", meaning: "certain, sure" },
    "sibi": { lemma: "sui, sibi, se", parsing: "dat. sing. reflexive", meaning: "for himself" },
    "perniciem": { lemma: "pernicies, -ei (f.)", parsing: "acc. sing.", meaning: "destruction, ruin" },
    "seu": { lemma: "seu / sive", parsing: "conjunction", meaning: "whether, or if" },
    "Britannicus": { lemma: "Britannicus, -i (m.)", parsing: "nom. sing.", meaning: "Britannicus (Claudius's son)" },
    "rerum": { lemma: "res, rei (f.)", parsing: "gen. pl.", meaning: "of power, of affairs, of the state" },
    "Nero": { lemma: "Nero, Neronis (m.)", parsing: "nom. sing.", meaning: "Nero (Agrippina's son)" },
    "poteretur": { lemma: "potior, potiri, potitus sum", parsing: "3rd sing. imperf. subj. pass.", meaning: "should gain control of" },
    "verum": { lemma: "verum", parsing: "conjunction", meaning: "but, however" },
    "ita": { lemma: "ita", parsing: "adverb", meaning: "so, to such a degree" },
    "de": { lemma: "de", parsing: "preposition + abl.", meaning: "concerning, about" },
    "se": { lemma: "sui, sibi, se", parsing: "abl. sing. reflexive", meaning: "himself" },
    "meritum": { lemma: "mereor, mereri, meritus sum", parsing: "acc. sing. masc. perf. part.", meaning: "having deserved, having earned" },
    "Caesarem": { lemma: "Caesar, Caesaris (m.)", parsing: "acc. sing.", meaning: "Caesar, the emperor (Claudius)" },
    "ut": { lemma: "ut", parsing: "conjunction", meaning: "that, so that" },
    "vitam": { lemma: "vita, -ae (f.)", parsing: "acc. sing.", meaning: "life" },
    "usui": { lemma: "usus, -us (m.)", parsing: "dat. sing.", meaning: "for the service, for the use" },
    "eius": { lemma: "is, ea, id", parsing: "gen. sing.", meaning: "his, of him" },
    "impenderet": { lemma: "impendo, impendere, impendi, impensum", parsing: "3rd sing. imperf. subj. act.", meaning: "he would sacrifice, he would spend" },
    "convictam": { lemma: "convinco, convincere, convici, convictum", parsing: "acc. sing. fem. perf. pass. part.", meaning: "convicted, found guilty" },
    "Messalinam": { lemma: "Messalina, -ae (f.)", parsing: "acc. sing.", meaning: "Messalina (Claudius's former wife)" },
    "et": { lemma: "et", parsing: "conjunction", meaning: "and" },
    "Silium": { lemma: "Silius, -i (m.)", parsing: "acc. sing.", meaning: "Silius (Messalina's lover)" },
    "pares": { lemma: "par, paris", parsing: "acc. pl.", meaning: "equal" },
    "iterum": { lemma: "iterum", parsing: "adverb", meaning: "again" },
    "accusandi": { lemma: "accuso, accusare", parsing: "gen. sing. gerund", meaning: "of accusing" },
    "causas": { lemma: "causa, -ae (f.)", parsing: "acc. pl.", meaning: "grounds, reasons, causes" },
    "esse": { lemma: "sum, esse, fui", parsing: "pres. act. inf.", meaning: "to be" },
    "si": { lemma: "si", parsing: "conjunction", meaning: "if" },
    "imperitaret": { lemma: "imperio, imperitare", parsing: "3rd sing. imperf. subj. act.", meaning: "should rule, should command" },
    "Britannico": { lemma: "Britannicus, -i (m.)", parsing: "abl. sing.", meaning: "Britannicus" },
    "successore": { lemma: "successor, successoris (m.)", parsing: "abl. sing.", meaning: "as successor" },
    "nullum": { lemma: "nullus, -a, -um", parsing: "acc. sing. masc.", meaning: "no, none" },
    "principi": { lemma: "princeps, principis (m.)", parsing: "dat. sing.", meaning: "for the emperor" },
    "metum": { lemma: "metus, -us (m.)", parsing: "acc. sing.", meaning: "fear" },
    "at": { lemma: "at", parsing: "conjunction", meaning: "but (strong adversative)" },
    "novercae": { lemma: "noverca, -ae (f.)", parsing: "gen. sing.", meaning: "of the stepmother" },
    "insidiis": { lemma: "insidiae, -arum (f. pl.)", parsing: "abl. pl.", meaning: "by plots, by treachery" },
    "domum": { lemma: "domus, -us (f.)", parsing: "acc. sing.", meaning: "household, house" },
    "omnem": { lemma: "omnis, -e", parsing: "acc. sing. fem.", meaning: "entire, whole" },
    "convelli": { lemma: "convello, convellere, convelli, convulsum", parsing: "pres. pass. inf.", meaning: "to be shaken, to be torn apart" },
    "maiore": { lemma: "maior, maius", parsing: "abl. sing.", meaning: "greater" },
    "flagitio": { lemma: "flagitium, -i (n.)", parsing: "abl. sing.", meaning: "disgrace, scandal" },
    "quam": { lemma: "quam", parsing: "conjunction", meaning: "than" },
    "impudicitiam": { lemma: "impudicitia, -ae (f.)", parsing: "acc. sing.", meaning: "shamelessness, unchastity" },
    "prioris": { lemma: "prior, prius", parsing: "gen. sing.", meaning: "former, previous" },
    "coniugis": { lemma: "coniunx, coniugis (m./f.)", parsing: "gen. sing.", meaning: "of the wife, of the spouse" },
    "reticuisset": { lemma: "reticeo, reticere, reticui", parsing: "3rd sing. pluperf. subj. act.", meaning: "he had kept silent about" },
    "quamquam": { lemma: "quamquam", parsing: "conjunction", meaning: "although, and yet" },
    "ne": { lemma: "ne", parsing: "conjunction", meaning: "not, so that not" },
    "quidem": { lemma: "quidem", parsing: "adverb", meaning: "indeed, even (with ne: not even)" },
    "nunc": { lemma: "nunc", parsing: "adverb", meaning: "now" },
    "abesse": { lemma: "absum, abesse, afui", parsing: "pres. act. inf.", meaning: "to be absent" },
    "Pallante": { lemma: "Pallas, Pallantis (m.)", parsing: "abl. sing.", meaning: "Pallas (another powerful freedman)" },
    "adultero": { lemma: "adulter, adulteri (m.)", parsing: "abl. sing.", meaning: "as adulterer" },
    "quis": { lemma: "quis, quid", parsing: "nom. sing.", meaning: "anyone" },
    "ambigat": { lemma: "ambigo, ambigere", parsing: "3rd sing. pres. subj. act.", meaning: "might doubt" },
    "decus": { lemma: "decus, decoris (n.)", parsing: "acc. sing.", meaning: "honour, dignity" },
    "pudorem": { lemma: "pudor, pudoris (m.)", parsing: "acc. sing.", meaning: "modesty, shame" },
    "corpus": { lemma: "corpus, corporis (n.)", parsing: "acc. sing.", meaning: "body" },
    "cuncta": { lemma: "cunctus, -a, -um", parsing: "acc. neut. pl.", meaning: "all things, everything" },
    "regno": { lemma: "regnum, -i (n.)", parsing: "abl. sing.", meaning: "than power, than rule" },
    "viliora": { lemma: "vilis, -e", parsing: "acc. neut. pl. comparative", meaning: "cheaper, of less value" },
    "habere": { lemma: "habeo, habere, habui, habitum", parsing: "pres. act. inf.", meaning: "to hold, to consider" },
    "atque": { lemma: "atque", parsing: "conjunction", meaning: "and" },
    "talia": { lemma: "talis, -e", parsing: "acc. neut. pl.", meaning: "such things" },
    "dictitans": { lemma: "dictito, dictitare", parsing: "nom. sing. masc. pres. act. part.", meaning: "saying repeatedly (frequentative)" },
    "amplecti": { lemma: "amplector, amplecti, amplexus sum", parsing: "pres. inf. deponent", meaning: "to embrace" },
    "Britannicum": { lemma: "Britannicus, -i (m.)", parsing: "acc. sing.", meaning: "Britannicus" },
    "robur": { lemma: "robur, roboris (n.)", parsing: "acc. sing.", meaning: "strength, maturity" },
    "aetatis": { lemma: "aetas, aetatis (f.)", parsing: "gen. sing.", meaning: "of age" },
    "maturrimum": { lemma: "mature", parsing: "superlative adverb", meaning: "most quickly, as quickly as possible" },
    "precari": { lemma: "precor, precari, precatus sum", parsing: "pres. inf. deponent", meaning: "to pray for" },
    "modo": { lemma: "modo", parsing: "adverb", meaning: "now, sometimes (modo...modo = now...now)" },
    "ad": { lemma: "ad", parsing: "preposition + acc.", meaning: "to, towards" },
    "deos": { lemma: "deus, -i (m.)", parsing: "acc. pl.", meaning: "the gods" },
    "ipsum": { lemma: "ipse, ipsa, ipsum", parsing: "acc. sing. masc.", meaning: "himself (referring to Britannicus)" },
    "tendere": { lemma: "tendo, tendere, tetendi, tentum", parsing: "pres. act. inf.", meaning: "to stretch out" },
    "manus": { lemma: "manus, -us (f.)", parsing: "acc. pl.", meaning: "hands" },
    "adolesceret": { lemma: "adolesco, adolescere, adolevi, adultum", parsing: "3rd sing. imperf. subj. act.", meaning: "let him grow up" },
    "patris": { lemma: "pater, patris (m.)", parsing: "gen. sing.", meaning: "of his father" },
    "inimicos": { lemma: "inimicus, -i (m.)", parsing: "acc. pl.", meaning: "enemies" },
    "depelleret": { lemma: "depello, depellere, depuli, depulsum", parsing: "3rd sing. imperf. subj. act.", meaning: "let him drive out" },
    "matris": { lemma: "mater, matris (f.)", parsing: "gen. sing.", meaning: "of his mother" },
    "etiam": { lemma: "etiam", parsing: "adverb", meaning: "even, also" },
    "interfectores": { lemma: "interfector, interfectoris (m.)", parsing: "acc. pl.", meaning: "killers, murderers" },
    "ulcisceretur": { lemma: "ulciscor, ulcisci, ultus sum", parsing: "3rd sing. imperf. subj. deponent", meaning: "let him avenge" }
};

const latinSentences = [
    "ceterum obiecta sunt quod coniugem principis devotionibus petivisset quodque parum coercitis per Calabriam servorum agminibus pacem Italiae turbaret.",
    "ob haec mors indicta, multum adversante Narcisso, qui Agrippinam magis magisque suspectans prompsisse inter proximos ferebatur certam sibi perniciem, seu Britannicus rerum seu Nero poteretur; verum ita de se meritum Caesarem, ut vitam usui eius impenderet.",
    "convictam Messalinam et Silium; pares iterum accusandi causas esse, si Nero imperitaret; Britannico successore nullum principi metum: at novercae insidiis domum omnem convelli, maiore flagitio quam si impudicitiam prioris coniugis reticuisset.",
    "quamquam ne impudicitiam quidem nunc abesse Pallante adultero, ne quis ambigat decus pudorem corpus, cuncta regno viliora habere.",
    "haec atque talia dictitans amplecti Britannicum, robur aetatis quam maturrimum precari, modo ad deos, modo ad ipsum tendere manus: adolesceret, patris inimicos depelleret, matris etiam interfectores ulcisceretur."
];

const resources = {
    summary: `<h4>Summary</h4>
<p>Domitia Lepida is charged with using curses against the empress (Agrippina) and with disturbing Italy's peace by failing to control her slave gangs in Calabria. Death is decreed for her.</p>
<p>Narcissus, the powerful freedman, opposes her execution but fails. Increasingly suspicious of Agrippina, he reportedly tells close associates that his destruction is certain whoever gains power - Britannicus or Nero - but he owes Claudius his loyalty.</p>
<p>He reminds Claudius of exposing Messalina and warns that Agrippina poses equal danger. With Britannicus as heir, Claudius would be safe; with Agrippina in control, the household is being destroyed. He even accuses Agrippina of adultery with Pallas. Embracing Britannicus, Narcissus prays for the boy to grow up and avenge both his father's enemies and his mother's killers.</p>`,
    context: `<h4>Historical Context</h4>
<p><strong>Domitia Lepida:</strong> Nero's aunt (his father's sister) and former guardian, Lepida was a rival to Agrippina for influence over the young Nero. Her execution removed a powerful threat to Agrippina's dominance.</p>
<p><strong>Narcissus:</strong> One of Claudius' most powerful freedmen, he had orchestrated the downfall of Messalina. He opposed Claudius' marriage to Agrippina and championed Britannicus as heir, making him Agrippina's natural enemy.</p>
<p><strong>Pallas:</strong> Another powerful freedman who supported Agrippina. The accusation of adultery between them may or may not have been true, but it reflects the intense factional rivalry at court.</p>
<p><strong>Messalina's Death:</strong> Narcissus' reference to 'matris interfectores' (killers of his mother) points to Agrippina's role in ensuring Messalina's execution in AD 48, which cleared the way for her own marriage to Claudius.</p>`,
    comprehension: `<h4>Comprehension Questions</h4>
<p><strong>Lines 1:</strong> What two charges were brought against Lepida?</p>
<p><strong>Line 2:</strong> What was the outcome of the trial? Who opposed the verdict?</p>
<p><strong>Lines 2-3:</strong> Why did Narcissus believe his destruction was certain regardless of who succeeded?</p>
<p><strong>Line 3:</strong> What past service did Narcissus remind Claudius of?</p>
<p><strong>Lines 3-4:</strong> According to Narcissus, what would happen under each potential successor?</p>
<p><strong>Line 4:</strong> What accusation did Narcissus make about Agrippina and Pallas?</p>
<p><strong>Line 4:</strong> What does the phrase 'decus pudorem corpus, cuncta regno viliora' suggest about Agrippina?</p>
<p><strong>Line 5:</strong> What did Narcissus pray for Britannicus to do?</p>
<p><strong>Overall:</strong> What is the dramatic irony in Narcissus' prayers for Britannicus, given what we know of later events?</p>`
};

let currentPopup = null;
let sentenceModeActive = false;
let currentSentenceIndex = 0;
let pointerModeActive = false;

function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    const isDark = document.body.classList.contains('dark-mode');
    savePreference('darkMode', isDark);

    const btn = event.currentTarget;
    if (isDark) {
        btn.textContent = '‚òÄÔ∏è Light';
        btn.classList.add('active');
    } else {
        btn.textContent = 'üåô Dark';
        btn.classList.remove('active');
    }
}

function toggleFullScreen() {
    document.body.classList.toggle('full-screen');
    const btn = event.currentTarget;
    if (document.body.classList.contains('full-screen')) {
        btn.textContent = '‚õ∂ Exit Full Screen';
        btn.classList.add('active');
    } else {
        btn.textContent = '‚õ∂ Full Screen';
        btn.classList.remove('active');
    }
}

function toggleLineNumbers() {
    const latinText = document.getElementById('latinText');
    latinText.classList.toggle('show-lines');
    const showLines = latinText.classList.contains('show-lines');
    savePreference('lineNumbers', showLines);

    const btn = event.currentTarget;
    btn.classList.toggle('active');
}

function togglePointerMode() {
    pointerModeActive = !pointerModeActive;
    document.body.classList.toggle('pointer-mode');
    const btn = event.currentTarget;
    btn.classList.toggle('active');

    if (!pointerModeActive) {
        // Clear all pointed words when exiting pointer mode
        document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
    }

    // Hide vocab popup when entering pointer mode
    if (pointerModeActive) {
        hidePopup();
    }
}

function toggleSentenceMode() {
    const latinText = document.getElementById('latinText');
    const sentenceNav = document.getElementById('sentenceNav');
    const btn = event.currentTarget;

    sentenceModeActive = !sentenceModeActive;

    if (sentenceModeActive) {
        latinText.classList.add('sentence-mode');
        sentenceNav.classList.add('visible');
        btn.classList.add('active');
        btn.textContent = 'Full Text';
        currentSentenceIndex = 0;
        updateSentenceDisplay();
    } else {
        latinText.classList.remove('sentence-mode');
        sentenceNav.classList.remove('visible');
        btn.classList.remove('active');
        btn.textContent = 'Sentence Mode';
        // Remove current-sentence class from all
        document.querySelectorAll('.latin-text p').forEach(p => p.classList.remove('current-sentence'));
    }
}

function updateSentenceDisplay() {
    const paragraphs = document.querySelectorAll('.latin-text p');
    paragraphs.forEach((p, i) => {
        if (i === currentSentenceIndex) {
            p.classList.add('current-sentence');
        } else {
            p.classList.remove('current-sentence');
        }
    });
    document.getElementById('sentenceCounter').textContent = `${currentSentenceIndex + 1} / ${paragraphs.length}`;

    // Update button states
    const navButtons = document.querySelectorAll('.sentence-nav button');
    navButtons[0].disabled = currentSentenceIndex === 0;
    navButtons[1].disabled = currentSentenceIndex === paragraphs.length - 1;
}

function prevSentence() {
    if (currentSentenceIndex > 0) {
        currentSentenceIndex--;
        updateSentenceDisplay();
        hidePopup();
    }
}

function nextSentence() {
    const paragraphs = document.querySelectorAll('.latin-text p');
    if (currentSentenceIndex < paragraphs.length - 1) {
        currentSentenceIndex++;
        updateSentenceDisplay();
        hidePopup();
    }
}

function generateLatinHTML() {
    let html = '';
    latinSentences.forEach((sentence, index) => {
        // Split into tokens, keeping punctuation attached to words
        const tokens = sentence.match(/[a-zA-Z]+[.,;:]*|[.,;:]+/g);
        html += '<p style="margin-bottom: 1.5rem;">';
        html += `<span class="line-number">${index + 1}</span>`;
        html += '<span class="line-content">';
        tokens.forEach((token, i) => {
            // Separate word from trailing punctuation
            const match = token.match(/^([a-zA-Z]+)([.,;:]*)$/);
            if (match) {
                const word = match[1];
                const punct = match[2];
                const lookupWord = word.toLowerCase();
                html += `<span class="word" data-word="${lookupWord}">${word}</span>${punct}`;
                // Add space after unless it's the last token
                if (i < tokens.length - 1) html += ' ';
            } else {
                // Just punctuation
                html += token + ' ';
            }
        });
        html += '</span></p>';
    });
    return html;
}

function showVocabPopup(event, word) {
    const popup = document.getElementById('vocabPopup');
    const wordData = vocab[word.toLowerCase()];

    // Remove active class from all words
    document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active'));

    if (!wordData) {
        popup.classList.remove('visible');
        return;
    }

    // Add active class to clicked word
    event.target.classList.add('active');

    popup.innerHTML = `
        <h4>${word}</h4>
        <div class="parsing">${wordData.parsing}</div>
        <div class="meaning">${wordData.meaning}</div>
        <div class="principal-parts">${wordData.lemma}</div>
    `;

    // Position popup near the word
    const rect = event.target.getBoundingClientRect();
    const popupWidth = 300;
    const popupHeight = 150;

    let left = rect.left + (rect.width / 2) - (popupWidth / 2);
    let top = rect.bottom + 12;
    let arrowBottom = false;

    // Keep popup within viewport horizontally
    if (left < 10) left = 10;
    if (left + popupWidth > window.innerWidth - 10) {
        left = window.innerWidth - popupWidth - 10;
    }

    // If popup would go below viewport, show above word
    if (top + popupHeight > window.innerHeight) {
        top = rect.top - popupHeight - 12;
        arrowBottom = true;
    }

    // Calculate arrow position relative to popup
    const wordCenterX = rect.left + (rect.width / 2);
    const arrowLeft = Math.max(20, Math.min(popupWidth - 20, wordCenterX - left));

    popup.style.left = left + 'px';
    popup.style.top = top + 'px';
    popup.style.setProperty('--arrow-left', arrowLeft + 'px');
    popup.classList.toggle('arrow-bottom', arrowBottom);
    popup.classList.add('visible');

    currentPopup = popup;
}

function hidePopup() {
    const popup = document.getElementById('vocabPopup');
    popup.classList.remove('visible');
    document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active'));
}

function toggleTranslation() {
    const box = document.getElementById('translationBox');
    const btn = event.currentTarget;

    if (box.classList.contains('active')) {
        box.classList.remove('active');
        btn.textContent = 'Show Translation';
        btn.classList.remove('active');
    } else {
        box.classList.add('active');
        btn.textContent = 'Hide Translation';
        btn.classList.add('active');
    }
}

function showView(view) {
    // Update nav
    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
    event.currentTarget.classList.add('active');

    const textCard = document.getElementById('textCard');
    const resourceCard = document.getElementById('resourceCard');

    if (view === 'text') {
        textCard.style.display = 'block';
        resourceCard.style.display = 'none';
    } else {
        textCard.style.display = 'none';
        resourceCard.style.display = 'block';
        document.getElementById('resourceTitle').textContent = view.charAt(0).toUpperCase() + view.slice(1);
        document.getElementById('resourceContent').innerHTML = resources[view];
    }
}

// Initialise
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('latinText').innerHTML = generateLatinHTML();

    // Load saved preferences
    loadPreferences();

    // Add click handlers to words
    document.querySelectorAll('.word').forEach(word => {
        word.addEventListener('click', function(e) {
            e.stopPropagation();

            if (pointerModeActive) {
                // Toggle pointed class
                this.classList.toggle('pointed');
            } else {
                showVocabPopup(e, this.dataset.word);
            }
        });
    });

    // Hide popup when clicking elsewhere, clear pointer highlights on background click
    document.addEventListener('click', function(e) {
        if (!e.target.classList.contains('word')) {
            hidePopup();

            // If in pointer mode and clicking background (not buttons), clear all highlights
            if (pointerModeActive && !e.target.closest('.btn-group') && !e.target.closest('.sentence-nav')) {
                document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
            }
        }
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Escape to exit full screen
        if (e.key === 'Escape') {
            if (document.body.classList.contains('full-screen')) {
                document.body.classList.remove('full-screen');
                const btn = document.querySelector('.btn-group .btn:last-child');
                if (btn) {
                    btn.textContent = '‚õ∂ Full Screen';
                    btn.classList.remove('active');
                }
            }
            // Also exit pointer mode on escape
            if (pointerModeActive) {
                pointerModeActive = false;
                document.body.classList.remove('pointer-mode');
                document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
                document.querySelectorAll('.btn').forEach(btn => {
                    if (btn.textContent === 'Pointer Mode') btn.classList.remove('active');
                });
            }
        }

        // Arrow keys for sentence navigation
        if (sentenceModeActive) {
            if (e.key === 'ArrowLeft') {
                prevSentence();
            } else if (e.key === 'ArrowRight') {
                nextSentence();
            }
        }
    });
});

function loadPreferences() {
    // Dark mode
    if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
        setTimeout(() => {
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent.includes('Dark')) {
                    btn.textContent = '‚òÄÔ∏è Light';
                    btn.classList.add('active');
                }
            });
        }, 0);
    }

    // Line numbers
    if (localStorage.getItem('lineNumbers') === 'true') {
        document.getElementById('latinText').classList.add('show-lines');
        setTimeout(() => {
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent === 'Line Numbers') {
                    btn.classList.add('active');
                }
            });
        }, 0);
    }
}

function savePreference(key, value) {
    localStorage.setItem(key, value);
}
    </script>
</body>
</html>
