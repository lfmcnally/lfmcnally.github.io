<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classicalia - Tacitus Annals 12.43</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 240px;
            background: white;
            border-right: 1px solid #e5e7eb;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }
        .logo-section {
            padding: 1.5rem 1.25rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }
        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #0066ff 0%, #4d94ff 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.1rem;
        }
        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
        }
        .nav-section {
            padding: 1rem 0.5rem;
        }
        .nav-title {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #9ca3af;
            letter-spacing: 0.05em;
            padding: 0 0.75rem;
            margin-bottom: 0.5rem;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.625rem 0.75rem;
            margin: 0.125rem 0;
            border-radius: 8px;
            text-decoration: none;
            color: #4b5563;
            font-size: 0.9rem;
            transition: all 0.15s ease;
            cursor: pointer;
        }
        .nav-item:hover {
            background: #f3f4f6;
            color: #1f2937;
        }
        .nav-item.active {
            background: #eef2ff;
            color: #0066ff;
            font-weight: 500;
        }
        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }
        .main-content {
            margin-left: 240px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .top-bar {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0.875rem 2rem;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .content-wrapper {
            flex: 1;
            overflow-y: auto;
        }
        .content-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }
        .lesson-header {
            margin-bottom: 2rem;
        }
        .lesson-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        .lesson-meta {
            display: flex;
            gap: 1.5rem;
            font-size: 0.875rem;
            color: #6b7280;
        }
        .card {
            background: white;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }
        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
        }
        .card-body {
            padding: 2rem;
        }
        .latin-text {
            font-size: 1.5rem;
            line-height: 2.4;
            color: #1f2937;
        }
        .word {
            cursor: pointer;
            padding: 2px 4px;
            margin: 0 1px;
            border-radius: 4px;
            transition: all 0.15s ease;
            display: inline;
        }
        .word:hover {
            background: rgba(0, 102, 255, 0.15);
        }
        .word.active {
            background: rgba(0, 102, 255, 0.25);
        }
        
        /* Popup styles */
        .vocab-popup {
            position: fixed;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05);
            padding: 1rem 1.25rem;
            z-index: 1000;
            max-width: 350px;
            min-width: 250px;
            display: none;
            animation: popIn 0.2s ease;
        }
        .vocab-popup::before {
            content: '';
            position: absolute;
            top: -8px;
            left: var(--arrow-left, 50%);
            transform: translateX(-50%);
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid white;
        }
        .vocab-popup.arrow-bottom::before {
            top: auto;
            bottom: -8px;
            border-bottom: none;
            border-top: 8px solid white;
        }
        body.dark-mode .vocab-popup::before {
            border-bottom-color: #4f0c28;
        }
        body.dark-mode .vocab-popup.arrow-bottom::before {
            border-bottom-color: transparent;
            border-top-color: #4f0c28;
        }
        @keyframes popIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .vocab-popup.visible {
            display: block;
        }
        .vocab-popup h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #0066ff;
            margin-bottom: 0.5rem;
        }
        .vocab-popup .parsing {
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
            font-style: italic;
        }
        .vocab-popup .meaning {
            font-size: 0.95rem;
            color: #1f2937;
            line-height: 1.5;
        }
        .vocab-popup .principal-parts {
            font-size: 0.85rem;
            color: #4b5563;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid #e5e7eb;
        }
        
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }
        .btn {
            padding: 0.625rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        .btn:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }
        .btn.active {
            background: #0066ff;
            color: white;
            border-color: #0066ff;
        }
        
        /* Dark mode styles */
        body.dark-mode {
            background: #2d0818;
        }
        body.dark-mode .sidebar {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .logo-icon {
            background: linear-gradient(135deg, #8b5a8a 0%, #a67aa6 100%);
        }
        body.dark-mode .logo-text {
            color: #c5d2f8;
        }
        body.dark-mode .nav-title {
            color: #9a8a9a;
        }
        body.dark-mode .nav-item {
            color: #b8a8b8;
        }
        body.dark-mode .nav-item:hover {
            background: #4f0c28;
            color: #c5d2f8;
        }
        body.dark-mode .nav-item.active {
            background: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .top-bar {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .card {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .card-header {
            border-color: #5a1a3a;
        }
        body.dark-mode .card-title {
            color: #c5d2f8;
        }
        body.dark-mode .lesson-title {
            color: #c5d2f8;
        }
        body.dark-mode .lesson-meta {
            color: #b8a8b8;
        }
        body.dark-mode .latin-text {
            color: #c5d2f8;
            text-shadow: 0 0 20px rgba(197, 210, 248, 0.15);
        }
        body.dark-mode .word:hover {
            background: rgba(232, 212, 168, 0.25);
        }
        body.dark-mode .word.active {
            background: rgba(232, 212, 168, 0.35);
        }
        body.dark-mode .btn {
            background: #4f0c28;
            border-color: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .btn:hover {
            background: #5a1a3a;
        }
        body.dark-mode .btn.active {
            background: #7a3a5a;
            border-color: #8a4a6a;
        }
        body.dark-mode .resource-card {
            background: #4f0c28;
            border-color: #5a1a3a;
        }
        body.dark-mode .resource-card h4 {
            color: #c5d2f8;
        }
        body.dark-mode .resource-card p {
            color: #b8c8e8;
        }
        body.dark-mode .vocab-popup {
            background: #4f0c28;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        body.dark-mode .vocab-popup h4 {
            color: #e8d4a8;
        }
        body.dark-mode .vocab-popup .parsing {
            color: #b8a8b8;
        }
        body.dark-mode .vocab-popup .meaning {
            color: #c5d2f8;
        }
        body.dark-mode .vocab-popup .principal-parts {
            color: #a8b8d8;
            border-color: #5a1a3a;
        }
        
        /* Sentence hover highlight */
        .latin-text p {
            padding: 0.5rem 0.75rem;
            margin: 0 -0.75rem 1.5rem -0.75rem;
            border-radius: 6px;
            transition: background 0.2s ease;
        }
        .latin-text p:hover {
            background: rgba(59, 130, 246, 0.08);
        }
        body.dark-mode .latin-text p:hover {
            background: rgba(197, 210, 248, 0.1);
        }
        
        /* Sentence-by-sentence mode */
        .latin-text.sentence-mode p {
            display: none;
        }
        .latin-text.sentence-mode p.current-sentence {
            display: block;
        }
        .latin-text.sentence-mode p:hover {
            background: transparent;
        }
        
        .sentence-nav {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }
        .sentence-nav.visible {
            display: flex;
        }
        body.dark-mode .sentence-nav {
            border-color: #5a1a3a;
        }
        .sentence-nav button {
            padding: 0.5rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        .sentence-nav button:hover:not(:disabled) {
            background: #f3f4f6;
        }
        .sentence-nav button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        body.dark-mode .sentence-nav button {
            background: #4f0c28;
            border-color: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .sentence-nav button:hover:not(:disabled) {
            background: #5a1a3a;
        }
        .sentence-counter {
            font-size: 0.875rem;
            color: #6b7280;
            min-width: 80px;
            text-align: center;
        }
        body.dark-mode .sentence-counter {
            color: #b8a8b8;
        }
        
        /* Full-screen mode */
        body.full-screen .sidebar {
            display: none;
        }
        body.full-screen .main-content {
            margin-left: 0;
        }
        body.full-screen .lesson-header {
            display: none;
        }
        body.full-screen .content-container {
            max-width: 100%;
            padding: 1rem 2rem;
        }
        body.full-screen .card {
            border: none;
            border-radius: 0;
            background: transparent;
        }
        body.full-screen .card-header {
            display: none;
        }
        body.full-screen .card-body {
            padding: 1rem 2rem;
        }
        body.full-screen .latin-text {
            font-size: 2rem;
            line-height: 2.6;
        }
        body.full-screen .btn-group {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            background: white;
            padding: 0.75rem;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 200;
        }
        body.full-screen.dark-mode .btn-group {
            background: #3a0a1f;
        }
        body.full-screen .resource-card {
            display: none !important;
        }
        body.full-screen .sentence-nav {
            border: none;
            padding-top: 0;
        }
        body.full-screen .top-bar {
            display: none;
        }
        
        /* Line numbers */
        .latin-text.show-lines p {
            display: flex;
            align-items: flex-start;
        }
        .line-number {
            display: none;
            min-width: 2.5rem;
            color: #9ca3af;
            font-size: 0.875rem;
            padding-top: 0.3rem;
            user-select: none;
        }
        .latin-text.show-lines .line-number {
            display: block;
        }
        body.dark-mode .line-number {
            color: #7a6a7a;
        }
        .line-content {
            flex: 1;
        }
        
        /* Pointer/highlight mode */
        .word.pointed {
            background: rgba(255, 200, 50, 0.5) !important;
            box-shadow: 0 0 12px rgba(255, 200, 50, 0.6);
            border-radius: 4px;
        }
        body.dark-mode .word.pointed {
            background: rgba(232, 212, 168, 0.5) !important;
            box-shadow: 0 0 15px rgba(232, 212, 168, 0.5);
        }
        
        /* Pointer mode indicator */
        body.pointer-mode .word {
            cursor: crosshair;
        }
        .mode-indicator {
            display: none;
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: #fef3c7;
            color: #92400e;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            z-index: 200;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        body.pointer-mode .mode-indicator {
            display: block;
        }
        body.dark-mode .mode-indicator {
            background: #4f0c28;
            color: #e8d4a8;
        }
        
        .resource-card {
            background: #f9fafb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px solid #e5e7eb;
            display: none;
        }
        .resource-card.active {
            display: block;
        }
        .resource-card h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.75rem;
        }
        .resource-card p {
            font-size: 0.95rem;
            line-height: 1.8;
            color: #374151;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
            }
            .latin-text {
                font-size: 1.25rem;
                line-height: 2.2;
            }
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="logo-section">
            <a href="../../../index.html" class="logo">
                <div class="logo-icon">C</div>
                <span class="logo-text">Classicalia</span>
            </a>
        </div>
        <nav class="nav-section">
            <div class="nav-title">Resources</div>
            <div class="nav-item active" onclick="showView('text')">
                <span class="nav-icon">üìñ</span>
                <span>Read</span>
            </div>
            <div class="nav-item" onclick="showView('summary')">
                <span class="nav-icon">üìã</span>
                <span>Summary</span>
            </div>
            <div class="nav-item" onclick="showView('context')">
                <span class="nav-icon">üèõÔ∏è</span>
                <span>Context</span>
            </div>
            <div class="nav-item" onclick="showView('comprehension')">
                <span class="nav-icon">‚ùì</span>
                <span>Comprehension</span>
            </div>
        </nav>
    </aside>
    
    <main class="main-content">
        <div class="top-bar"></div>
        <div class="content-wrapper">
            <div class="content-container">
                <header class="lesson-header">
                    <h1 class="lesson-title">Portents and Famine in Rome</h1>
                    <div class="lesson-meta">
                        <span>üìï Tacitus Annals 12.43</span>
                        <span>‚è±Ô∏è 45 min</span>
                        <span>üìä A-Level</span>
                    </div>
                </header>
                
                <div class="card" id="textCard">
                    <div class="card-header">
                        <h3 class="card-title">Latin Text</h3>
                    </div>
                    <div class="card-body">
                        <div class="latin-text" id="latinText"></div>
                        <div class="btn-group">
                            <button class="btn" onclick="toggleTranslation()">Translation</button>
                            <button class="btn" onclick="toggleSentenceMode()">Sentence Mode</button>
                            <button class="btn" onclick="toggleLineNumbers()">Line Numbers</button>
                            <button class="btn" onclick="togglePointerMode()">Pointer Mode</button>
                            <button class="btn" onclick="toggleDarkMode()">üåô Dark</button>
                            <button class="btn" onclick="toggleFullScreen()">‚õ∂ Full Screen</button>
                        </div>
                        <div class="sentence-nav" id="sentenceNav">
                            <button onclick="prevSentence()">‚Üê Previous</button>
                            <span class="sentence-counter" id="sentenceCounter">1 / 6</span>
                            <button onclick="nextSentence()">Next ‚Üí</button>
                        </div>
                        <div class="resource-card" id="translationBox">
                            <h4>Translation</h4>
                            <p>Many portents happened in that year. The Capitol was occupied by birds of ill omen, houses were destroyed by frequent earthquakes, and while fear spread more widely, every weak person was trampled in the panic of the crowd; shortage of crops also, and the famine which arose from that, were regarded as a portent. There were not only hidden complaints, but when Claudius was dispensing justice, people surrounded him with turbulent shouts, and having driven him to the furthest part of the forum, they pressed upon him with violence, until he broke through the hostile crowd with a band of soldiers. It was established that there were provisions for fifteen days left for the city, no more, and that the desperate situation was relieved by the great kindness of the gods and the mildness of the winter. But, by Hercules, in the past Italy used to export provisions for the legions to distant provinces, and the difficulty now is not because of infertility, but we cultivate Africa and Egypt instead, and the life of the Roman people has been entrusted to ships and chance.</p>
                        </div>
                    </div>
                </div>
                
                <div class="card" id="resourceCard" style="display: none; margin-top: 1.5rem;">
                    <div class="card-header">
                        <h3 class="card-title" id="resourceTitle">Summary</h3>
                    </div>
                    <div class="card-body" id="resourceContent"></div>
                </div>
            </div>
        </div>
    </main>
    
    <div class="vocab-popup" id="vocabPopup"></div>
    <div class="mode-indicator">üìç Pointer Mode (click words to highlight, click again to remove)</div>

    <script>
const vocab = {
    "multa": { lemma: "multus, -a, -um", parsing: "nom./acc. neut. pl.", meaning: "many" },
    "eo": { lemma: "is, ea, id", parsing: "abl. masc./neut. sing.", meaning: "that" },
    "anno": { lemma: "annus, -i (m.)", parsing: "abl. sing.", meaning: "year" },
    "prodigia": { lemma: "prodigium, -i (n.)", parsing: "nom./acc. pl.", meaning: "portents, omens, signs" },
    "evenere": { lemma: "evenio, -ire, eveni, eventum", parsing: "3rd pl. perf. act. ind.", meaning: "happened, occurred" },
    "insessum": { lemma: "insido, -ere, insedi, insessum", parsing: "perf. pass. part. nom./acc. neut. sing.", meaning: "occupied, settled upon" },
    "diris": { lemma: "dirus, -a, -um", parsing: "abl. pl.", meaning: "dreadful, ill-omened" },
    "avibus": { lemma: "avis, avis (f.)", parsing: "abl. pl.", meaning: "birds" },
    "Capitolium": { lemma: "Capitolium, -i (n.)", parsing: "nom./acc. sing.", meaning: "the Capitol (temple of Jupiter in Rome)" },
    "crebris": { lemma: "creber, crebra, crebrum", parsing: "abl. pl.", meaning: "frequent, repeated" },
    "terrae": { lemma: "terra, -ae (f.)", parsing: "gen. sing.", meaning: "of the earth" },
    "motibus": { lemma: "motus, -us (m.)", parsing: "abl. pl.", meaning: "movements, earthquakes" },
    "prorutae": { lemma: "proruo, -ere, prorui, prorutum", parsing: "nom. pl. fem. perf. pass. part.", meaning: "destroyed, thrown down" },
    "domus": { lemma: "domus, -us (f.)", parsing: "nom. pl.", meaning: "houses" },
    "ac": { lemma: "ac / atque", parsing: "conjunction", meaning: "and" },
    "dum": { lemma: "dum", parsing: "conjunction", meaning: "while" },
    "latius": { lemma: "late (adv.)", parsing: "comparative adverb", meaning: "more widely" },
    "metuitur": { lemma: "metuo, -ere, metui", parsing: "3rd sing. pres. pass. ind.", meaning: "it is feared" },
    "trepidatione": { lemma: "trepidatio, -onis (f.)", parsing: "abl. sing.", meaning: "panic, alarm" },
    "vulgi": { lemma: "vulgus, -i (n.)", parsing: "gen. sing.", meaning: "of the crowd, of the common people" },
    "invalidus": { lemma: "invalidus, -a, -um", parsing: "nom. sing. masc.", meaning: "weak, feeble" },
    "quisque": { lemma: "quisque, quaeque, quidque", parsing: "nom. sing.", meaning: "each one, every" },
    "obtriti": { lemma: "obtero, -ere, obtrivi, obtritum", parsing: "nom. pl. masc. perf. pass. part.", meaning: "trampled, crushed" },
    "frugum": { lemma: "frux, frugis (f.)", parsing: "gen. pl.", meaning: "of crops, of grain" },
    "quoque": { lemma: "quoque", parsing: "adverb", meaning: "also" },
    "egestas": { lemma: "egestas, -atis (f.)", parsing: "nom. sing.", meaning: "want, shortage, poverty" },
    "et": { lemma: "et", parsing: "conjunction", meaning: "and" },
    "orta": { lemma: "orior, oriri, ortus sum", parsing: "nom. sing. fem. perf. part.", meaning: "having arisen" },
    "ex": { lemma: "ex / e", parsing: "preposition + abl.", meaning: "from, out of" },
    "fames": { lemma: "fames, -is (f.)", parsing: "nom. sing.", meaning: "famine, hunger" },
    "in": { lemma: "in", parsing: "preposition + acc.", meaning: "into, as" },
    "prodigium": { lemma: "prodigium, -i (n.)", parsing: "acc. sing.", meaning: "portent, omen" },
    "accipiebatur": { lemma: "accipio, -ere, accepi, acceptum", parsing: "3rd sing. imperf. pass. ind.", meaning: "was regarded, was received" },
    "nec": { lemma: "nec / neque", parsing: "conjunction", meaning: "and not, nor" },
    "occulti": { lemma: "occultus, -a, -um", parsing: "nom. pl. masc.", meaning: "hidden, secret" },
    "tantum": { lemma: "tantum", parsing: "adverb", meaning: "only" },
    "questus": { lemma: "questus, -us (m.)", parsing: "nom. pl.", meaning: "complaints" },
    "sed": { lemma: "sed", parsing: "conjunction", meaning: "but" },
    "iura": { lemma: "ius, iuris (n.)", parsing: "acc. pl.", meaning: "laws, justice, legal judgments" },
    "reddentem": { lemma: "reddo, -ere, reddidi, redditum", parsing: "acc. sing. masc. pres. act. part.", meaning: "giving back, dispensing" },
    "Claudium": { lemma: "Claudius, -i (m.)", parsing: "acc. sing.", meaning: "Claudius (the emperor)" },
    "circumvasere": { lemma: "circumvado, -ere", parsing: "3rd pl. perf. act. ind.", meaning: "surrounded" },
    "clamoribus": { lemma: "clamor, -oris (m.)", parsing: "abl. pl.", meaning: "with shouts" },
    "turbidis": { lemma: "turbidus, -a, -um", parsing: "abl. pl.", meaning: "turbulent, wild, disordered" },
    "pulsumque": { lemma: "pello, -ere, pepuli, pulsum", parsing: "acc. sing. masc. perf. pass. part. + -que", meaning: "and having been driven" },
    "extremam": { lemma: "extremus, -a, -um", parsing: "acc. sing. fem.", meaning: "furthest, outermost" },
    "fori": { lemma: "forum, -i (n.)", parsing: "gen. sing.", meaning: "of the forum" },
    "partem": { lemma: "pars, partis (f.)", parsing: "acc. sing.", meaning: "part" },
    "vi": { lemma: "vis, vis (f.)", parsing: "abl. sing.", meaning: "with force, with violence" },
    "urgebant": { lemma: "urgeo, -ere, ursi", parsing: "3rd pl. imperf. act. ind.", meaning: "they were pressing, urging" },
    "donec": { lemma: "donec", parsing: "conjunction", meaning: "until" },
    "militum": { lemma: "miles, militis (m.)", parsing: "gen. pl.", meaning: "of soldiers" },
    "globo": { lemma: "globus, -i (m.)", parsing: "abl. sing.", meaning: "with a band, with a group" },
    "infensos": { lemma: "infensus, -a, -um", parsing: "acc. pl. masc.", meaning: "hostile" },
    "perrupit": { lemma: "perrumpo, -ere, perrupi, perruptum", parsing: "3rd sing. perf. act. ind.", meaning: "broke through" },
    "quindecim": { lemma: "quindecim", parsing: "indeclinable numeral", meaning: "fifteen" },
    "dierum": { lemma: "dies, diei (m./f.)", parsing: "gen. pl.", meaning: "of days" },
    "alimenta": { lemma: "alimentum, -i (n.)", parsing: "nom./acc. pl.", meaning: "provisions, food supplies" },
    "urbi": { lemma: "urbs, urbis (f.)", parsing: "dat. sing.", meaning: "for the city" },
    "non": { lemma: "non", parsing: "adverb", meaning: "not" },
    "amplius": { lemma: "amplius", parsing: "comparative adverb", meaning: "more" },
    "superfuisse": { lemma: "supersum, -esse, -fui", parsing: "perf. act. inf.", meaning: "to have remained, to have been left over" },
    "constitit": { lemma: "consto, -are, constiti", parsing: "3rd sing. perf. act. ind.", meaning: "it was established, it was agreed" },
    "magnaque": { lemma: "magnus, -a, -um + -que", parsing: "abl. sing. fem. + and", meaning: "and by great" },
    "deum": { lemma: "deus, -i (m.)", parsing: "gen. pl.", meaning: "of the gods" },
    "benignitate": { lemma: "benignitas, -atis (f.)", parsing: "abl. sing.", meaning: "kindness, favour" },
    "modestia": { lemma: "modestia, -ae (f.)", parsing: "abl. sing.", meaning: "mildness, moderation" },
    "hiemis": { lemma: "hiems, hiemis (f.)", parsing: "gen. sing.", meaning: "of winter" },
    "rebus": { lemma: "res, rei (f.)", parsing: "dat./abl. pl.", meaning: "circumstances, situation" },
    "extremis": { lemma: "extremus, -a, -um", parsing: "dat./abl. pl.", meaning: "desperate, extreme" },
    "subventum": { lemma: "subvenio, -ire, subveni, subventum", parsing: "perf. pass. part. (impersonal)", meaning: "relief was brought, help came" },
    "at": { lemma: "at", parsing: "conjunction", meaning: "but" },
    "hercule": { lemma: "hercule / mehercule", parsing: "interjection", meaning: "by Hercules!" },
    "olim": { lemma: "olim", parsing: "adverb", meaning: "once, in the past" },
    "Italia": { lemma: "Italia, -ae (f.)", parsing: "nom. sing.", meaning: "Italy" },
    "legionibus": { lemma: "legio, -onis (f.)", parsing: "dat. pl.", meaning: "for the legions" },
    "longinquas": { lemma: "longinquus, -a, -um", parsing: "acc. pl. fem.", meaning: "distant, remote" },
    "provincias": { lemma: "provincia, -ae (f.)", parsing: "acc. pl.", meaning: "provinces" },
    "commeatus": { lemma: "commeatus, -us (m.)", parsing: "acc. pl.", meaning: "provisions, supplies" },
    "portabat": { lemma: "porto, -are, -avi, -atum", parsing: "3rd sing. imperf. act. ind.", meaning: "used to carry, used to transport" },
    "nunc": { lemma: "nunc", parsing: "adverb", meaning: "now" },
    "infecunditate": { lemma: "infecunditas, -atis (f.)", parsing: "abl. sing.", meaning: "infertility, barrenness" },
    "laboratur": { lemma: "laboro, -are, -avi, -atum", parsing: "3rd sing. pres. pass. ind.", meaning: "there is difficulty, it is struggled" },
    "Africam": { lemma: "Africa, -ae (f.)", parsing: "acc. sing.", meaning: "Africa" },
    "potius": { lemma: "potius", parsing: "adverb", meaning: "rather, instead" },
    "Aegyptum": { lemma: "Aegyptus, -i (f.)", parsing: "acc. sing.", meaning: "Egypt" },
    "exercemus": { lemma: "exerceo, -ere, exercui, exercitum", parsing: "1st pl. pres. act. ind.", meaning: "we cultivate, we work" },
    "navibusque": { lemma: "navis, -is (f.) + -que", parsing: "dat./abl. pl. + and", meaning: "and to ships" },
    "casibus": { lemma: "casus, -us (m.)", parsing: "dat./abl. pl.", meaning: "to chance, to accidents" },
    "vita": { lemma: "vita, -ae (f.)", parsing: "nom. sing.", meaning: "life" },
    "populi": { lemma: "populus, -i (m.)", parsing: "gen. sing.", meaning: "of the people" },
    "Romani": { lemma: "Romanus, -a, -um", parsing: "gen. sing. masc.", meaning: "Roman" },
    "permissa": { lemma: "permitto, -ere, permisi, permissum", parsing: "nom. sing. fem. perf. pass. part.", meaning: "entrusted, handed over" },
    "est": { lemma: "sum, esse, fui", parsing: "3rd sing. pres. act. ind.", meaning: "is" }
};

const latinSentences = [
    "multa eo anno prodigia evenere.",
    "insessum diris avibus Capitolium, crebris terrae motibus prorutae domus, ac dum latius metuitur, trepidatione vulgi invalidus quisque obtriti;",
    "frugum quoque egestas et orta ex eo fames in prodigium accipiebatur.",
    "nec occulti tantum questus, sed iura reddentem Claudium circumvasere clamoribus turbidis, pulsumque in extremam fori partem vi urgebant, donec militum globo infensos perrupit.",
    "quindecim dierum alimenta urbi, non amplius superfuisse constitit, magnaque deum benignitate et modestia hiemis rebus extremis subventum.",
    "at hercule olim Italia legionibus longinquas in provincias commeatus portabat, nec nunc infecunditate laboratur, sed Africam potius et Aegyptum exercemus, navibusque et casibus vita populi Romani permissa est."
];

const resources = {
    summary: `<h4>Summary</h4>
<p>Tacitus describes a year filled with terrifying portents in Rome. Birds of ill omen settled on the Capitol, frequent earthquakes destroyed houses, and in the widespread panic the weak were trampled by crowds. A grain shortage leading to famine was also interpreted as a supernatural warning.</p>
<p>The situation escalated beyond private complaints to open violence. While Claudius was dispensing justice publicly, an angry mob surrounded him with turbulent shouts, drove him to the edge of the forum, and physically threatened him. He had to be rescued by soldiers who forced their way through the hostile crowd.</p>
<p>It emerged that Rome had only fifteen days' worth of food remaining. The crisis was averted only by divine favour and a mild winter that allowed grain supplies to arrive. Tacitus concludes with a pointed reflection: in the past, Italy exported grain to feed armies abroad, but now Rome depends entirely on Africa and Egypt for its food supply, meaning the Roman people's survival rests on ships and chance.</p>`,
    context: `<h4>Historical Context</h4>
<p><strong>Prodigia and Roman Religion:</strong> Romans took portents extremely seriously. Unusual natural phenomena were interpreted as signs of divine displeasure requiring expiation. The Senate maintained official records of prodigies and would commission rituals to restore the pax deorum (peace with the gods). Birds on the Capitol were particularly significant since it was Jupiter's sacred precinct.</p>
<p><strong>The Grain Supply (Annona):</strong> By the mid-first century AD, Rome's population of roughly one million depended almost entirely on imported grain, primarily from Egypt and North Africa. The emperor was personally responsible for ensuring supply, and any shortage threatened both lives and political stability. Augustus had made Egypt imperial property partly to control this vital resource.</p>
<p><strong>Claudius and the Mob:</strong> This incident reveals the precarious nature of imperial authority. Despite absolute power in theory, an emperor could be physically threatened by a hungry mob. Claudius's rescue by soldiers highlights how military force underpinned imperial rule. The episode also shows how food shortage could rapidly become political crisis.</p>
<p><strong>Italy's Decline:</strong> Tacitus's concluding reflection touches on a common theme in Roman literature: the decline from a self-sufficient past to a dependent present. Italian agriculture had shifted from grain to more profitable crops (wine, olives), leaving Rome vulnerable to supply disruptions.</p>`,
    comprehension: `<h4>Comprehension Questions</h4>
<p><strong>Lines 1-2:</strong> What portents does Tacitus describe at the start of the chapter?</p>
<p><strong>Line 2:</strong> What happened to weak people during the panic? What Latin word describes the crowd's state?</p>
<p><strong>Line 3:</strong> How was the grain shortage interpreted? What does 'in prodigium accipiebatur' tell us about Roman attitudes?</p>
<p><strong>Lines 4:</strong> What was Claudius doing when the crowd attacked? What phrase describes the nature of the crowd's shouts?</p>
<p><strong>Line 4:</strong> Where was Claudius driven to? How did he escape?</p>
<p><strong>Line 5:</strong> How many days' worth of food remained? What two things saved the situation?</p>
<p><strong>Line 6:</strong> What contrast does Tacitus draw between past and present Italy?</p>
<p><strong>Line 6:</strong> What does 'navibusque et casibus vita populi Romani permissa est' suggest about Rome's vulnerability?</p>
<p><strong>Overall:</strong> What tone does Tacitus adopt in his final reflection? Is he simply reporting facts or making a moral point?</p>`
};

let currentPopup = null;
let sentenceModeActive = false;
let currentSentenceIndex = 0;
let pointerModeActive = false;

function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    const isDark = document.body.classList.contains('dark-mode');
    savePreference('darkMode', isDark);
    
    const btn = event.currentTarget;
    if (isDark) {
        btn.textContent = '‚òÄÔ∏è Light';
        btn.classList.add('active');
    } else {
        btn.textContent = 'üåô Dark';
        btn.classList.remove('active');
    }
}

function toggleFullScreen() {
    document.body.classList.toggle('full-screen');
    const btn = event.currentTarget;
    if (document.body.classList.contains('full-screen')) {
        btn.textContent = '‚õ∂ Exit Full Screen';
        btn.classList.add('active');
    } else {
        btn.textContent = '‚õ∂ Full Screen';
        btn.classList.remove('active');
    }
}

function toggleLineNumbers() {
    const latinText = document.getElementById('latinText');
    latinText.classList.toggle('show-lines');
    const showLines = latinText.classList.contains('show-lines');
    savePreference('lineNumbers', showLines);
    
    const btn = event.currentTarget;
    btn.classList.toggle('active');
}

function togglePointerMode() {
    pointerModeActive = !pointerModeActive;
    document.body.classList.toggle('pointer-mode');
    const btn = event.currentTarget;
    btn.classList.toggle('active');
    
    if (!pointerModeActive) {
        // Clear all pointed words when exiting pointer mode
        document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
    }
    
    // Hide vocab popup when entering pointer mode
    if (pointerModeActive) {
        hidePopup();
    }
}

function toggleSentenceMode() {
    const latinText = document.getElementById('latinText');
    const sentenceNav = document.getElementById('sentenceNav');
    const btn = event.currentTarget;
    
    sentenceModeActive = !sentenceModeActive;
    
    if (sentenceModeActive) {
        latinText.classList.add('sentence-mode');
        sentenceNav.classList.add('visible');
        btn.classList.add('active');
        btn.textContent = 'Full Text';
        currentSentenceIndex = 0;
        updateSentenceDisplay();
    } else {
        latinText.classList.remove('sentence-mode');
        sentenceNav.classList.remove('visible');
        btn.classList.remove('active');
        btn.textContent = 'Sentence Mode';
        // Remove current-sentence class from all
        document.querySelectorAll('.latin-text p').forEach(p => p.classList.remove('current-sentence'));
    }
}

function updateSentenceDisplay() {
    const paragraphs = document.querySelectorAll('.latin-text p');
    paragraphs.forEach((p, i) => {
        if (i === currentSentenceIndex) {
            p.classList.add('current-sentence');
        } else {
            p.classList.remove('current-sentence');
        }
    });
    document.getElementById('sentenceCounter').textContent = `${currentSentenceIndex + 1} / ${paragraphs.length}`;
    
    // Update button states
    const navButtons = document.querySelectorAll('.sentence-nav button');
    navButtons[0].disabled = currentSentenceIndex === 0;
    navButtons[1].disabled = currentSentenceIndex === paragraphs.length - 1;
}

function prevSentence() {
    if (currentSentenceIndex > 0) {
        currentSentenceIndex--;
        updateSentenceDisplay();
        hidePopup();
    }
}

function nextSentence() {
    const paragraphs = document.querySelectorAll('.latin-text p');
    if (currentSentenceIndex < paragraphs.length - 1) {
        currentSentenceIndex++;
        updateSentenceDisplay();
        hidePopup();
    }
}

function generateLatinHTML() {
    let html = '';
    latinSentences.forEach((sentence, index) => {
        // Split into tokens, keeping punctuation attached to words
        const tokens = sentence.match(/[a-zA-Z]+[.,;:]*|[.,;:]+/g);
        html += '<p style="margin-bottom: 1.5rem;">';
        html += `<span class="line-number">${index + 1}</span>`;
        html += '<span class="line-content">';
        tokens.forEach((token, i) => {
            // Separate word from trailing punctuation
            const match = token.match(/^([a-zA-Z]+)([.,;:]*)$/);
            if (match) {
                const word = match[1];
                const punct = match[2];
                const lookupWord = word.toLowerCase();
                html += `<span class="word" data-word="${lookupWord}">${word}</span>${punct}`;
                // Add space after unless it's the last token
                if (i < tokens.length - 1) html += ' ';
            } else {
                // Just punctuation
                html += token + ' ';
            }
        });
        html += '</span></p>';
    });
    return html;
}

function showVocabPopup(event, word) {
    const popup = document.getElementById('vocabPopup');
    const wordData = vocab[word.toLowerCase()];
    
    // Remove active class from all words
    document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active'));
    
    if (!wordData) {
        popup.classList.remove('visible');
        return;
    }
    
    // Add active class to clicked word
    event.target.classList.add('active');
    
    popup.innerHTML = `
        <h4>${word}</h4>
        <div class="parsing">${wordData.parsing}</div>
        <div class="meaning">${wordData.meaning}</div>
        <div class="principal-parts">${wordData.lemma}</div>
    `;
    
    // Position popup near the word
    const rect = event.target.getBoundingClientRect();
    const popupWidth = 300;
    const popupHeight = 150;
    
    let left = rect.left + (rect.width / 2) - (popupWidth / 2);
    let top = rect.bottom + 12;
    let arrowBottom = false;
    
    // Keep popup within viewport horizontally
    if (left < 10) left = 10;
    if (left + popupWidth > window.innerWidth - 10) {
        left = window.innerWidth - popupWidth - 10;
    }
    
    // If popup would go below viewport, show above word
    if (top + popupHeight > window.innerHeight) {
        top = rect.top - popupHeight - 12;
        arrowBottom = true;
    }
    
    // Calculate arrow position relative to popup
    const wordCenterX = rect.left + (rect.width / 2);
    const arrowLeft = Math.max(20, Math.min(popupWidth - 20, wordCenterX - left));
    
    popup.style.left = left + 'px';
    popup.style.top = top + 'px';
    popup.style.setProperty('--arrow-left', arrowLeft + 'px');
    popup.classList.toggle('arrow-bottom', arrowBottom);
    popup.classList.add('visible');
    
    currentPopup = popup;
}

function hidePopup() {
    const popup = document.getElementById('vocabPopup');
    popup.classList.remove('visible');
    document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active'));
}

function toggleTranslation() {
    const box = document.getElementById('translationBox');
    const btn = event.currentTarget;
    
    if (box.classList.contains('active')) {
        box.classList.remove('active');
        btn.textContent = 'Show Translation';
        btn.classList.remove('active');
    } else {
        box.classList.add('active');
        btn.textContent = 'Hide Translation';
        btn.classList.add('active');
    }
}

function showView(view) {
    // Update nav
    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
    event.currentTarget.classList.add('active');
    
    const textCard = document.getElementById('textCard');
    const resourceCard = document.getElementById('resourceCard');
    
    if (view === 'text') {
        textCard.style.display = 'block';
        resourceCard.style.display = 'none';
    } else {
        textCard.style.display = 'none';
        resourceCard.style.display = 'block';
        document.getElementById('resourceTitle').textContent = view.charAt(0).toUpperCase() + view.slice(1);
        document.getElementById('resourceContent').innerHTML = resources[view];
    }
}

// Initialise
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('latinText').innerHTML = generateLatinHTML();
    
    // Load saved preferences
    loadPreferences();
    
    // Add click handlers to words
    document.querySelectorAll('.word').forEach(word => {
        word.addEventListener('click', function(e) {
            e.stopPropagation();
            
            if (pointerModeActive) {
                // Toggle pointed class
                this.classList.toggle('pointed');
            } else {
                showVocabPopup(e, this.dataset.word);
            }
        });
    });
    
    // Hide popup when clicking elsewhere, clear pointer highlights on background click
    document.addEventListener('click', function(e) {
        if (!e.target.classList.contains('word')) {
            hidePopup();
            
            // If in pointer mode and clicking background (not buttons), clear all highlights
            if (pointerModeActive && !e.target.closest('.btn-group') && !e.target.closest('.sentence-nav')) {
                document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
            }
        }
    });
    
    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Escape to exit full screen
        if (e.key === 'Escape') {
            if (document.body.classList.contains('full-screen')) {
                document.body.classList.remove('full-screen');
                const btn = document.querySelector('.btn-group .btn:last-child');
                if (btn) {
                    btn.textContent = '‚õ∂ Full Screen';
                    btn.classList.remove('active');
                }
            }
            // Also exit pointer mode on escape
            if (pointerModeActive) {
                pointerModeActive = false;
                document.body.classList.remove('pointer-mode');
                document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
                document.querySelectorAll('.btn').forEach(btn => {
                    if (btn.textContent === 'Pointer Mode') btn.classList.remove('active');
                });
            }
        }
        
        // Arrow keys for sentence navigation
        if (sentenceModeActive) {
            if (e.key === 'ArrowLeft') {
                prevSentence();
            } else if (e.key === 'ArrowRight') {
                nextSentence();
            }
        }
    });
});

function loadPreferences() {
    // Dark mode
    if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
        setTimeout(() => {
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent.includes('Dark')) {
                    btn.textContent = '‚òÄÔ∏è Light';
                    btn.classList.add('active');
                }
            });
        }, 0);
    }
    
    // Line numbers
    if (localStorage.getItem('lineNumbers') === 'true') {
        document.getElementById('latinText').classList.add('show-lines');
        setTimeout(() => {
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent === 'Line Numbers') {
                    btn.classList.add('active');
                }
            });
        }, 0);
    }
}

function savePreference(key, value) {
    localStorage.setItem(key, value);
}
    </script>
</body>
</html>
