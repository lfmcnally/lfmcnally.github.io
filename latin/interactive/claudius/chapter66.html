<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classicalia - Tacitus Annals 12.66</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 240px;
            background: white;
            border-right: 1px solid #e5e7eb;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }
        .logo-section {
            padding: 1.5rem 1.25rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }
        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #0066ff 0%, #4d94ff 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.1rem;
        }
        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
        }
        .nav-section {
            padding: 1rem 0.5rem;
        }
        .nav-title {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #9ca3af;
            letter-spacing: 0.05em;
            padding: 0 0.75rem;
            margin-bottom: 0.5rem;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.625rem 0.75rem;
            margin: 0.125rem 0;
            border-radius: 8px;
            text-decoration: none;
            color: #4b5563;
            font-size: 0.9rem;
            transition: all 0.15s ease;
            cursor: pointer;
        }
        .nav-item:hover {
            background: #f3f4f6;
            color: #1f2937;
        }
        .nav-item.active {
            background: #eef2ff;
            color: #0066ff;
            font-weight: 500;
        }
        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }
        .main-content {
            margin-left: 240px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .top-bar {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0.875rem 2rem;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .content-wrapper {
            flex: 1;
            overflow-y: auto;
        }
        .content-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }
        .lesson-header {
            margin-bottom: 2rem;
        }
        .lesson-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        .lesson-meta {
            display: flex;
            gap: 1.5rem;
            font-size: 0.875rem;
            color: #6b7280;
        }
        .card {
            background: white;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }
        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
        }
        .card-body {
            padding: 2rem;
        }
        .latin-text {
            font-size: 1.5rem;
            line-height: 2.4;
            color: #1f2937;
        }
        .word {
            cursor: pointer;
            padding: 2px 4px;
            margin: 0 1px;
            border-radius: 4px;
            transition: all 0.15s ease;
            display: inline;
        }
        .word:hover {
            background: rgba(0, 102, 255, 0.15);
        }
        .word.active {
            background: rgba(0, 102, 255, 0.25);
        }

        /* Popup styles */
        .vocab-popup {
            position: fixed;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05);
            padding: 1rem 1.25rem;
            z-index: 1000;
            max-width: 350px;
            min-width: 250px;
            display: none;
            animation: popIn 0.2s ease;
        }
        .vocab-popup::before {
            content: '';
            position: absolute;
            top: -8px;
            left: var(--arrow-left, 50%);
            transform: translateX(-50%);
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid white;
        }
        .vocab-popup.arrow-bottom::before {
            top: auto;
            bottom: -8px;
            border-bottom: none;
            border-top: 8px solid white;
        }
        body.dark-mode .vocab-popup::before {
            border-bottom-color: #4f0c28;
        }
        body.dark-mode .vocab-popup.arrow-bottom::before {
            border-bottom-color: transparent;
            border-top-color: #4f0c28;
        }
        @keyframes popIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .vocab-popup.visible {
            display: block;
        }
        .vocab-popup h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #0066ff;
            margin-bottom: 0.5rem;
        }
        .vocab-popup .parsing {
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
            font-style: italic;
        }
        .vocab-popup .meaning {
            font-size: 0.95rem;
            color: #1f2937;
            line-height: 1.5;
        }
        .vocab-popup .principal-parts {
            font-size: 0.85rem;
            color: #4b5563;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid #e5e7eb;
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }
        .btn {
            padding: 0.625rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        .btn:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }
        .btn.active {
            background: #0066ff;
            color: white;
            border-color: #0066ff;
        }

        /* Dark mode styles */
        body.dark-mode {
            background: #2d0818;
        }
        body.dark-mode .sidebar {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .logo-icon {
            background: linear-gradient(135deg, #8b5a8a 0%, #a67aa6 100%);
        }
        body.dark-mode .logo-text {
            color: #c5d2f8;
        }
        body.dark-mode .nav-title {
            color: #9a8a9a;
        }
        body.dark-mode .nav-item {
            color: #b8a8b8;
        }
        body.dark-mode .nav-item:hover {
            background: #4f0c28;
            color: #c5d2f8;
        }
        body.dark-mode .nav-item.active {
            background: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .top-bar {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .card {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .card-header {
            border-color: #5a1a3a;
        }
        body.dark-mode .card-title {
            color: #c5d2f8;
        }
        body.dark-mode .lesson-title {
            color: #c5d2f8;
        }
        body.dark-mode .lesson-meta {
            color: #b8a8b8;
        }
        body.dark-mode .latin-text {
            color: #c5d2f8;
            text-shadow: 0 0 20px rgba(197, 210, 248, 0.15);
        }
        body.dark-mode .word:hover {
            background: rgba(232, 212, 168, 0.25);
        }
        body.dark-mode .word.active {
            background: rgba(232, 212, 168, 0.35);
        }
        body.dark-mode .btn {
            background: #4f0c28;
            border-color: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .btn:hover {
            background: #5a1a3a;
        }
        body.dark-mode .btn.active {
            background: #7a3a5a;
            border-color: #8a4a6a;
        }
        body.dark-mode .resource-card {
            background: #4f0c28;
            border-color: #5a1a3a;
        }
        body.dark-mode .resource-card h4 {
            color: #c5d2f8;
        }
        body.dark-mode .resource-card p {
            color: #b8c8e8;
        }
        body.dark-mode .vocab-popup {
            background: #4f0c28;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        body.dark-mode .vocab-popup h4 {
            color: #e8d4a8;
        }
        body.dark-mode .vocab-popup .parsing {
            color: #b8a8b8;
        }
        body.dark-mode .vocab-popup .meaning {
            color: #c5d2f8;
        }
        body.dark-mode .vocab-popup .principal-parts {
            color: #a8b8d8;
            border-color: #5a1a3a;
        }

        /* Sentence hover highlight */
        .latin-text p {
            padding: 0.5rem 0.75rem;
            margin: 0 -0.75rem 1.5rem -0.75rem;
            border-radius: 6px;
            transition: background 0.2s ease;
        }
        .latin-text p:hover {
            background: rgba(59, 130, 246, 0.08);
        }
        body.dark-mode .latin-text p:hover {
            background: rgba(197, 210, 248, 0.1);
        }

        /* Sentence-by-sentence mode */
        .latin-text.sentence-mode p {
            display: none;
        }
        .latin-text.sentence-mode p.current-sentence {
            display: block;
        }
        .latin-text.sentence-mode p:hover {
            background: transparent;
        }

        .sentence-nav {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }
        .sentence-nav.visible {
            display: flex;
        }
        body.dark-mode .sentence-nav {
            border-color: #5a1a3a;
        }
        .sentence-nav button {
            padding: 0.5rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        .sentence-nav button:hover:not(:disabled) {
            background: #f3f4f6;
        }
        .sentence-nav button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        body.dark-mode .sentence-nav button {
            background: #4f0c28;
            border-color: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .sentence-nav button:hover:not(:disabled) {
            background: #5a1a3a;
        }
        .sentence-counter {
            font-size: 0.875rem;
            color: #6b7280;
            min-width: 80px;
            text-align: center;
        }
        body.dark-mode .sentence-counter {
            color: #b8a8b8;
        }

        /* Full-screen mode */
        body.full-screen .sidebar {
            display: none;
        }
        body.full-screen .main-content {
            margin-left: 0;
        }
        body.full-screen .lesson-header {
            display: none;
        }
        body.full-screen .content-container {
            max-width: 100%;
            padding: 1rem 2rem;
        }
        body.full-screen .card {
            border: none;
            border-radius: 0;
            background: transparent;
        }
        body.full-screen .card-header {
            display: none;
        }
        body.full-screen .card-body {
            padding: 1rem 2rem;
        }
        body.full-screen .latin-text {
            font-size: 2rem;
            line-height: 2.6;
        }
        body.full-screen .btn-group {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            background: white;
            padding: 0.75rem;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 200;
        }
        body.full-screen.dark-mode .btn-group {
            background: #3a0a1f;
        }
        body.full-screen .resource-card {
            display: none !important;
        }
        body.full-screen .sentence-nav {
            border: none;
            padding-top: 0;
        }
        body.full-screen .top-bar {
            display: none;
        }

        /* Line numbers */
        .latin-text.show-lines p {
            display: flex;
            align-items: flex-start;
        }
        .line-number {
            display: none;
            min-width: 2.5rem;
            color: #9ca3af;
            font-size: 0.875rem;
            padding-top: 0.3rem;
            user-select: none;
        }
        .latin-text.show-lines .line-number {
            display: block;
        }
        body.dark-mode .line-number {
            color: #7a6a7a;
        }
        .line-content {
            flex: 1;
        }

        /* Pointer/highlight mode */
        .word.pointed {
            background: rgba(255, 200, 50, 0.5) !important;
            box-shadow: 0 0 12px rgba(255, 200, 50, 0.6);
            border-radius: 4px;
        }
        body.dark-mode .word.pointed {
            background: rgba(232, 212, 168, 0.5) !important;
            box-shadow: 0 0 15px rgba(232, 212, 168, 0.5);
        }

        /* Pointer mode indicator */
        body.pointer-mode .word {
            cursor: crosshair;
        }
        .mode-indicator {
            display: none;
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: #fef3c7;
            color: #92400e;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            z-index: 200;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        body.pointer-mode .mode-indicator {
            display: block;
        }
        body.dark-mode .mode-indicator {
            background: #4f0c28;
            color: #e8d4a8;
        }

        .resource-card {
            background: #f9fafb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px solid #e5e7eb;
            display: none;
        }
        .resource-card.active {
            display: block;
        }
        .resource-card h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.75rem;
        }
        .resource-card p {
            font-size: 0.95rem;
            line-height: 1.8;
            color: #374151;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
            }
            .latin-text {
                font-size: 1.25rem;
                line-height: 2.2;
            }
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="logo-section">
            <a href="../../../index.html" class="logo">
                <div class="logo-icon">C</div>
                <span class="logo-text">Classicalia</span>
            </a>
        </div>
        <nav class="nav-section">
            <div class="nav-title">Resources</div>
            <div class="nav-item active" onclick="showView('text')">
                <span class="nav-icon">üìñ</span>
                <span>Read</span>
            </div>
            <div class="nav-item" onclick="showView('summary')">
                <span class="nav-icon">üìã</span>
                <span>Summary</span>
            </div>
            <div class="nav-item" onclick="showView('context')">
                <span class="nav-icon">üèõÔ∏è</span>
                <span>Context</span>
            </div>
            <div class="nav-item" onclick="showView('comprehension')">
                <span class="nav-icon">‚ùì</span>
                <span>Comprehension</span>
            </div>
        </nav>
    </aside>

    <main class="main-content">
        <div class="top-bar"></div>
        <div class="content-wrapper">
            <div class="content-container">
                <header class="lesson-header">
                    <h1 class="lesson-title">Agrippina's Poison Plot</h1>
                    <div class="lesson-meta">
                        <span>üìï Tacitus Annals 12.66</span>
                        <span>‚è±Ô∏è 45 min</span>
                        <span>üìä A-Level</span>
                    </div>
                </header>

                <div class="card" id="textCard">
                    <div class="card-header">
                        <h3 class="card-title">Latin Text</h3>
                    </div>
                    <div class="card-body">
                        <div class="latin-text" id="latinText"></div>
                        <div class="btn-group">
                            <button class="btn" onclick="toggleTranslation()">Translation</button>
                            <button class="btn" onclick="toggleSentenceMode()">Sentence Mode</button>
                            <button class="btn" onclick="toggleLineNumbers()">Line Numbers</button>
                            <button class="btn" onclick="togglePointerMode()">Pointer Mode</button>
                            <button class="btn" onclick="toggleDarkMode()">üåô Dark</button>
                            <button class="btn" onclick="toggleFullScreen()">‚õ∂ Full Screen</button>
                        </div>
                        <div class="sentence-nav" id="sentenceNav">
                            <button onclick="prevSentence()">‚Üê Previous</button>
                            <span class="sentence-counter" id="sentenceCounter">1 / 6</span>
                            <button onclick="nextSentence()">Next ‚Üí</button>
                        </div>
                        <div class="resource-card" id="translationBox">
                            <h4>Translation</h4>
                            <p>Amid such a mass of cares he is seized by ill health, and to restore his strength by the mild climate and healthy waters he proceeded to Sinuessa. Then Agrippina, long since determined on the crime and eager for the opportunity now offered, and not lacking agents, deliberated about the type of poison, lest a sudden and rapid one would betray the deed; if she chose a slow and wasting one, lest Claudius, brought near to his end and having understood the treachery, might return to love for his son. Something refined was desirable, which would disturb his mind and delay death. An expert in such matters named Locusta was chosen, recently condemned for poisoning and long kept among the instruments of the reign. By this woman's skill a poison was prepared, whose agent from among the eunuchs was Halotus, accustomed to bring in the dishes and test them by tasting.</p>
                        </div>
                    </div>
                </div>

                <div class="card" id="resourceCard" style="display: none; margin-top: 1.5rem;">
                    <div class="card-header">
                        <h3 class="card-title" id="resourceTitle">Summary</h3>
                    </div>
                    <div class="card-body" id="resourceContent"></div>
                </div>
            </div>
        </div>
    </main>

    <div class="vocab-popup" id="vocabPopup"></div>
    <div class="mode-indicator">üìç Pointer Mode (click words to highlight, click again to remove)</div>

    <script>
const vocab = {
    "in": { lemma: "in", parsing: "preposition + abl.", meaning: "amid, in" },
    "tanta": { lemma: "tantus, -a, -um", parsing: "abl. sing. fem.", meaning: "so great" },
    "mole": { lemma: "moles, -is (f.)", parsing: "abl. sing.", meaning: "mass, burden" },
    "curarum": { lemma: "cura, -ae (f.)", parsing: "gen. pl.", meaning: "of cares, of worries" },
    "valetudine": { lemma: "valetudo, -inis (f.)", parsing: "abl. sing.", meaning: "by ill health" },
    "adversa": { lemma: "adversus, -a, -um", parsing: "abl. sing. fem.", meaning: "adverse, unfavourable" },
    "corripitur": { lemma: "corripio, -ere, corripui, correptum", parsing: "3rd sing. pres. pass. ind.", meaning: "he is seized" },
    "refovendisque": { lemma: "refoveo, -ere, refovi, refotum", parsing: "gerundive dat. pl. + -que", meaning: "and to be restored" },
    "viribus": { lemma: "vires, virium (f. pl.)", parsing: "dat. pl.", meaning: "his strength" },
    "mollitia": { lemma: "mollitia, -ae (f.)", parsing: "abl. sing.", meaning: "by the mildness" },
    "caeli": { lemma: "caelum, -i (n.)", parsing: "gen. sing.", meaning: "of the climate, of the sky" },
    "et": { lemma: "et", parsing: "conjunction", meaning: "and" },
    "salubritate": { lemma: "salubritas, -atis (f.)", parsing: "abl. sing.", meaning: "by the healthiness" },
    "aquarum": { lemma: "aqua, -ae (f.)", parsing: "gen. pl.", meaning: "of the waters" },
    "sinuessam": { lemma: "Sinuessa, -ae (f.)", parsing: "acc. sing.", meaning: "to Sinuessa (a coastal town)" },
    "pergit": { lemma: "pergo, -ere, perrexi, perrectum", parsing: "3rd sing. pres. act. ind.", meaning: "he proceeds" },
    "tum": { lemma: "tum", parsing: "adverb", meaning: "then, at that time" },
    "agrippina": { lemma: "Agrippina, -ae (f.)", parsing: "nom. sing.", meaning: "Agrippina" },
    "sceleris": { lemma: "scelus, sceleris (n.)", parsing: "gen. sing.", meaning: "of the crime" },
    "olim": { lemma: "olim", parsing: "adverb", meaning: "long since, long ago" },
    "certa": { lemma: "certus, -a, -um", parsing: "nom. sing. fem.", meaning: "certain, determined" },
    "oblatae": { lemma: "offero, offerre, obtuli, oblatum", parsing: "gen. sing. fem. perf. pass. part.", meaning: "offered, presented" },
    "occasionis": { lemma: "occasio, -onis (f.)", parsing: "gen. sing.", meaning: "of the opportunity" },
    "propera": { lemma: "properus, -a, -um", parsing: "nom. sing. fem.", meaning: "eager, hasty" },
    "nec": { lemma: "nec / neque", parsing: "conjunction", meaning: "and not, nor" },
    "ministrorum": { lemma: "minister, -tri (m.)", parsing: "gen. pl.", meaning: "of agents, of servants" },
    "egens": { lemma: "egeo, -ere, egui (+ gen.)", parsing: "nom. sing. pres. act. part.", meaning: "lacking" },
    "de": { lemma: "de", parsing: "preposition + abl.", meaning: "about, concerning" },
    "genere": { lemma: "genus, generis (n.)", parsing: "abl. sing.", meaning: "the type, the kind" },
    "veneni": { lemma: "venenum, -i (n.)", parsing: "gen. sing.", meaning: "of poison" },
    "consultavit": { lemma: "consulto, -are, -avi, -atum", parsing: "3rd sing. perf. act. ind.", meaning: "she deliberated" },
    "ne": { lemma: "ne", parsing: "conjunction", meaning: "lest, so that... not" },
    "repentino": { lemma: "repentinus, -a, -um", parsing: "abl. sing. neut.", meaning: "by a sudden one" },
    "praecipiti": { lemma: "praeceps, praecipitis", parsing: "abl. sing. neut.", meaning: "by a rapid, hasty one" },
    "facinus": { lemma: "facinus, -oris (n.)", parsing: "nom. sing.", meaning: "the deed, the crime" },
    "proderetur": { lemma: "prodo, -ere, prodidi, proditum", parsing: "3rd sing. imperf. pass. subj.", meaning: "would be betrayed" },
    "si": { lemma: "si", parsing: "conjunction", meaning: "if" },
    "lentum": { lemma: "lentus, -a, -um", parsing: "acc. sing. neut.", meaning: "slow" },
    "tabidum": { lemma: "tabidus, -a, -um", parsing: "acc. sing. neut.", meaning: "wasting, consuming" },
    "delegisset": { lemma: "deligo, -ere, delegi, delectum", parsing: "3rd sing. pluperf. act. subj.", meaning: "she had chosen" },
    "admotus": { lemma: "admoveo, -ere, admovi, admotum", parsing: "nom. sing. masc. perf. pass. part.", meaning: "brought near" },
    "supremis": { lemma: "supremus, -a, -um", parsing: "dat. pl. neut.", meaning: "to his end, to death" },
    "claudius": { lemma: "Claudius, -i (m.)", parsing: "nom. sing.", meaning: "Claudius (the emperor)" },
    "dolo": { lemma: "dolus, -i (m.)", parsing: "abl. sing.", meaning: "the treachery" },
    "intellecto": { lemma: "intellego, -ere, intellexi, intellectum", parsing: "abl. sing. neut. perf. pass. part.", meaning: "having been understood" },
    "ad": { lemma: "ad", parsing: "preposition + acc.", meaning: "to" },
    "amorem": { lemma: "amor, -oris (m.)", parsing: "acc. sing.", meaning: "love" },
    "filii": { lemma: "filius, -i (m.)", parsing: "gen. sing.", meaning: "for his son" },
    "rediret": { lemma: "redeo, -ire, redii, reditum", parsing: "3rd sing. imperf. act. subj.", meaning: "might return" },
    "exquisitum": { lemma: "exquiro, -ere, exquisivi, exquisitum", parsing: "nom./acc. sing. neut. perf. pass. part.", meaning: "something refined, something unusual" },
    "aliquid": { lemma: "aliquis, aliquid", parsing: "nom./acc. sing. neut.", meaning: "something" },
    "placebat": { lemma: "placeo, -ere, placui, placitum", parsing: "3rd sing. imperf. act. ind.", meaning: "was pleasing, was desirable" },
    "quod": { lemma: "qui, quae, quod", parsing: "nom. sing. neut. rel. pron.", meaning: "which" },
    "turbaret": { lemma: "turbo, -are, -avi, -atum", parsing: "3rd sing. imperf. act. subj.", meaning: "would disturb" },
    "mentem": { lemma: "mens, mentis (f.)", parsing: "acc. sing.", meaning: "the mind" },
    "mortem": { lemma: "mors, mortis (f.)", parsing: "acc. sing.", meaning: "death" },
    "differret": { lemma: "differo, differre, distuli, dilatum", parsing: "3rd sing. imperf. act. subj.", meaning: "would delay" },
    "deligitur": { lemma: "deligo, -ere, delegi, delectum", parsing: "3rd sing. pres. pass. ind.", meaning: "is chosen" },
    "artifex": { lemma: "artifex, -icis (m./f.)", parsing: "nom. sing.", meaning: "expert, craftsman" },
    "talium": { lemma: "talis, -e", parsing: "gen. pl. neut.", meaning: "in such matters" },
    "vocabulo": { lemma: "vocabulum, -i (n.)", parsing: "abl. sing.", meaning: "by the name of" },
    "locusta": { lemma: "Locusta, -ae (f.)", parsing: "nom./abl. sing.", meaning: "Locusta (the poisoner)" },
    "nuper": { lemma: "nuper", parsing: "adverb", meaning: "recently" },
    "veneficii": { lemma: "veneficium, -i (n.)", parsing: "gen. sing.", meaning: "of poisoning" },
    "damnata": { lemma: "damno, -are, -avi, -atum", parsing: "nom. sing. fem. perf. pass. part.", meaning: "condemned" },
    "diu": { lemma: "diu", parsing: "adverb", meaning: "for a long time" },
    "inter": { lemma: "inter", parsing: "preposition + acc.", meaning: "among" },
    "instrumenta": { lemma: "instrumentum, -i (n.)", parsing: "acc. pl.", meaning: "tools, instruments" },
    "regni": { lemma: "regnum, -i (n.)", parsing: "gen. sing.", meaning: "of the reign" },
    "habita": { lemma: "habeo, -ere, habui, habitum", parsing: "nom. sing. fem. perf. pass. part.", meaning: "kept, held" },
    "eius": { lemma: "is, ea, id", parsing: "gen. sing. fem.", meaning: "of this" },
    "mulieris": { lemma: "mulier, -eris (f.)", parsing: "gen. sing.", meaning: "woman's" },
    "ingenio": { lemma: "ingenium, -i (n.)", parsing: "abl. sing.", meaning: "by the skill, by the talent" },
    "paratum": { lemma: "paro, -are, -avi, -atum", parsing: "nom. sing. neut. perf. pass. part.", meaning: "prepared" },
    "virus": { lemma: "virus, -i (n.)", parsing: "nom. sing.", meaning: "poison" },
    "cuius": { lemma: "qui, quae, quod", parsing: "gen. sing. neut.", meaning: "whose, of which" },
    "minister": { lemma: "minister, -tri (m.)", parsing: "nom. sing.", meaning: "agent, servant" },
    "e": { lemma: "e / ex", parsing: "preposition + abl.", meaning: "from among" },
    "spadonibus": { lemma: "spado, -onis (m.)", parsing: "abl. pl.", meaning: "the eunuchs" },
    "fuit": { lemma: "sum, esse, fui", parsing: "3rd sing. perf. act. ind.", meaning: "was" },
    "halotus": { lemma: "Halotus, -i (m.)", parsing: "nom. sing.", meaning: "Halotus (a eunuch)" },
    "inferre": { lemma: "infero, inferre, intuli, illatum", parsing: "pres. act. inf.", meaning: "to bring in" },
    "epulas": { lemma: "epulae, -arum (f. pl.)", parsing: "acc. pl.", meaning: "the dishes, the food" },
    "explorare": { lemma: "exploro, -are, -avi, -atum", parsing: "pres. act. inf.", meaning: "to test, to examine" },
    "gustu": { lemma: "gustus, -us (m.)", parsing: "abl. sing.", meaning: "by tasting" },
    "solitus": { lemma: "soleo, -ere, solitus sum", parsing: "nom. sing. masc. perf. part.", meaning: "accustomed" }
};

const latinSentences = [
    "in tanta mole curarum valetudine adversa corripitur, refovendisque viribus mollitia caeli et salubritate aquarum Sinuessam pergit.",
    "tum Agrippina, sceleris olim certa et oblatae occasionis propera nec ministrorum egens, de genere veneni consultavit, ne repentino et praecipiti facinus proderetur;",
    "si lentum et tabidum delegisset, ne admotus supremis Claudius et dolo intellecto ad amorem filii rediret.",
    "exquisitum aliquid placebat, quod turbaret mentem et mortem differret.",
    "deligitur artifex talium vocabulo Locusta, nuper veneficii damnata et diu inter instrumenta regni habita.",
    "eius mulieris ingenio paratum virus, cuius minister e spadonibus fuit Halotus, inferre epulas et explorare gustu solitus."
];

const resources = {
    summary: `<h4>Summary</h4>
<p>Claudius falls ill amid his many concerns and travels to Sinuessa to recover. Agrippina, who has long planned to murder him, sees her opportunity. She deliberates carefully about what poison to use.</p>
<p>A sudden poison might expose the crime; a slow one might give Claudius time to realise the treachery and reconcile with his son Britannicus. She needs something that will confuse his mind while delaying death.</p>
<p>Locusta, a convicted poisoner kept as a state asset, is chosen. She prepares the poison, which will be administered by the eunuch Halotus - ironically, the very man whose job is to taste Claudius' food for poison.</p>`,
    context: `<h4>Historical Context</h4>
<p><strong>Sinuessa:</strong> A coastal town in Campania (modern Mondragone) famous for its hot springs and mild climate. Roman aristocrats often sought health cures at such resorts.</p>
<p><strong>Agrippina the Younger:</strong> Claudius' fourth wife and mother of Nero. A great-granddaughter of Augustus, she was ambitious for her son and ruthless in pursuing power.</p>
<p><strong>Britannicus:</strong> Claudius' natural son by Messalina, and the legitimate heir. His existence threatened Nero's succession, making him Agrippina's obstacle.</p>
<p><strong>Locusta:</strong> A historical figure, a professional poisoner from Gaul. She was later used by Nero to murder Britannicus and was eventually executed under Galba.</p>
<p><strong>Halotus:</strong> A eunuch who served as Claudius' food-taster (<em>praegustator</em>). Eunuchs were trusted in such roles because they could not found rival dynasties.</p>`,
    comprehension: `<h4>Comprehension Questions</h4>
<p><strong>Line 1:</strong> Why did Claudius travel to Sinuessa?</p>
<p><strong>Line 2:</strong> What does 'sceleris olim certa' reveal about Agrippina's intentions?</p>
<p><strong>Lines 2-3:</strong> Why did Agrippina reject a sudden, rapid poison?</p>
<p><strong>Line 3:</strong> Why did she also reject a slow, wasting poison?</p>
<p><strong>Line 4:</strong> What kind of poison did Agrippina want?</p>
<p><strong>Line 5:</strong> Who was Locusta and why was she chosen?</p>
<p><strong>Line 6:</strong> What was Halotus' role in Claudius' household?</p>
<p><strong>Line 6:</strong> What is ironic about Halotus being chosen as the agent?</p>`
};

let currentPopup = null;
let sentenceModeActive = false;
let currentSentenceIndex = 0;
let pointerModeActive = false;

function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    const isDark = document.body.classList.contains('dark-mode');
    savePreference('darkMode', isDark);

    const btn = event.currentTarget;
    if (isDark) {
        btn.textContent = '‚òÄÔ∏è Light';
        btn.classList.add('active');
    } else {
        btn.textContent = 'üåô Dark';
        btn.classList.remove('active');
    }
}

function toggleFullScreen() {
    document.body.classList.toggle('full-screen');
    const btn = event.currentTarget;
    if (document.body.classList.contains('full-screen')) {
        btn.textContent = '‚õ∂ Exit Full Screen';
        btn.classList.add('active');
    } else {
        btn.textContent = '‚õ∂ Full Screen';
        btn.classList.remove('active');
    }
}

function toggleLineNumbers() {
    const latinText = document.getElementById('latinText');
    latinText.classList.toggle('show-lines');
    const showLines = latinText.classList.contains('show-lines');
    savePreference('lineNumbers', showLines);

    const btn = event.currentTarget;
    btn.classList.toggle('active');
}

function togglePointerMode() {
    pointerModeActive = !pointerModeActive;
    document.body.classList.toggle('pointer-mode');
    const btn = event.currentTarget;
    btn.classList.toggle('active');

    if (!pointerModeActive) {
        // Clear all pointed words when exiting pointer mode
        document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
    }

    // Hide vocab popup when entering pointer mode
    if (pointerModeActive) {
        hidePopup();
    }
}

function toggleSentenceMode() {
    const latinText = document.getElementById('latinText');
    const sentenceNav = document.getElementById('sentenceNav');
    const btn = event.currentTarget;

    sentenceModeActive = !sentenceModeActive;

    if (sentenceModeActive) {
        latinText.classList.add('sentence-mode');
        sentenceNav.classList.add('visible');
        btn.classList.add('active');
        btn.textContent = 'Full Text';
        currentSentenceIndex = 0;
        updateSentenceDisplay();
    } else {
        latinText.classList.remove('sentence-mode');
        sentenceNav.classList.remove('visible');
        btn.classList.remove('active');
        btn.textContent = 'Sentence Mode';
        // Remove current-sentence class from all
        document.querySelectorAll('.latin-text p').forEach(p => p.classList.remove('current-sentence'));
    }
}

function updateSentenceDisplay() {
    const paragraphs = document.querySelectorAll('.latin-text p');
    paragraphs.forEach((p, i) => {
        if (i === currentSentenceIndex) {
            p.classList.add('current-sentence');
        } else {
            p.classList.remove('current-sentence');
        }
    });
    document.getElementById('sentenceCounter').textContent = `${currentSentenceIndex + 1} / ${paragraphs.length}`;

    // Update button states
    const navButtons = document.querySelectorAll('.sentence-nav button');
    navButtons[0].disabled = currentSentenceIndex === 0;
    navButtons[1].disabled = currentSentenceIndex === paragraphs.length - 1;
}

function prevSentence() {
    if (currentSentenceIndex > 0) {
        currentSentenceIndex--;
        updateSentenceDisplay();
        hidePopup();
    }
}

function nextSentence() {
    const paragraphs = document.querySelectorAll('.latin-text p');
    if (currentSentenceIndex < paragraphs.length - 1) {
        currentSentenceIndex++;
        updateSentenceDisplay();
        hidePopup();
    }
}

function generateLatinHTML() {
    let html = '';
    latinSentences.forEach((sentence, index) => {
        // Split into tokens, keeping punctuation attached to words
        const tokens = sentence.match(/[a-zA-Z]+[.,;:]*|[.,;:]+/g);
        html += '<p style="margin-bottom: 1.5rem;">';
        html += `<span class="line-number">${index + 1}</span>`;
        html += '<span class="line-content">';
        tokens.forEach((token, i) => {
            // Separate word from trailing punctuation
            const match = token.match(/^([a-zA-Z]+)([.,;:]*)$/);
            if (match) {
                const word = match[1];
                const punct = match[2];
                const lookupWord = word.toLowerCase();
                html += `<span class="word" data-word="${lookupWord}">${word}</span>${punct}`;
                // Add space after unless it's the last token
                if (i < tokens.length - 1) html += ' ';
            } else {
                // Just punctuation
                html += token + ' ';
            }
        });
        html += '</span></p>';
    });
    return html;
}

function showVocabPopup(event, word) {
    const popup = document.getElementById('vocabPopup');
    const wordData = vocab[word.toLowerCase()];

    // Remove active class from all words
    document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active'));

    if (!wordData) {
        popup.classList.remove('visible');
        return;
    }

    // Add active class to clicked word
    event.target.classList.add('active');

    popup.innerHTML = `
        <h4>${word}</h4>
        <div class="parsing">${wordData.parsing}</div>
        <div class="meaning">${wordData.meaning}</div>
        <div class="principal-parts">${wordData.lemma}</div>
    `;

    // Position popup near the word
    const rect = event.target.getBoundingClientRect();
    const popupWidth = 300;
    const popupHeight = 150;

    let left = rect.left + (rect.width / 2) - (popupWidth / 2);
    let top = rect.bottom + 12;
    let arrowBottom = false;

    // Keep popup within viewport horizontally
    if (left < 10) left = 10;
    if (left + popupWidth > window.innerWidth - 10) {
        left = window.innerWidth - popupWidth - 10;
    }

    // If popup would go below viewport, show above word
    if (top + popupHeight > window.innerHeight) {
        top = rect.top - popupHeight - 12;
        arrowBottom = true;
    }

    // Calculate arrow position relative to popup
    const wordCenterX = rect.left + (rect.width / 2);
    const arrowLeft = Math.max(20, Math.min(popupWidth - 20, wordCenterX - left));

    popup.style.left = left + 'px';
    popup.style.top = top + 'px';
    popup.style.setProperty('--arrow-left', arrowLeft + 'px');
    popup.classList.toggle('arrow-bottom', arrowBottom);
    popup.classList.add('visible');

    currentPopup = popup;
}

function hidePopup() {
    const popup = document.getElementById('vocabPopup');
    popup.classList.remove('visible');
    document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active'));
}

function toggleTranslation() {
    const box = document.getElementById('translationBox');
    const btn = event.currentTarget;

    if (box.classList.contains('active')) {
        box.classList.remove('active');
        btn.textContent = 'Translation';
        btn.classList.remove('active');
    } else {
        box.classList.add('active');
        btn.textContent = 'Hide Translation';
        btn.classList.add('active');
    }
}

function showView(view) {
    // Update nav
    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
    event.currentTarget.classList.add('active');

    const textCard = document.getElementById('textCard');
    const resourceCard = document.getElementById('resourceCard');

    if (view === 'text') {
        textCard.style.display = 'block';
        resourceCard.style.display = 'none';
    } else {
        textCard.style.display = 'none';
        resourceCard.style.display = 'block';
        document.getElementById('resourceTitle').textContent = view.charAt(0).toUpperCase() + view.slice(1);
        document.getElementById('resourceContent').innerHTML = resources[view];
    }
}

// Initialise
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('latinText').innerHTML = generateLatinHTML();

    // Load saved preferences
    loadPreferences();

    // Add click handlers to words
    document.querySelectorAll('.word').forEach(word => {
        word.addEventListener('click', function(e) {
            e.stopPropagation();

            if (pointerModeActive) {
                // Toggle pointed class
                this.classList.toggle('pointed');
            } else {
                showVocabPopup(e, this.dataset.word);
            }
        });
    });

    // Hide popup when clicking elsewhere, clear pointer highlights on background click
    document.addEventListener('click', function(e) {
        if (!e.target.classList.contains('word')) {
            hidePopup();

            // If in pointer mode and clicking background (not buttons), clear all highlights
            if (pointerModeActive && !e.target.closest('.btn-group') && !e.target.closest('.sentence-nav')) {
                document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
            }
        }
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Escape to exit full screen
        if (e.key === 'Escape') {
            if (document.body.classList.contains('full-screen')) {
                document.body.classList.remove('full-screen');
                const btn = document.querySelector('.btn-group .btn:last-child');
                if (btn) {
                    btn.textContent = '‚õ∂ Full Screen';
                    btn.classList.remove('active');
                }
            }
            // Also exit pointer mode on escape
            if (pointerModeActive) {
                pointerModeActive = false;
                document.body.classList.remove('pointer-mode');
                document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
                document.querySelectorAll('.btn').forEach(btn => {
                    if (btn.textContent === 'Pointer Mode') btn.classList.remove('active');
                });
            }
        }

        // Arrow keys for sentence navigation
        if (sentenceModeActive) {
            if (e.key === 'ArrowLeft') {
                prevSentence();
            } else if (e.key === 'ArrowRight') {
                nextSentence();
            }
        }
    });
});

function loadPreferences() {
    // Dark mode
    if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
        setTimeout(() => {
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent.includes('Dark')) {
                    btn.textContent = '‚òÄÔ∏è Light';
                    btn.classList.add('active');
                }
            });
        }, 0);
    }

    // Line numbers
    if (localStorage.getItem('lineNumbers') === 'true') {
        document.getElementById('latinText').classList.add('show-lines');
        setTimeout(() => {
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent === 'Line Numbers') {
                    btn.classList.add('active');
                }
            });
        }, 0);
    }
}

function savePreference(key, value) {
    localStorage.setItem(key, value);
}
    </script>
</body>
</html>
