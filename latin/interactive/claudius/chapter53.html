<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classicalia - Tacitus Annals 12.53</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 240px;
            background: white;
            border-right: 1px solid #e5e7eb;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }
        .logo-section {
            padding: 1.5rem 1.25rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }
        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #0066ff 0%, #4d94ff 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.1rem;
        }
        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
        }
        .nav-section {
            padding: 1rem 0.5rem;
        }
        .nav-title {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #9ca3af;
            letter-spacing: 0.05em;
            padding: 0 0.75rem;
            margin-bottom: 0.5rem;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.625rem 0.75rem;
            margin: 0.125rem 0;
            border-radius: 8px;
            text-decoration: none;
            color: #4b5563;
            font-size: 0.9rem;
            transition: all 0.15s ease;
            cursor: pointer;
        }
        .nav-item:hover {
            background: #f3f4f6;
            color: #1f2937;
        }
        .nav-item.active {
            background: #eef2ff;
            color: #0066ff;
            font-weight: 500;
        }
        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }
        .main-content {
            margin-left: 240px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .top-bar {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0.875rem 2rem;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .content-wrapper {
            flex: 1;
            overflow-y: auto;
        }
        .content-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }
        .lesson-header {
            margin-bottom: 2rem;
        }
        .lesson-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        .lesson-meta {
            display: flex;
            gap: 1.5rem;
            font-size: 0.875rem;
            color: #6b7280;
        }
        .card {
            background: white;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }
        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
        }
        .card-body {
            padding: 2rem;
        }
        .latin-text {
            font-size: 1.5rem;
            line-height: 2.4;
            color: #1f2937;
        }
        .word {
            cursor: pointer;
            padding: 2px 4px;
            margin: 0 1px;
            border-radius: 4px;
            transition: all 0.15s ease;
            display: inline;
        }
        .word:hover {
            background: rgba(0, 102, 255, 0.15);
        }
        .word.active {
            background: rgba(0, 102, 255, 0.25);
        }

        /* Popup styles */
        .vocab-popup {
            position: fixed;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05);
            padding: 1rem 1.25rem;
            z-index: 1000;
            max-width: 350px;
            min-width: 250px;
            display: none;
            animation: popIn 0.2s ease;
        }
        .vocab-popup::before {
            content: '';
            position: absolute;
            top: -8px;
            left: var(--arrow-left, 50%);
            transform: translateX(-50%);
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid white;
        }
        .vocab-popup.arrow-bottom::before {
            top: auto;
            bottom: -8px;
            border-bottom: none;
            border-top: 8px solid white;
        }
        body.dark-mode .vocab-popup::before {
            border-bottom-color: #4f0c28;
        }
        body.dark-mode .vocab-popup.arrow-bottom::before {
            border-bottom-color: transparent;
            border-top-color: #4f0c28;
        }
        @keyframes popIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .vocab-popup.visible {
            display: block;
        }
        .vocab-popup h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #0066ff;
            margin-bottom: 0.5rem;
        }
        .vocab-popup .parsing {
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
            font-style: italic;
        }
        .vocab-popup .meaning {
            font-size: 0.95rem;
            color: #1f2937;
            line-height: 1.5;
        }
        .vocab-popup .principal-parts {
            font-size: 0.85rem;
            color: #4b5563;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid #e5e7eb;
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }
        .btn {
            padding: 0.625rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        .btn:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }
        .btn.active {
            background: #0066ff;
            color: white;
            border-color: #0066ff;
        }

        /* Dark mode styles */
        body.dark-mode {
            background: #2d0818;
        }
        body.dark-mode .sidebar {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .logo-icon {
            background: linear-gradient(135deg, #8b5a8a 0%, #a67aa6 100%);
        }
        body.dark-mode .logo-text {
            color: #c5d2f8;
        }
        body.dark-mode .nav-title {
            color: #9a8a9a;
        }
        body.dark-mode .nav-item {
            color: #b8a8b8;
        }
        body.dark-mode .nav-item:hover {
            background: #4f0c28;
            color: #c5d2f8;
        }
        body.dark-mode .nav-item.active {
            background: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .top-bar {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .card {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .card-header {
            border-color: #5a1a3a;
        }
        body.dark-mode .card-title {
            color: #c5d2f8;
        }
        body.dark-mode .lesson-title {
            color: #c5d2f8;
        }
        body.dark-mode .lesson-meta {
            color: #b8a8b8;
        }
        body.dark-mode .latin-text {
            color: #c5d2f8;
            text-shadow: 0 0 20px rgba(197, 210, 248, 0.15);
        }
        body.dark-mode .word:hover {
            background: rgba(232, 212, 168, 0.25);
        }
        body.dark-mode .word.active {
            background: rgba(232, 212, 168, 0.35);
        }
        body.dark-mode .btn {
            background: #4f0c28;
            border-color: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .btn:hover {
            background: #5a1a3a;
        }
        body.dark-mode .btn.active {
            background: #7a3a5a;
            border-color: #8a4a6a;
        }
        body.dark-mode .resource-card {
            background: #4f0c28;
            border-color: #5a1a3a;
        }
        body.dark-mode .resource-card h4 {
            color: #c5d2f8;
        }
        body.dark-mode .resource-card p {
            color: #b8c8e8;
        }
        body.dark-mode .vocab-popup {
            background: #4f0c28;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        body.dark-mode .vocab-popup h4 {
            color: #e8d4a8;
        }
        body.dark-mode .vocab-popup .parsing {
            color: #b8a8b8;
        }
        body.dark-mode .vocab-popup .meaning {
            color: #c5d2f8;
        }
        body.dark-mode .vocab-popup .principal-parts {
            color: #a8b8d8;
            border-color: #5a1a3a;
        }

        /* Sentence hover highlight */
        .latin-text p {
            padding: 0.5rem 0.75rem;
            margin: 0 -0.75rem 1.5rem -0.75rem;
            border-radius: 6px;
            transition: background 0.2s ease;
        }
        .latin-text p:hover {
            background: rgba(59, 130, 246, 0.08);
        }
        body.dark-mode .latin-text p:hover {
            background: rgba(197, 210, 248, 0.1);
        }

        /* Sentence-by-sentence mode */
        .latin-text.sentence-mode p {
            display: none;
        }
        .latin-text.sentence-mode p.current-sentence {
            display: block;
        }
        .latin-text.sentence-mode p:hover {
            background: transparent;
        }

        .sentence-nav {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }
        .sentence-nav.visible {
            display: flex;
        }
        body.dark-mode .sentence-nav {
            border-color: #5a1a3a;
        }
        .sentence-nav button {
            padding: 0.5rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        .sentence-nav button:hover:not(:disabled) {
            background: #f3f4f6;
        }
        .sentence-nav button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        body.dark-mode .sentence-nav button {
            background: #4f0c28;
            border-color: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .sentence-nav button:hover:not(:disabled) {
            background: #5a1a3a;
        }
        .sentence-counter {
            font-size: 0.875rem;
            color: #6b7280;
            min-width: 80px;
            text-align: center;
        }
        body.dark-mode .sentence-counter {
            color: #b8a8b8;
        }

        /* Full-screen mode */
        body.full-screen .sidebar {
            display: none;
        }
        body.full-screen .main-content {
            margin-left: 0;
        }
        body.full-screen .lesson-header {
            display: none;
        }
        body.full-screen .content-container {
            max-width: 100%;
            padding: 1rem 2rem;
        }
        body.full-screen .card {
            border: none;
            border-radius: 0;
            background: transparent;
        }
        body.full-screen .card-header {
            display: none;
        }
        body.full-screen .card-body {
            padding: 1rem 2rem;
        }
        body.full-screen .latin-text {
            font-size: 2rem;
            line-height: 2.6;
        }
        body.full-screen .btn-group {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            background: white;
            padding: 0.75rem;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 200;
        }
        body.full-screen.dark-mode .btn-group {
            background: #3a0a1f;
        }
        body.full-screen .resource-card {
            display: none !important;
        }
        body.full-screen .sentence-nav {
            border: none;
            padding-top: 0;
        }
        body.full-screen .top-bar {
            display: none;
        }

        /* Line numbers */
        .latin-text.show-lines p {
            display: flex;
            align-items: flex-start;
        }
        .line-number {
            display: none;
            min-width: 2.5rem;
            color: #9ca3af;
            font-size: 0.875rem;
            padding-top: 0.3rem;
            user-select: none;
        }
        .latin-text.show-lines .line-number {
            display: block;
        }
        body.dark-mode .line-number {
            color: #7a6a7a;
        }
        .line-content {
            flex: 1;
        }

        /* Pointer/highlight mode */
        .word.pointed {
            background: rgba(255, 200, 50, 0.5) !important;
            box-shadow: 0 0 12px rgba(255, 200, 50, 0.6);
            border-radius: 4px;
        }
        body.dark-mode .word.pointed {
            background: rgba(232, 212, 168, 0.5) !important;
            box-shadow: 0 0 15px rgba(232, 212, 168, 0.5);
        }

        /* Pointer mode indicator */
        body.pointer-mode .word {
            cursor: crosshair;
        }
        .mode-indicator {
            display: none;
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: #fef3c7;
            color: #92400e;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            z-index: 200;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        body.pointer-mode .mode-indicator {
            display: block;
        }
        body.dark-mode .mode-indicator {
            background: #4f0c28;
            color: #e8d4a8;
        }

        .resource-card {
            background: #f9fafb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px solid #e5e7eb;
            display: none;
        }
        .resource-card.active {
            display: block;
        }
        .resource-card h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.75rem;
        }
        .resource-card p {
            font-size: 0.95rem;
            line-height: 1.8;
            color: #374151;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
            }
            .latin-text {
                font-size: 1.25rem;
                line-height: 2.2;
            }
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="logo-section">
            <a href="../../../index.html" class="logo">
                <div class="logo-icon">C</div>
                <span class="logo-text">Classicalia</span>
            </a>
        </div>
        <nav class="nav-section">
            <div class="nav-title">Resources</div>
            <div class="nav-item active" onclick="showView('text')">
                <span class="nav-icon">üìñ</span>
                <span>Read</span>
            </div>
            <div class="nav-item" onclick="showView('summary')">
                <span class="nav-icon">üìã</span>
                <span>Summary</span>
            </div>
            <div class="nav-item" onclick="showView('context')">
                <span class="nav-icon">üèõÔ∏è</span>
                <span>Context</span>
            </div>
            <div class="nav-item" onclick="showView('comprehension')">
                <span class="nav-icon">‚ùì</span>
                <span>Comprehension</span>
            </div>
        </nav>
    </aside>

    <main class="main-content">
        <div class="top-bar"></div>
        <div class="content-wrapper">
            <div class="content-container">
                <header class="lesson-header">
                    <h1 class="lesson-title">Honours for Pallas</h1>
                    <div class="lesson-meta">
                        <span>üìï Tacitus Annals 12.53</span>
                        <span>‚è±Ô∏è 45 min</span>
                        <span>üìä A-Level</span>
                    </div>
                </header>

                <div class="card" id="textCard">
                    <div class="card-header">
                        <h3 class="card-title">Latin Text</h3>
                    </div>
                    <div class="card-body">
                        <div class="latin-text" id="latinText"></div>
                        <div class="btn-group">
                            <button class="btn" onclick="toggleTranslation()">Translation</button>
                            <button class="btn" onclick="toggleSentenceMode()">Sentence Mode</button>
                            <button class="btn" onclick="toggleLineNumbers()">Line Numbers</button>
                            <button class="btn" onclick="togglePointerMode()">Pointer Mode</button>
                            <button class="btn" onclick="toggleDarkMode()">üåô Dark</button>
                            <button class="btn" onclick="toggleFullScreen()">‚õ∂ Full Screen</button>
                        </div>
                        <div class="sentence-nav" id="sentenceNav">
                            <button onclick="prevSentence()">‚Üê Previous</button>
                            <span class="sentence-counter" id="sentenceCounter">1 / 6</span>
                            <button onclick="nextSentence()">Next ‚Üí</button>
                        </div>
                        <div class="resource-card" id="translationBox">
                            <h4>Translation</h4>
                            <p>Amid these events, he referred to the Senate a proposal concerning the punishment of women who formed unions with slaves; and it was decreed that those who had slipped into such relationships without the knowledge of the master should be held in slavery, but if he had consented, they should be regarded as freedwomen. To Pallas, whom the emperor had declared to be the author of this proposal, the consul-designate Barea Soranus proposed praetorian insignia and fifteen million sesterces. Scipio Cornelius added that public thanks should be given to him, because, though descended from the kings of Arcadia, he set aside his most ancient nobility for the public good and allowed himself to be counted among the emperor's servants. Claudius asserted that Pallas was content with the honour alone and would remain within his former poverty. And the Senate's decree, in which a freedman possessing three hundred million sesterces was heaped with praises for his old-fashioned thrift, was fixed up in public bronze.</p>
                        </div>
                    </div>
                </div>

                <div class="card" id="resourceCard" style="display: none; margin-top: 1.5rem;">
                    <div class="card-header">
                        <h3 class="card-title" id="resourceTitle">Summary</h3>
                    </div>
                    <div class="card-body" id="resourceContent"></div>
                </div>
            </div>
        </div>
    </main>

    <div class="vocab-popup" id="vocabPopup"></div>
    <div class="mode-indicator">üìç Pointer Mode (click words to highlight, click again to remove)</div>

    <script>
const vocab = {
    "inter": { lemma: "inter (prep. + acc.)", parsing: "preposition", meaning: "amid, among, during" },
    "quae": { lemma: "qui, quae, quod", parsing: "rel. pron., neut. acc. pl. / fem. nom. pl.", meaning: "which things, who" },
    "refert": { lemma: "refero, referre, rettuli, relatum", parsing: "3rd sing. pres. ind. act.", meaning: "he refers, he brings back" },
    "ad": { lemma: "ad (prep. + acc.)", parsing: "preposition", meaning: "to" },
    "patres": { lemma: "pater, patris (m.)", parsing: "acc. pl.", meaning: "the fathers, i.e. the senators" },
    "de": { lemma: "de (prep. + abl.)", parsing: "preposition", meaning: "concerning, about" },
    "poena": { lemma: "poena, -ae (f.)", parsing: "abl. sing.", meaning: "punishment, penalty" },
    "feminarum": { lemma: "femina, -ae (f.)", parsing: "gen. pl.", meaning: "of women" },
    "servis": { lemma: "servus, -i (m.)", parsing: "dat./abl. pl.", meaning: "with slaves" },
    "coniungerentur": { lemma: "coniungo, -ere, -iunxi, -iunctum", parsing: "3rd pl. impf. subj. pass.", meaning: "would form unions, would be joined" },
    "statuiturque": { lemma: "statuo, -ere, statui, statutum + -que", parsing: "3rd sing. pres. ind. pass. + and", meaning: "and it is decreed, and it is established" },
    "ut": { lemma: "ut", parsing: "conjunction", meaning: "that" },
    "ignaro": { lemma: "ignarus, -a, -um", parsing: "abl. masc. sing.", meaning: "ignorant, unaware" },
    "domino": { lemma: "dominus, -i (m.)", parsing: "abl. sing.", meaning: "master" },
    "id": { lemma: "is, ea, id", parsing: "acc. neut. sing.", meaning: "this, that" },
    "prolapsae": { lemma: "prolabor, prolabi, prolapsus sum", parsing: "perf. part. nom. fem. pl.", meaning: "having slipped, having fallen" },
    "in": { lemma: "in (prep.)", parsing: "preposition + abl./acc.", meaning: "in, into" },
    "servitute": { lemma: "servitus, -utis (f.)", parsing: "abl. sing.", meaning: "slavery, servitude" },
    "sin": { lemma: "sin", parsing: "conjunction", meaning: "but if, if however" },
    "consensisset": { lemma: "consentio, -ire, -sensi, -sensum", parsing: "3rd sing. plpf. subj. act.", meaning: "he had consented" },
    "pro": { lemma: "pro (prep. + abl.)", parsing: "preposition", meaning: "as, in place of, in return for" },
    "libertis": { lemma: "libertus, -i (m.)", parsing: "abl. pl.", meaning: "freedwomen/freedmen" },
    "haberentur": { lemma: "habeo, habere, habui, habitum", parsing: "3rd pl. impf. subj. pass.", meaning: "they should be regarded, they should be held" },
    "Pallanti": { lemma: "Pallas, Pallantis (m.)", parsing: "dat. sing.", meaning: "to/for Pallas" },
    "quem": { lemma: "qui, quae, quod", parsing: "rel. pron., masc. acc. sing.", meaning: "whom" },
    "repertorem": { lemma: "repertor, -oris (m.)", parsing: "acc. sing.", meaning: "inventor, discoverer, author" },
    "eius": { lemma: "is, ea, id", parsing: "gen. sing.", meaning: "of this, of that" },
    "relationis": { lemma: "relatio, -onis (f.)", parsing: "gen. sing.", meaning: "proposal, report" },
    "ediderat": { lemma: "edo, edere, edidi, editum", parsing: "3rd sing. plpf. ind. act.", meaning: "had declared, had published" },
    "Caesar": { lemma: "Caesar, -aris (m.)", parsing: "nom. sing.", meaning: "the emperor (Claudius)" },
    "praetoria": { lemma: "praetorius, -a, -um", parsing: "acc. neut. pl.", meaning: "praetorian, of a praetor" },
    "insignia": { lemma: "insigne, -is (n.)", parsing: "acc. pl.", meaning: "insignia, decorations, badges of office" },
    "et": { lemma: "et", parsing: "conjunction", meaning: "and" },
    "centies": { lemma: "centies", parsing: "numeral adverb", meaning: "a hundred times" },
    "quinquagies": { lemma: "quinquagies", parsing: "numeral adverb", meaning: "fifty times (centies quinquagies = 15 million)" },
    "sestertium": { lemma: "sestertius, -i (m.)", parsing: "gen. pl.", meaning: "of sesterces" },
    "censuit": { lemma: "censeo, censere, censui, censum", parsing: "3rd sing. pf. ind. act.", meaning: "proposed, voted" },
    "consul": { lemma: "consul, -ulis (m.)", parsing: "nom. sing.", meaning: "consul" },
    "designatus": { lemma: "designo, -are, -avi, -atum", parsing: "pf. part. nom. masc. sing.", meaning: "designated, appointed" },
    "Barea": { lemma: "Barea (proper name)", parsing: "nom. sing.", meaning: "Barea (part of Barea Soranus)" },
    "Soranus": { lemma: "Soranus (proper name)", parsing: "nom. sing.", meaning: "Soranus (part of Barea Soranus)" },
    "additum": { lemma: "addo, addere, addidi, additum", parsing: "pf. part. neut. nom. sing.", meaning: "it was added (impersonal)" },
    "a": { lemma: "a/ab (prep. + abl.)", parsing: "preposition", meaning: "by, from" },
    "Scipione": { lemma: "Scipio, -onis (m.)", parsing: "abl. sing.", meaning: "Scipio" },
    "Cornelio": { lemma: "Cornelius, -i (m.)", parsing: "abl. sing.", meaning: "Cornelius" },
    "grates": { lemma: "grates (archaic)", parsing: "acc. pl.", meaning: "thanks (archaic form of gratias)" },
    "publice": { lemma: "publice", parsing: "adverb", meaning: "publicly, in the name of the state" },
    "agendas": { lemma: "ago, agere, egi, actum", parsing: "gerundive, acc. fem. pl.", meaning: "to be given, to be rendered" },
    "quod": { lemma: "quod", parsing: "conjunction", meaning: "because, since" },
    "regibus": { lemma: "rex, regis (m.)", parsing: "abl. pl.", meaning: "from kings" },
    "Arcadiae": { lemma: "Arcadia, -ae (f.)", parsing: "gen. sing.", meaning: "of Arcadia (region in Greece)" },
    "ortus": { lemma: "orior, oriri, ortus sum", parsing: "pf. part. nom. masc. sing.", meaning: "having arisen, descended" },
    "veterrimam": { lemma: "vetus, veteris", parsing: "superl. adj., acc. fem. sing.", meaning: "most ancient, oldest" },
    "nobilitatem": { lemma: "nobilitas, -atis (f.)", parsing: "acc. sing.", meaning: "nobility, noble birth" },
    "usui": { lemma: "usus, -us (m.)", parsing: "dat. sing.", meaning: "to use, for the benefit" },
    "publico": { lemma: "publicus, -a, -um", parsing: "dat. masc./neut. sing.", meaning: "public" },
    "postponeret": { lemma: "postpono, -ere, -posui, -positum", parsing: "3rd sing. impf. subj. act.", meaning: "he set aside, he put after" },
    "seque": { lemma: "se + -que", parsing: "reflex. pron. acc. + and", meaning: "and himself" },
    "ministros": { lemma: "minister, -tri (m.)", parsing: "acc. pl.", meaning: "servants, attendants, ministers" },
    "principis": { lemma: "princeps, -ipis (m.)", parsing: "gen. sing.", meaning: "of the emperor, of the leading man" },
    "haberi": { lemma: "habeo, habere, habui, habitum", parsing: "pres. inf. pass.", meaning: "to be held, to be regarded" },
    "sineret": { lemma: "sino, sinere, sivi, situm", parsing: "3rd sing. impf. subj. act.", meaning: "he allowed" },
    "adseveravit": { lemma: "adsevero, -are, -avi, -atum", parsing: "3rd sing. pf. ind. act.", meaning: "he asserted, he declared solemnly" },
    "Claudius": { lemma: "Claudius, -i (m.)", parsing: "nom. sing.", meaning: "Claudius" },
    "contentum": { lemma: "contentus, -a, -um", parsing: "acc. masc. sing.", meaning: "content, satisfied (+ ablative)" },
    "honore": { lemma: "honor/honos, -oris (m.)", parsing: "abl. sing.", meaning: "with the honour" },
    "Pallantem": { lemma: "Pallas, Pallantis (m.)", parsing: "acc. sing.", meaning: "Pallas" },
    "intra": { lemma: "intra (prep. + acc.)", parsing: "preposition", meaning: "within, inside" },
    "priorem": { lemma: "prior, prius", parsing: "comp. adj., acc. fem. sing.", meaning: "former, previous" },
    "paupertatem": { lemma: "paupertas, -atis (f.)", parsing: "acc. sing.", meaning: "poverty" },
    "subsistere": { lemma: "subsisto, -ere, substiti", parsing: "pres. inf. act.", meaning: "to remain, to stay" },
    "fixum": { lemma: "figo, figere, fixi, fixum", parsing: "pf. part. neut. nom. sing.", meaning: "fixed, posted" },
    "est": { lemma: "sum, esse, fui", parsing: "3rd sing. pres. ind.", meaning: "is, was" },
    "aere": { lemma: "aes, aeris (n.)", parsing: "abl. sing.", meaning: "in bronze" },
    "senatus": { lemma: "senatus, -us (m.)", parsing: "gen. sing.", meaning: "of the Senate" },
    "consultum": { lemma: "consultum, -i (n.)", parsing: "nom. sing.", meaning: "decree" },
    "quo": { lemma: "qui, quae, quod", parsing: "rel. pron., abl. neut. sing.", meaning: "in which" },
    "libertinus": { lemma: "libertinus, -i (m.)", parsing: "nom. sing.", meaning: "a freedman" },
    "sestertii": { lemma: "sestertius, -i (m.)", parsing: "gen. sing.", meaning: "of sesterces" },
    "ter": { lemma: "ter", parsing: "numeral adverb", meaning: "three times" },
    "milies": { lemma: "milies", parsing: "numeral adverb", meaning: "a thousand times (ter milies = 300 million)" },
    "possessor": { lemma: "possessor, -oris (m.)", parsing: "nom. sing.", meaning: "possessor, owner" },
    "antiquae": { lemma: "antiquus, -a, -um", parsing: "gen. fem. sing.", meaning: "of old-fashioned, of ancient" },
    "parsimoniae": { lemma: "parsimonia, -ae (f.)", parsing: "gen. sing.", meaning: "thrift, frugality" },
    "laudibus": { lemma: "laus, laudis (f.)", parsing: "abl. pl.", meaning: "with praises" },
    "cumulabatur": { lemma: "cumulo, -are, -avi, -atum", parsing: "3rd sing. impf. ind. pass.", meaning: "was heaped, was piled" },
    "se": { lemma: "se", parsing: "reflex. pron. acc.", meaning: "himself" }
};

const latinSentences = [
    "inter quae refert ad patres de poena feminarum quae servis coniungerentur;",
    "statuiturque ut ignaro domino ad id prolapsae in servitute, sin consensisset, pro libertis haberentur.",
    "Pallanti, quem repertorem eius relationis ediderat Caesar, praetoria insignia et centies quinquagies sestertium censuit consul designatus Barea Soranus.",
    "additum a Scipione Cornelio grates publice agendas, quod regibus Arcadiae ortus veterrimam nobilitatem usui publico postponeret seque inter ministros principis haberi sineret.",
    "adseveravit Claudius contentum honore Pallantem intra priorem paupertatem subsistere.",
    "et fixum est aere publico senatus consultum quo libertinus sestertii ter milies possessor antiquae parsimoniae laudibus cumulabatur."
];

const resources = {
    summary: `<h4>Summary</h4>
<p>Claudius refers a proposal to the Senate concerning women who form relationships with slaves: if the master was unaware, the women become slaves; if he consented, they become freedwomen.</p>
<p>The emperor credits his freedman Pallas with devising this law. The consul-designate Barea Soranus proposes awarding Pallas praetorian insignia and 15 million sesterces. Scipio Cornelius adds that public thanks should be given because Pallas, supposedly descended from Arcadian kings, puts aside his noble birth to serve the emperor.</p>
<p>Claudius declares that Pallas, content with the honour, will remain in his 'former poverty'. The decree praising this freedman's 'old-fashioned thrift' is inscribed on bronze - despite the fact that he possesses 300 million sesterces.</p>`,
    context: `<h4>Historical Context</h4>
<p><strong>Pallas:</strong> Marcus Antonius Pallas was one of the most powerful freedmen in Roman history. He served as Claudius' financial secretary (<em>a rationibus</em>) and wielded enormous influence. His wealth of 300 million sesterces made him one of the richest men in Rome.</p>
<p><strong>The Senatus Consultum Claudianum:</strong> The law mentioned here (AD 52) regulated relationships between free women and slaves. It remained in force for centuries and shows that freedmen like Pallas could shape major legislation.</p>
<p><strong>Praetorian Insignia:</strong> These honorary decorations were traditionally reserved for senators who had held the praetorship (a senior magistracy). Granting them to a freedman violated fundamental principles of Roman social hierarchy.</p>
<p><strong>Senate Servility:</strong> Under the emperors, the Senate increasingly competed to offer extravagant honours. This passage exemplifies how traditional institutions debased themselves to curry imperial favour.</p>`,
    comprehension: `<h4>Comprehension Questions</h4>
<p><strong>Lines 1-2:</strong> What proposal did Claudius bring to the Senate? What happened to women who formed relationships with slaves if the master was unaware?</p>
<p><strong>Line 2:</strong> What happened if the master had consented to the relationship?</p>
<p><strong>Line 3:</strong> Who was credited as the author of this proposal? What honours did Barea Soranus propose for Pallas?</p>
<p><strong>Line 4:</strong> What additional honour did Scipio Cornelius propose? What claim was made about Pallas' ancestry?</p>
<p><strong>Line 5:</strong> What did Claudius say about Pallas' attitude to wealth?</p>
<p><strong>Line 6:</strong> Where was the Senate's decree displayed? How much money did Pallas actually possess?</p>
<p><strong>Overall:</strong> What is ironic about praising Pallas for 'old-fashioned thrift'? What does this passage reveal about the relationship between emperor, Senate, and freedmen?</p>`
};

let currentPopup = null;
let sentenceModeActive = false;
let currentSentenceIndex = 0;
let pointerModeActive = false;

function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    const isDark = document.body.classList.contains('dark-mode');
    savePreference('darkMode', isDark);

    const btn = event.currentTarget;
    if (isDark) {
        btn.textContent = '‚òÄÔ∏è Light';
        btn.classList.add('active');
    } else {
        btn.textContent = 'üåô Dark';
        btn.classList.remove('active');
    }
}

function toggleFullScreen() {
    document.body.classList.toggle('full-screen');
    const btn = event.currentTarget;
    if (document.body.classList.contains('full-screen')) {
        btn.textContent = '‚õ∂ Exit Full Screen';
        btn.classList.add('active');
    } else {
        btn.textContent = '‚õ∂ Full Screen';
        btn.classList.remove('active');
    }
}

function toggleLineNumbers() {
    const latinText = document.getElementById('latinText');
    latinText.classList.toggle('show-lines');
    const showLines = latinText.classList.contains('show-lines');
    savePreference('lineNumbers', showLines);

    const btn = event.currentTarget;
    btn.classList.toggle('active');
}

function togglePointerMode() {
    pointerModeActive = !pointerModeActive;
    document.body.classList.toggle('pointer-mode');
    const btn = event.currentTarget;
    btn.classList.toggle('active');

    if (!pointerModeActive) {
        // Clear all pointed words when exiting pointer mode
        document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
    }

    // Hide vocab popup when entering pointer mode
    if (pointerModeActive) {
        hidePopup();
    }
}

function toggleSentenceMode() {
    const latinText = document.getElementById('latinText');
    const sentenceNav = document.getElementById('sentenceNav');
    const btn = event.currentTarget;

    sentenceModeActive = !sentenceModeActive;

    if (sentenceModeActive) {
        latinText.classList.add('sentence-mode');
        sentenceNav.classList.add('visible');
        btn.classList.add('active');
        btn.textContent = 'Full Text';
        currentSentenceIndex = 0;
        updateSentenceDisplay();
    } else {
        latinText.classList.remove('sentence-mode');
        sentenceNav.classList.remove('visible');
        btn.classList.remove('active');
        btn.textContent = 'Sentence Mode';
        // Remove current-sentence class from all
        document.querySelectorAll('.latin-text p').forEach(p => p.classList.remove('current-sentence'));
    }
}

function updateSentenceDisplay() {
    const paragraphs = document.querySelectorAll('.latin-text p');
    paragraphs.forEach((p, i) => {
        if (i === currentSentenceIndex) {
            p.classList.add('current-sentence');
        } else {
            p.classList.remove('current-sentence');
        }
    });
    document.getElementById('sentenceCounter').textContent = `${currentSentenceIndex + 1} / ${paragraphs.length}`;

    // Update button states
    const navButtons = document.querySelectorAll('.sentence-nav button');
    navButtons[0].disabled = currentSentenceIndex === 0;
    navButtons[1].disabled = currentSentenceIndex === paragraphs.length - 1;
}

function prevSentence() {
    if (currentSentenceIndex > 0) {
        currentSentenceIndex--;
        updateSentenceDisplay();
        hidePopup();
    }
}

function nextSentence() {
    const paragraphs = document.querySelectorAll('.latin-text p');
    if (currentSentenceIndex < paragraphs.length - 1) {
        currentSentenceIndex++;
        updateSentenceDisplay();
        hidePopup();
    }
}

function generateLatinHTML() {
    let html = '';
    latinSentences.forEach((sentence, index) => {
        // Split into tokens, keeping punctuation attached to words
        const tokens = sentence.match(/[a-zA-Z]+[.,;:]*|[.,;:]+/g);
        html += '<p style="margin-bottom: 1.5rem;">';
        html += `<span class="line-number">${index + 1}</span>`;
        html += '<span class="line-content">';
        tokens.forEach((token, i) => {
            // Separate word from trailing punctuation
            const match = token.match(/^([a-zA-Z]+)([.,;:]*)$/);
            if (match) {
                const word = match[1];
                const punct = match[2];
                const lookupWord = word.toLowerCase();
                html += `<span class="word" data-word="${lookupWord}">${word}</span>${punct}`;
                // Add space after unless it's the last token
                if (i < tokens.length - 1) html += ' ';
            } else {
                // Just punctuation
                html += token + ' ';
            }
        });
        html += '</span></p>';
    });
    return html;
}

function showVocabPopup(event, word) {
    const popup = document.getElementById('vocabPopup');
    const wordData = vocab[word.toLowerCase()];

    // Remove active class from all words
    document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active'));

    if (!wordData) {
        popup.classList.remove('visible');
        return;
    }

    // Add active class to clicked word
    event.target.classList.add('active');

    popup.innerHTML = `
        <h4>${word}</h4>
        <div class="parsing">${wordData.parsing}</div>
        <div class="meaning">${wordData.meaning}</div>
        <div class="principal-parts">${wordData.lemma}</div>
    `;

    // Position popup near the word
    const rect = event.target.getBoundingClientRect();
    const popupWidth = 300;
    const popupHeight = 150;

    let left = rect.left + (rect.width / 2) - (popupWidth / 2);
    let top = rect.bottom + 12;
    let arrowBottom = false;

    // Keep popup within viewport horizontally
    if (left < 10) left = 10;
    if (left + popupWidth > window.innerWidth - 10) {
        left = window.innerWidth - popupWidth - 10;
    }

    // If popup would go below viewport, show above word
    if (top + popupHeight > window.innerHeight) {
        top = rect.top - popupHeight - 12;
        arrowBottom = true;
    }

    // Calculate arrow position relative to popup
    const wordCenterX = rect.left + (rect.width / 2);
    const arrowLeft = Math.max(20, Math.min(popupWidth - 20, wordCenterX - left));

    popup.style.left = left + 'px';
    popup.style.top = top + 'px';
    popup.style.setProperty('--arrow-left', arrowLeft + 'px');
    popup.classList.toggle('arrow-bottom', arrowBottom);
    popup.classList.add('visible');

    currentPopup = popup;
}

function hidePopup() {
    const popup = document.getElementById('vocabPopup');
    popup.classList.remove('visible');
    document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active'));
}

function toggleTranslation() {
    const box = document.getElementById('translationBox');
    const btn = event.currentTarget;

    if (box.classList.contains('active')) {
        box.classList.remove('active');
        btn.textContent = 'Show Translation';
        btn.classList.remove('active');
    } else {
        box.classList.add('active');
        btn.textContent = 'Hide Translation';
        btn.classList.add('active');
    }
}

function showView(view) {
    // Update nav
    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
    event.currentTarget.classList.add('active');

    const textCard = document.getElementById('textCard');
    const resourceCard = document.getElementById('resourceCard');

    if (view === 'text') {
        textCard.style.display = 'block';
        resourceCard.style.display = 'none';
    } else {
        textCard.style.display = 'none';
        resourceCard.style.display = 'block';
        document.getElementById('resourceTitle').textContent = view.charAt(0).toUpperCase() + view.slice(1);
        document.getElementById('resourceContent').innerHTML = resources[view];
    }
}

// Initialise
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('latinText').innerHTML = generateLatinHTML();

    // Load saved preferences
    loadPreferences();

    // Add click handlers to words
    document.querySelectorAll('.word').forEach(word => {
        word.addEventListener('click', function(e) {
            e.stopPropagation();

            if (pointerModeActive) {
                // Toggle pointed class
                this.classList.toggle('pointed');
            } else {
                showVocabPopup(e, this.dataset.word);
            }
        });
    });

    // Hide popup when clicking elsewhere, clear pointer highlights on background click
    document.addEventListener('click', function(e) {
        if (!e.target.classList.contains('word')) {
            hidePopup();

            // If in pointer mode and clicking background (not buttons), clear all highlights
            if (pointerModeActive && !e.target.closest('.btn-group') && !e.target.closest('.sentence-nav')) {
                document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
            }
        }
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Escape to exit full screen
        if (e.key === 'Escape') {
            if (document.body.classList.contains('full-screen')) {
                document.body.classList.remove('full-screen');
                const btn = document.querySelector('.btn-group .btn:last-child');
                if (btn) {
                    btn.textContent = '‚õ∂ Full Screen';
                    btn.classList.remove('active');
                }
            }
            // Also exit pointer mode on escape
            if (pointerModeActive) {
                pointerModeActive = false;
                document.body.classList.remove('pointer-mode');
                document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
                document.querySelectorAll('.btn').forEach(btn => {
                    if (btn.textContent === 'Pointer Mode') btn.classList.remove('active');
                });
            }
        }

        // Arrow keys for sentence navigation
        if (sentenceModeActive) {
            if (e.key === 'ArrowLeft') {
                prevSentence();
            } else if (e.key === 'ArrowRight') {
                nextSentence();
            }
        }
    });
});

function loadPreferences() {
    // Dark mode
    if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
        setTimeout(() => {
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent.includes('Dark')) {
                    btn.textContent = '‚òÄÔ∏è Light';
                    btn.classList.add('active');
                }
            });
        }, 0);
    }

    // Line numbers
    if (localStorage.getItem('lineNumbers') === 'true') {
        document.getElementById('latinText').classList.add('show-lines');
        setTimeout(() => {
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent === 'Line Numbers') {
                    btn.classList.add('active');
                }
            });
        }, 0);
    }
}

function savePreference(key, value) {
    localStorage.setItem(key, value);
}
    </script>
</body>
</html>
