<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classicalia - Tacitus Annals 12.69</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 240px;
            background: white;
            border-right: 1px solid #e5e7eb;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }
        .logo-section {
            padding: 1.5rem 1.25rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }
        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #0066ff 0%, #4d94ff 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.1rem;
        }
        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
        }
        .nav-section {
            padding: 1rem 0.5rem;
        }
        .nav-title {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #9ca3af;
            letter-spacing: 0.05em;
            padding: 0 0.75rem;
            margin-bottom: 0.5rem;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.625rem 0.75rem;
            margin: 0.125rem 0;
            border-radius: 8px;
            text-decoration: none;
            color: #4b5563;
            font-size: 0.9rem;
            transition: all 0.15s ease;
            cursor: pointer;
        }
        .nav-item:hover {
            background: #f3f4f6;
            color: #1f2937;
        }
        .nav-item.active {
            background: #eef2ff;
            color: #0066ff;
            font-weight: 500;
        }
        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }
        .main-content {
            margin-left: 240px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .top-bar {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0.875rem 2rem;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .content-wrapper {
            flex: 1;
            overflow-y: auto;
        }
        .content-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }
        .lesson-header {
            margin-bottom: 2rem;
        }
        .lesson-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        .lesson-meta {
            display: flex;
            gap: 1.5rem;
            font-size: 0.875rem;
            color: #6b7280;
        }
        .card {
            background: white;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }
        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
        }
        .card-body {
            padding: 2rem;
        }
        .latin-text {
            font-size: 1.5rem;
            line-height: 2.4;
            color: #1f2937;
        }
        .word {
            cursor: pointer;
            padding: 2px 4px;
            margin: 0 1px;
            border-radius: 4px;
            transition: all 0.15s ease;
            display: inline;
        }
        .word:hover {
            background: rgba(0, 102, 255, 0.15);
        }
        .word.active {
            background: rgba(0, 102, 255, 0.25);
        }

        /* Popup styles */
        .vocab-popup {
            position: fixed;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05);
            padding: 1rem 1.25rem;
            z-index: 1000;
            max-width: 350px;
            min-width: 250px;
            display: none;
            animation: popIn 0.2s ease;
        }
        .vocab-popup::before {
            content: '';
            position: absolute;
            top: -8px;
            left: var(--arrow-left, 50%);
            transform: translateX(-50%);
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid white;
        }
        .vocab-popup.arrow-bottom::before {
            top: auto;
            bottom: -8px;
            border-bottom: none;
            border-top: 8px solid white;
        }
        body.dark-mode .vocab-popup::before {
            border-bottom-color: #4f0c28;
        }
        body.dark-mode .vocab-popup.arrow-bottom::before {
            border-bottom-color: transparent;
            border-top-color: #4f0c28;
        }
        @keyframes popIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .vocab-popup.visible {
            display: block;
        }
        .vocab-popup h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #0066ff;
            margin-bottom: 0.5rem;
        }
        .vocab-popup .parsing {
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
            font-style: italic;
        }
        .vocab-popup .meaning {
            font-size: 0.95rem;
            color: #1f2937;
            line-height: 1.5;
        }
        .vocab-popup .principal-parts {
            font-size: 0.85rem;
            color: #4b5563;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid #e5e7eb;
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }
        .btn {
            padding: 0.625rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        .btn:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }
        .btn.active {
            background: #0066ff;
            color: white;
            border-color: #0066ff;
        }

        /* Dark mode styles */
        body.dark-mode {
            background: #2d0818;
        }
        body.dark-mode .sidebar {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .logo-icon {
            background: linear-gradient(135deg, #8b5a8a 0%, #a67aa6 100%);
        }
        body.dark-mode .logo-text {
            color: #c5d2f8;
        }
        body.dark-mode .nav-title {
            color: #9a8a9a;
        }
        body.dark-mode .nav-item {
            color: #b8a8b8;
        }
        body.dark-mode .nav-item:hover {
            background: #4f0c28;
            color: #c5d2f8;
        }
        body.dark-mode .nav-item.active {
            background: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .top-bar {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .card {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .card-header {
            border-color: #5a1a3a;
        }
        body.dark-mode .card-title {
            color: #c5d2f8;
        }
        body.dark-mode .lesson-title {
            color: #c5d2f8;
        }
        body.dark-mode .lesson-meta {
            color: #b8a8b8;
        }
        body.dark-mode .latin-text {
            color: #c5d2f8;
            text-shadow: 0 0 20px rgba(197, 210, 248, 0.15);
        }
        body.dark-mode .word:hover {
            background: rgba(232, 212, 168, 0.25);
        }
        body.dark-mode .word.active {
            background: rgba(232, 212, 168, 0.35);
        }
        body.dark-mode .btn {
            background: #4f0c28;
            border-color: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .btn:hover {
            background: #5a1a3a;
        }
        body.dark-mode .btn.active {
            background: #7a3a5a;
            border-color: #8a4a6a;
        }
        body.dark-mode .resource-card {
            background: #4f0c28;
            border-color: #5a1a3a;
        }
        body.dark-mode .resource-card h4 {
            color: #c5d2f8;
        }
        body.dark-mode .resource-card p {
            color: #b8c8e8;
        }
        body.dark-mode .vocab-popup {
            background: #4f0c28;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        body.dark-mode .vocab-popup h4 {
            color: #e8d4a8;
        }
        body.dark-mode .vocab-popup .parsing {
            color: #b8a8b8;
        }
        body.dark-mode .vocab-popup .meaning {
            color: #c5d2f8;
        }
        body.dark-mode .vocab-popup .principal-parts {
            color: #a8b8d8;
            border-color: #5a1a3a;
        }

        /* Sentence hover highlight */
        .latin-text p {
            padding: 0.5rem 0.75rem;
            margin: 0 -0.75rem 1.5rem -0.75rem;
            border-radius: 6px;
            transition: background 0.2s ease;
        }
        .latin-text p:hover {
            background: rgba(59, 130, 246, 0.08);
        }
        body.dark-mode .latin-text p:hover {
            background: rgba(197, 210, 248, 0.1);
        }

        /* Sentence-by-sentence mode */
        .latin-text.sentence-mode p {
            display: none;
        }
        .latin-text.sentence-mode p.current-sentence {
            display: block;
        }
        .latin-text.sentence-mode p:hover {
            background: transparent;
        }

        .sentence-nav {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }
        .sentence-nav.visible {
            display: flex;
        }
        body.dark-mode .sentence-nav {
            border-color: #5a1a3a;
        }
        .sentence-nav button {
            padding: 0.5rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        .sentence-nav button:hover:not(:disabled) {
            background: #f3f4f6;
        }
        .sentence-nav button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        body.dark-mode .sentence-nav button {
            background: #4f0c28;
            border-color: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .sentence-nav button:hover:not(:disabled) {
            background: #5a1a3a;
        }
        .sentence-counter {
            font-size: 0.875rem;
            color: #6b7280;
            min-width: 80px;
            text-align: center;
        }
        body.dark-mode .sentence-counter {
            color: #b8a8b8;
        }

        /* Full-screen mode */
        body.full-screen .sidebar {
            display: none;
        }
        body.full-screen .main-content {
            margin-left: 0;
        }
        body.full-screen .lesson-header {
            display: none;
        }
        body.full-screen .content-container {
            max-width: 100%;
            padding: 1rem 2rem;
        }
        body.full-screen .card {
            border: none;
            border-radius: 0;
            background: transparent;
        }
        body.full-screen .card-header {
            display: none;
        }
        body.full-screen .card-body {
            padding: 1rem 2rem;
        }
        body.full-screen .latin-text {
            font-size: 2rem;
            line-height: 2.6;
        }
        body.full-screen .btn-group {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            background: white;
            padding: 0.75rem;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 200;
        }
        body.full-screen.dark-mode .btn-group {
            background: #3a0a1f;
        }
        body.full-screen .resource-card {
            display: none !important;
        }
        body.full-screen .sentence-nav {
            border: none;
            padding-top: 0;
        }
        body.full-screen .top-bar {
            display: none;
        }

        /* Line numbers */
        .latin-text.show-lines p {
            display: flex;
            align-items: flex-start;
        }
        .line-number {
            display: none;
            min-width: 2.5rem;
            color: #9ca3af;
            font-size: 0.875rem;
            padding-top: 0.3rem;
            user-select: none;
        }
        .latin-text.show-lines .line-number {
            display: block;
        }
        body.dark-mode .line-number {
            color: #7a6a7a;
        }
        .line-content {
            flex: 1;
        }

        /* Pointer/highlight mode */
        .word.pointed {
            background: rgba(255, 200, 50, 0.5) !important;
            box-shadow: 0 0 12px rgba(255, 200, 50, 0.6);
            border-radius: 4px;
        }
        body.dark-mode .word.pointed {
            background: rgba(232, 212, 168, 0.5) !important;
            box-shadow: 0 0 15px rgba(232, 212, 168, 0.5);
        }

        /* Pointer mode indicator */
        body.pointer-mode .word {
            cursor: crosshair;
        }
        .mode-indicator {
            display: none;
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: #fef3c7;
            color: #92400e;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            z-index: 200;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        body.pointer-mode .mode-indicator {
            display: block;
        }
        body.dark-mode .mode-indicator {
            background: #4f0c28;
            color: #e8d4a8;
        }

        .resource-card {
            background: #f9fafb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px solid #e5e7eb;
            display: none;
        }
        .resource-card.active {
            display: block;
        }
        .resource-card h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.75rem;
        }
        .resource-card p {
            font-size: 0.95rem;
            line-height: 1.8;
            color: #374151;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
            }
            .latin-text {
                font-size: 1.25rem;
                line-height: 2.2;
            }
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="logo-section">
            <a href="../../../index.html" class="logo">
                <div class="logo-icon">C</div>
                <span class="logo-text">Classicalia</span>
            </a>
        </div>
        <nav class="nav-section">
            <div class="nav-title">Resources</div>
            <div class="nav-item active" onclick="showView('text')">
                <span class="nav-icon">üìñ</span>
                <span>Read</span>
            </div>
            <div class="nav-item" onclick="showView('summary')">
                <span class="nav-icon">üìã</span>
                <span>Summary</span>
            </div>
            <div class="nav-item" onclick="showView('context')">
                <span class="nav-icon">üèõÔ∏è</span>
                <span>Context</span>
            </div>
            <div class="nav-item" onclick="showView('comprehension')">
                <span class="nav-icon">‚ùì</span>
                <span>Comprehension</span>
            </div>
        </nav>
    </aside>

    <main class="main-content">
        <div class="top-bar"></div>
        <div class="content-wrapper">
            <div class="content-container">
                <header class="lesson-header">
                    <h1 class="lesson-title">Nero's Accession to Power</h1>
                    <div class="lesson-meta">
                        <span>üìï Tacitus Annals 12.69</span>
                        <span>‚è±Ô∏è 45 min</span>
                        <span>üìä A-Level</span>
                    </div>
                </header>

                <div class="card" id="textCard">
                    <div class="card-header">
                        <h3 class="card-title">Latin Text</h3>
                    </div>
                    <div class="card-body">
                        <div class="latin-text" id="latinText"></div>
                        <div class="btn-group">
                            <button class="btn" onclick="toggleTranslation()">Translation</button>
                            <button class="btn" onclick="toggleSentenceMode()">Sentence Mode</button>
                            <button class="btn" onclick="toggleLineNumbers()">Line Numbers</button>
                            <button class="btn" onclick="togglePointerMode()">Pointer Mode</button>
                            <button class="btn" onclick="toggleDarkMode()">üåô Dark</button>
                            <button class="btn" onclick="toggleFullScreen()">‚õ∂ Full Screen</button>
                        </div>
                        <div class="sentence-nav" id="sentenceNav">
                            <button onclick="prevSentence()">‚Üê Previous</button>
                            <span class="sentence-counter" id="sentenceCounter">1 / 8</span>
                            <button onclick="nextSentence()">Next ‚Üí</button>
                        </div>
                        <div class="resource-card" id="translationBox">
                            <h4>Translation</h4>
                            <p>Then at midday on October 13th, with the palace doors suddenly thrown open, Nero goes out to the cohort with Burrus accompanying him, which according to military custom is present for guard duty. There, with the prefect directing, he was received with auspicious shouts and placed in a litter. They say that some hesitated, looking back and repeatedly asking where Britannicus was: soon, with no one urging differently, they followed what was offered to them. And Nero, carried into the camp and having delivered a speech fitting to the occasion, with a donative promised after the example of his father's generosity, is hailed as emperor. The decrees of the senators followed the decision of the soldiers, nor was there any doubt in the provinces. Divine honours are decreed for Claudius and the funeral ceremony was celebrated just as for the deified Augustus, with Agrippina emulating the magnificence of her great-grandmother Livia. Yet the will was not read, lest the stepson having been placed before the son should disturb the minds of the common people with its injustice and resentment.</p>
                        </div>
                    </div>
                </div>

                <div class="card" id="resourceCard" style="display: none; margin-top: 1.5rem;">
                    <div class="card-header">
                        <h3 class="card-title" id="resourceTitle">Summary</h3>
                    </div>
                    <div class="card-body" id="resourceContent"></div>
                </div>
            </div>
        </div>
    </main>

    <div class="vocab-popup" id="vocabPopup"></div>
    <div class="mode-indicator">üìç Pointer Mode (click words to highlight, click again to remove)</div>

    <script>
const vocab = {
    "tunc": { lemma: "tunc", parsing: "adverb", meaning: "then, at that time" },
    "medio": { lemma: "medius, -a, -um", parsing: "abl. neut. sing.", meaning: "middle" },
    "diei": { lemma: "dies, diei (m./f.)", parsing: "gen. sing.", meaning: "of the day" },
    "tertium": { lemma: "tertius, -a, -um", parsing: "acc. neut. sing.", meaning: "third" },
    "ante": { lemma: "ante", parsing: "preposition + acc.", meaning: "before" },
    "idus": { lemma: "Idus, -uum (f. pl.)", parsing: "acc. pl.", meaning: "Ides" },
    "octobris": { lemma: "October, -bris", parsing: "gen. sing.", meaning: "of October" },
    "foribus": { lemma: "foris, -is (f.)", parsing: "abl. pl.", meaning: "doors" },
    "palatii": { lemma: "palatium, -i (n.)", parsing: "gen. sing.", meaning: "of the palace" },
    "repente": { lemma: "repente", parsing: "adverb", meaning: "suddenly" },
    "diductis": { lemma: "diduco, -ere, diduxi, diductum", parsing: "perf. pass. part. abl. pl.", meaning: "having been thrown open" },
    "comitante": { lemma: "comitor, -ari, -atus sum", parsing: "pres. part. abl. sing.", meaning: "accompanying" },
    "burro": { lemma: "Burrus, -i (m.)", parsing: "abl. sing.", meaning: "Burrus" },
    "nero": { lemma: "Nero, -onis (m.)", parsing: "nom. sing.", meaning: "Nero" },
    "egreditur": { lemma: "egredior, egredi, egressus sum", parsing: "3rd sing. pres. dep.", meaning: "goes out" },
    "ad": { lemma: "ad", parsing: "preposition + acc.", meaning: "to, towards" },
    "cohortem": { lemma: "cohors, cohortis (f.)", parsing: "acc. sing.", meaning: "cohort" },
    "quae": { lemma: "qui, quae, quod", parsing: "nom. fem. sing.", meaning: "which" },
    "more": { lemma: "mos, moris (m.)", parsing: "abl. sing.", meaning: "according to the custom" },
    "militiae": { lemma: "militia, -ae (f.)", parsing: "gen. sing.", meaning: "of military service" },
    "excubiis": { lemma: "excubiae, -arum (f. pl.)", parsing: "dat. pl.", meaning: "for guard duty" },
    "adest": { lemma: "adsum, adesse, adfui", parsing: "3rd sing. pres.", meaning: "is present" },
    "ibi": { lemma: "ibi", parsing: "adverb", meaning: "there" },
    "monente": { lemma: "moneo, -ere, monui, monitum", parsing: "pres. part. abl. sing.", meaning: "directing, prompting" },
    "praefecto": { lemma: "praefectus, -i (m.)", parsing: "abl. sing.", meaning: "the prefect" },
    "faustis": { lemma: "faustus, -a, -um", parsing: "abl. pl.", meaning: "auspicious, favourable" },
    "vocibus": { lemma: "vox, vocis (f.)", parsing: "abl. pl.", meaning: "with shouts, voices" },
    "exceptus": { lemma: "excipio, -ere, excepi, exceptum", parsing: "perf. pass. part. nom. sing.", meaning: "received" },
    "inditur": { lemma: "indo, -ere, indidi, inditum", parsing: "3rd sing. pres. pass.", meaning: "he is placed" },
    "lecticae": { lemma: "lectica, -ae (f.)", parsing: "dat. sing.", meaning: "into a litter" },
    "dubitavisse": { lemma: "dubito, -are, -avi, -atum", parsing: "perf. inf.", meaning: "to have hesitated" },
    "quosdam": { lemma: "quidam, quaedam, quiddam", parsing: "acc. pl. masc.", meaning: "some" },
    "ferunt": { lemma: "fero, ferre, tuli, latum", parsing: "3rd pl. pres.", meaning: "they say, it is reported" },
    "respectantes": { lemma: "respecto, -are", parsing: "pres. part. nom. pl.", meaning: "looking back" },
    "rogitantesque": { lemma: "rogito, -are", parsing: "pres. part. nom. pl. + -que", meaning: "and repeatedly asking" },
    "rogitantes": { lemma: "rogito, -are", parsing: "pres. part. nom. pl.", meaning: "repeatedly asking" },
    "ubi": { lemma: "ubi", parsing: "adverb/conjunction", meaning: "where" },
    "britannicus": { lemma: "Britannicus, -i (m.)", parsing: "nom. sing.", meaning: "Britannicus" },
    "esset": { lemma: "sum, esse, fui", parsing: "3rd sing. imperf. subj.", meaning: "was, might be" },
    "mox": { lemma: "mox", parsing: "adverb", meaning: "soon" },
    "nullo": { lemma: "nullus, -a, -um", parsing: "abl. sing.", meaning: "no one, with no one" },
    "in": { lemma: "in", parsing: "preposition + acc./abl.", meaning: "in, into" },
    "diversum": { lemma: "diversus, -a, -um", parsing: "acc. neut. sing.", meaning: "different direction" },
    "auctore": { lemma: "auctor, -oris (m.)", parsing: "abl. sing.", meaning: "urging, advocating" },
    "offerebantur": { lemma: "offero, offerre, obtuli, oblatum", parsing: "3rd pl. imperf. pass.", meaning: "were being offered" },
    "secuti": { lemma: "sequor, sequi, secutus sum", parsing: "perf. part. nom. pl.", meaning: "having followed" },
    "sunt": { lemma: "sum, esse, fui", parsing: "3rd pl. pres.", meaning: "are, they are" },
    "inlatusque": { lemma: "infero, inferre, intuli, illatum", parsing: "perf. pass. part. nom. sing. + -que", meaning: "and having been carried in" },
    "inlatus": { lemma: "infero, inferre, intuli, illatum", parsing: "perf. pass. part. nom. sing.", meaning: "having been carried in" },
    "castris": { lemma: "castra, -orum (n. pl.)", parsing: "dat./abl. pl.", meaning: "into the camp" },
    "et": { lemma: "et", parsing: "conjunction", meaning: "and" },
    "congruentia": { lemma: "congruens, -entis", parsing: "acc. pl. neut.", meaning: "fitting things" },
    "tempori": { lemma: "tempus, temporis (n.)", parsing: "dat. sing.", meaning: "to the occasion" },
    "praefatus": { lemma: "praefor, praefari, praefatus sum", parsing: "perf. dep. part. nom. sing.", meaning: "having spoken beforehand" },
    "promisso": { lemma: "promitto, -ere, promisi, promissum", parsing: "perf. pass. part. abl. sing.", meaning: "having been promised" },
    "donativo": { lemma: "donativum, -i (n.)", parsing: "abl. sing.", meaning: "donative, cash gift" },
    "exemplum": { lemma: "exemplum, -i (n.)", parsing: "acc. sing.", meaning: "example" },
    "paternae": { lemma: "paternus, -a, -um", parsing: "gen. fem. sing.", meaning: "of his father, paternal" },
    "largitionis": { lemma: "largitio, -onis (f.)", parsing: "gen. sing.", meaning: "generosity, largesse" },
    "imperator": { lemma: "imperator, -oris (m.)", parsing: "nom. sing.", meaning: "emperor, commander" },
    "consalutatur": { lemma: "consaluto, -are", parsing: "3rd sing. pres. pass.", meaning: "he is hailed, acclaimed" },
    "sententiam": { lemma: "sententia, -ae (f.)", parsing: "acc. sing.", meaning: "decision, judgement" },
    "militum": { lemma: "miles, militis (m.)", parsing: "gen. pl.", meaning: "of the soldiers" },
    "secuta": { lemma: "sequor, sequi, secutus sum", parsing: "perf. part. nom. pl. fem.", meaning: "having followed" },
    "patrum": { lemma: "pater, patris (m.)", parsing: "gen. pl.", meaning: "of the senators" },
    "consulta": { lemma: "consultum, -i (n.)", parsing: "nom. pl.", meaning: "decrees, resolutions" },
    "nec": { lemma: "nec / neque", parsing: "conjunction", meaning: "nor, and not" },
    "dubitatum": { lemma: "dubito, -are, -avi, -atum", parsing: "perf. pass. part. nom. neut.", meaning: "doubt" },
    "est": { lemma: "sum, esse, fui", parsing: "3rd sing. pres.", meaning: "is" },
    "apud": { lemma: "apud", parsing: "preposition + acc.", meaning: "among, in" },
    "provincias": { lemma: "provincia, -ae (f.)", parsing: "acc. pl.", meaning: "the provinces" },
    "caelestesque": { lemma: "caelestis, -e", parsing: "nom. pl. + -que", meaning: "and divine, heavenly" },
    "caelestes": { lemma: "caelestis, -e", parsing: "nom. pl.", meaning: "divine, heavenly" },
    "honores": { lemma: "honor, -oris (m.)", parsing: "nom. pl.", meaning: "honours" },
    "claudio": { lemma: "Claudius, -i (m.)", parsing: "dat. sing.", meaning: "for Claudius" },
    "decernuntur": { lemma: "decerno, -ere, decrevi, decretum", parsing: "3rd pl. pres. pass.", meaning: "are decreed" },
    "funeris": { lemma: "funus, -eris (n.)", parsing: "gen. sing.", meaning: "of the funeral" },
    "sollemne": { lemma: "sollemne, -is (n.)", parsing: "nom. sing.", meaning: "ceremony, rite" },
    "perinde": { lemma: "perinde", parsing: "adverb", meaning: "just as" },
    "ac": { lemma: "ac / atque", parsing: "conjunction", meaning: "as, and" },
    "divo": { lemma: "divus, -i (m.)", parsing: "dat. sing.", meaning: "the deified" },
    "augusto": { lemma: "Augustus, -i (m.)", parsing: "dat. sing.", meaning: "Augustus" },
    "celebratur": { lemma: "celebro, -are, -avi, -atum", parsing: "3rd sing. pres. pass.", meaning: "is celebrated" },
    "aemulante": { lemma: "aemulor, -ari, -atus sum", parsing: "pres. part. abl. sing.", meaning: "emulating" },
    "agrippina": { lemma: "Agrippina, -ae (f.)", parsing: "abl. sing.", meaning: "Agrippina" },
    "proaviae": { lemma: "proavia, -ae (f.)", parsing: "gen. sing.", meaning: "of her great-grandmother" },
    "liviae": { lemma: "Livia, -ae (f.)", parsing: "gen. sing.", meaning: "Livia" },
    "magnificentiam": { lemma: "magnificentia, -ae (f.)", parsing: "acc. sing.", meaning: "magnificence, splendour" },
    "testamentum": { lemma: "testamentum, -i (n.)", parsing: "nom. sing.", meaning: "will, testament" },
    "tamen": { lemma: "tamen", parsing: "adverb", meaning: "however, yet" },
    "haud": { lemma: "haud", parsing: "adverb", meaning: "not" },
    "recitatum": { lemma: "recito, -are, -avi, -atum", parsing: "perf. pass. part. nom. neut.", meaning: "was read out" },
    "ne": { lemma: "ne", parsing: "conjunction", meaning: "lest, so that not" },
    "antepositus": { lemma: "antepono, -ere, -posui, -positum", parsing: "perf. pass. part. nom. sing.", meaning: "having been placed before" },
    "filio": { lemma: "filius, -i (m.)", parsing: "dat. sing.", meaning: "the son" },
    "privignus": { lemma: "privignus, -i (m.)", parsing: "nom. sing.", meaning: "stepson" },
    "iniuria": { lemma: "iniuria, -ae (f.)", parsing: "abl. sing.", meaning: "injustice, wrong" },
    "invidia": { lemma: "invidia, -ae (f.)", parsing: "abl. sing.", meaning: "resentment, envy" },
    "animos": { lemma: "animus, -i (m.)", parsing: "acc. pl.", meaning: "minds, spirits" },
    "vulgi": { lemma: "vulgus, -i (n.)", parsing: "gen. sing.", meaning: "of the common people" },
    "turbaret": { lemma: "turbo, -are, -avi, -atum", parsing: "3rd sing. imperf. subj.", meaning: "should disturb" }
};

const latinSentences = [
    "tunc medio diei tertium ante Idus Octobris, foribus palatii repente diductis, comitante Burro Nero egreditur ad cohortem, quae more militiae excubiis adest.",
    "ibi monente praefecto faustis vocibus exceptus inditur lecticae.",
    "dubitavisse quosdam ferunt, respectantes rogitantesque ubi Britannicus esset:",
    "mox nullo in diversum auctore quae offerebantur secuti sunt.",
    "inlatusque castris Nero et congruentia tempori praefatus, promisso donativo ad exemplum paternae largitionis, imperator consalutatur.",
    "sententiam militum secuta patrum consulta, nec dubitatum est apud provincias.",
    "caelestesque honores Claudio decernuntur et funeris sollemne perinde ac divo Augusto celebratur, aemulante Agrippina proaviae Liviae magnificentiam.",
    "testamentum tamen haud recitatum, ne antepositus filio privignus iniuria et invidia animos vulgi turbaret."
];

const resources = {
    summary: `<h4>Summary</h4>
<p>On October 13th AD 54, Nero emerges from the palace with Praetorian Prefect Burrus and is presented to the guard cohort on duty. With Burrus directing proceedings, the soldiers acclaim Nero and place him in a litter.</p>
<p>Some soldiers hesitate, asking about Britannicus, but with no one offering an alternative, they follow along. Nero is carried to the Praetorian camp, delivers a speech, and promises a donative. He is hailed as emperor.</p>
<p>The Senate ratifies the soldiers' decision, and the provinces accept Nero without question. Claudius receives divine honours and a grand funeral, with Agrippina emulating her great-grandmother Livia. However, Claudius' will is suppressed to hide that it disinherited Britannicus in favour of Nero.</p>`,
    context: `<h4>Historical Context</h4>
<p><strong>The Date:</strong> October 13th, AD 54. Claudius had died the previous day, reportedly poisoned by Agrippina using mushrooms. The timing of Nero's emergence was carefully chosen - midday, when the guard was assembled.</p>
<p><strong>Burrus:</strong> Sextus Afranius Burrus had been appointed Praetorian Prefect by Agrippina in AD 51. His support was essential for controlling the military during the succession.</p>
<p><strong>Britannicus:</strong> Claudius' biological son, about 13 years old. He was the legitimate heir but had been marginalised by Nero's adoption in AD 50. He would be poisoned in AD 55.</p>
<p><strong>The Praetorian Guard:</strong> The emperor's bodyguard had become kingmakers since their acclamation of Claudius in AD 41. Their acceptance was essential for any succession.</p>
<p><strong>The Donative:</strong> Cash payments to soldiers upon accession became expected. Claudius had paid 15,000-20,000 sesterces per man in AD 41.</p>`,
    comprehension: `<h4>Comprehension Questions</h4>
<p><strong>Line 1:</strong> On what date did these events take place? What is the significance of midday?</p>
<p><strong>Line 1:</strong> Who accompanied Nero when he emerged from the palace? Why was this significant?</p>
<p><strong>Line 1:</strong> Why was a cohort present at the palace?</p>
<p><strong>Lines 2-3:</strong> How was Nero received by the soldiers? Who directed this reception?</p>
<p><strong>Line 3:</strong> What did some soldiers ask about? What does 'rogitantes' tell us about their concern?</p>
<p><strong>Line 4:</strong> What does 'nullo in diversum auctore' suggest about why the succession succeeded?</p>
<p><strong>Line 5:</strong> What did Nero promise the soldiers? What precedent did he invoke?</p>
<p><strong>Line 6:</strong> What was the relationship between the soldiers' decision and the Senate's decrees?</p>
<p><strong>Line 7:</strong> What honours were given to Claudius? Who did Agrippina emulate at the funeral?</p>
<p><strong>Line 8:</strong> Why was Claudius' will not read publicly? What does 'privignus' emphasise?</p>`
};

let currentPopup = null;
let sentenceModeActive = false;
let currentSentenceIndex = 0;
let pointerModeActive = false;

function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    const isDark = document.body.classList.contains('dark-mode');
    savePreference('darkMode', isDark);

    const btn = event.currentTarget;
    if (isDark) {
        btn.textContent = '‚òÄÔ∏è Light';
        btn.classList.add('active');
    } else {
        btn.textContent = 'üåô Dark';
        btn.classList.remove('active');
    }
}

function toggleFullScreen() {
    document.body.classList.toggle('full-screen');
    const btn = event.currentTarget;
    if (document.body.classList.contains('full-screen')) {
        btn.textContent = '‚õ∂ Exit Full Screen';
        btn.classList.add('active');
    } else {
        btn.textContent = '‚õ∂ Full Screen';
        btn.classList.remove('active');
    }
}

function toggleLineNumbers() {
    const latinText = document.getElementById('latinText');
    latinText.classList.toggle('show-lines');
    const showLines = latinText.classList.contains('show-lines');
    savePreference('lineNumbers', showLines);

    const btn = event.currentTarget;
    btn.classList.toggle('active');
}

function togglePointerMode() {
    pointerModeActive = !pointerModeActive;
    document.body.classList.toggle('pointer-mode');
    const btn = event.currentTarget;
    btn.classList.toggle('active');

    if (!pointerModeActive) {
        // Clear all pointed words when exiting pointer mode
        document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
    }

    // Hide vocab popup when entering pointer mode
    if (pointerModeActive) {
        hidePopup();
    }
}

function toggleSentenceMode() {
    const latinText = document.getElementById('latinText');
    const sentenceNav = document.getElementById('sentenceNav');
    const btn = event.currentTarget;

    sentenceModeActive = !sentenceModeActive;

    if (sentenceModeActive) {
        latinText.classList.add('sentence-mode');
        sentenceNav.classList.add('visible');
        btn.classList.add('active');
        btn.textContent = 'Full Text';
        currentSentenceIndex = 0;
        updateSentenceDisplay();
    } else {
        latinText.classList.remove('sentence-mode');
        sentenceNav.classList.remove('visible');
        btn.classList.remove('active');
        btn.textContent = 'Sentence Mode';
        // Remove current-sentence class from all
        document.querySelectorAll('.latin-text p').forEach(p => p.classList.remove('current-sentence'));
    }
}

function updateSentenceDisplay() {
    const paragraphs = document.querySelectorAll('.latin-text p');
    paragraphs.forEach((p, i) => {
        if (i === currentSentenceIndex) {
            p.classList.add('current-sentence');
        } else {
            p.classList.remove('current-sentence');
        }
    });
    document.getElementById('sentenceCounter').textContent = `${currentSentenceIndex + 1} / ${paragraphs.length}`;

    // Update button states
    const navButtons = document.querySelectorAll('.sentence-nav button');
    navButtons[0].disabled = currentSentenceIndex === 0;
    navButtons[1].disabled = currentSentenceIndex === paragraphs.length - 1;
}

function prevSentence() {
    if (currentSentenceIndex > 0) {
        currentSentenceIndex--;
        updateSentenceDisplay();
        hidePopup();
    }
}

function nextSentence() {
    const paragraphs = document.querySelectorAll('.latin-text p');
    if (currentSentenceIndex < paragraphs.length - 1) {
        currentSentenceIndex++;
        updateSentenceDisplay();
        hidePopup();
    }
}

function generateLatinHTML() {
    let html = '';
    latinSentences.forEach((sentence, index) => {
        // Split into tokens, keeping punctuation attached to words
        const tokens = sentence.match(/[a-zA-Z]+[.,;:]*|[.,;:]+/g);
        html += '<p style="margin-bottom: 1.5rem;">';
        html += `<span class="line-number">${index + 1}</span>`;
        html += '<span class="line-content">';
        tokens.forEach((token, i) => {
            // Separate word from trailing punctuation
            const match = token.match(/^([a-zA-Z]+)([.,;:]*)$/);
            if (match) {
                const word = match[1];
                const punct = match[2];
                const lookupWord = word.toLowerCase();
                html += `<span class="word" data-word="${lookupWord}">${word}</span>${punct}`;
                // Add space after unless it's the last token
                if (i < tokens.length - 1) html += ' ';
            } else {
                // Just punctuation
                html += token + ' ';
            }
        });
        html += '</span></p>';
    });
    return html;
}

function showVocabPopup(event, word) {
    const popup = document.getElementById('vocabPopup');
    const wordData = vocab[word.toLowerCase()];

    // Remove active class from all words
    document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active'));

    if (!wordData) {
        popup.classList.remove('visible');
        return;
    }

    // Add active class to clicked word
    event.target.classList.add('active');

    popup.innerHTML = `
        <h4>${word}</h4>
        <div class="parsing">${wordData.parsing}</div>
        <div class="meaning">${wordData.meaning}</div>
        <div class="principal-parts">${wordData.lemma}</div>
    `;

    // Position popup near the word
    const rect = event.target.getBoundingClientRect();
    const popupWidth = 300;
    const popupHeight = 150;

    let left = rect.left + (rect.width / 2) - (popupWidth / 2);
    let top = rect.bottom + 12;
    let arrowBottom = false;

    // Keep popup within viewport horizontally
    if (left < 10) left = 10;
    if (left + popupWidth > window.innerWidth - 10) {
        left = window.innerWidth - popupWidth - 10;
    }

    // If popup would go below viewport, show above word
    if (top + popupHeight > window.innerHeight) {
        top = rect.top - popupHeight - 12;
        arrowBottom = true;
    }

    // Calculate arrow position relative to popup
    const wordCenterX = rect.left + (rect.width / 2);
    const arrowLeft = Math.max(20, Math.min(popupWidth - 20, wordCenterX - left));

    popup.style.left = left + 'px';
    popup.style.top = top + 'px';
    popup.style.setProperty('--arrow-left', arrowLeft + 'px');
    popup.classList.toggle('arrow-bottom', arrowBottom);
    popup.classList.add('visible');

    currentPopup = popup;
}

function hidePopup() {
    const popup = document.getElementById('vocabPopup');
    popup.classList.remove('visible');
    document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active'));
}

function toggleTranslation() {
    const box = document.getElementById('translationBox');
    const btn = event.currentTarget;

    if (box.classList.contains('active')) {
        box.classList.remove('active');
        btn.textContent = 'Translation';
        btn.classList.remove('active');
    } else {
        box.classList.add('active');
        btn.textContent = 'Hide Translation';
        btn.classList.add('active');
    }
}

function showView(view) {
    // Update nav
    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
    event.currentTarget.classList.add('active');

    const textCard = document.getElementById('textCard');
    const resourceCard = document.getElementById('resourceCard');

    if (view === 'text') {
        textCard.style.display = 'block';
        resourceCard.style.display = 'none';
    } else {
        textCard.style.display = 'none';
        resourceCard.style.display = 'block';
        document.getElementById('resourceTitle').textContent = view.charAt(0).toUpperCase() + view.slice(1);
        document.getElementById('resourceContent').innerHTML = resources[view];
    }
}

// Initialise
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('latinText').innerHTML = generateLatinHTML();

    // Load saved preferences
    loadPreferences();

    // Add click handlers to words
    document.querySelectorAll('.word').forEach(word => {
        word.addEventListener('click', function(e) {
            e.stopPropagation();

            if (pointerModeActive) {
                // Toggle pointed class
                this.classList.toggle('pointed');
            } else {
                showVocabPopup(e, this.dataset.word);
            }
        });
    });

    // Hide popup when clicking elsewhere, clear pointer highlights on background click
    document.addEventListener('click', function(e) {
        if (!e.target.classList.contains('word')) {
            hidePopup();

            // If in pointer mode and clicking background (not buttons), clear all highlights
            if (pointerModeActive && !e.target.closest('.btn-group') && !e.target.closest('.sentence-nav')) {
                document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
            }
        }
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Escape to exit full screen
        if (e.key === 'Escape') {
            if (document.body.classList.contains('full-screen')) {
                document.body.classList.remove('full-screen');
                const btn = document.querySelector('.btn-group .btn:last-child');
                if (btn) {
                    btn.textContent = '‚õ∂ Full Screen';
                    btn.classList.remove('active');
                }
            }
            // Also exit pointer mode on escape
            if (pointerModeActive) {
                pointerModeActive = false;
                document.body.classList.remove('pointer-mode');
                document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
                document.querySelectorAll('.btn').forEach(btn => {
                    if (btn.textContent === 'Pointer Mode') btn.classList.remove('active');
                });
            }
        }

        // Arrow keys for sentence navigation
        if (sentenceModeActive) {
            if (e.key === 'ArrowLeft') {
                prevSentence();
            } else if (e.key === 'ArrowRight') {
                nextSentence();
            }
        }
    });
});

function loadPreferences() {
    // Dark mode
    if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
        setTimeout(() => {
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent.includes('Dark')) {
                    btn.textContent = '‚òÄÔ∏è Light';
                    btn.classList.add('active');
                }
            });
        }, 0);
    }

    // Line numbers
    if (localStorage.getItem('lineNumbers') === 'true') {
        document.getElementById('latinText').classList.add('show-lines');
        setTimeout(() => {
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent === 'Line Numbers') {
                    btn.classList.add('active');
                }
            });
        }, 0);
    }
}

function savePreference(key, value) {
    localStorage.setItem(key, value);
}
    </script>
</body>
</html>
