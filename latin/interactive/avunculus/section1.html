<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avunculus Meus - Section 1</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #ffffff;
            color: #333;
            padding: 25px 45px;
            min-height: 100vh;
            margin: 0;
            font-size: 22px;
        }

        .header {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .header-left {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .logo {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #0066ff 0%, #4d94ff 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.5rem;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            text-decoration: none;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-top: 2px;
        }

        .logo:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 102, 255, 0.3);
        }

        .title-area {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        h1 {
            color: #222;
            margin: 0;
            font-size: 1.6em;
            font-weight: 600;
        }

        .subtitle {
            font-size: 1em;
            color: #666;
            margin: 0;
        }

        /* Compact controls */
        .controls-area {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            gap: 4px;
        }

        .controls {
            display: flex;
            gap: 6px;
            justify-content: flex-end;
        }

        .controls button {
            padding: 0.6rem 1rem;
            font-size: 0.9rem;
            font-weight: 500;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: rgba(0, 102, 255, 0.08);
            color: #0066ff;
            flex: 1;
            text-align: center;
        }

        .controls button:hover {
            background: rgba(0, 102, 255, 0.15);
            transform: translateY(-1px);
        }

        #showAllBtn {
            background: #0066ff;
            color: white;
        }

        #showAllBtn:hover {
            background: #0052cc;
        }

        #hideAllBtn {
            background: rgba(0, 102, 255, 0.08);
            color: #0066ff;
        }

        #toggleColoursBtn {
            background: rgba(0, 102, 255, 0.08);
            color: #0066ff;
        }

        #toggleStyleBtn {
            background: rgba(0, 102, 255, 0.08);
            color: #0066ff;
        }

        body.style-mode #toggleStyleBtn {
            background: #0066ff;
            color: white;
        }

        /* Key - compact squares in header */
        .key {
            display: flex;
            gap: 6px;
        }

        .key-item {
            padding: 0.6rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            color: #333;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
            text-align: center;
            border: none;
            flex: 1;
        }

        .key-item:hover {
            transform: translateY(-1px);
            filter: brightness(0.95);
        }

        .key-item.active {
            outline: 2px solid #333;
            outline-offset: 1px;
        }

        /* Main content area */
        .translation-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 60px;
        }

        .column-header {
            font-size: 0.9em;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 15px;
            padding-left: 0;
        }

        /* Each line row */
        .line-row {
            display: flex;
            align-items: flex-end;
            margin-bottom: 14px;
            flex-wrap: wrap;
        }

        .line-number {
            display: none;
            color: #0066ff;
            font-weight: bold;
            min-width: 45px;
            margin-right: 10px;
            font-size: 1.15em;
            align-self: flex-end;
            padding-bottom: 4px;
        }

        .words-container {
            display: flex;
            align-items: flex-end;
            gap: 3px;
            flex-wrap: wrap;
        }

        /* Word group with number above */
        .word-group {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }

        .word-order {
            font-size: 0.65em;
            color: #888;
            margin-bottom: 4px;
            height: 1em;
            font-weight: 600;
        }

        .latin-word, .english-word {
            padding: 3px 7px;
            border-radius: 3px;
            font-size: 1em;
            transition: background-color 0.3s, opacity 0.3s;
            cursor: pointer;
        }

        .latin-word {
            background-color: transparent;
        }

        .english-word {
            opacity: 0;
        }

        .english-word.revealed {
            opacity: 1;
        }

        /* Colours */
        .subject .latin-word { background-color: #ffb3b3; }
        .english-word.subject { background-color: #ffb3b3; }

        .verb .latin-word { background-color: #b3e6ff; }
        .english-word.verb { background-color: #b3e6ff; }

        .object .latin-word { background-color: #b3ffcc; }
        .english-word.object { background-color: #b3ffcc; }

        .genitive .latin-word { background-color: #ffd9b3; }
        .english-word.genitive { background-color: #ffd9b3; }

        .dative .latin-word { background-color: #e6b3ff; }
        .english-word.dative { background-color: #e6b3ff; }

        .ablative .latin-word { background-color: #ffffb3; }
        .english-word.ablative { background-color: #ffffb3; }

        .preposition .latin-word { background-color: #ffb3e6; }
        .english-word.preposition { background-color: #ffb3e6; }

        .conjunction .latin-word { background-color: #d9ffb3; }
        .english-word.conjunction { background-color: #d9ffb3; }

        .adverb .latin-word { background-color: #ccb3ff; }
        .english-word.adverb { background-color: #ccb3ff; }

        .gerundive .latin-word { background-color: #ffcbb3; }
        .english-word.gerundive { background-color: #ffcbb3; }

        /* Highlighting */
        .subject.highlighted .latin-word { background-color: #ffb3b3 !important; }
        .english-word.subject.highlighted { background-color: #ffb3b3 !important; }
        .verb.highlighted .latin-word { background-color: #b3e6ff !important; }
        .english-word.verb.highlighted { background-color: #b3e6ff !important; }
        .object.highlighted .latin-word { background-color: #b3ffcc !important; }
        .english-word.object.highlighted { background-color: #b3ffcc !important; }
        .genitive.highlighted .latin-word { background-color: #ffd9b3 !important; }
        .english-word.genitive.highlighted { background-color: #ffd9b3 !important; }
        .dative.highlighted .latin-word { background-color: #e6b3ff !important; }
        .english-word.dative.highlighted { background-color: #e6b3ff !important; }
        .ablative.highlighted .latin-word { background-color: #ffffb3 !important; }
        .english-word.ablative.highlighted { background-color: #ffffb3 !important; }
        .preposition.highlighted .latin-word { background-color: #ffb3e6 !important; }
        .english-word.preposition.highlighted { background-color: #ffb3e6 !important; }
        .conjunction.highlighted .latin-word { background-color: #d9ffb3 !important; }
        .english-word.conjunction.highlighted { background-color: #d9ffb3 !important; }
        .adverb.highlighted .latin-word { background-color: #ccb3ff !important; }
        .english-word.adverb.highlighted { background-color: #ccb3ff !important; }
        .gerundive.highlighted .latin-word { background-color: #ffcbb3 !important; }
        .english-word.gerundive.highlighted { background-color: #ffcbb3 !important; }

        /* Hide colours mode */
        body.hide-colours .subject .latin-word,
        body.hide-colours .english-word.subject.revealed,
        body.hide-colours .verb .latin-word,
        body.hide-colours .english-word.verb.revealed,
        body.hide-colours .object .latin-word,
        body.hide-colours .english-word.object.revealed,
        body.hide-colours .genitive .latin-word,
        body.hide-colours .english-word.genitive.revealed,
        body.hide-colours .dative .latin-word,
        body.hide-colours .english-word.dative.revealed,
        body.hide-colours .ablative .latin-word,
        body.hide-colours .english-word.ablative.revealed,
        body.hide-colours .preposition .latin-word,
        body.hide-colours .english-word.preposition.revealed,
        body.hide-colours .conjunction .latin-word,
        body.hide-colours .english-word.conjunction.revealed,
        body.hide-colours .adverb .latin-word,
        body.hide-colours .english-word.adverb.revealed,
        body.hide-colours .gerundive .latin-word,
        body.hide-colours .english-word.gerundive.revealed {
            background-color: #e0e0e0;
        }

        /* Style Mode */
        .style-highlight {
            position: relative;
        }

        .style-highlight.active-style .latin-word {
            outline: 2px solid #333;
            outline-offset: 1px;
        }

        /* Style panel at bottom */
        .style-panel {
            display: none;
            background: rgba(0, 102, 255, 0.03);
            border-top: 2px solid rgba(0, 102, 255, 0.15);
            padding: 18px 24px;
            margin-top: 20px;
        }

        body.style-mode .style-panel {
            display: block;
        }

        .style-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .style-panel h3 {
            margin: 0;
            color: #0066ff;
            font-size: 1rem;
            font-weight: 600;
        }

        .style-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .style-tag {
            padding: 8px 14px;
            background: white;
            border: 1px solid rgba(0, 102, 255, 0.25);
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #333;
        }

        .style-tag:hover {
            border-color: #0066ff;
            background: rgba(0, 102, 255, 0.05);
        }

        .style-tag.active {
            background: #0066ff;
            color: white;
            border-color: #0066ff;
        }

        .style-tag em {
            font-style: italic;
        }

        .style-analysis {
            display: none;
            padding: 16px 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid rgba(0, 102, 255, 0.15);
        }

        .style-analysis.active {
            display: block;
        }

        .style-analysis-title {
            font-weight: 600;
            color: #0066ff;
            margin-bottom: 6px;
            font-size: 1rem;
        }

        .style-analysis-lines {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }

        .style-analysis-effect {
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .style-analysis-effect strong {
            color: #0066ff;
        }

        .style-analysis-exam {
            padding-top: 12px;
            border-top: 1px dashed #ddd;
            font-size: 0.9rem;
            color: #555;
            line-height: 1.5;
        }

        .style-analysis-exam strong {
            color: #333;
        }

        .style-analysis em {
            font-style: italic;
        }

        /* ===== ANALYSIS MODE ===== */
        #analyseBtn {
            background: linear-gradient(135deg, #0066ff 0%, #4d94ff 100%);
            color: white;
        }

        #analyseBtn:hover {
            background: linear-gradient(135deg, #0052cc 0%, #3d85e0 100%);
        }

        .analysis-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #fff;
            z-index: 1000;
            flex-direction: column;
        }

        .analysis-overlay.active {
            display: flex;
        }

        .analysis-overlay .english-word {
            opacity: 1;
        }

        /* Top toolbar */
        .analysis-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 20px;
            border-bottom: 1px solid #eee;
            background: #fff;
            z-index: 20;
            flex-shrink: 0;
        }

        .analysis-toolbar-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .analysis-btn {
            padding: 6px 14px;
            font-size: 0.85rem;
            font-weight: 500;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s ease;
            background: rgba(0, 102, 255, 0.08);
            color: #0066ff;
            font-family: inherit;
        }

        .analysis-btn:hover {
            background: rgba(0, 102, 255, 0.15);
        }

        .analysis-btn.active {
            background: #0066ff;
            color: white;
        }

        .analysis-btn.back-btn {
            background: #f0f0f0;
            color: #333;
        }

        .analysis-btn.back-btn:hover {
            background: #e0e0e0;
        }

        .analysis-nav-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #333;
            min-width: 140px;
            text-align: center;
        }

        .save-indicator {
            font-size: 0.8rem;
            color: #4caf50;
            font-weight: 500;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .save-indicator.visible {
            opacity: 1;
        }

        /* Drawing tools bar */
        .analysis-tools-bar {
            display: flex;
            align-items: center;
            padding: 8px 20px;
            gap: 6px;
            border-bottom: 1px solid #eee;
            background: #fafafa;
            flex-shrink: 0;
            z-index: 20;
            flex-wrap: wrap;
        }

        .tool-group {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .tool-divider {
            width: 1px;
            height: 22px;
            background: #ddd;
            margin: 0 8px;
        }

        .color-swatch {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.15s;
        }

        .color-swatch:hover {
            transform: scale(1.1);
        }

        .color-swatch.active {
            border-color: #333;
            box-shadow: 0 0 0 2px #fff, 0 0 0 4px #333;
        }

        .size-btn {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            background: white;
            transition: all 0.15s;
            font-family: inherit;
        }

        .size-btn:hover {
            background: #f0f0f0;
        }

        .size-btn.active {
            background: #333;
            color: white;
            border-color: #333;
        }

        /* Analysis key */
        .analysis-key {
            display: flex;
            gap: 4px;
            margin-left: auto;
        }

        .analysis-key-item {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 500;
            color: #555;
        }

        /* Workspace */
        .analysis-workspace {
            flex: 1;
            position: relative;
            overflow: hidden;
            min-height: 0;
            background-image: radial-gradient(circle, #e8e8e8 1px, transparent 1px);
            background-size: 30px 30px;
        }

        .analysis-sentence-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 5;
            pointer-events: none;
            max-width: 80%;
        }

        .analysis-latin-line {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            justify-content: center;
            margin-bottom: 24px;
        }

        .analysis-english-line {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            justify-content: center;
            padding-top: 20px;
            border-top: 1px dashed #ccc;
        }

        .analysis-sentence-display .word-group {
            cursor: default;
        }

        .analysis-sentence-display .word-order {
            display: none;
        }

        .analysis-sentence-display .latin-word {
            font-size: 1.4em;
            padding: 5px 12px;
            border-radius: 4px;
        }

        .analysis-sentence-display .english-word {
            font-size: 1.2em;
            padding: 4px 10px;
            border-radius: 4px;
        }

        #analysisCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            cursor: crosshair;
        }

        #analysisCanvas.eraser-mode {
            cursor: cell;
        }

        #analysisCanvas.pointer-mode {
            pointer-events: none;
            cursor: default;
        }

        /* Notes panel */
        .analysis-notes {
            border-top: 2px solid #eee;
            background: #fafafa;
            flex-shrink: 0;
            z-index: 20;
        }

        .analysis-notes-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 20px;
            cursor: pointer;
            user-select: none;
        }

        .analysis-notes-toggle:hover {
            background: #f0f0f0;
        }

        .analysis-notes-toggle h4 {
            margin: 0;
            font-size: 0.85rem;
            color: #666;
            font-weight: 500;
        }

        .analysis-notes-toggle .toggle-arrow {
            font-size: 0.8rem;
            color: #999;
            transition: transform 0.2s;
        }

        .analysis-notes.open .toggle-arrow {
            transform: rotate(180deg);
        }

        .analysis-notes-body {
            display: none;
            padding: 0 20px 12px;
        }

        .analysis-notes.open .analysis-notes-body {
            display: block;
        }

        #analysisNotesText {
            width: 100%;
            height: 80px;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 10px 12px;
            font-family: inherit;
            font-size: 0.9rem;
            resize: vertical;
            outline: none;
            line-height: 1.5;
        }

        #analysisNotesText:focus {
            border-color: #0066ff;
            box-shadow: 0 0 0 2px rgba(0, 102, 255, 0.1);
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-top">
            <div class="header-left">
                <a href="https://www.classicalia.co.uk" class="logo">C</a>
                <div class="title-area">
                    <h1>Avunculus Meus</h1>
                    <p class="subtitle">Section 1: The uncle's daily routine</p>
                </div>
            </div>
            <div class="controls-area">
                <div class="controls">
                    <button id="showAllBtn">Show All</button>
                    <button id="hideAllBtn">Hide All</button>
                    <button id="toggleColoursBtn">Hide Colours</button>
                    <button id="toggleStyleBtn">Style Notes</button>
                    <button id="analyseBtn">Analyse</button>
                </div>
                <div class="key">
                    <span class="key-item" data-category="subject" style="background-color: #ffb3b3;">Subj.</span>
                    <span class="key-item" data-category="object" style="background-color: #b3ffcc;">Obj.</span>
                    <span class="key-item" data-category="verb" style="background-color: #b3e6ff;">Verb</span>
                    <span class="key-item" data-category="genitive" style="background-color: #ffd9b3;">Gen.</span>
                    <span class="key-item" data-category="dative" style="background-color: #e6b3ff;">Dat.</span>
                    <span class="key-item" data-category="ablative" style="background-color: #ffffb3;">Abl.</span>
                    <span class="key-item" data-category="preposition" style="background-color: #ffb3e6;">Prep.</span>
                    <span class="key-item" data-category="conjunction" style="background-color: #d9ffb3;">Conj.</span>
                    <span class="key-item" data-category="adverb" style="background-color: #ccb3ff;">Adv.</span>
                </div>
            </div>
        </div>
    </div>

    <div class="translation-area">
        <!-- LATIN COLUMN -->
        <div class="latin-column">
            <div class="column-header">Latin</div>

            <!-- Sentence 1: ante lucem ibat ad Vespasianum imperatorem -->
            <div class="line-row" data-line="1">
                <span class="line-number">1</span>
                <div class="words-container">
                    <span class="word-group preposition style-highlight" data-order="01-01" data-style-feature="fire-dedication"><span class="word-order">1</span><span class="latin-word">ante</span></span>
                    <span class="word-group object style-highlight" data-order="01-02" data-style-feature="fire-dedication"><span class="word-order">2</span><span class="latin-word">lucem</span></span>
                    <span class="word-group verb style-highlight" data-order="01-03" data-style-feature="habitual-imperfects"><span class="word-order">3</span><span class="latin-word">ibat</span></span>
                    <span class="word-group preposition" data-order="01-04"><span class="word-order">4</span><span class="latin-word">ad</span></span>
                    <span class="word-group object" data-order="01-05"><span class="word-order">5</span><span class="latin-word">imperatorem</span></span>
                    <span class="word-group object" data-order="01-06"><span class="word-order">6</span><span class="latin-word">Vespasianum</span></span>
                </div>
            </div>

            <!-- Sentence 1b: (nam ille quoque noctibus utebatur), -->
            <div class="line-row" data-line="1b">
                <span class="line-number"></span>
                <div class="words-container">
                    <span class="word-group conjunction style-highlight" data-order="1b-01" data-style-feature="parenthetical-asides"><span class="word-order">1</span><span class="latin-word">(nam</span></span>
                    <span class="word-group subject style-highlight" data-order="1b-02" data-style-feature="parenthetical-asides"><span class="word-order">2</span><span class="latin-word">ille</span></span>
                    <span class="word-group adverb style-highlight" data-order="1b-03" data-style-feature="parenthetical-asides"><span class="word-order">3</span><span class="latin-word">quoque</span></span>
                    <span class="word-group verb style-highlight" data-order="1b-04" data-style-feature="parenthetical-asides fire-dedication"><span class="word-order">4</span><span class="latin-word">utebatur</span></span>
                    <span class="word-group ablative style-highlight" data-order="1b-05" data-style-feature="parenthetical-asides fire-dedication"><span class="word-order">5</span><span class="latin-word">noctibus),</span></span>
                </div>
            </div>

            <!-- Sentence 1c: deinde ad officium sibi delegatum. -->
            <div class="line-row" data-line="1c">
                <span class="line-number"></span>
                <div class="words-container">
                    <span class="word-group adverb" data-order="1c-01"><span class="word-order">1</span><span class="latin-word">deinde</span></span>
                    <span class="word-group preposition" data-order="1c-02"><span class="word-order">2</span><span class="latin-word">ad</span></span>
                    <span class="word-group object" data-order="1c-03"><span class="word-order">3</span><span class="latin-word">officium</span></span>
                    <span class="word-group object" data-order="1c-04"><span class="word-order">4</span><span class="latin-word">delegatum</span></span>
                    <span class="word-group dative" data-order="1c-05"><span class="word-order">5</span><span class="latin-word">sibi.</span></span>
                </div>
            </div>

            <!-- Sentence 2: reversus domum reliquum tempus studiis dabat. -->
            <div class="line-row" data-line="2">
                <span class="line-number">2</span>
                <div class="words-container">
                    <span class="word-group verb" data-order="02-01"><span class="word-order">1</span><span class="latin-word">reversus</span></span>
                    <span class="word-group object" data-order="02-02"><span class="word-order">2</span><span class="latin-word">domum</span></span>
                    <span class="word-group verb style-highlight" data-order="02-03" data-style-feature="habitual-imperfects"><span class="word-order">3</span><span class="latin-word">dabat</span></span>
                    <span class="word-group object" data-order="02-04"><span class="word-order">4</span><span class="latin-word">reliquum</span></span>
                    <span class="word-group object" data-order="02-05"><span class="word-order">5</span><span class="latin-word">tempus</span></span>
                    <span class="word-group dative" data-order="02-06"><span class="word-order">6</span><span class="latin-word">studiis.</span></span>
                </div>
            </div>

            <!-- Sentence 3: saepe post cibum (qui veterum more interdiu levis et facilis erat) aestate, si quid otii erat, iacebat in sole, liber legebatur, adnotabat excerpebatque. -->
            <div class="line-row" data-line="3">
                <span class="line-number">3</span>
                <div class="words-container">
                    <span class="word-group adverb" data-order="03-01"><span class="word-order">1</span><span class="latin-word">saepe</span></span>
                    <span class="word-group preposition" data-order="03-02"><span class="word-order">2</span><span class="latin-word">post</span></span>
                    <span class="word-group object" data-order="03-03"><span class="word-order">3</span><span class="latin-word">cibum</span></span>
                    <span class="word-group subject" data-order="03-04"><span class="word-order">4</span><span class="latin-word">(qui</span></span>
                    <span class="word-group ablative" data-order="03-05"><span class="word-order">5</span><span class="latin-word">more</span></span>
                    <span class="word-group genitive" data-order="03-06"><span class="word-order">6</span><span class="latin-word">veterum</span></span>
                    <span class="word-group adverb" data-order="03-07"><span class="word-order">7</span><span class="latin-word">interdiu</span></span>
                    <span class="word-group verb" data-order="03-08"><span class="word-order">8</span><span class="latin-word">erat</span></span>
                    <span class="word-group subject" data-order="03-09"><span class="word-order">9</span><span class="latin-word">levis</span></span>
                    <span class="word-group conjunction" data-order="03-10"><span class="word-order">10</span><span class="latin-word">et</span></span>
                    <span class="word-group subject" data-order="03-11"><span class="word-order">11</span><span class="latin-word">facilis)</span></span>
                    <span class="word-group ablative" data-order="03-12"><span class="word-order">12</span><span class="latin-word">aestate,</span></span>
                    <span class="word-group conjunction" data-order="03-13"><span class="word-order">13</span><span class="latin-word">si</span></span>
                    <span class="word-group verb" data-order="03-14"><span class="word-order">14</span><span class="latin-word">erat</span></span>
                    <span class="word-group subject" data-order="03-15"><span class="word-order">15</span><span class="latin-word">quid</span></span>
                    <span class="word-group genitive" data-order="03-16"><span class="word-order">16</span><span class="latin-word">otii,</span></span>
                    <span class="word-group verb style-highlight" data-order="03-17" data-style-feature="habitual-imperfects"><span class="word-order">17</span><span class="latin-word">iacebat</span></span>
                    <span class="word-group preposition" data-order="03-18"><span class="word-order">18</span><span class="latin-word">in</span></span>
                    <span class="word-group ablative" data-order="03-19"><span class="word-order">19</span><span class="latin-word">sole,</span></span>
                    <span class="word-group subject" data-order="03-20"><span class="word-order">20</span><span class="latin-word">liber</span></span>
                    <span class="word-group verb" data-order="03-21"><span class="word-order">21</span><span class="latin-word">legebatur,</span></span>
                    <span class="word-group verb style-highlight" data-order="03-22" data-style-feature="asyndeton"><span class="word-order">22</span><span class="latin-word">adnotabat</span></span>
                    <span class="word-group conjunction" data-order="03-23"><span class="word-order">23</span><span class="latin-word"></span></span>
                    <span class="word-group verb style-highlight" data-order="03-24" data-style-feature="asyndeton"><span class="word-order">24</span><span class="latin-word">excerpebatque.</span></span>
                </div>
            </div>

            <!-- Sentence 4: nihil enim legit quod non excerperet; -->
            <div class="line-row" data-line="4">
                <span class="line-number">4</span>
                <div class="words-container">
                    <span class="word-group conjunction" data-order="04-01"><span class="word-order">1</span><span class="latin-word">enim</span></span>
                    <span class="word-group verb" data-order="04-02"><span class="word-order">2</span><span class="latin-word">legit</span></span>
                    <span class="word-group object style-highlight" data-order="04-03" data-style-feature="litotes"><span class="word-order">3</span><span class="latin-word">nihil</span></span>
                    <span class="word-group conjunction" data-order="04-04"><span class="word-order">4</span><span class="latin-word">quod</span></span>
                    <span class="word-group adverb style-highlight" data-order="04-05" data-style-feature="litotes"><span class="word-order">5</span><span class="latin-word">non</span></span>
                    <span class="word-group verb style-highlight" data-order="04-06" data-style-feature="litotes"><span class="word-order">6</span><span class="latin-word">excerperet;</span></span>
                </div>
            </div>

            <!-- Sentence 4b: dicere etiam solebat nullum librum esse tam malum ut non aliqua parte prodesset. -->
            <div class="line-row" data-line="4b">
                <span class="line-number"></span>
                <div class="words-container">
                    <span class="word-group adverb" data-order="4b-01"><span class="word-order">1</span><span class="latin-word">etiam</span></span>
                    <span class="word-group verb" data-order="4b-02"><span class="word-order">2</span><span class="latin-word">solebat</span></span>
                    <span class="word-group verb" data-order="4b-03"><span class="word-order">3</span><span class="latin-word">dicere</span></span>
                    <span class="word-group object style-highlight" data-order="4b-04" data-style-feature="sententia"><span class="word-order">4</span><span class="latin-word">nullum</span></span>
                    <span class="word-group object style-highlight" data-order="4b-05" data-style-feature="sententia"><span class="word-order">5</span><span class="latin-word">librum</span></span>
                    <span class="word-group verb" data-order="4b-06"><span class="word-order">6</span><span class="latin-word">esse</span></span>
                    <span class="word-group adverb style-highlight" data-order="4b-07" data-style-feature="sententia"><span class="word-order">7</span><span class="latin-word">tam</span></span>
                    <span class="word-group object style-highlight" data-order="4b-08" data-style-feature="sententia"><span class="word-order">8</span><span class="latin-word">malum</span></span>
                    <span class="word-group conjunction" data-order="4b-09"><span class="word-order">9</span><span class="latin-word">ut</span></span>
                    <span class="word-group adverb" data-order="4b-10"><span class="word-order">10</span><span class="latin-word">non</span></span>
                    <span class="word-group verb style-highlight" data-order="4b-11" data-style-feature="sententia"><span class="word-order">11</span><span class="latin-word">prodesset</span></span>
                    <span class="word-group ablative" data-order="4b-12"><span class="word-order">12</span><span class="latin-word">aliqua</span></span>
                    <span class="word-group ablative" data-order="4b-13"><span class="word-order">13</span><span class="latin-word">parte.</span></span>
                </div>
            </div>

            <!-- Sentence 5: post solem plerumque aqua frigida lavabatur, deinde gustabat dormiebatque minimum; -->
            <div class="line-row" data-line="5">
                <span class="line-number">5</span>
                <div class="words-container">
                    <span class="word-group preposition" data-order="05-01"><span class="word-order">1</span><span class="latin-word">post</span></span>
                    <span class="word-group object" data-order="05-02"><span class="word-order">2</span><span class="latin-word">solem</span></span>
                    <span class="word-group adverb" data-order="05-03"><span class="word-order">3</span><span class="latin-word">plerumque</span></span>
                    <span class="word-group verb" data-order="05-04"><span class="word-order">4</span><span class="latin-word">lavabatur</span></span>
                    <span class="word-group ablative" data-order="05-05"><span class="word-order">5</span><span class="latin-word">frigida</span></span>
                    <span class="word-group ablative" data-order="05-06"><span class="word-order">6</span><span class="latin-word">aqua,</span></span>
                    <span class="word-group adverb" data-order="05-07"><span class="word-order">7</span><span class="latin-word">deinde</span></span>
                    <span class="word-group verb" data-order="05-08"><span class="word-order">8</span><span class="latin-word">gustabat</span></span>
                    <span class="word-group conjunction" data-order="05-09"><span class="word-order">9</span><span class="latin-word"></span></span>
                    <span class="word-group verb" data-order="05-10"><span class="word-order">10</span><span class="latin-word">dormiebatque</span></span>
                    <span class="word-group adverb" data-order="05-11"><span class="word-order">11</span><span class="latin-word">minimum;</span></span>
                </div>
            </div>

            <!-- Sentence 6: mox quasi alio die studebat in cenae tempus. -->
            <div class="line-row" data-line="6">
                <span class="line-number">6</span>
                <div class="words-container">
                    <span class="word-group adverb" data-order="06-01"><span class="word-order">1</span><span class="latin-word">mox</span></span>
                    <span class="word-group adverb style-highlight" data-order="06-02" data-style-feature="simile"><span class="word-order">2</span><span class="latin-word">quasi</span></span>
                    <span class="word-group ablative style-highlight" data-order="06-03" data-style-feature="simile"><span class="word-order">3</span><span class="latin-word">alio</span></span>
                    <span class="word-group ablative style-highlight" data-order="06-04" data-style-feature="simile"><span class="word-order">4</span><span class="latin-word">die</span></span>
                    <span class="word-group verb" data-order="06-05"><span class="word-order">5</span><span class="latin-word">studebat</span></span>
                    <span class="word-group preposition" data-order="06-06"><span class="word-order">6</span><span class="latin-word">in</span></span>
                    <span class="word-group object" data-order="06-07"><span class="word-order">7</span><span class="latin-word">tempus</span></span>
                    <span class="word-group genitive" data-order="06-08"><span class="word-order">8</span><span class="latin-word">cenae.</span></span>
                </div>
            </div>

            <!-- Sentence 7: super cenam liber legebatur adnotabatur, et quidem cursim. -->
            <div class="line-row" data-line="7">
                <span class="line-number">7</span>
                <div class="words-container">
                    <span class="word-group preposition" data-order="07-01"><span class="word-order">1</span><span class="latin-word">super</span></span>
                    <span class="word-group object" data-order="07-02"><span class="word-order">2</span><span class="latin-word">cenam</span></span>
                    <span class="word-group subject" data-order="07-03"><span class="word-order">3</span><span class="latin-word">liber</span></span>
                    <span class="word-group verb style-highlight" data-order="07-04" data-style-feature="asyndeton"><span class="word-order">4</span><span class="latin-word">legebatur</span></span>
                    <span class="word-group verb style-highlight" data-order="07-05" data-style-feature="asyndeton"><span class="word-order">5</span><span class="latin-word">adnotabatur,</span></span>
                    <span class="word-group conjunction style-highlight" data-order="07-06" data-style-feature="emphatic-closure"><span class="word-order">6</span><span class="latin-word">et</span></span>
                    <span class="word-group adverb style-highlight" data-order="07-07" data-style-feature="emphatic-closure"><span class="word-order">7</span><span class="latin-word">cursim</span></span>
                    <span class="word-group adverb style-highlight" data-order="07-08" data-style-feature="emphatic-closure"><span class="word-order">8</span><span class="latin-word">quidem.</span></span>
                </div>
            </div>
        </div>

        <!-- ENGLISH COLUMN -->
        <div class="english-column">
            <div class="column-header">English</div>

            <!-- Sentence 1 English -->
            <div class="line-row" data-line="1">
                <span class="line-number">1</span>
                <div class="words-container">
                    <span class="word-group"><span class="word-order"></span><span class="english-word preposition" data-order="01-01">Before</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="01-02">dawn</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="01-03">he used to go</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word preposition" data-order="01-04">to</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="01-05">the emperor</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="01-06">Vespasian</span></span>
                </div>
            </div>

            <!-- Sentence 1b English -->
            <div class="line-row" data-line="1b">
                <span class="line-number"></span>
                <div class="words-container">
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="1b-01">(for</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="1b-02">he</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="1b-03">also</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="1b-04">used</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word ablative" data-order="1b-05">the nights),</span></span>
                </div>
            </div>

            <!-- Sentence 1c English -->
            <div class="line-row" data-line="1c">
                <span class="line-number"></span>
                <div class="words-container">
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="1c-01">then</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word preposition" data-order="1c-02">to</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="1c-03">the duty</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="1c-04">assigned</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word dative" data-order="1c-05">to him.</span></span>
                </div>
            </div>

            <!-- Sentence 2 English -->
            <div class="line-row" data-line="2">
                <span class="line-number">2</span>
                <div class="words-container">
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="02-01">Having returned</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="02-02">home,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="02-03">he gave</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="02-04">the remaining</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="02-05">time</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word dative" data-order="02-06">to his studies.</span></span>
                </div>
            </div>

            <!-- Sentence 3 English -->
            <div class="line-row" data-line="3">
                <span class="line-number">3</span>
                <div class="words-container">
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="03-01">Often</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word preposition" data-order="03-02">after</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="03-03">food</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="03-04">(which</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word ablative" data-order="03-05">in the custom</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word genitive" data-order="03-06">of the ancients</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="03-07">during the day</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="03-08">was</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="03-09">light</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="03-10">and</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="03-11">easy)</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word ablative" data-order="03-12">in summer,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="03-13">if</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="03-14">there was</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="03-15">any</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word genitive" data-order="03-16">leisure,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="03-17">he would lie</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word preposition" data-order="03-18">in</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word ablative" data-order="03-19">the sun,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="03-20">a book</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="03-21">was being read,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="03-22">he would note</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="03-23">and</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="03-24">take extracts.</span></span>
                </div>
            </div>

            <!-- Sentence 4 English -->
            <div class="line-row" data-line="4">
                <span class="line-number">4</span>
                <div class="words-container">
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="04-01">For</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="04-02">he read</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="04-03">nothing</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="04-04">from which</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="04-05">not</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="04-06">he would extract;</span></span>
                </div>
            </div>

            <!-- Sentence 4b English -->
            <div class="line-row" data-line="4b">
                <span class="line-number"></span>
                <div class="words-container">
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="4b-01">indeed</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="4b-02">he used to</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="4b-03">say</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="4b-04">no</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="4b-05">book</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="4b-06">was</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="4b-07">so</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="4b-08">bad</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="4b-09">that</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="4b-10">not</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="4b-11">would it be useful</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word ablative" data-order="4b-12">in some</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word ablative" data-order="4b-13">part.</span></span>
                </div>
            </div>

            <!-- Sentence 5 English -->
            <div class="line-row" data-line="5">
                <span class="line-number">5</span>
                <div class="words-container">
                    <span class="word-group"><span class="word-order"></span><span class="english-word preposition" data-order="05-01">After</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="05-02">sunbathing</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="05-03">usually</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="05-04">he bathed</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word ablative" data-order="05-05">in cold</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word ablative" data-order="05-06">water,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="05-07">then</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="05-08">he snacked</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="05-09">and</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="05-10">slept</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="05-11">very little;</span></span>
                </div>
            </div>

            <!-- Sentence 6 English -->
            <div class="line-row" data-line="6">
                <span class="line-number">6</span>
                <div class="words-container">
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="06-01">Soon</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="06-02">as if</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word ablative" data-order="06-03">on another</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word ablative" data-order="06-04">day</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="06-05">he studied</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word preposition" data-order="06-06">until</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="06-07">dinner</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word genitive" data-order="06-08">time.</span></span>
                </div>
            </div>

            <!-- Sentence 7 English -->
            <div class="line-row" data-line="7">
                <span class="line-number">7</span>
                <div class="words-container">
                    <span class="word-group"><span class="word-order"></span><span class="english-word preposition" data-order="07-01">Over</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word object" data-order="07-02">dinner</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word subject" data-order="07-03">a book</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="07-04">was read</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word verb" data-order="07-05">and noted,</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word conjunction" data-order="07-06">and</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="07-07">hastily</span></span>
                    <span class="word-group"><span class="word-order"></span><span class="english-word adverb" data-order="07-08">indeed.</span></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Style Panel -->
    <div class="style-panel">
        <div class="style-panel-header">
            <h3>Stylistic Features</h3>
        </div>
        <div class="style-list">
            <span class="style-tag" data-feature="fire-dedication">Temporal Extremes  <em>ante lucem... noctibus utebatur</em></span>
            <span class="style-tag" data-feature="habitual-imperfects">Habitual Imperfects  <em>ibat... dabat... iacebat</em></span>
            <span class="style-tag" data-feature="parenthetical-asides">Parenthetical Aside  <em>nam ille quoque noctibus utebatur</em></span>
            <span class="style-tag" data-feature="simile">Simile  <em>quasi alio die</em></span>
            <span class="style-tag" data-feature="litotes">Litotes  <em>nihil... quod non excerperet</em></span>
            <span class="style-tag" data-feature="sententia">Sententia  <em>nullum librum... tam malum</em></span>
            <span class="style-tag" data-feature="asyndeton">Asyndeton  <em>adnotabat excerpebatque</em></span>
            <span class="style-tag" data-feature="emphatic-closure">Emphatic Closure  <em>et quidem cursim</em></span>
        </div>

        <div class="style-analysis" id="analysis-fire-dedication">
            <div class="style-analysis-title">Temporal Extremes  ante lucem... noctibus utebatur</div>
            <div class="style-analysis-lines">Lines 1</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> The passage opens with temporal extremes  before dawn and through the night. Pliny establishes his uncle's extraordinary dedication by contrasting <em>ante lucem</em> ('before dawn') with Vespasian's use of the nights (<em>noctibus utebatur</em>). The implication is that both men's working hours consumed the entire 24-hour cycle. This isn't just early rising  it's a world in which darkness is no barrier to activity, and rest is the exception rather than the rule.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "The temporal markers <em>ante lucem</em> and <em>noctibus</em> create a portrait of relentless activity spanning both day and night. Pliny implies his uncle matched the emperor's extraordinary work ethic, establishing from the very first words a character defined by total dedication to duty."
            </div>
        </div>

        <div class="style-analysis" id="analysis-habitual-imperfects">
            <div class="style-analysis-title">Habitual Imperfects  ibat... dabat... iacebat</div>
            <div class="style-analysis-lines">Lines 1-3</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> The sustained use of imperfect tense verbs throughout  <em>ibat</em> ('he used to go'), <em>dabat</em> ('he gave'), <em>iacebat</em> ('he lay')  establishes the uncle's daily routine as habitual and unchanging. This is not a single remarkable day but <em>every</em> day. The imperfect's inherent sense of repeated action creates a powerful impression of relentless consistency, painting the uncle as a man whose entire existence was structured around the same unwavering dedication.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "The sustained use of habitual imperfects (<em>ibat</em>, <em>dabat</em>, <em>iacebat</em>) characterises Pliny the Elder's routine as unvarying and disciplined. The imperfect tense emphasises the permanence of his scholarly dedication  this was not exceptional behaviour but his standard mode of existence."
            </div>
        </div>

        <div class="style-analysis" id="analysis-parenthetical-asides">
            <div class="style-analysis-title">Parenthetical Aside  nam ille quoque noctibus utebatur</div>
            <div class="style-analysis-lines">Line 1</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> Pliny interrupts his main narrative with an explanatory comment in parentheses. The aside <em>(nam ille quoque noctibus utebatur)</em> breaks the narrative flow to provide background information, creating an intimate, conversational tone typical of Roman epistolary writing. It also adds legitimacy to the uncle's early schedule by showing the emperor shared similar habits. The word <em>quoque</em> ('also') is key  it implies the uncle was <em>keeping up with</em> the emperor, not being eccentric.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "The parenthetical remark demonstrates Pliny's epistolary style whilst validating his uncle's extreme schedule  if the emperor himself worked through the night, the uncle's pre-dawn visits become a mark of dutiful attendance rather than mere eccentricity. The aside creates intimacy between writer and reader."
            </div>
        </div>

        <div class="style-analysis" id="analysis-simile">
            <div class="style-analysis-title">Simile  quasi alio die</div>
            <div class="style-analysis-lines">Line 6</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> The comparison <em>quasi alio die</em> ('as if on another day') transforms a brief nap into a complete renewal. After sleeping for the absolute minimum, the uncle approaches his afternoon studies with the energy of a fresh start, effectively doubling his working days. The simile captures something remarkable about his resilience  most people drag through an afternoon, but he <em>begins again</em> with the vigour of morning.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "The simile <em>quasi alio die</em> emphasises Pliny the Elder's extraordinary ability to renew his scholarly energy after minimal rest. The comparison effectively presents each day as containing two complete working periods, reinforcing the theme of maximised productivity."
            </div>
        </div>

        <div class="style-analysis" id="analysis-litotes">
            <div class="style-analysis-title">Litotes  nihil... quod non excerperet</div>
            <div class="style-analysis-lines">Line 4</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> The litotes <em>nihil...quod non excerperet</em> ('nothing which he would not extract from') makes an emphatic absolute claim through understatement. Rather than positively saying 'he noted everything', the double negative creates a stronger, more comprehensive assertion. It's a classic Latin rhetorical device  denying the negative carries more weight than simply asserting the positive, and it leaves no room for exceptions.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "The litotes <em>nihil...quod non</em> employs characteristic Latin understatement to create emphasis. The double negative is more forceful than a simple positive statement, conveying the uncle's absolute thoroughness  there existed no text, however poor, that escaped his systematic note-taking."
            </div>
        </div>

        <div class="style-analysis" id="analysis-sententia">
            <div class="style-analysis-title">Sententia  nullum librum esse tam malum ut non aliqua parte prodesset</div>
            <div class="style-analysis-lines">Line 4</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> The uncle's quoted belief reads like a <em>sententia</em>  one of those pithy, memorable Roman maxims designed to be carved in stone or quoted at dinner parties. The balanced structure with <em>tam malum</em> ('so bad') set against <em>aliqua parte prodesset</em> ('useful in some part') gives it the polished quality of a philosophical pronouncement, elevating a personal reading habit into universal wisdom. You can almost hear him saying this with absolute conviction.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "The reported saying functions as a <em>sententia</em>, a characteristic Roman maxim. Its balanced construction  <em>tam malum</em> ('so bad') contrasted with <em>aliqua parte prodesset</em> ('useful in some part')  gives it memorable, quotable quality, revealing the uncle's optimistic intellectual philosophy and his belief in the inherent value of all knowledge."
            </div>
        </div>

        <div class="style-analysis" id="analysis-asyndeton">
            <div class="style-analysis-title">Asyndeton  adnotabat excerpebatque... legebatur adnotabatur</div>
            <div class="style-analysis-lines">Lines 3, 7</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> The rapid succession of verbs  <em>adnotabat excerpebatque</em> in sentence 3 and <em>legebatur adnotabatur</em> in sentence 7  creates a breathless rhythm that mirrors the uncle's relentless scholarly activity. The minimal connectives suggest simultaneous, overlapping actions rather than a measured sequence. The text itself feels hurried, as if Pliny can barely keep up with listing everything his uncle did.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "The asyndeton in <em>adnotabat excerpebatque</em> and <em>legebatur adnotabatur</em> creates a rapid rhythm reflecting the uncle's ceaseless scholarly activity. The minimal connectives mirror the breathless pace of his routine, suggesting these actions were virtually simultaneous."
            </div>
        </div>

        <div class="style-analysis" id="analysis-emphatic-closure">
            <div class="style-analysis-title">Emphatic Closure  et quidem cursim</div>
            <div class="style-analysis-lines">Line 7</div>
            <div class="style-analysis-effect">
                <strong>What's happening:</strong> The closing detail <em>et quidem cursim</em> ('and indeed hastily') provides a vivid final image. Even during dinner reading  itself already remarkable  the pace was hurried. The emphatic <em>quidem</em> ('indeed') insists on this point, as if Pliny knows it sounds incredible but wants to assure the reader it's true. The uncle begrudged time spent on physical necessities and wanted to return to proper study as quickly as possible.
            </div>
            <div class="style-analysis-exam">
                <strong>In an exam:</strong> "The emphatic <em>quidem</em> with <em>cursim</em> provides a memorable closing detail. The acknowledgment that even dinner-time study was conducted hastily serves as a final, clinching illustration of the uncle's extraordinary relationship with time  not even meals could slow his scholarly pace."
            </div>
        </div>
    </div>

    <!-- Analysis Mode Overlay -->
    <div id="analysisOverlay" class="analysis-overlay">
        <!-- Toolbar -->
        <div class="analysis-toolbar">
            <div class="analysis-toolbar-section">
                <button class="analysis-btn back-btn" id="analysisBackBtn">Back</button>
                <button class="analysis-btn" id="analysisPrevBtn">&#9664;</button>
                <span class="analysis-nav-label" id="analysisNavLabel">Sentence 1 of 7</span>
                <button class="analysis-btn" id="analysisNextBtn">&#9654;</button>
            </div>
            <div class="analysis-toolbar-section">
                <button class="analysis-btn" id="analysisSaveBtn">Save</button>
                <span class="save-indicator" id="analysisSaveIndicator">Saved</span>
            </div>
        </div>

        <!-- Drawing tools -->
        <div class="analysis-tools-bar">
            <div class="tool-group">
                <button class="analysis-btn active" data-tool="pen" id="toolPen">Pen</button>
                <button class="analysis-btn" data-tool="eraser" id="toolEraser">Eraser</button>
                <button class="analysis-btn" data-tool="pointer" id="toolPointer">Pointer</button>
            </div>
            <span class="tool-divider"></span>
            <div class="tool-group">
                <span class="color-swatch active" data-color="#333333" style="background:#333333;" title="Black"></span>
                <span class="color-swatch" data-color="#e53935" style="background:#e53935;" title="Red"></span>
                <span class="color-swatch" data-color="#1e88e5" style="background:#1e88e5;" title="Blue"></span>
                <span class="color-swatch" data-color="#43a047" style="background:#43a047;" title="Green"></span>
                <span class="color-swatch" data-color="#fb8c00" style="background:#fb8c00;" title="Orange"></span>
            </div>
            <span class="tool-divider"></span>
            <div class="tool-group">
                <button class="size-btn" data-size="2" title="Fine">S</button>
                <button class="size-btn active" data-size="4" title="Medium">M</button>
                <button class="size-btn" data-size="8" title="Thick">L</button>
            </div>
            <span class="tool-divider"></span>
            <div class="tool-group">
                <button class="analysis-btn" id="undoBtn">Undo</button>
                <button class="analysis-btn" id="clearCanvasBtn">Clear</button>
            </div>
            <div class="analysis-key">
                <span class="analysis-key-item" style="background:#ffb3b3;">Subj</span>
                <span class="analysis-key-item" style="background:#b3ffcc;">Obj</span>
                <span class="analysis-key-item" style="background:#b3e6ff;">Verb</span>
                <span class="analysis-key-item" style="background:#ffd9b3;">Gen</span>
                <span class="analysis-key-item" style="background:#e6b3ff;">Dat</span>
                <span class="analysis-key-item" style="background:#ffffb3;">Abl</span>
                <span class="analysis-key-item" style="background:#ffb3e6;">Prep</span>
                <span class="analysis-key-item" style="background:#d9ffb3;">Conj</span>
                <span class="analysis-key-item" style="background:#ccb3ff;">Adv</span>
            </div>
        </div>

        <!-- Workspace -->
        <div class="analysis-workspace" id="analysisWorkspace">
            <div class="analysis-sentence-display" id="analysisSentenceDisplay">
                <div class="analysis-latin-line" id="analysisLatinLine"></div>
                <div class="analysis-english-line" id="analysisEnglishLine"></div>
            </div>
            <canvas id="analysisCanvas"></canvas>
        </div>

        <!-- Notes panel -->
        <div class="analysis-notes" id="analysisNotes">
            <div class="analysis-notes-toggle" id="analysisNotesToggle">
                <h4>Notes</h4>
                <span class="toggle-arrow">&#9650;</span>
            </div>
            <div class="analysis-notes-body">
                <textarea id="analysisNotesText" placeholder="Type your analysis notes here..."></textarea>
            </div>
        </div>
    </div>

    <div style="text-align: center; padding: 20px 0; margin-top: 10px;">
        <a href="section2.html" style="display: inline-block; padding: 10px 24px; background: #0066ff; color: white; text-decoration: none; border-radius: 8px; font-weight: 500; font-size: 0.95rem;">Section 2 </a>
    </div>

    <script>
        let currentStep = 0;
        let coloursHidden = false;
        const activeCategories = new Set();

        const wordOrders = [];
        document.querySelectorAll('.latin-column .word-group').forEach(group => {
            if (group.dataset.order) {
                wordOrders.push(group.dataset.order);
            }
        });
        wordOrders.sort((a, b) => {
            const [lineA, numA] = a.split('-');
            const [lineB, numB] = b.split('-');
            if (lineA !== lineB) return lineA.localeCompare(lineB);
            return parseInt(numA) - parseInt(numB);
        });

        function revealWord(order) {
            const latinGroup = document.querySelector(`.latin-column .word-group[data-order="${order}"]`);
            if (latinGroup) {
                latinGroup.classList.add('revealed');
            }

            document.querySelectorAll(`.english-word`).forEach(word => {
                if (word.dataset.order) {
                    const orders = word.dataset.order.split(',');
                    if (orders.includes(order)) {
                        word.classList.add('revealed');
                    }
                }
            });
        }

        function hideWord(order) {
            const latinGroup = document.querySelector(`.latin-column .word-group[data-order="${order}"]`);
            if (latinGroup) {
                latinGroup.classList.remove('revealed');
            }

            document.querySelectorAll(`.english-word`).forEach(word => {
                if (word.dataset.order) {
                    const orders = word.dataset.order.split(',');
                    if (orders.includes(order)) {
                        word.classList.remove('revealed');
                    }
                }
            });
        }

        function toggleWord(order) {
            const latinGroup = document.querySelector(`.latin-column .word-group[data-order="${order}"]`);
            if (latinGroup && latinGroup.classList.contains('revealed')) {
                hideWord(order);
            } else {
                revealWord(order);
            }
        }

        function stepForward() {
            if (currentStep < wordOrders.length) {
                revealWord(wordOrders[currentStep]);
                currentStep++;
            }
        }

        function stepBackward() {
            if (currentStep > 0) {
                currentStep--;
                hideWord(wordOrders[currentStep]);
            }
        }

        function toggleCategory(category) {
            const keyItem = document.querySelector(`.key-item[data-category="${category}"]`);

            if (activeCategories.has(category)) {
                activeCategories.delete(category);
                keyItem.classList.remove('active');

                document.querySelectorAll(`.latin-column .word-group.${category}`).forEach(group => {
                    group.classList.remove('highlighted');
                });

                document.querySelectorAll(`.english-word.${category}`).forEach(word => {
                    word.classList.remove('highlighted');
                });
            } else {
                activeCategories.add(category);
                keyItem.classList.add('active');

                document.querySelectorAll(`.latin-column .word-group.${category}`).forEach(group => {
                    group.classList.add('highlighted');
                });

                document.querySelectorAll(`.english-word.${category}`).forEach(word => {
                    word.classList.add('highlighted');
                });
            }
        }

        document.getElementById('showAllBtn').addEventListener('click', () => {
            document.querySelectorAll('.latin-column .word-group').forEach(group => {
                if (group.dataset.order) {
                    revealWord(group.dataset.order);
                }
            });
            currentStep = wordOrders.length;
        });

        document.getElementById('hideAllBtn').addEventListener('click', () => {
            document.querySelectorAll('.revealed').forEach(el => {
                el.classList.remove('revealed');
            });
            document.querySelectorAll('.english-word').forEach(el => {
                el.classList.remove('revealed');
            });
            document.querySelectorAll('.highlighted').forEach(el => {
                el.classList.remove('highlighted');
            });
            document.querySelectorAll('.key-item').forEach(el => {
                el.classList.remove('active');
            });
            activeCategories.clear();
            currentStep = 0;
        });

        document.getElementById('toggleColoursBtn').addEventListener('click', () => {
            coloursHidden = !coloursHidden;
            document.body.classList.toggle('hide-colours', coloursHidden);
            document.getElementById('toggleColoursBtn').textContent =
                coloursHidden ? 'Show Colours' : 'Hide Colours';
        });

        document.querySelectorAll('.key-item').forEach(item => {
            item.addEventListener('click', () => {
                toggleCategory(item.dataset.category);
            });
        });

        document.querySelectorAll('.latin-column .word-group').forEach(group => {
            group.addEventListener('click', () => {
                if (group.dataset.order) {
                    toggleWord(group.dataset.order);
                }
            });
        });

        document.querySelectorAll('.english-word').forEach(word => {
            word.addEventListener('click', () => {
                if (word.dataset.order) {
                    const order = word.dataset.order.split(',')[0];
                    toggleWord(order);
                }
            });
        });

        document.querySelectorAll('.english-column .line-number').forEach(lineNum => {
            lineNum.style.cursor = 'pointer';
            lineNum.addEventListener('click', () => {
                const lineRow = lineNum.closest('.line-row');
                const lineOrders = [];
                lineRow.querySelectorAll('.english-word').forEach(word => {
                    if (word.dataset.order) {
                        word.dataset.order.split(',').forEach(order => {
                            if (!lineOrders.includes(order)) {
                                lineOrders.push(order);
                            }
                        });
                    }
                });

                const firstWord = lineRow.querySelector('.english-word');
                const isRevealed = firstWord && firstWord.classList.contains('revealed');

                lineOrders.forEach(order => {
                    if (isRevealed) {
                        hideWord(order);
                    } else {
                        revealWord(order);
                    }
                });
            });
        });

        document.getElementById('toggleStyleBtn').addEventListener('click', () => {
            document.body.classList.toggle('style-mode');
            const isStyleMode = document.body.classList.contains('style-mode');
            document.getElementById('toggleStyleBtn').textContent =
                isStyleMode ? 'Hide Style' : 'Style Notes';

            if (!isStyleMode) {
                document.querySelectorAll('.style-tag.active').forEach(tag => {
                    tag.classList.remove('active');
                });
                document.querySelectorAll('.style-analysis.active').forEach(analysis => {
                    analysis.classList.remove('active');
                });
                document.querySelectorAll('.active-style').forEach(el => {
                    el.classList.remove('active-style');
                });
            }
        });

        document.querySelectorAll('.style-tag').forEach(tag => {
            tag.addEventListener('click', () => {
                const featureId = tag.dataset.feature;
                const isActive = tag.classList.contains('active');

                document.querySelectorAll('.style-tag.active').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.style-analysis.active').forEach(a => a.classList.remove('active'));
                document.querySelectorAll('.active-style').forEach(el => el.classList.remove('active-style'));

                if (!isActive) {
                    tag.classList.add('active');

                    const analysis = document.getElementById('analysis-' + featureId);
                    if (analysis) {
                        analysis.classList.add('active');
                    }

                    document.querySelectorAll('[data-style-feature]').forEach(el => {
                        const features = el.dataset.styleFeature.split(' ');
                        if (features.includes(featureId)) {
                            el.classList.add('active-style');
                        }
                    });
                }
            });
        });

        document.addEventListener('keydown', (e) => {
            if (window.isAnalysisActive && window.isAnalysisActive()) return;
            if (e.code === 'ArrowRight' || e.code === 'ArrowDown' || e.code === 'PageDown' || e.code === 'Space' || e.code === 'Enter') {
                e.preventDefault();
                stepForward();
            }
            else if (e.code === 'ArrowLeft' || e.code === 'ArrowUp' || e.code === 'PageUp' || e.code === 'Backspace') {
                e.preventDefault();
                stepBackward();
            }
            else if (e.code === 'Escape' || e.code === 'KeyR') {
                document.getElementById('hideAllBtn').click();
            }
        });
        // ===== ANALYSIS MODE =====
        (function() {
            const overlay = document.getElementById('analysisOverlay');
            const canvas = document.getElementById('analysisCanvas');
            const ctx = canvas.getContext('2d');
            const workspace = document.getElementById('analysisWorkspace');

            let analysisActive = false;
            let currentSentenceIdx = 0;
            let drawTool = 'pen';
            let drawColor = '#333333';
            let drawSize = 4;
            let isDrawing = false;
            let lastX = 0, lastY = 0;
            let undoStack = [];
            const MAX_UNDO = 30;

            const sentences = [
                { lines: ['1', '1b', '1c'], title: 'Sentence 1' },
                { lines: ['2'], title: 'Sentence 2' },
                { lines: ['3'], title: 'Sentence 3' },
                { lines: ['4', '4b'], title: 'Sentence 4' },
                { lines: ['5'], title: 'Sentence 5' },
                { lines: ['6'], title: 'Sentence 6' },
                { lines: ['7'], title: 'Sentence 7' }
            ];

            // === Canvas setup ===
            function resizeCanvas(preserveContent) {
                const rect = workspace.getBoundingClientRect();
                const dpr = window.devicePixelRatio || 1;
                let savedData = null;
                if (preserveContent && canvas.width > 0 && canvas.height > 0) {
                    savedData = canvas.toDataURL();
                }
                canvas.width = rect.width * dpr;
                canvas.height = rect.height * dpr;
                canvas.style.width = rect.width + 'px';
                canvas.style.height = rect.height + 'px';
                ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
                if (savedData) {
                    const img = new Image();
                    img.onload = () => ctx.drawImage(img, 0, 0, rect.width, rect.height);
                    img.src = savedData;
                }
            }

            // === Drawing ===
            function getCoords(e) {
                const rect = canvas.getBoundingClientRect();
                const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
                const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
                return { x, y };
            }

            function saveUndoState() {
                undoStack.push(canvas.toDataURL());
                if (undoStack.length > MAX_UNDO) undoStack.shift();
            }

            function startDraw(e) {
                if (drawTool === 'pointer') return;
                e.preventDefault();
                isDrawing = true;
                saveUndoState();
                const { x, y } = getCoords(e);
                lastX = x; lastY = y;
                ctx.beginPath();
                ctx.arc(x, y, drawSize / 2, 0, Math.PI * 2);
                ctx.globalCompositeOperation = drawTool === 'eraser' ? 'destination-out' : 'source-over';
                ctx.fillStyle = drawTool === 'eraser' ? 'rgba(0,0,0,1)' : drawColor;
                ctx.fill();
            }

            function doDraw(e) {
                if (!isDrawing) return;
                e.preventDefault();
                const { x, y } = getCoords(e);
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(x, y);
                ctx.lineWidth = drawSize;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.globalCompositeOperation = drawTool === 'eraser' ? 'destination-out' : 'source-over';
                ctx.strokeStyle = drawTool === 'eraser' ? 'rgba(0,0,0,1)' : drawColor;
                ctx.stroke();
                lastX = x; lastY = y;
            }

            function stopDraw() {
                isDrawing = false;
            }

            canvas.addEventListener('mousedown', startDraw);
            canvas.addEventListener('mousemove', doDraw);
            canvas.addEventListener('mouseup', stopDraw);
            canvas.addEventListener('mouseleave', stopDraw);
            canvas.addEventListener('touchstart', startDraw, { passive: false });
            canvas.addEventListener('touchmove', doDraw, { passive: false });
            canvas.addEventListener('touchend', stopDraw);

            // === Undo ===
            function undo() {
                if (undoStack.length === 0) return;
                const prev = undoStack.pop();
                const img = new Image();
                img.onload = () => {
                    const rect = workspace.getBoundingClientRect();
                    ctx.clearRect(0, 0, rect.width, rect.height);
                    ctx.globalCompositeOperation = 'source-over';
                    ctx.drawImage(img, 0, 0, rect.width, rect.height);
                };
                img.src = prev;
            }

            document.getElementById('undoBtn').addEventListener('click', undo);

            document.getElementById('clearCanvasBtn').addEventListener('click', () => {
                saveUndoState();
                const rect = workspace.getBoundingClientRect();
                ctx.clearRect(0, 0, rect.width, rect.height);
            });

            // === Tools ===
            document.querySelectorAll('[data-tool]').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('[data-tool]').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    drawTool = btn.dataset.tool;
                    canvas.className = drawTool === 'pointer' ? 'pointer-mode' :
                                       drawTool === 'eraser' ? 'eraser-mode' : '';
                });
            });

            document.querySelectorAll('.color-swatch').forEach(swatch => {
                swatch.addEventListener('click', () => {
                    document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
                    swatch.classList.add('active');
                    drawColor = swatch.dataset.color;
                    if (drawTool !== 'pen') {
                        document.querySelector('[data-tool="pen"]').click();
                    }
                });
            });

            document.querySelectorAll('.size-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    drawSize = parseInt(btn.dataset.size);
                });
            });

            // === Save / Load ===
            function getStorageKey(idx) {
                return 'avunculus-s1-analysis-' + idx;
            }

            function saveAnalysis() {
                const data = {
                    canvas: canvas.toDataURL(),
                    notes: document.getElementById('analysisNotesText').value
                };
                localStorage.setItem(getStorageKey(currentSentenceIdx), JSON.stringify(data));
                const indicator = document.getElementById('analysisSaveIndicator');
                indicator.classList.add('visible');
                setTimeout(() => indicator.classList.remove('visible'), 1500);
            }

            function loadAnalysis(idx) {
                const raw = localStorage.getItem(getStorageKey(idx));
                const rect = workspace.getBoundingClientRect();
                ctx.clearRect(0, 0, rect.width, rect.height);
                ctx.globalCompositeOperation = 'source-over';
                document.getElementById('analysisNotesText').value = '';
                undoStack = [];

                if (raw) {
                    try {
                        const data = JSON.parse(raw);
                        if (data.canvas) {
                            const img = new Image();
                            img.onload = () => {
                                ctx.globalCompositeOperation = 'source-over';
                                ctx.drawImage(img, 0, 0, rect.width, rect.height);
                            };
                            img.src = data.canvas;
                        }
                        if (data.notes) {
                            document.getElementById('analysisNotesText').value = data.notes;
                        }
                    } catch(e) {}
                }
            }

            document.getElementById('analysisSaveBtn').addEventListener('click', saveAnalysis);

            // === Sentence display ===
            function showSentence(idx) {
                if (analysisActive && currentSentenceIdx !== idx) {
                    saveAnalysis();
                }

                currentSentenceIdx = idx;
                const def = sentences[idx];

                document.getElementById('analysisNavLabel').textContent =
                    def.title + ' (' + (idx + 1) + ' of ' + sentences.length + ')';

                // Build Latin
                const latinEl = document.getElementById('analysisLatinLine');
                latinEl.innerHTML = '';
                def.lines.forEach(line => {
                    const row = document.querySelector('.latin-column .line-row[data-line="' + line + '"]');
                    if (row) {
                        row.querySelectorAll('.word-group').forEach(wg => {
                            const clone = wg.cloneNode(true);
                            clone.style.cursor = 'default';
                            latinEl.appendChild(clone);
                        });
                    }
                });

                // Build English
                const engEl = document.getElementById('analysisEnglishLine');
                engEl.innerHTML = '';
                def.lines.forEach(line => {
                    const row = document.querySelector('.english-column .line-row[data-line="' + line + '"]');
                    if (row) {
                        row.querySelectorAll('.word-group').forEach(wg => {
                            const clone = wg.cloneNode(true);
                            clone.querySelectorAll('.english-word').forEach(ew => ew.classList.add('revealed'));
                            clone.style.cursor = 'default';
                            engEl.appendChild(clone);
                        });
                    }
                });

                requestAnimationFrame(() => loadAnalysis(idx));
            }

            // Nav
            document.getElementById('analysisPrevBtn').addEventListener('click', () => {
                if (currentSentenceIdx > 0) showSentence(currentSentenceIdx - 1);
            });

            document.getElementById('analysisNextBtn').addEventListener('click', () => {
                if (currentSentenceIdx < sentences.length - 1) showSentence(currentSentenceIdx + 1);
            });

            // === Enter / Exit ===
            function enterAnalysis() {
                analysisActive = true;
                overlay.classList.add('active');
                document.body.style.overflow = 'hidden';
                requestAnimationFrame(() => {
                    resizeCanvas(false);
                    showSentence(0);
                });
            }

            function exitAnalysis() {
                saveAnalysis();
                analysisActive = false;
                overlay.classList.remove('active');
                document.body.style.overflow = '';
            }

            document.getElementById('analyseBtn').addEventListener('click', enterAnalysis);
            document.getElementById('analysisBackBtn').addEventListener('click', exitAnalysis);

            // Notes toggle
            document.getElementById('analysisNotesToggle').addEventListener('click', () => {
                document.getElementById('analysisNotes').classList.toggle('open');
                requestAnimationFrame(() => resizeCanvas(true));
            });

            // Window resize
            window.addEventListener('resize', () => {
                if (analysisActive) resizeCanvas(true);
            });

            // Analysis keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (!analysisActive) return;
                if (document.activeElement && document.activeElement.tagName === 'TEXTAREA') {
                    if (e.code === 'Escape') {
                        document.activeElement.blur();
                        e.preventDefault();
                    }
                    return;
                }
                if (e.code === 'Escape') {
                    e.preventDefault();
                    exitAnalysis();
                } else if (e.code === 'ArrowLeft') {
                    e.preventDefault();
                    if (currentSentenceIdx > 0) showSentence(currentSentenceIdx - 1);
                } else if (e.code === 'ArrowRight') {
                    e.preventDefault();
                    if (currentSentenceIdx < sentences.length - 1) showSentence(currentSentenceIdx + 1);
                } else if ((e.ctrlKey || e.metaKey) && e.code === 'KeyZ') {
                    e.preventDefault();
                    undo();
                } else if (e.code === 'KeyS' && (e.ctrlKey || e.metaKey)) {
                    e.preventDefault();
                    saveAnalysis();
                }
            });

            window.isAnalysisActive = () => analysisActive;
        })();
    </script>
</body>
</html>
