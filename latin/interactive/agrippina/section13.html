<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classicalia - Tacitus Annals 14.13</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 240px;
            background: white;
            border-right: 1px solid #e5e7eb;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }
        .logo-section {
            padding: 1.5rem 1.25rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }
        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #0066ff 0%, #4d94ff 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.1rem;
        }
        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
        }
        .nav-section {
            padding: 1rem 0.5rem;
        }
        .nav-title {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #9ca3af;
            letter-spacing: 0.05em;
            padding: 0 0.75rem;
            margin-bottom: 0.5rem;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.625rem 0.75rem;
            margin: 0.125rem 0;
            border-radius: 8px;
            text-decoration: none;
            color: #4b5563;
            font-size: 0.9rem;
            transition: all 0.15s ease;
            cursor: pointer;
        }
        .nav-item:hover {
            background: #f3f4f6;
            color: #1f2937;
        }
        .nav-item.active {
            background: #eef2ff;
            color: #0066ff;
            font-weight: 500;
        }
        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }
        .main-content {
            margin-left: 240px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .top-bar {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0.875rem 2rem;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .content-wrapper {
            flex: 1;
            overflow-y: auto;
        }
        .content-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }
        .lesson-header {
            margin-bottom: 2rem;
        }
        .lesson-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        .lesson-meta {
            display: flex;
            gap: 1.5rem;
            font-size: 0.875rem;
            color: #6b7280;
        }
        .card {
            background: white;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }
        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
        }
        .card-body {
            padding: 2rem;
        }
        .latin-text {
            font-size: 1.5rem;
            line-height: 2.4;
            color: #1f2937;
        }
        .word {
            cursor: pointer;
            padding: 2px 4px;
            margin: 0 1px;
            border-radius: 4px;
            transition: all 0.15s ease;
            display: inline;
        }
        .word:hover {
            background: rgba(0, 102, 255, 0.15);
        }
        .word.active {
            background: rgba(0, 102, 255, 0.25);
        }

        /* Popup styles */
        .vocab-popup {
            position: fixed;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05);
            padding: 1rem 1.25rem;
            z-index: 1000;
            max-width: 350px;
            min-width: 250px;
            display: none;
            animation: popIn 0.2s ease;
        }
        .vocab-popup::before {
            content: '';
            position: absolute;
            top: -8px;
            left: var(--arrow-left, 50%);
            transform: translateX(-50%);
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid white;
        }
        .vocab-popup.arrow-bottom::before {
            top: auto;
            bottom: -8px;
            border-bottom: none;
            border-top: 8px solid white;
        }
        body.dark-mode .vocab-popup::before {
            border-bottom-color: #4f0c28;
        }
        body.dark-mode .vocab-popup.arrow-bottom::before {
            border-bottom-color: transparent;
            border-top-color: #4f0c28;
        }
        @keyframes popIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .vocab-popup.visible {
            display: block;
        }
        .vocab-popup h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #0066ff;
            margin-bottom: 0.5rem;
        }
        .vocab-popup .parsing {
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
            font-style: italic;
        }
        .vocab-popup .meaning {
            font-size: 0.95rem;
            color: #1f2937;
            line-height: 1.5;
        }
        .vocab-popup .principal-parts {
            font-size: 0.85rem;
            color: #4b5563;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid #e5e7eb;
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }
        .btn {
            padding: 0.625rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        .btn:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }
        .btn.active {
            background: #0066ff;
            color: white;
            border-color: #0066ff;
        }

        /* Dark mode styles */
        body.dark-mode {
            background: #2d0818;
        }
        body.dark-mode .sidebar {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .logo-icon {
            background: linear-gradient(135deg, #8b5a8a 0%, #a67aa6 100%);
        }
        body.dark-mode .logo-text {
            color: #c5d2f8;
        }
        body.dark-mode .nav-title {
            color: #9a8a9a;
        }
        body.dark-mode .nav-item {
            color: #b8a8b8;
        }
        body.dark-mode .nav-item:hover {
            background: #4f0c28;
            color: #c5d2f8;
        }
        body.dark-mode .nav-item.active {
            background: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .top-bar {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .card {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .card-header {
            border-color: #5a1a3a;
        }
        body.dark-mode .card-title {
            color: #c5d2f8;
        }
        body.dark-mode .lesson-title {
            color: #c5d2f8;
        }
        body.dark-mode .lesson-meta {
            color: #b8a8b8;
        }
        body.dark-mode .latin-text {
            color: #c5d2f8;
            text-shadow: 0 0 20px rgba(197, 210, 248, 0.15);
        }
        body.dark-mode .word:hover {
            background: rgba(232, 212, 168, 0.25);
        }
        body.dark-mode .word.active {
            background: rgba(232, 212, 168, 0.35);
        }
        body.dark-mode .btn {
            background: #4f0c28;
            border-color: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .btn:hover {
            background: #5a1a3a;
        }
        body.dark-mode .btn.active {
            background: #7a3a5a;
            border-color: #8a4a6a;
        }
        body.dark-mode .resource-card {
            background: #4f0c28;
            border-color: #5a1a3a;
        }
        body.dark-mode .resource-card h4 {
            color: #c5d2f8;
        }
        body.dark-mode .resource-card p {
            color: #b8c8e8;
        }
        body.dark-mode .vocab-popup {
            background: #4f0c28;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        body.dark-mode .vocab-popup h4 {
            color: #e8d4a8;
        }
        body.dark-mode .vocab-popup .parsing {
            color: #b8a8b8;
        }
        body.dark-mode .vocab-popup .meaning {
            color: #c5d2f8;
        }
        body.dark-mode .vocab-popup .principal-parts {
            color: #a8b8d8;
            border-color: #5a1a3a;
        }

        /* Sentence hover highlight */
        .latin-text p {
            padding: 0.5rem 0.75rem;
            margin: 0 -0.75rem 1.5rem -0.75rem;
            border-radius: 6px;
            transition: background 0.2s ease;
        }
        .latin-text p:hover {
            background: rgba(59, 130, 246, 0.08);
        }
        body.dark-mode .latin-text p:hover {
            background: rgba(197, 210, 248, 0.1);
        }

        /* Sentence-by-sentence mode */
        .latin-text.sentence-mode p {
            display: none;
        }
        .latin-text.sentence-mode p.current-sentence {
            display: block;
        }
        .latin-text.sentence-mode p:hover {
            background: transparent;
        }

        .sentence-nav {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }
        .sentence-nav.visible {
            display: flex;
        }
        body.dark-mode .sentence-nav {
            border-color: #5a1a3a;
        }
        .sentence-nav button {
            padding: 0.5rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        .sentence-nav button:hover:not(:disabled) {
            background: #f3f4f6;
        }
        .sentence-nav button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        body.dark-mode .sentence-nav button {
            background: #4f0c28;
            border-color: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .sentence-nav button:hover:not(:disabled) {
            background: #5a1a3a;
        }
        .sentence-counter {
            font-size: 0.875rem;
            color: #6b7280;
            min-width: 80px;
            text-align: center;
        }
        body.dark-mode .sentence-counter {
            color: #b8a8b8;
        }

        /* Full-screen mode */
        body.full-screen .sidebar {
            display: none;
        }
        body.full-screen .main-content {
            margin-left: 0;
        }
        body.full-screen .lesson-header {
            display: none;
        }
        body.full-screen .content-container {
            max-width: 100%;
            padding: 1rem 2rem;
        }
        body.full-screen .card {
            border: none;
            border-radius: 0;
            background: transparent;
        }
        body.full-screen .card-header {
            display: none;
        }
        body.full-screen .card-body {
            padding: 1rem 2rem;
        }
        body.full-screen .latin-text {
            font-size: 2rem;
            line-height: 2.6;
        }
        body.full-screen .btn-group {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            background: white;
            padding: 0.75rem;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 200;
        }
        body.full-screen.dark-mode .btn-group {
            background: #3a0a1f;
        }
        body.full-screen .resource-card {
            display: none !important;
        }
        body.full-screen .sentence-nav {
            border: none;
            padding-top: 0;
        }
        body.full-screen .top-bar {
            display: none;
        }

        /* Line numbers */
        .latin-text.show-lines p {
            display: flex;
            align-items: flex-start;
        }
        .line-number {
            display: none;
            min-width: 2.5rem;
            color: #9ca3af;
            font-size: 0.875rem;
            padding-top: 0.3rem;
            user-select: none;
        }
        .latin-text.show-lines .line-number {
            display: block;
        }
        body.dark-mode .line-number {
            color: #7a6a7a;
        }
        .line-content {
            flex: 1;
        }

        /* Pointer/highlight mode */
        .word.pointed {
            background: rgba(255, 200, 50, 0.5) !important;
            box-shadow: 0 0 12px rgba(255, 200, 50, 0.6);
            border-radius: 4px;
        }
        body.dark-mode .word.pointed {
            background: rgba(232, 212, 168, 0.5) !important;
            box-shadow: 0 0 15px rgba(232, 212, 168, 0.5);
        }

        /* Pointer mode indicator */
        body.pointer-mode .word {
            cursor: crosshair;
        }
        .mode-indicator {
            display: none;
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: #fef3c7;
            color: #92400e;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            z-index: 200;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        body.pointer-mode .mode-indicator {
            display: block;
        }
        body.dark-mode .mode-indicator {
            background: #4f0c28;
            color: #e8d4a8;
        }

        .resource-card {
            background: #f9fafb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px solid #e5e7eb;
            display: none;
        }
        .resource-card.active {
            display: block;
        }
        .resource-card h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.75rem;
        }
        .resource-card p {
            font-size: 0.95rem;
            line-height: 1.8;
            color: #374151;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
            }
            .latin-text {
                font-size: 1.25rem;
                line-height: 2.2;
            }
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="logo-section">
            <a href="../../../index.html" class="logo">
                <div class="logo-icon">C</div>
                <span class="logo-text">Classicalia</span>
            </a>
        </div>
        <nav class="nav-section">
            <div class="nav-title">Resources</div>
            <div class="nav-item active" onclick="showView('text')">
                <span class="nav-icon">üìñ</span>
                <span>Read</span>
            </div>
            <div class="nav-item" onclick="showView('summary')">
                <span class="nav-icon">üìã</span>
                <span>Summary</span>
            </div>
            <div class="nav-item" onclick="showView('context')">
                <span class="nav-icon">üèõÔ∏è</span>
                <span>Context</span>
            </div>
            <div class="nav-item" onclick="showView('comprehension')">
                <span class="nav-icon">‚ùì</span>
                <span>Comprehension</span>
            </div>
        </nav>
    </aside>

    <main class="main-content">
        <div class="top-bar"></div>
        <div class="content-wrapper">
            <div class="content-container">
                <header class="lesson-header">
                    <h1 class="lesson-title">The Triumphal Return</h1>
                    <div class="lesson-meta">
                        <span>üìï Tacitus Annals 14.13</span>
                        <span>‚è±Ô∏è 60 min</span>
                        <span>üìä A-Level</span>
                    </div>
                </header>

                <div class="card" id="textCard">
                    <div class="card-header">
                        <h3 class="card-title">Latin Text</h3>
                    </div>
                    <div class="card-body">
                        <div class="latin-text" id="latinText"></div>
                        <div class="btn-group">
                            <button class="btn" onclick="toggleTranslation()">Translation</button>
                            <button class="btn" onclick="toggleSentenceMode()">Sentence Mode</button>
                            <button class="btn" onclick="toggleLineNumbers()">Line Numbers</button>
                            <button class="btn" onclick="togglePointerMode()">Pointer Mode</button>
                            <button class="btn" onclick="toggleDarkMode()">üåô Dark</button>
                            <button class="btn" onclick="toggleFullScreen()">‚õ∂ Full Screen</button>
                        </div>
                        <div class="sentence-nav" id="sentenceNav">
                            <button onclick="prevSentence()">‚Üê Previous</button>
                            <span class="sentence-counter" id="sentenceCounter">1 / 7</span>
                            <button onclick="nextSentence()">Next ‚Üí</button>
                        </div>
                        <div class="resource-card" id="translationBox">
                            <h4>Translation</h4>
                            <p>However, he delayed in the towns of Campania, anxious about how he should enter Rome, or whether he would find the Senate obsequious and the people affectionate. On the other hand, all the vilest (of his court), of whom there has not existed any other more fertile palace, argued that Agrippina's name was hated, and the support of the people had been fired by her death: he should go fearlessly and experience (the people's) reverence for him face to face; at the same time, they demand to go in advance. And they found circumstances more favourable than they had promised, tribes coming to meet them, the Senate in festal attire, bands of wives and children arranged by sex and age, steps of grandstands set up (on the road) by which he was to proceed, the way triumphs are watched. Hence, he approached the Capitol, proud and conqueror of the public slavery, paid his thanks, and poured himself into all the lusts which, barely contained, respect for his mother, such as it was, had delayed.</p>
                        </div>
                    </div>
                </div>

                <div class="card" id="resourceCard" style="display: none; margin-top: 1.5rem;">
                    <div class="card-header">
                        <h3 class="card-title" id="resourceTitle">Summary</h3>
                    </div>
                    <div class="card-body" id="resourceContent"></div>
                </div>
            </div>
        </div>
    </main>

    <div class="vocab-popup" id="vocabPopup"></div>
    <div class="mode-indicator">üìç Pointer Mode (click words to highlight, click again to remove)</div>

    <script>
const vocab = {
    "tamen": { lemma: "tamen", parsing: "adverb", meaning: "however, nevertheless" },
    "cunctari": { lemma: "cunctor, cunctari, cunctatus sum", parsing: "pres. inf. deponent", meaning: "to delay, hesitate" },
    "in": { lemma: "in", parsing: "preposition + abl.", meaning: "in, on" },
    "oppidis": { lemma: "oppidum, -i (n.)", parsing: "abl. pl.", meaning: "towns" },
    "campaniae": { lemma: "Campania, -ae (f.)", parsing: "gen. sing.", meaning: "of Campania" },
    "quonam": { lemma: "quonam", parsing: "interrogative adverb", meaning: "in what way, how" },
    "modo": { lemma: "modus, -i (m.)", parsing: "abl. sing.", meaning: "manner, way" },
    "urbem": { lemma: "urbs, urbis (f.)", parsing: "acc. sing.", meaning: "city, Rome" },
    "ingrederetur": { lemma: "ingredior, ingredi, ingressus sum", parsing: "imperf. subj. deponent 3rd sing.", meaning: "he might enter" },
    "an": { lemma: "an", parsing: "conjunction", meaning: "whether, or (in questions)" },
    "obsequium": { lemma: "obsequium, -i (n.)", parsing: "acc. sing.", meaning: "obedience, compliance" },
    "senatus": { lemma: "senatus, -us (m.)", parsing: "gen. sing.", meaning: "of the Senate" },
    "studia": { lemma: "studium, -i (n.)", parsing: "acc. pl.", meaning: "enthusiasm, affection" },
    "plebis": { lemma: "plebs, plebis (f.)", parsing: "gen. sing.", meaning: "of the people" },
    "reperiret": { lemma: "reperio, reperire, repperi, repertum", parsing: "imperf. subj. act. 3rd sing.", meaning: "he would find" },
    "anxius": { lemma: "anxius, -a, -um", parsing: "nom. masc. sing.", meaning: "anxious, worried" },
    "contra": { lemma: "contra", parsing: "adverb", meaning: "on the other hand, in response" },
    "deterrimus": { lemma: "deterrimus, -a, -um", parsing: "superlative nom. masc. sing.", meaning: "the worst, vilest" },
    "quisque": { lemma: "quisque, quaeque, quidque", parsing: "nom. masc. sing.", meaning: "each one, everyone" },
    "quorum": { lemma: "qui, quae, quod", parsing: "gen. pl.", meaning: "of whom" },
    "non": { lemma: "non", parsing: "adverb", meaning: "not" },
    "alia": { lemma: "alius, alia, aliud", parsing: "nom. fem. sing.", meaning: "other" },
    "regia": { lemma: "regia, -ae (f.)", parsing: "nom. sing.", meaning: "palace" },
    "fecundior": { lemma: "fecundus, -a, -um", parsing: "comparative nom. fem. sing.", meaning: "more fertile, productive" },
    "extitit": { lemma: "exsisto, exsistere, exstiti", parsing: "perf. act. ind. 3rd sing.", meaning: "has existed" },
    "invisum": { lemma: "invisus, -a, -um", parsing: "acc. neut. sing.", meaning: "hated" },
    "agrippinae": { lemma: "Agrippina, -ae (f.)", parsing: "gen. sing.", meaning: "of Agrippina" },
    "nomen": { lemma: "nomen, nominis (n.)", parsing: "acc. sing.", meaning: "name" },
    "et": { lemma: "et", parsing: "conjunction", meaning: "and" },
    "morte": { lemma: "mors, mortis (f.)", parsing: "abl. sing.", meaning: "by death" },
    "eius": { lemma: "is, ea, id", parsing: "gen. sing.", meaning: "her, of her" },
    "accensum": { lemma: "accendo, accendere, accendi, accensum", parsing: "perf. pass. part. acc. neut. sing.", meaning: "inflamed, kindled" },
    "populi": { lemma: "populus, -i (m.)", parsing: "gen. sing.", meaning: "of the people" },
    "favorem": { lemma: "favor, favoris (m.)", parsing: "acc. sing.", meaning: "favour, support" },
    "disserunt": { lemma: "dissero, disserere, disserui, dissertum", parsing: "pres. act. ind. 3rd pl.", meaning: "they argue, maintain" },
    "iret": { lemma: "eo, ire, ii/ivi, itum", parsing: "imperf. subj. act. 3rd sing.", meaning: "he should go" },
    "intrepidus": { lemma: "intrepidus, -a, -um", parsing: "nom. masc. sing.", meaning: "fearless, unafraid" },
    "venerationem": { lemma: "veneratio, -onis (f.)", parsing: "acc. sing.", meaning: "reverence, veneration" },
    "sui": { lemma: "sui, sibi, se", parsing: "gen. reflexive", meaning: "of himself" },
    "coram": { lemma: "coram", parsing: "adverb", meaning: "face to face, in person" },
    "experiretur": { lemma: "experior, experiri, expertus sum", parsing: "imperf. subj. deponent 3rd sing.", meaning: "he should experience" },
    "simul": { lemma: "simul", parsing: "adverb", meaning: "at the same time" },
    "praegredi": { lemma: "praegredior, praegredi, praegressus sum", parsing: "pres. inf. deponent", meaning: "to go ahead, advance" },
    "exposcunt": { lemma: "exposco, exposcere, expoposci", parsing: "pres. act. ind. 3rd pl.", meaning: "they demand" },
    "promptiora": { lemma: "promptus, -a, -um", parsing: "comparative acc. neut. pl.", meaning: "more ready, favourable" },
    "quam": { lemma: "quam", parsing: "conjunction", meaning: "than" },
    "promiserant": { lemma: "promitto, promittere, promisi, promissum", parsing: "pluperf. act. ind. 3rd pl.", meaning: "they had promised" },
    "inveniunt": { lemma: "invenio, invenire, inveni, inventum", parsing: "pres. act. ind. 3rd pl.", meaning: "they find" },
    "obvias": { lemma: "obvius, -a, -um", parsing: "acc. fem. pl.", meaning: "coming to meet" },
    "tribus": { lemma: "tribus, -us (f.)", parsing: "acc. pl.", meaning: "tribes" },
    "festo": { lemma: "festus, -a, -um", parsing: "abl. masc. sing.", meaning: "festive, holiday" },
    "cultu": { lemma: "cultus, -us (m.)", parsing: "abl. sing.", meaning: "dress, attire" },
    "senatum": { lemma: "senatus, -us (m.)", parsing: "acc. sing.", meaning: "Senate" },
    "coniugum": { lemma: "coniunx, coniugis (c.)", parsing: "gen. pl.", meaning: "of wives" },
    "ac": { lemma: "ac/atque", parsing: "conjunction", meaning: "and" },
    "liberorum": { lemma: "liberi, -orum (m. pl.)", parsing: "gen. pl.", meaning: "of children" },
    "agmina": { lemma: "agmen, agminis (n.)", parsing: "acc. pl.", meaning: "troops, bands" },
    "per": { lemma: "per", parsing: "preposition + acc.", meaning: "according to, by" },
    "sexum": { lemma: "sexus, -us (m.)", parsing: "acc. sing.", meaning: "sex, gender" },
    "aetatem": { lemma: "aetas, aetatis (f.)", parsing: "acc. sing.", meaning: "age" },
    "disposita": { lemma: "dispono, disponere, disposui, dispositum", parsing: "perf. pass. part. acc. pl.", meaning: "arranged" },
    "extructos": { lemma: "exstruo, exstruere, exstruxi, exstructum", parsing: "perf. pass. part. acc. masc. pl.", meaning: "erected, built up" },
    "qua": { lemma: "qua", parsing: "relative adverb", meaning: "where, by which way" },
    "incederet": { lemma: "incedo, incedere, incessi, incessum", parsing: "imperf. subj. act. 3rd sing.", meaning: "he would proceed" },
    "spectaculorum": { lemma: "spectaculum, -i (n.)", parsing: "gen. pl.", meaning: "of spectacles, shows" },
    "gradus": { lemma: "gradus, -us (m.)", parsing: "acc. pl.", meaning: "steps, tiers" },
    "quo": { lemma: "quo", parsing: "relative adverb", meaning: "in which" },
    "triumphi": { lemma: "triumphus, -i (m.)", parsing: "nom. pl.", meaning: "triumphs" },
    "visuntur": { lemma: "video, videre, vidi, visum", parsing: "pres. pass. ind. 3rd pl.", meaning: "are watched" },
    "hinc": { lemma: "hinc", parsing: "adverb", meaning: "from here, hence" },
    "superbus": { lemma: "superbus, -a, -um", parsing: "nom. masc. sing.", meaning: "proud, arrogant" },
    "publici": { lemma: "publicus, -a, -um", parsing: "gen. neut. sing.", meaning: "public" },
    "servitii": { lemma: "servitium, -i (n.)", parsing: "gen. sing.", meaning: "of slavery, servitude" },
    "victor": { lemma: "victor, victoris (m.)", parsing: "nom. sing.", meaning: "victor, conqueror" },
    "capitolium": { lemma: "Capitolium, -i (n.)", parsing: "acc. sing.", meaning: "the Capitol" },
    "adiit": { lemma: "adeo, adire, adii, aditum", parsing: "perf. act. ind. 3rd sing.", meaning: "he approached, went to" },
    "grates": { lemma: "grates (f. pl.)", parsing: "acc. pl.", meaning: "thanks" },
    "exolvit": { lemma: "exsolvo, exsolvere, exsolvi, exsolutum", parsing: "perf. act. ind. 3rd sing.", meaning: "he paid, discharged" },
    "se": { lemma: "sui, sibi, se", parsing: "acc. reflexive", meaning: "himself" },
    "seque": { lemma: "sui, sibi, se + -que", parsing: "acc. reflexive + and", meaning: "and himself" },
    "que": { lemma: "-que", parsing: "enclitic conjunction", meaning: "and" },
    "omnes": { lemma: "omnis, -e", parsing: "acc. fem. pl.", meaning: "all" },
    "libidines": { lemma: "libido, libidinis (f.)", parsing: "acc. pl.", meaning: "lusts, desires" },
    "effudit": { lemma: "effundo, effundere, effudi, effusum", parsing: "perf. act. ind. 3rd sing.", meaning: "he poured out" },
    "quas": { lemma: "qui, quae, quod", parsing: "acc. fem. pl.", meaning: "which" },
    "male": { lemma: "male", parsing: "adverb", meaning: "badly, poorly" },
    "coercitas": { lemma: "coerceo, coercere, coercui, coercitum", parsing: "perf. pass. part. acc. fem. pl.", meaning: "restrained" },
    "qualiscumque": { lemma: "qualiscumque, qualecumque", parsing: "nom. fem. sing.", meaning: "of whatever kind, such as it was" },
    "matris": { lemma: "mater, matris (f.)", parsing: "gen. sing.", meaning: "of mother" },
    "reverentia": { lemma: "reverentia, -ae (f.)", parsing: "nom. sing.", meaning: "respect, reverence" },
    "tardaverat": { lemma: "tardo, tardare, tardavi, tardatum", parsing: "pluperf. act. ind. 3rd sing.", meaning: "had delayed, checked" }
};

const latinSentences = [
    "tamen cunctari in oppidis Campaniae, quonam modo urbem ingrederetur, an obsequium senatus, an studia plebis reperiret anxius:",
    "contra deterrimus quisque, quorum non alia regia fecundior extitit, invisum Agrippinae nomen et morte eius accensum populi favorem disserunt:",
    "iret intrepidus et venerationem sui coram experiretur;",
    "simul praegredi exposcunt.",
    "et promptiora quam promiserant inveniunt, obvias tribus, festo cultu senatum, coniugum ac liberorum agmina per sexum et aetatem disposita, extructos, qua incederet, spectaculorum gradus, quo modo triumphi visuntur.",
    "hinc superbus ac publici servitii victor Capitolium adiit, grates exolvit",
    "seque in omnes libidines effudit quas male coercitas qualiscumque matris reverentia tardaverat."
];

const resources = {
    summary: `<h4>Summary</h4>
<p>In this passage, Nero lingers in Campanian towns, anxious about returning to Rome after committing matricide. He worries about how to enter the city and whether he will find the Senate obedient and the people affectionate. His worst courtiers‚ÄîTacitus notes that no palace has ever been more productive of such villains‚Äîreassure him that Agrippina's name was hated and her death has actually inflamed popular support.</p>
<p>They encourage him to go fearlessly and experience the people's reverence for himself in person, while demanding to go ahead to prepare his reception. They find circumstances even more favourable than they had promised: tribes coming out to meet him, the Senate in holiday dress, bands of wives and children arranged by sex and age, grandstands erected along his route‚Äî"the way triumphs are watched."</p>
<p>The passage culminates with Nero approaching the Capitol "proud and victor over public slavery," paying thanks to the gods (for his successful matricide), and then pouring himself into all the lusts which his mother's respect‚Äî"such as it was"‚Äîhad previously restrained. Tacitus presents this as the turning point when Nero's moral collapse becomes complete.</p>`,
    context: `<h4>Historical Context</h4>
<p><strong>Roman Triumphs:</strong> Triumphs were sacred military processions granted for defeating foreign enemies. Specific rituals included the victor processing to the Capitol to give thanks to Jupiter. The comparison to a triumph for matricide is deliberately shocking‚ÄîNero treats killing his mother like a military victory over Rome's enemies.</p>
<p><strong>The Tribes (Tribus):</strong> Rome's voting districts were organised into tribes. Their organised appearance suggests political orchestration‚Äîthis "spontaneous" joy required careful planning and coordination.</p>
<p><strong>Festo Cultu:</strong> Holiday dress indicated festive occasions‚Äîwhite togas for citizens, special garments for senators. Wearing such clothes for a matricide's return perverts the concept of celebration.</p>
<p><strong>The Capitol:</strong> Rome's most sacred space, where triumphant generals gave thanks to Jupiter. Nero thanks the gods at their holiest temple for successfully killing his mother‚Äîthe ultimate sacrilege.</p>
<p><strong>"Publici Servitii Victor":</strong> This phrase inverts triumph language completely. Instead of conquering foreign enemies, Nero has conquered Roman freedom itself. He is "victor over public slavery"‚Äîthe slavery he himself created.</p>
<p><strong>Historical Turning Point:</strong> Tacitus presents AD 59 as the moment when Nero's reign transitions from bad to catastrophic. With his mother's restraining influence removed, however inadequate it was, total moral collapse follows.</p>`,
    comprehension: `<h4>Comprehension Questions</h4>
<p><strong>Lines 1-2:</strong> What does Nero's anxiety ("anxius") reveal about his awareness of his crime? Why does he delay in Campania?</p>
<p><strong>Line 2:</strong> What is the significance of "deterrimus quisque"? What does Tacitus's comment about no palace being "more fertile" suggest about Nero's court?</p>
<p><strong>Lines 2-3:</strong> How do the courtiers manipulate Nero? What perverse logic do they use about Agrippina's death and popular favour?</p>
<p><strong>Line 4:</strong> Why do the courtiers demand to "go ahead" (praegredi)? What does this reveal about the "spontaneous" reception?</p>
<p><strong>Lines 5:</strong> What details describe the triumphal reception? How does "quo modo triumphi visuntur" function as both comparison and condemnation?</p>
<p><strong>Line 6:</strong> Explain the phrase "publici servitii victor." How does this invert traditional triumph language?</p>
<p><strong>Line 6:</strong> What is the significance of Nero going to the Capitol and paying thanks ("grates exolvit")?</p>
<p><strong>Line 7:</strong> What does "male coercitas" suggest about Nero's vices even before his mother's death? How does "qualiscumque" function as commentary?</p>
<p><strong>Overall:</strong> How does Tacitus present this moment as a turning point in Nero's reign? What literary techniques does he use to convey moral condemnation?</p>`
};

let currentPopup = null;
let sentenceModeActive = false;
let currentSentenceIndex = 0;
let pointerModeActive = false;

function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    const isDark = document.body.classList.contains('dark-mode');
    savePreference('darkMode', isDark);

    const btn = event.currentTarget;
    if (isDark) {
        btn.textContent = '‚òÄÔ∏è Light';
        btn.classList.add('active');
    } else {
        btn.textContent = 'üåô Dark';
        btn.classList.remove('active');
    }
}

function toggleFullScreen() {
    document.body.classList.toggle('full-screen');
    const btn = event.currentTarget;
    if (document.body.classList.contains('full-screen')) {
        btn.textContent = '‚õ∂ Exit Full Screen';
        btn.classList.add('active');
    } else {
        btn.textContent = '‚õ∂ Full Screen';
        btn.classList.remove('active');
    }
}

function toggleLineNumbers() {
    const latinText = document.getElementById('latinText');
    latinText.classList.toggle('show-lines');
    const showLines = latinText.classList.contains('show-lines');
    savePreference('lineNumbers', showLines);

    const btn = event.currentTarget;
    btn.classList.toggle('active');
}

function togglePointerMode() {
    pointerModeActive = !pointerModeActive;
    document.body.classList.toggle('pointer-mode');
    const btn = event.currentTarget;
    btn.classList.toggle('active');

    if (!pointerModeActive) {
        // Clear all pointed words when exiting pointer mode
        document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
    }

    // Hide vocab popup when entering pointer mode
    if (pointerModeActive) {
        hidePopup();
    }
}

function toggleSentenceMode() {
    const latinText = document.getElementById('latinText');
    const sentenceNav = document.getElementById('sentenceNav');
    const btn = event.currentTarget;

    sentenceModeActive = !sentenceModeActive;

    if (sentenceModeActive) {
        latinText.classList.add('sentence-mode');
        sentenceNav.classList.add('visible');
        btn.classList.add('active');
        btn.textContent = 'Full Text';
        currentSentenceIndex = 0;
        updateSentenceDisplay();
    } else {
        latinText.classList.remove('sentence-mode');
        sentenceNav.classList.remove('visible');
        btn.classList.remove('active');
        btn.textContent = 'Sentence Mode';
        // Remove current-sentence class from all
        document.querySelectorAll('.latin-text p').forEach(p => p.classList.remove('current-sentence'));
    }
}

function updateSentenceDisplay() {
    const paragraphs = document.querySelectorAll('.latin-text p');
    paragraphs.forEach((p, i) => {
        if (i === currentSentenceIndex) {
            p.classList.add('current-sentence');
        } else {
            p.classList.remove('current-sentence');
        }
    });
    document.getElementById('sentenceCounter').textContent = `${currentSentenceIndex + 1} / ${paragraphs.length}`;

    // Update button states
    const navButtons = document.querySelectorAll('.sentence-nav button');
    navButtons[0].disabled = currentSentenceIndex === 0;
    navButtons[1].disabled = currentSentenceIndex === paragraphs.length - 1;
}

function prevSentence() {
    if (currentSentenceIndex > 0) {
        currentSentenceIndex--;
        updateSentenceDisplay();
        hidePopup();
    }
}

function nextSentence() {
    const paragraphs = document.querySelectorAll('.latin-text p');
    if (currentSentenceIndex < paragraphs.length - 1) {
        currentSentenceIndex++;
        updateSentenceDisplay();
        hidePopup();
    }
}

function generateLatinHTML() {
    let html = '';
    latinSentences.forEach((sentence, index) => {
        // Split into tokens, keeping punctuation attached to words
        const tokens = sentence.match(/[a-zA-Z]+[.,;:]*|[.,;:]+/g);
        html += '<p style="margin-bottom: 1.5rem;">';
        html += `<span class="line-number">${index + 1}</span>`;
        html += '<span class="line-content">';
        if (tokens) {
            tokens.forEach((token, i) => {
                // Separate word from trailing punctuation
                const match = token.match(/^([a-zA-Z]+)([.,;:]*)$/);
                if (match) {
                    const word = match[1];
                    const punct = match[2];
                    const lookupWord = word.toLowerCase();
                    html += `<span class="word" data-word="${lookupWord}">${word}</span>${punct}`;
                    // Add space after unless it's the last token
                    if (i < tokens.length - 1) html += ' ';
                } else {
                    // Just punctuation
                    html += token + ' ';
                }
            });
        }
        html += '</span></p>';
    });
    return html;
}

function showVocabPopup(event, word) {
    const popup = document.getElementById('vocabPopup');
    const wordData = vocab[word.toLowerCase()];

    // Remove active class from all words
    document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active'));

    if (!wordData) {
        popup.classList.remove('visible');
        return;
    }

    // Add active class to clicked word
    event.target.classList.add('active');

    popup.innerHTML = `
        <h4>${word}</h4>
        <div class="parsing">${wordData.parsing}</div>
        <div class="meaning">${wordData.meaning}</div>
        <div class="principal-parts">${wordData.lemma}</div>
    `;

    // Position popup near the word
    const rect = event.target.getBoundingClientRect();
    const popupWidth = 300;
    const popupHeight = 150;

    let left = rect.left + (rect.width / 2) - (popupWidth / 2);
    let top = rect.bottom + 12;
    let arrowBottom = false;

    // Keep popup within viewport horizontally
    if (left < 10) left = 10;
    if (left + popupWidth > window.innerWidth - 10) {
        left = window.innerWidth - popupWidth - 10;
    }

    // If popup would go below viewport, show above word
    if (top + popupHeight > window.innerHeight) {
        top = rect.top - popupHeight - 12;
        arrowBottom = true;
    }

    // Calculate arrow position relative to popup
    const wordCenterX = rect.left + (rect.width / 2);
    const arrowLeft = Math.max(20, Math.min(popupWidth - 20, wordCenterX - left));

    popup.style.left = left + 'px';
    popup.style.top = top + 'px';
    popup.style.setProperty('--arrow-left', arrowLeft + 'px');
    popup.classList.toggle('arrow-bottom', arrowBottom);
    popup.classList.add('visible');

    currentPopup = popup;
}

function hidePopup() {
    const popup = document.getElementById('vocabPopup');
    popup.classList.remove('visible');
    document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active'));
}

function toggleTranslation() {
    const box = document.getElementById('translationBox');
    const btn = event.currentTarget;

    if (box.classList.contains('active')) {
        box.classList.remove('active');
        btn.textContent = 'Translation';
        btn.classList.remove('active');
    } else {
        box.classList.add('active');
        btn.textContent = 'Hide Translation';
        btn.classList.add('active');
    }
}

function showView(view) {
    // Update nav
    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
    event.currentTarget.classList.add('active');

    const textCard = document.getElementById('textCard');
    const resourceCard = document.getElementById('resourceCard');

    if (view === 'text') {
        textCard.style.display = 'block';
        resourceCard.style.display = 'none';
    } else {
        textCard.style.display = 'none';
        resourceCard.style.display = 'block';
        document.getElementById('resourceTitle').textContent = view.charAt(0).toUpperCase() + view.slice(1);
        document.getElementById('resourceContent').innerHTML = resources[view];
    }
}

// Initialise
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('latinText').innerHTML = generateLatinHTML();

    // Load saved preferences
    loadPreferences();

    // Add click handlers to words
    document.querySelectorAll('.word').forEach(word => {
        word.addEventListener('click', function(e) {
            e.stopPropagation();

            if (pointerModeActive) {
                // Toggle pointed class
                this.classList.toggle('pointed');
            } else {
                showVocabPopup(e, this.dataset.word);
            }
        });
    });

    // Hide popup when clicking elsewhere, clear pointer highlights on background click
    document.addEventListener('click', function(e) {
        if (!e.target.classList.contains('word')) {
            hidePopup();

            // If in pointer mode and clicking background (not buttons), clear all highlights
            if (pointerModeActive && !e.target.closest('.btn-group') && !e.target.closest('.sentence-nav')) {
                document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
            }
        }
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Escape to exit full screen
        if (e.key === 'Escape') {
            if (document.body.classList.contains('full-screen')) {
                document.body.classList.remove('full-screen');
                const btn = document.querySelector('.btn-group .btn:last-child');
                if (btn) {
                    btn.textContent = '‚õ∂ Full Screen';
                    btn.classList.remove('active');
                }
            }
            // Also exit pointer mode on escape
            if (pointerModeActive) {
                pointerModeActive = false;
                document.body.classList.remove('pointer-mode');
                document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
                document.querySelectorAll('.btn').forEach(btn => {
                    if (btn.textContent === 'Pointer Mode') btn.classList.remove('active');
                });
            }
        }

        // Arrow keys for sentence navigation
        if (sentenceModeActive) {
            if (e.key === 'ArrowLeft') {
                prevSentence();
            } else if (e.key === 'ArrowRight') {
                nextSentence();
            }
        }
    });
});

function loadPreferences() {
    // Dark mode
    if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
        setTimeout(() => {
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent.includes('Dark')) {
                    btn.textContent = '‚òÄÔ∏è Light';
                    btn.classList.add('active');
                }
            });
        }, 0);
    }

    // Line numbers
    if (localStorage.getItem('lineNumbers') === 'true') {
        document.getElementById('latinText').classList.add('show-lines');
        setTimeout(() => {
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent === 'Line Numbers') {
                    btn.classList.add('active');
                }
            });
        }, 0);
    }
}

function savePreference(key, value) {
    localStorage.setItem(key, value);
}
    </script>
</body>
</html>
