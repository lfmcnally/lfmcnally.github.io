<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classicalia - Tacitus Annals 14.12</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 240px;
            background: white;
            border-right: 1px solid #e5e7eb;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }
        .logo-section {
            padding: 1.5rem 1.25rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }
        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #0066ff 0%, #4d94ff 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.1rem;
        }
        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
        }
        .nav-section {
            padding: 1rem 0.5rem;
        }
        .nav-title {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #9ca3af;
            letter-spacing: 0.05em;
            padding: 0 0.75rem;
            margin-bottom: 0.5rem;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.625rem 0.75rem;
            margin: 0.125rem 0;
            border-radius: 8px;
            text-decoration: none;
            color: #4b5563;
            font-size: 0.9rem;
            transition: all 0.15s ease;
            cursor: pointer;
        }
        .nav-item:hover {
            background: #f3f4f6;
            color: #1f2937;
        }
        .nav-item.active {
            background: #eef2ff;
            color: #0066ff;
            font-weight: 500;
        }
        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }
        .main-content {
            margin-left: 240px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .top-bar {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0.875rem 2rem;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .content-wrapper {
            flex: 1;
            overflow-y: auto;
        }
        .content-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }
        .lesson-header {
            margin-bottom: 2rem;
        }
        .lesson-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        .lesson-meta {
            display: flex;
            gap: 1.5rem;
            font-size: 0.875rem;
            color: #6b7280;
        }
        .card {
            background: white;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }
        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
        }
        .card-body {
            padding: 2rem;
        }
        .latin-text {
            font-size: 1.5rem;
            line-height: 2.4;
            color: #1f2937;
        }
        .word {
            cursor: pointer;
            padding: 2px 4px;
            margin: 0 1px;
            border-radius: 4px;
            transition: all 0.15s ease;
            display: inline;
        }
        .word:hover {
            background: rgba(0, 102, 255, 0.15);
        }
        .word.active {
            background: rgba(0, 102, 255, 0.25);
        }

        /* Popup styles */
        .vocab-popup {
            position: fixed;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05);
            padding: 1rem 1.25rem;
            z-index: 1000;
            max-width: 350px;
            min-width: 250px;
            display: none;
            animation: popIn 0.2s ease;
        }
        .vocab-popup::before {
            content: '';
            position: absolute;
            top: -8px;
            left: var(--arrow-left, 50%);
            transform: translateX(-50%);
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid white;
        }
        .vocab-popup.arrow-bottom::before {
            top: auto;
            bottom: -8px;
            border-bottom: none;
            border-top: 8px solid white;
        }
        body.dark-mode .vocab-popup::before {
            border-bottom-color: #4f0c28;
        }
        body.dark-mode .vocab-popup.arrow-bottom::before {
            border-bottom-color: transparent;
            border-top-color: #4f0c28;
        }
        @keyframes popIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .vocab-popup.visible {
            display: block;
        }
        .vocab-popup h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #0066ff;
            margin-bottom: 0.5rem;
        }
        .vocab-popup .parsing {
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
            font-style: italic;
        }
        .vocab-popup .meaning {
            font-size: 0.95rem;
            color: #1f2937;
            line-height: 1.5;
        }
        .vocab-popup .principal-parts {
            font-size: 0.85rem;
            color: #4b5563;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid #e5e7eb;
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }
        .btn {
            padding: 0.625rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        .btn:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }
        .btn.active {
            background: #0066ff;
            color: white;
            border-color: #0066ff;
        }

        /* Dark mode styles */
        body.dark-mode {
            background: #2d0818;
        }
        body.dark-mode .sidebar {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .logo-icon {
            background: linear-gradient(135deg, #8b5a8a 0%, #a67aa6 100%);
        }
        body.dark-mode .logo-text {
            color: #c5d2f8;
        }
        body.dark-mode .nav-title {
            color: #9a8a9a;
        }
        body.dark-mode .nav-item {
            color: #b8a8b8;
        }
        body.dark-mode .nav-item:hover {
            background: #4f0c28;
            color: #c5d2f8;
        }
        body.dark-mode .nav-item.active {
            background: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .top-bar {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .card {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .card-header {
            border-color: #5a1a3a;
        }
        body.dark-mode .card-title {
            color: #c5d2f8;
        }
        body.dark-mode .lesson-title {
            color: #c5d2f8;
        }
        body.dark-mode .lesson-meta {
            color: #b8a8b8;
        }
        body.dark-mode .latin-text {
            color: #c5d2f8;
            text-shadow: 0 0 20px rgba(197, 210, 248, 0.15);
        }
        body.dark-mode .word:hover {
            background: rgba(232, 212, 168, 0.25);
        }
        body.dark-mode .word.active {
            background: rgba(232, 212, 168, 0.35);
        }
        body.dark-mode .btn {
            background: #4f0c28;
            border-color: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .btn:hover {
            background: #5a1a3a;
        }
        body.dark-mode .btn.active {
            background: #7a3a5a;
            border-color: #8a4a6a;
        }
        body.dark-mode .resource-card {
            background: #4f0c28;
            border-color: #5a1a3a;
        }
        body.dark-mode .resource-card h4 {
            color: #c5d2f8;
        }
        body.dark-mode .resource-card p {
            color: #b8c8e8;
        }
        body.dark-mode .vocab-popup {
            background: #4f0c28;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        body.dark-mode .vocab-popup h4 {
            color: #e8d4a8;
        }
        body.dark-mode .vocab-popup .parsing {
            color: #b8a8b8;
        }
        body.dark-mode .vocab-popup .meaning {
            color: #c5d2f8;
        }
        body.dark-mode .vocab-popup .principal-parts {
            color: #a8b8d8;
            border-color: #5a1a3a;
        }

        /* Sentence hover highlight */
        .latin-text p {
            padding: 0.5rem 0.75rem;
            margin: 0 -0.75rem 1.5rem -0.75rem;
            border-radius: 6px;
            transition: background 0.2s ease;
        }
        .latin-text p:hover {
            background: rgba(59, 130, 246, 0.08);
        }
        body.dark-mode .latin-text p:hover {
            background: rgba(197, 210, 248, 0.1);
        }

        /* Sentence-by-sentence mode */
        .latin-text.sentence-mode p {
            display: none;
        }
        .latin-text.sentence-mode p.current-sentence {
            display: block;
        }
        .latin-text.sentence-mode p:hover {
            background: transparent;
        }

        .sentence-nav {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }
        .sentence-nav.visible {
            display: flex;
        }
        body.dark-mode .sentence-nav {
            border-color: #5a1a3a;
        }
        .sentence-nav button {
            padding: 0.5rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        .sentence-nav button:hover:not(:disabled) {
            background: #f3f4f6;
        }
        .sentence-nav button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        body.dark-mode .sentence-nav button {
            background: #4f0c28;
            border-color: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .sentence-nav button:hover:not(:disabled) {
            background: #5a1a3a;
        }
        .sentence-counter {
            font-size: 0.875rem;
            color: #6b7280;
            min-width: 80px;
            text-align: center;
        }
        body.dark-mode .sentence-counter {
            color: #b8a8b8;
        }

        /* Full-screen mode */
        body.full-screen .sidebar {
            display: none;
        }
        body.full-screen .main-content {
            margin-left: 0;
        }
        body.full-screen .lesson-header {
            display: none;
        }
        body.full-screen .content-container {
            max-width: 100%;
            padding: 1rem 2rem;
        }
        body.full-screen .card {
            border: none;
            border-radius: 0;
            background: transparent;
        }
        body.full-screen .card-header {
            display: none;
        }
        body.full-screen .card-body {
            padding: 1rem 2rem;
        }
        body.full-screen .latin-text {
            font-size: 2rem;
            line-height: 2.6;
        }
        body.full-screen .btn-group {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            background: white;
            padding: 0.75rem;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 200;
        }
        body.full-screen.dark-mode .btn-group {
            background: #3a0a1f;
        }
        body.full-screen .resource-card {
            display: none !important;
        }
        body.full-screen .sentence-nav {
            border: none;
            padding-top: 0;
        }
        body.full-screen .top-bar {
            display: none;
        }

        /* Line numbers */
        .latin-text.show-lines p {
            display: flex;
            align-items: flex-start;
        }
        .line-number {
            display: none;
            min-width: 2.5rem;
            color: #9ca3af;
            font-size: 0.875rem;
            padding-top: 0.3rem;
            user-select: none;
        }
        .latin-text.show-lines .line-number {
            display: block;
        }
        body.dark-mode .line-number {
            color: #7a6a7a;
        }
        .line-content {
            flex: 1;
        }

        /* Pointer/highlight mode */
        .word.pointed {
            background: rgba(255, 200, 50, 0.5) !important;
            box-shadow: 0 0 12px rgba(255, 200, 50, 0.6);
            border-radius: 4px;
        }
        body.dark-mode .word.pointed {
            background: rgba(232, 212, 168, 0.5) !important;
            box-shadow: 0 0 15px rgba(232, 212, 168, 0.5);
        }

        /* Pointer mode indicator */
        body.pointer-mode .word {
            cursor: crosshair;
        }
        .mode-indicator {
            display: none;
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: #fef3c7;
            color: #92400e;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            z-index: 200;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        body.pointer-mode .mode-indicator {
            display: block;
        }
        body.dark-mode .mode-indicator {
            background: #4f0c28;
            color: #e8d4a8;
        }

        .resource-card {
            background: #f9fafb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px solid #e5e7eb;
            display: none;
        }
        .resource-card.active {
            display: block;
        }
        .resource-card h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.75rem;
        }
        .resource-card p {
            font-size: 0.95rem;
            line-height: 1.8;
            color: #374151;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
            }
            .latin-text {
                font-size: 1.25rem;
                line-height: 2.2;
            }
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="logo-section">
            <a href="../../../index.html" class="logo">
                <div class="logo-icon">C</div>
                <span class="logo-text">Classicalia</span>
            </a>
        </div>
        <nav class="nav-section">
            <div class="nav-title">Resources</div>
            <div class="nav-item active" onclick="showView('text')">
                <span class="nav-icon">üìñ</span>
                <span>Read</span>
            </div>
            <div class="nav-item" onclick="showView('summary')">
                <span class="nav-icon">üìã</span>
                <span>Summary</span>
            </div>
            <div class="nav-item" onclick="showView('context')">
                <span class="nav-icon">üèõÔ∏è</span>
                <span>Context</span>
            </div>
            <div class="nav-item" onclick="showView('comprehension')">
                <span class="nav-icon">‚ùì</span>
                <span>Comprehension</span>
            </div>
        </nav>
    </aside>

    <main class="main-content">
        <div class="top-bar"></div>
        <div class="content-wrapper">
            <div class="content-container">
                <header class="lesson-header">
                    <h1 class="lesson-title">Celebrations and Omens</h1>
                    <div class="lesson-meta">
                        <span>üìï Tacitus Annals 14.12</span>
                        <span>‚è±Ô∏è 60 min</span>
                        <span>üìä A-Level</span>
                    </div>
                </header>

                <div class="card" id="textCard">
                    <div class="card-header">
                        <h3 class="card-title">Latin Text</h3>
                    </div>
                    <div class="card-body">
                        <div class="latin-text" id="latinText"></div>
                        <div class="btn-group">
                            <button class="btn" onclick="toggleTranslation()">Translation</button>
                            <button class="btn" onclick="toggleSentenceMode()">Sentence Mode</button>
                            <button class="btn" onclick="toggleLineNumbers()">Line Numbers</button>
                            <button class="btn" onclick="togglePointerMode()">Pointer Mode</button>
                            <button class="btn" onclick="toggleDarkMode()">üåô Dark</button>
                            <button class="btn" onclick="toggleFullScreen()">‚õ∂ Full Screen</button>
                        </div>
                        <div class="sentence-nav" id="sentenceNav">
                            <button onclick="prevSentence()">‚Üê Previous</button>
                            <span class="sentence-counter" id="sentenceCounter">1 / 10</span>
                            <button onclick="nextSentence()">Next ‚Üí</button>
                        </div>
                        <div class="resource-card" id="translationBox">
                            <h4>Translation</h4>
                            <p>However, public prayers were decreed at all the sacred couches of the gods to the accompaniment of remarkable rivalry among the nobles, and (it was decreed) that the Quinquatrus, at which the plot was revealed, should be celebrated with annual games; a golden statue of Minerva and an image of the emperor nearby were to be set up in the Senate House; the birthday of Agrippina was (included) among the unlucky days. Thrasea Paetus, who had been accustomed to let through former acts of flattery in silence or with brief assent, went out of the Senate at that point and created for himself a reason for danger, without showing the beginning of liberty to others. Numerous omens also intervened which proved ineffectual: a woman gave birth to a snake and another was killed by a thunderbolt in the act of intercourse with her husband; shortly afterwards, the sun was suddenly obscured, and fourteen regions of the city were struck from the sky. These things happened without any concern of the gods to such an extent that Nero continued his reign and crimes for many years afterwards. But in order to increase hatred of his mother and demonstrate that his leniency had been increased now that she was out of the way, he restored to their ancestral homes two famous women, Junia and Calpurnia, (together with) Valerius Capito and Licinius Gabolus, who had completed their praetorships and been banished some time before by Agrippina. He even allowed the ashes of Lollia Paulina to be brought back and a tomb to be erected; and he released from punishment Iturius and Calvisius, whom he himself had recently banished. For Silana had completed her destiny, when she returned to Tarentum from a distant exile, since Agrippina, by whose enmity she had fallen, was now declining in influence or appeased.</p>
                        </div>
                    </div>
                </div>

                <div class="card" id="resourceCard" style="display: none; margin-top: 1.5rem;">
                    <div class="card-header">
                        <h3 class="card-title" id="resourceTitle">Summary</h3>
                    </div>
                    <div class="card-body" id="resourceContent"></div>
                </div>
            </div>
        </div>
    </main>

    <div class="vocab-popup" id="vocabPopup"></div>
    <div class="mode-indicator">üìç Pointer Mode (click words to highlight, click again to remove)</div>

    <script>
const vocab = {
    "miro": { lemma: "mirus, -a, -um", parsing: "abl. sing.", meaning: "remarkable, extraordinary" },
    "tamen": { lemma: "tamen", parsing: "adverb", meaning: "however, nevertheless" },
    "certamine": { lemma: "certamen, -inis (n.)", parsing: "abl. sing.", meaning: "competition, rivalry" },
    "procerum": { lemma: "procer, -eris (m.)", parsing: "gen. pl.", meaning: "of nobles" },
    "decernuntur": { lemma: "decerno, -ere, decrevi, decretum", parsing: "pres. pass. ind. 3rd pl.", meaning: "are decreed" },
    "supplicationes": { lemma: "supplicatio, -onis (f.)", parsing: "nom. pl.", meaning: "public thanksgivings, prayers" },
    "apud": { lemma: "apud", parsing: "preposition + acc.", meaning: "at, near" },
    "omnia": { lemma: "omnis, -e", parsing: "acc. neut. pl.", meaning: "all" },
    "pulvinaria": { lemma: "pulvinar, -aris (n.)", parsing: "acc. pl.", meaning: "sacred couches for gods" },
    "ut": { lemma: "ut", parsing: "conjunction", meaning: "that, so that" },
    "utque": { lemma: "ut + -que", parsing: "conjunction", meaning: "and that" },
    "que": { lemma: "-que", parsing: "enclitic conjunction", meaning: "and" },
    "quinquatrus": { lemma: "Quinquatrus, -uum (f. pl.)", parsing: "nom.", meaning: "Quinquatrus festival (of Minerva)" },
    "quibus": { lemma: "qui, quae, quod", parsing: "abl. pl.", meaning: "at which" },
    "apertae": { lemma: "aperio, -ire, aperui, apertum", parsing: "perf. pass. part. nom. fem. pl.", meaning: "revealed, exposed" },
    "insidiae": { lemma: "insidiae, -arum (f. pl.)", parsing: "nom. pl.", meaning: "plot, ambush" },
    "essent": { lemma: "sum, esse, fui", parsing: "imperf. subj. 3rd pl.", meaning: "were" },
    "ludis": { lemma: "ludus, -i (m.)", parsing: "abl. pl.", meaning: "with games" },
    "annuis": { lemma: "annuus, -a, -um", parsing: "abl. pl.", meaning: "annual, yearly" },
    "celebrarentur": { lemma: "celebro, -are, -avi, -atum", parsing: "imperf. pass. subj. 3rd pl.", meaning: "should be celebrated" },
    "aureum": { lemma: "aureus, -a, -um", parsing: "acc. neut. sing.", meaning: "golden" },
    "minervae": { lemma: "Minerva, -ae (f.)", parsing: "gen. sing.", meaning: "of Minerva" },
    "simulacrum": { lemma: "simulacrum, -i (n.)", parsing: "nom. sing.", meaning: "statue, image" },
    "in": { lemma: "in", parsing: "preposition + abl.", meaning: "in, on" },
    "curia": { lemma: "curia, -ae (f.)", parsing: "abl. sing.", meaning: "Senate House" },
    "et": { lemma: "et", parsing: "conjunction", meaning: "and" },
    "iuxta": { lemma: "iuxta", parsing: "adverb/preposition", meaning: "next to, beside" },
    "principis": { lemma: "princeps, -cipis (m.)", parsing: "gen. sing.", meaning: "of the emperor" },
    "imago": { lemma: "imago, -inis (f.)", parsing: "nom. sing.", meaning: "image, likeness" },
    "statuerentur": { lemma: "statuo, -ere, statui, statutum", parsing: "imperf. pass. subj. 3rd pl.", meaning: "should be set up" },
    "dies": { lemma: "dies, -ei (m./f.)", parsing: "nom. sing.", meaning: "day" },
    "natalis": { lemma: "natalis, -e", parsing: "gen. sing.", meaning: "of birth, birthday" },
    "agrippinae": { lemma: "Agrippina, -ae (f.)", parsing: "gen. sing.", meaning: "of Agrippina" },
    "inter": { lemma: "inter", parsing: "preposition + acc.", meaning: "among, between" },
    "nefastos": { lemma: "nefastus, -a, -um", parsing: "acc. pl.", meaning: "unlucky, cursed" },
    "esset": { lemma: "sum, esse, fui", parsing: "imperf. subj. 3rd sing.", meaning: "should be" },
    "thrasea": { lemma: "Thrasea, -ae (m.)", parsing: "nom. sing.", meaning: "Thrasea (proper name)" },
    "paetus": { lemma: "Paetus, -i (m.)", parsing: "nom. sing.", meaning: "Paetus (proper name)" },
    "silentio": { lemma: "silentium, -i (n.)", parsing: "abl. sing.", meaning: "in silence" },
    "vel": { lemma: "vel", parsing: "conjunction", meaning: "or, even" },
    "brevi": { lemma: "brevis, -e", parsing: "abl. sing.", meaning: "brief, short" },
    "adsensu": { lemma: "adsensus, -us (m.)", parsing: "abl. sing.", meaning: "with assent, agreement" },
    "priores": { lemma: "prior, -ius", parsing: "acc. pl.", meaning: "previous, former" },
    "adulationes": { lemma: "adulatio, -onis (f.)", parsing: "acc. pl.", meaning: "flatteries, acts of flattery" },
    "transmittere": { lemma: "transmitto, -ere, -misi, -missum", parsing: "pres. inf.", meaning: "to let pass, allow through" },
    "solitus": { lemma: "soleo, -ere, solitus sum", parsing: "perf. part. nom. masc. sing.", meaning: "accustomed" },
    "exiit": { lemma: "exeo, -ire, -ii, -itum", parsing: "perf. act. ind. 3rd sing.", meaning: "went out, left" },
    "tum": { lemma: "tum", parsing: "adverb", meaning: "then, at that time" },
    "senatu": { lemma: "senatus, -us (m.)", parsing: "abl. sing.", meaning: "from the Senate" },
    "ac": { lemma: "ac/atque", parsing: "conjunction", meaning: "and" },
    "sibi": { lemma: "sui, sibi, se", parsing: "dat. reflexive", meaning: "for himself" },
    "causam": { lemma: "causa, -ae (f.)", parsing: "acc. sing.", meaning: "cause, reason" },
    "periculi": { lemma: "periculum, -i (n.)", parsing: "gen. sing.", meaning: "of danger" },
    "fecit": { lemma: "facio, -ere, feci, factum", parsing: "perf. act. ind. 3rd sing.", meaning: "made, created" },
    "ceteris": { lemma: "ceteri, -ae, -a", parsing: "dat. pl.", meaning: "to the others" },
    "libertatis": { lemma: "libertas, -atis (f.)", parsing: "gen. sing.", meaning: "of freedom" },
    "initium": { lemma: "initium, -i (n.)", parsing: "acc. sing.", meaning: "beginning, start" },
    "non": { lemma: "non", parsing: "adverb", meaning: "not" },
    "praebuit": { lemma: "praebeo, -ere, -ui, -itum", parsing: "perf. act. ind. 3rd sing.", meaning: "offered, provided" },
    "prodigia": { lemma: "prodigium, -i (n.)", parsing: "nom. pl.", meaning: "omens, portents" },
    "quoque": { lemma: "quoque", parsing: "adverb", meaning: "also, too" },
    "crebra": { lemma: "creber, -bra, -brum", parsing: "nom. neut. pl.", meaning: "numerous, frequent" },
    "inrita": { lemma: "inritus, -a, -um", parsing: "nom. neut. pl.", meaning: "ineffectual, void" },
    "intercessere": { lemma: "intercedo, -ere, -cessi, -cessum", parsing: "perf. act. ind. 3rd pl.", meaning: "intervened, occurred" },
    "anguem": { lemma: "anguis, -is (m./f.)", parsing: "acc. sing.", meaning: "snake, serpent" },
    "enixa": { lemma: "enitor, -i, enixus/enisus sum", parsing: "perf. part. nom. fem. sing.", meaning: "having given birth to" },
    "mulier": { lemma: "mulier, -eris (f.)", parsing: "nom. sing.", meaning: "woman" },
    "alia": { lemma: "alius, -a, -ud", parsing: "nom. fem. sing.", meaning: "another" },
    "concubitu": { lemma: "concubitus, -us (m.)", parsing: "abl. sing.", meaning: "in intercourse, during sex" },
    "mariti": { lemma: "maritus, -i (m.)", parsing: "gen. sing.", meaning: "of husband" },
    "fulmine": { lemma: "fulmen, -inis (n.)", parsing: "abl. sing.", meaning: "by lightning" },
    "exanimata": { lemma: "exanimo, -are, -avi, -atum", parsing: "perf. pass. part. nom. fem. sing.", meaning: "killed, struck dead" },
    "iam": { lemma: "iam", parsing: "adverb", meaning: "now, already" },
    "sol": { lemma: "sol, solis (m.)", parsing: "nom. sing.", meaning: "sun" },
    "repente": { lemma: "repente", parsing: "adverb", meaning: "suddenly" },
    "obscuratus": { lemma: "obscuro, -are, -avi, -atum", parsing: "perf. pass. part. nom. masc. sing.", meaning: "darkened, obscured" },
    "tactae": { lemma: "tango, -ere, tetigi, tactum", parsing: "perf. pass. part. nom. fem. pl.", meaning: "struck, touched" },
    "de": { lemma: "de", parsing: "preposition + abl.", meaning: "from, down from" },
    "caelo": { lemma: "caelum, -i (n.)", parsing: "abl. sing.", meaning: "heaven, sky" },
    "quattuordecim": { lemma: "quattuordecim", parsing: "indeclinable numeral", meaning: "fourteen" },
    "urbis": { lemma: "urbs, urbis (f.)", parsing: "gen. sing.", meaning: "of the city" },
    "regiones": { lemma: "regio, -onis (f.)", parsing: "nom. pl.", meaning: "regions, districts" },
    "quae": { lemma: "qui, quae, quod", parsing: "nom. neut. pl.", meaning: "which things" },
    "adeo": { lemma: "adeo", parsing: "adverb", meaning: "to such an extent, so much" },
    "sine": { lemma: "sine", parsing: "preposition + abl.", meaning: "without" },
    "cura": { lemma: "cura, -ae (f.)", parsing: "abl. sing.", meaning: "care, concern" },
    "deum": { lemma: "deus, -i (m.)", parsing: "gen. pl.", meaning: "of the gods" },
    "eveniebant": { lemma: "evenio, -ire, eveni, eventum", parsing: "imperf. act. ind. 3rd pl.", meaning: "were happening" },
    "multos": { lemma: "multus, -a, -um", parsing: "acc. masc. pl.", meaning: "many" },
    "post": { lemma: "post", parsing: "preposition + acc.", meaning: "after" },
    "annos": { lemma: "annus, -i (m.)", parsing: "acc. pl.", meaning: "years" },
    "nero": { lemma: "Nero, -onis (m.)", parsing: "nom. sing.", meaning: "Nero" },
    "imperium": { lemma: "imperium, -i (n.)", parsing: "acc. sing.", meaning: "power, empire" },
    "scelera": { lemma: "scelus, -eris (n.)", parsing: "acc. pl.", meaning: "crimes, wickedness" },
    "continuaverit": { lemma: "continuo, -are, -avi, -atum", parsing: "perf. subj. act. 3rd sing.", meaning: "continued" },
    "ceterum": { lemma: "ceterum", parsing: "adverb", meaning: "but, however" },
    "quo": { lemma: "quo", parsing: "conjunction + subj.", meaning: "in order that, so that" },
    "gravaret": { lemma: "gravo, -are, -avi, -atum", parsing: "imperf. subj. act. 3rd sing.", meaning: "he might increase" },
    "invidiam": { lemma: "invidia, -ae (f.)", parsing: "acc. sing.", meaning: "hatred, unpopularity" },
    "matris": { lemma: "mater, matris (f.)", parsing: "gen. sing.", meaning: "of mother" },
    "ea": { lemma: "is, ea, id", parsing: "abl. fem. sing.", meaning: "she" },
    "eaque": { lemma: "is, ea, id + -que", parsing: "abl. fem. sing. + and", meaning: "and she" },
    "demota": { lemma: "demoveo, -ere, -movi, -motum", parsing: "perf. pass. part. abl. fem. sing.", meaning: "removed, out of the way" },
    "auctam": { lemma: "augeo, -ere, auxi, auctum", parsing: "perf. pass. part. acc. fem. sing.", meaning: "increased" },
    "lenitatem": { lemma: "lenitas, -atis (f.)", parsing: "acc. sing.", meaning: "mercy, clemency" },
    "suam": { lemma: "suus, -a, -um", parsing: "acc. fem. sing.", meaning: "his own" },
    "testificaretur": { lemma: "testificor, -ari, -atus sum", parsing: "imperf. subj. dep. 3rd sing.", meaning: "he might demonstrate" },
    "feminas": { lemma: "femina, -ae (f.)", parsing: "acc. pl.", meaning: "women" },
    "inlustres": { lemma: "inlustris, -e", parsing: "acc. pl.", meaning: "distinguished, noble" },
    "iuniam": { lemma: "Iunia, -ae (f.)", parsing: "acc. sing.", meaning: "Junia (proper name)" },
    "calpurniam": { lemma: "Calpurnia, -ae (f.)", parsing: "acc. sing.", meaning: "Calpurnia (proper name)" },
    "praetura": { lemma: "praetura, -ae (f.)", parsing: "abl. sing.", meaning: "praetorship" },
    "functos": { lemma: "fungor, -i, functus sum", parsing: "perf. part. acc. masc. pl.", meaning: "having completed" },
    "valerium": { lemma: "Valerius, -i (m.)", parsing: "acc. sing.", meaning: "Valerius (proper name)" },
    "capitonem": { lemma: "Capito, -onis (m.)", parsing: "acc. sing.", meaning: "Capito (proper name)" },
    "licinium": { lemma: "Licinius, -i (m.)", parsing: "acc. sing.", meaning: "Licinius (proper name)" },
    "gabolum": { lemma: "Gabolus, -i (m.)", parsing: "acc. sing.", meaning: "Gabolus (proper name)" },
    "sedibus": { lemma: "sedes, -is (f.)", parsing: "dat. pl.", meaning: "to homes" },
    "patriis": { lemma: "patrius, -a, -um", parsing: "dat. pl.", meaning: "ancestral, family" },
    "reddidit": { lemma: "reddo, -ere, reddidi, redditum", parsing: "perf. act. ind. 3rd sing.", meaning: "restored, gave back" },
    "ab": { lemma: "ab/a", parsing: "preposition + abl.", meaning: "by, from" },
    "agrippina": { lemma: "Agrippina, -ae (f.)", parsing: "abl. sing.", meaning: "by Agrippina" },
    "olim": { lemma: "olim", parsing: "adverb", meaning: "formerly, some time ago" },
    "pulsos": { lemma: "pello, -ere, pepuli, pulsum", parsing: "perf. pass. part. acc. masc. pl.", meaning: "exiled, driven out" },
    "etiam": { lemma: "etiam", parsing: "adverb", meaning: "even, also" },
    "lolliae": { lemma: "Lollia, -ae (f.)", parsing: "gen. sing.", meaning: "of Lollia" },
    "paulinae": { lemma: "Paulina, -ae (f.)", parsing: "gen. sing.", meaning: "of Paulina" },
    "cineres": { lemma: "cinis, -eris (m.)", parsing: "acc. pl.", meaning: "ashes" },
    "reportari": { lemma: "reporto, -are, -avi, -atum", parsing: "pres. pass. inf.", meaning: "to be brought back" },
    "sepulcrum": { lemma: "sepulcrum, -i (n.)", parsing: "acc. sing.", meaning: "tomb, sepulchre" },
    "sepulcrumque": { lemma: "sepulcrum, -i (n.) + -que", parsing: "acc. sing. + and", meaning: "and a tomb" },
    "extrui": { lemma: "exstruo, -ere, -struxi, -structum", parsing: "pres. pass. inf.", meaning: "to be built" },
    "permisit": { lemma: "permitto, -ere, -misi, -missum", parsing: "perf. act. ind. 3rd sing.", meaning: "allowed, permitted" },
    "quos": { lemma: "qui, quae, quod", parsing: "acc. masc. pl.", meaning: "whom" },
    "quosque": { lemma: "qui, quae, quod + -que", parsing: "acc. masc. pl. + and", meaning: "and whom" },
    "ipse": { lemma: "ipse, ipsa, ipsum", parsing: "nom. masc. sing.", meaning: "he himself" },
    "nuper": { lemma: "nuper", parsing: "adverb", meaning: "recently" },
    "relegaverat": { lemma: "relego, -are, -avi, -atum", parsing: "pluperf. act. ind. 3rd sing.", meaning: "had banished" },
    "iturium": { lemma: "Iturius, -i (m.)", parsing: "acc. sing.", meaning: "Iturius (proper name)" },
    "calvisium": { lemma: "Calvisius, -i (m.)", parsing: "acc. sing.", meaning: "Calvisius (proper name)" },
    "poena": { lemma: "poena, -ae (f.)", parsing: "abl. sing.", meaning: "from punishment" },
    "exolvit": { lemma: "exsolvo, -ere, -solvi, -solutum", parsing: "perf. act. ind. 3rd sing.", meaning: "released, freed" },
    "nam": { lemma: "nam", parsing: "conjunction", meaning: "for" },
    "silana": { lemma: "Silana, -ae (f.)", parsing: "nom. sing.", meaning: "Silana (proper name)" },
    "fato": { lemma: "fatum, -i (n.)", parsing: "abl. sing.", meaning: "by fate, death" },
    "functa": { lemma: "fungor, -i, functus sum", parsing: "perf. part. nom. fem. sing.", meaning: "having met with" },
    "erat": { lemma: "sum, esse, fui", parsing: "imperf. ind. 3rd sing.", meaning: "was" },
    "longinquo": { lemma: "longinquus, -a, -um", parsing: "abl. neut. sing.", meaning: "distant, remote" },
    "exilio": { lemma: "exilium, -i (n.)", parsing: "abl. sing.", meaning: "from exile" },
    "tarentum": { lemma: "Tarentum, -i (n.)", parsing: "acc. sing.", meaning: "to Tarentum" },
    "regressa": { lemma: "regredior, -i, regressus sum", parsing: "perf. part. nom. fem. sing.", meaning: "having returned" },
    "labante": { lemma: "labo, -are, -avi, -atum", parsing: "pres. part. abl. sing.", meaning: "declining, wavering" },
    "cuius": { lemma: "qui, quae, quod", parsing: "gen. sing.", meaning: "whose" },
    "inimicitiis": { lemma: "inimicitia, -ae (f.)", parsing: "abl. pl.", meaning: "by enmities" },
    "conciderat": { lemma: "concido, -ere, -cidi", parsing: "pluperf. act. ind. 3rd sing.", meaning: "had fallen, been ruined" },
    "mitigata": { lemma: "mitigo, -are, -avi, -atum", parsing: "perf. pass. part. abl. fem. sing.", meaning: "softened, appeased" }
};

const latinSentences = [
    "miro tamen certamine procerum decernuntur supplicationes apud omnia pulvinaria,",
    "utque Quinquatrus quibus apertae insidiae essent ludis annuis celebrarentur;",
    "aureum Minervae simulacrum in curia et iuxta principis imago statuerentur; dies natalis Agrippinae inter nefastos esset.",
    "Thrasea Paetus silentio vel brevi adsensu priores adulationes transmittere solitus exiit tum senatu ac sibi causam periculi fecit, ceteris libertatis initium non praebuit.",
    "prodigia quoque crebra et inrita intercessere: anguem enixa mulier et alia in concubitu mariti fulmine exanimata;",
    "iam sol repente obscuratus et tactae de caelo quattuordecim urbis regiones.",
    "quae adeo sine cura deum eveniebant ut multos post annos Nero imperium et scelera continuaverit.",
    "ceterum quo gravaret invidiam matris eaque demota auctam lenitatem suam testificaretur, feminas inlustres Iuniam et Calpurniam, praetura functos Valerium Capitonem et Licinium Gabolum sedibus patriis reddidit, ab Agrippina olim pulsos.",
    "etiam Lolliae Paulinae cineres reportari sepulcrumque extrui permisit; quosque ipse nuper relegaverat, Iturium et Calvisium poena exolvit.",
    "nam Silana fato functa erat, longinquo ab exilio Tarentum regressa labante iam Agrippina, cuius inimicitiis conciderat, vel mitigata."
];

const resources = {
    summary: `<h4>Summary</h4>
<p>In this passage, the Senate engages in competitive flattery, decreeing thanksgivings at all temples and annual games for the Quinquatrus (now rebranded as when the "plot" was exposed). They order a golden statue of Minerva with Nero's image beside it for the Senate House, and declare Agrippina's birthday cursed‚Äîa religious erasure of memory.</p>
<p>Thrasea Paetus, who had previously tolerated flattery with silence or minimal assent, walks out of the Senate‚Äîcreating danger for himself without inspiring others to resist. Multiple omens occur: a woman births a snake, another is killed by lightning during sex, the sun darkens, and fourteen districts are struck by lightning. Yet Tacitus notes these proved meaningless‚ÄîNero continued ruling and committing crimes for years, suggesting divine indifference.</p>
<p>To "prove" Agrippina's evil and his new mercy, Nero recalls those she had exiled: noblewomen Junia and Calpurnia, ex-praetors Valerius Capito and Licinius Gabolus, allows Lollia Paulina's ashes proper burial, and pardons Iturius and Calvisius (whom he himself had exiled). Silana, Agrippina's enemy, had already died returning from exile as Agrippina's power waned‚Äîconvenient timing for the narrative.</p>`,
    context: `<h4>Historical Context</h4>
<p><strong>The Quinquatrus:</strong> The Quinquatrus (March 19-23) was Minerva's festival‚Äîits perversion into celebrating matricide shows religious corruption. Placing statues in the Senate House made political statements‚ÄîMinerva with Nero suggests wisdom approving murder. Declaring days "nefasti" (religiously unlucky) was serious‚Äîno public business could occur, effectively erasing the person from the calendar.</p>
<p><strong>Thrasea Paetus:</strong> Thrasea Paetus was a Stoic senator who would later be forced to suicide by Nero‚Äîhis walkout begins his resistance. His silent protest demonstrates the impossibility of principled opposition under tyranny: speaking out meant death, but even walking out "created for himself a reason for danger."</p>
<p><strong>Roman Prodigies:</strong> Roman prodigies (births of monsters, lightning strikes, eclipses) traditionally indicated divine anger requiring expiation. The fourteen regions were Rome's administrative districts‚Äîlightning striking all suggests comprehensive divine wrath. Tacitus's dismissal of these as "ineffectual" is deeply ironic: either the gods don't care, or their warnings mean nothing.</p>
<p><strong>The Recalled Exiles:</strong> The recalled exiles were genuine historical figures‚ÄîLollia Paulina had been Caligula's wife, a rival to Agrippina for Claudius's hand. Tarentum (modern Taranto) was a common exile location‚Äîfar enough for punishment, close enough for recall. Nero's "clemency" is hollow propaganda, blaming all past cruelty on his dead mother.</p>`,
    comprehension: `<h4>Comprehension Questions</h4>
<p><strong>Lines 1-3:</strong> What honours does the Senate decree for Nero? What is ironic about celebrating the Quinquatrus as when the "plot was revealed"?</p>
<p><strong>Line 3:</strong> What is the significance of declaring Agrippina's birthday among the "dies nefasti"? How does this constitute damnatio memoriae?</p>
<p><strong>Line 4:</strong> How had Thrasea Paetus typically responded to senatorial flattery before this? What changed, and what were the consequences?</p>
<p><strong>Lines 4:</strong> Tacitus says Thrasea "ceteris libertatis initium non praebuit" (did not provide the beginning of liberty to others). What does this suggest about the possibility of resistance?</p>
<p><strong>Lines 5-6:</strong> List the omens that occurred. What traditional Roman interpretation would these portents receive?</p>
<p><strong>Line 7:</strong> What is Tacitus's verdict on the omens with "adeo sine cura deum"? How does this comment on divine justice?</p>
<p><strong>Lines 8-9:</strong> Why does Nero recall Agrippina's victims? What does "quo gravaret invidiam matris" reveal about his motivation?</p>
<p><strong>Line 10:</strong> What happened to Silana? Why does Tacitus note she returned "labante iam Agrippina"?</p>
<p><strong>Overall:</strong> How does this passage demonstrate the corruption of Roman religious and political institutions under Nero?</p>`
};

let currentPopup = null;
let sentenceModeActive = false;
let currentSentenceIndex = 0;
let pointerModeActive = false;

function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    const isDark = document.body.classList.contains('dark-mode');
    savePreference('darkMode', isDark);

    const btn = event.currentTarget;
    if (isDark) {
        btn.textContent = '‚òÄÔ∏è Light';
        btn.classList.add('active');
    } else {
        btn.textContent = 'üåô Dark';
        btn.classList.remove('active');
    }
}

function toggleFullScreen() {
    document.body.classList.toggle('full-screen');
    const btn = event.currentTarget;
    if (document.body.classList.contains('full-screen')) {
        btn.textContent = '‚õ∂ Exit Full Screen';
        btn.classList.add('active');
    } else {
        btn.textContent = '‚õ∂ Full Screen';
        btn.classList.remove('active');
    }
}

function toggleLineNumbers() {
    const latinText = document.getElementById('latinText');
    latinText.classList.toggle('show-lines');
    const showLines = latinText.classList.contains('show-lines');
    savePreference('lineNumbers', showLines);

    const btn = event.currentTarget;
    btn.classList.toggle('active');
}

function togglePointerMode() {
    pointerModeActive = !pointerModeActive;
    document.body.classList.toggle('pointer-mode');
    const btn = event.currentTarget;
    btn.classList.toggle('active');

    if (!pointerModeActive) {
        // Clear all pointed words when exiting pointer mode
        document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
    }

    // Hide vocab popup when entering pointer mode
    if (pointerModeActive) {
        hidePopup();
    }
}

function toggleSentenceMode() {
    const latinText = document.getElementById('latinText');
    const sentenceNav = document.getElementById('sentenceNav');
    const btn = event.currentTarget;

    sentenceModeActive = !sentenceModeActive;

    if (sentenceModeActive) {
        latinText.classList.add('sentence-mode');
        sentenceNav.classList.add('visible');
        btn.classList.add('active');
        btn.textContent = 'Full Text';
        currentSentenceIndex = 0;
        updateSentenceDisplay();
    } else {
        latinText.classList.remove('sentence-mode');
        sentenceNav.classList.remove('visible');
        btn.classList.remove('active');
        btn.textContent = 'Sentence Mode';
        // Remove current-sentence class from all
        document.querySelectorAll('.latin-text p').forEach(p => p.classList.remove('current-sentence'));
    }
}

function updateSentenceDisplay() {
    const paragraphs = document.querySelectorAll('.latin-text p');
    paragraphs.forEach((p, i) => {
        if (i === currentSentenceIndex) {
            p.classList.add('current-sentence');
        } else {
            p.classList.remove('current-sentence');
        }
    });
    document.getElementById('sentenceCounter').textContent = `${currentSentenceIndex + 1} / ${paragraphs.length}`;

    // Update button states
    const navButtons = document.querySelectorAll('.sentence-nav button');
    navButtons[0].disabled = currentSentenceIndex === 0;
    navButtons[1].disabled = currentSentenceIndex === paragraphs.length - 1;
}

function prevSentence() {
    if (currentSentenceIndex > 0) {
        currentSentenceIndex--;
        updateSentenceDisplay();
        hidePopup();
    }
}

function nextSentence() {
    const paragraphs = document.querySelectorAll('.latin-text p');
    if (currentSentenceIndex < paragraphs.length - 1) {
        currentSentenceIndex++;
        updateSentenceDisplay();
        hidePopup();
    }
}

function generateLatinHTML() {
    let html = '';
    latinSentences.forEach((sentence, index) => {
        // Split into tokens, keeping punctuation attached to words
        const tokens = sentence.match(/[a-zA-Z]+[.,;:]*|[.,;:]+/g);
        html += '<p style="margin-bottom: 1.5rem;">';
        html += `<span class="line-number">${index + 1}</span>`;
        html += '<span class="line-content">';
        if (tokens) {
            tokens.forEach((token, i) => {
                // Separate word from trailing punctuation
                const match = token.match(/^([a-zA-Z]+)([.,;:]*)$/);
                if (match) {
                    const word = match[1];
                    const punct = match[2];
                    const lookupWord = word.toLowerCase();
                    html += `<span class="word" data-word="${lookupWord}">${word}</span>${punct}`;
                    // Add space after unless it's the last token
                    if (i < tokens.length - 1) html += ' ';
                } else {
                    // Just punctuation
                    html += token + ' ';
                }
            });
        }
        html += '</span></p>';
    });
    return html;
}

function showVocabPopup(event, word) {
    const popup = document.getElementById('vocabPopup');
    const wordData = vocab[word.toLowerCase()];

    // Remove active class from all words
    document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active'));

    if (!wordData) {
        popup.classList.remove('visible');
        return;
    }

    // Add active class to clicked word
    event.target.classList.add('active');

    popup.innerHTML = `
        <h4>${word}</h4>
        <div class="parsing">${wordData.parsing}</div>
        <div class="meaning">${wordData.meaning}</div>
        <div class="principal-parts">${wordData.lemma}</div>
    `;

    // Position popup near the word
    const rect = event.target.getBoundingClientRect();
    const popupWidth = 300;
    const popupHeight = 150;

    let left = rect.left + (rect.width / 2) - (popupWidth / 2);
    let top = rect.bottom + 12;
    let arrowBottom = false;

    // Keep popup within viewport horizontally
    if (left < 10) left = 10;
    if (left + popupWidth > window.innerWidth - 10) {
        left = window.innerWidth - popupWidth - 10;
    }

    // If popup would go below viewport, show above word
    if (top + popupHeight > window.innerHeight) {
        top = rect.top - popupHeight - 12;
        arrowBottom = true;
    }

    // Calculate arrow position relative to popup
    const wordCenterX = rect.left + (rect.width / 2);
    const arrowLeft = Math.max(20, Math.min(popupWidth - 20, wordCenterX - left));

    popup.style.left = left + 'px';
    popup.style.top = top + 'px';
    popup.style.setProperty('--arrow-left', arrowLeft + 'px');
    popup.classList.toggle('arrow-bottom', arrowBottom);
    popup.classList.add('visible');

    currentPopup = popup;
}

function hidePopup() {
    const popup = document.getElementById('vocabPopup');
    popup.classList.remove('visible');
    document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active'));
}

function toggleTranslation() {
    const box = document.getElementById('translationBox');
    const btn = event.currentTarget;

    if (box.classList.contains('active')) {
        box.classList.remove('active');
        btn.textContent = 'Translation';
        btn.classList.remove('active');
    } else {
        box.classList.add('active');
        btn.textContent = 'Hide Translation';
        btn.classList.add('active');
    }
}

function showView(view) {
    // Update nav
    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
    event.currentTarget.classList.add('active');

    const textCard = document.getElementById('textCard');
    const resourceCard = document.getElementById('resourceCard');

    if (view === 'text') {
        textCard.style.display = 'block';
        resourceCard.style.display = 'none';
    } else {
        textCard.style.display = 'none';
        resourceCard.style.display = 'block';
        document.getElementById('resourceTitle').textContent = view.charAt(0).toUpperCase() + view.slice(1);
        document.getElementById('resourceContent').innerHTML = resources[view];
    }
}

// Initialise
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('latinText').innerHTML = generateLatinHTML();

    // Load saved preferences
    loadPreferences();

    // Add click handlers to words
    document.querySelectorAll('.word').forEach(word => {
        word.addEventListener('click', function(e) {
            e.stopPropagation();

            if (pointerModeActive) {
                // Toggle pointed class
                this.classList.toggle('pointed');
            } else {
                showVocabPopup(e, this.dataset.word);
            }
        });
    });

    // Hide popup when clicking elsewhere, clear pointer highlights on background click
    document.addEventListener('click', function(e) {
        if (!e.target.classList.contains('word')) {
            hidePopup();

            // If in pointer mode and clicking background (not buttons), clear all highlights
            if (pointerModeActive && !e.target.closest('.btn-group') && !e.target.closest('.sentence-nav')) {
                document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
            }
        }
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Escape to exit full screen
        if (e.key === 'Escape') {
            if (document.body.classList.contains('full-screen')) {
                document.body.classList.remove('full-screen');
                const btn = document.querySelector('.btn-group .btn:last-child');
                if (btn) {
                    btn.textContent = '‚õ∂ Full Screen';
                    btn.classList.remove('active');
                }
            }
            // Also exit pointer mode on escape
            if (pointerModeActive) {
                pointerModeActive = false;
                document.body.classList.remove('pointer-mode');
                document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
                document.querySelectorAll('.btn').forEach(btn => {
                    if (btn.textContent === 'Pointer Mode') btn.classList.remove('active');
                });
            }
        }

        // Arrow keys for sentence navigation
        if (sentenceModeActive) {
            if (e.key === 'ArrowLeft') {
                prevSentence();
            } else if (e.key === 'ArrowRight') {
                nextSentence();
            }
        }
    });
});

function loadPreferences() {
    // Dark mode
    if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
        setTimeout(() => {
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent.includes('Dark')) {
                    btn.textContent = '‚òÄÔ∏è Light';
                    btn.classList.add('active');
                }
            });
        }, 0);
    }

    // Line numbers
    if (localStorage.getItem('lineNumbers') === 'true') {
        document.getElementById('latinText').classList.add('show-lines');
        setTimeout(() => {
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent === 'Line Numbers') {
                    btn.classList.add('active');
                }
            });
        }, 0);
    }
}

function savePreference(key, value) {
    localStorage.setItem(key, value);
}
    </script>
</body>
</html>
