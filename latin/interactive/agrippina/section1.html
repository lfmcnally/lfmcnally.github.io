<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classicalia - Tacitus Annals 14.1</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif; background: #f8f9fa; min-height: 100vh; display: flex; }
        .sidebar { width: 240px; background: white; border-right: 1px solid #e5e7eb; position: fixed; height: 100vh; overflow-y: auto; z-index: 100; }
        .logo-section { padding: 1.5rem 1.25rem; border-bottom: 1px solid #e5e7eb; }
        .logo { display: flex; align-items: center; gap: 0.75rem; text-decoration: none; }
        .logo-icon { width: 32px; height: 32px; background: linear-gradient(135deg, #0066ff 0%, #4d94ff 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 700; color: white; font-size: 1.1rem; }
        .logo-text { font-size: 1.25rem; font-weight: 700; color: #1f2937; }
        .nav-section { padding: 1rem 0.5rem; }
        .nav-title { font-size: 0.7rem; font-weight: 600; text-transform: uppercase; color: #9ca3af; letter-spacing: 0.05em; padding: 0 0.75rem; margin-bottom: 0.5rem; }
        .nav-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.625rem 0.75rem; margin: 0.125rem 0; border-radius: 8px; text-decoration: none; color: #4b5563; font-size: 0.9rem; transition: all 0.15s ease; cursor: pointer; }
        .nav-item:hover { background: #f3f4f6; color: #1f2937; }
        .nav-item.active { background: #eef2ff; color: #0066ff; font-weight: 500; }
        .nav-icon { width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; }
        .main-content { margin-left: 240px; flex: 1; display: flex; flex-direction: column; }
        .top-bar { background: white; border-bottom: 1px solid #e5e7eb; padding: 0.875rem 2rem; position: sticky; top: 0; z-index: 50; }
        .content-wrapper { flex: 1; overflow-y: auto; }
        .content-container { max-width: 1000px; margin: 0 auto; padding: 2rem; }
        .lesson-header { margin-bottom: 2rem; }
        .lesson-title { font-size: 2rem; font-weight: 700; color: #1f2937; margin-bottom: 0.5rem; }
        .lesson-meta { display: flex; gap: 1.5rem; font-size: 0.875rem; color: #6b7280; }
        .card { background: white; border-radius: 12px; border: 1px solid #e5e7eb; overflow: hidden; }
        .card-header { padding: 1.25rem 1.5rem; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: space-between; }
        .card-title { font-size: 1.125rem; font-weight: 600; color: #1f2937; }
        .card-body { padding: 2rem; }
        .latin-text { font-size: 1.5rem; line-height: 2.4; color: #1f2937; }
        .word { cursor: pointer; padding: 2px 4px; margin: 0 1px; border-radius: 4px; transition: all 0.15s ease; display: inline; }
        .word:hover { background: rgba(0, 102, 255, 0.15); }
        .word.active { background: rgba(0, 102, 255, 0.25); }
        .vocab-popup { position: fixed; background: white; border-radius: 10px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05); padding: 1rem 1.25rem; z-index: 1000; max-width: 350px; min-width: 250px; display: none; animation: popIn 0.2s ease; }
        .vocab-popup::before { content: ''; position: absolute; top: -8px; left: var(--arrow-left, 50%); transform: translateX(-50%); border-left: 8px solid transparent; border-right: 8px solid transparent; border-bottom: 8px solid white; }
        .vocab-popup.arrow-bottom::before { top: auto; bottom: -8px; border-bottom: none; border-top: 8px solid white; }
        @keyframes popIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        .vocab-popup.visible { display: block; }
        .vocab-popup h4 { font-size: 1.1rem; font-weight: 600; color: #0066ff; margin-bottom: 0.5rem; }
        .vocab-popup .parsing { font-size: 0.8rem; color: #6b7280; margin-bottom: 0.5rem; font-style: italic; }
        .vocab-popup .meaning { font-size: 0.95rem; color: #1f2937; line-height: 1.5; }
        .vocab-popup .principal-parts { font-size: 0.85rem; color: #4b5563; margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid #e5e7eb; }
        .btn-group { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 1.5rem; }
        .btn { padding: 0.625rem 1rem; border: 1px solid #e5e7eb; background: white; border-radius: 8px; font-size: 0.8rem; font-weight: 500; color: #374151; cursor: pointer; transition: all 0.2s ease; white-space: nowrap; }
        .btn:hover { background: #f9fafb; border-color: #d1d5db; }
        .btn.active { background: #0066ff; color: white; border-color: #0066ff; }
        body.dark-mode { background: #2d0818; }
        body.dark-mode .sidebar { background: #3a0a1f; border-color: #5a1a3a; }
        body.dark-mode .logo-icon { background: linear-gradient(135deg, #8b5a8a 0%, #a67aa6 100%); }
        body.dark-mode .logo-text { color: #c5d2f8; }
        body.dark-mode .nav-title { color: #9a8a9a; }
        body.dark-mode .nav-item { color: #b8a8b8; }
        body.dark-mode .nav-item:hover { background: #4f0c28; color: #c5d2f8; }
        body.dark-mode .nav-item.active { background: #6b2a4a; color: #c5d2f8; }
        body.dark-mode .top-bar { background: #3a0a1f; border-color: #5a1a3a; }
        body.dark-mode .card { background: #3a0a1f; border-color: #5a1a3a; }
        body.dark-mode .card-header { border-color: #5a1a3a; }
        body.dark-mode .card-title { color: #c5d2f8; }
        body.dark-mode .lesson-title { color: #c5d2f8; }
        body.dark-mode .lesson-meta { color: #b8a8b8; }
        body.dark-mode .latin-text { color: #c5d2f8; text-shadow: 0 0 20px rgba(197, 210, 248, 0.15); }
        body.dark-mode .word:hover { background: rgba(232, 212, 168, 0.25); }
        body.dark-mode .word.active { background: rgba(232, 212, 168, 0.35); }
        body.dark-mode .btn { background: #4f0c28; border-color: #6b2a4a; color: #c5d2f8; }
        body.dark-mode .btn:hover { background: #5a1a3a; }
        body.dark-mode .btn.active { background: #7a3a5a; border-color: #8a4a6a; }
        body.dark-mode .resource-card { background: #4f0c28; border-color: #5a1a3a; }
        body.dark-mode .resource-card h4 { color: #c5d2f8; }
        body.dark-mode .resource-card p, body.dark-mode .resource-card li { color: #b8c8e8; }
        body.dark-mode .vocab-popup { background: #4f0c28; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5); }
        body.dark-mode .vocab-popup::before { border-bottom-color: #4f0c28; }
        body.dark-mode .vocab-popup.arrow-bottom::before { border-bottom-color: transparent; border-top-color: #4f0c28; }
        body.dark-mode .vocab-popup h4 { color: #e8d4a8; }
        body.dark-mode .vocab-popup .parsing { color: #b8a8b8; }
        body.dark-mode .vocab-popup .meaning { color: #c5d2f8; }
        body.dark-mode .vocab-popup .principal-parts { color: #a8b8d8; border-color: #5a1a3a; }
        .latin-text p { padding: 0.5rem 0.75rem; margin: 0 -0.75rem 1.5rem -0.75rem; border-radius: 6px; transition: background 0.2s ease; }
        .latin-text p:hover { background: rgba(59, 130, 246, 0.08); }
        body.dark-mode .latin-text p:hover { background: rgba(197, 210, 248, 0.1); }
        .latin-text.sentence-mode p { display: none; }
        .latin-text.sentence-mode p.current-sentence { display: block; }
        .latin-text.sentence-mode p:hover { background: transparent; }
        .sentence-nav { display: none; align-items: center; justify-content: center; gap: 1rem; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e5e7eb; }
        .sentence-nav.visible { display: flex; }
        body.dark-mode .sentence-nav { border-color: #5a1a3a; }
        .sentence-nav button { padding: 0.5rem 1rem; border: 1px solid #e5e7eb; background: white; border-radius: 6px; font-size: 0.875rem; cursor: pointer; transition: all 0.15s ease; }
        .sentence-nav button:hover:not(:disabled) { background: #f3f4f6; }
        .sentence-nav button:disabled { opacity: 0.4; cursor: not-allowed; }
        body.dark-mode .sentence-nav button { background: #4f0c28; border-color: #6b2a4a; color: #c5d2f8; }
        body.dark-mode .sentence-nav button:hover:not(:disabled) { background: #5a1a3a; }
        .sentence-counter { font-size: 0.875rem; color: #6b7280; min-width: 80px; text-align: center; }
        body.dark-mode .sentence-counter { color: #b8a8b8; }
        body.full-screen .sidebar { display: none; }
        body.full-screen .main-content { margin-left: 0; }
        body.full-screen .lesson-header { display: none; }
        body.full-screen .content-container { max-width: 100%; padding: 1rem 2rem; }
        body.full-screen .card { border: none; border-radius: 0; background: transparent; }
        body.full-screen .card-header { display: none; }
        body.full-screen .card-body { padding: 1rem 2rem; }
        body.full-screen .latin-text { font-size: 2rem; line-height: 2.6; }
        body.full-screen .btn-group { position: fixed; bottom: 1.5rem; right: 1.5rem; background: white; padding: 0.75rem; border-radius: 10px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15); z-index: 200; }
        body.full-screen.dark-mode .btn-group { background: #3a0a1f; }
        body.full-screen .resource-card { display: none !important; }
        body.full-screen .sentence-nav { border: none; padding-top: 0; }
        body.full-screen .top-bar { display: none; }
        .latin-text.show-lines p { display: flex; align-items: flex-start; }
        .line-number { display: none; min-width: 2.5rem; color: #9ca3af; font-size: 0.875rem; padding-top: 0.3rem; user-select: none; }
        .latin-text.show-lines .line-number { display: block; }
        body.dark-mode .line-number { color: #7a6a7a; }
        .line-content { flex: 1; }
        .word.pointed { background: rgba(255, 200, 50, 0.5) !important; box-shadow: 0 0 12px rgba(255, 200, 50, 0.6); border-radius: 4px; }
        body.dark-mode .word.pointed { background: rgba(232, 212, 168, 0.5) !important; box-shadow: 0 0 15px rgba(232, 212, 168, 0.5); }
        body.pointer-mode .word { cursor: crosshair; }
        .mode-indicator { display: none; position: fixed; top: 1rem; right: 1rem; background: #fef3c7; color: #92400e; padding: 0.5rem 1rem; border-radius: 6px; font-size: 0.875rem; font-weight: 500; z-index: 200; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); }
        body.pointer-mode .mode-indicator { display: block; }
        body.dark-mode .mode-indicator { background: #4f0c28; color: #e8d4a8; }
        .resource-card { background: #f9fafb; border-radius: 8px; padding: 1.5rem; margin-top: 1.5rem; border: 1px solid #e5e7eb; display: none; }
        .resource-card.active { display: block; }
        .resource-card h4 { font-size: 1rem; font-weight: 600; color: #1f2937; margin-bottom: 0.75rem; }
        .resource-card p, .resource-card li { font-size: 0.95rem; line-height: 1.8; color: #374151; }
        .resource-card ul { margin-left: 1.5rem; margin-top: 0.5rem; }
        .resource-card li { margin-bottom: 0.5rem; }
        @media (max-width: 768px) { .sidebar { transform: translateX(-100%); } .main-content { margin-left: 0; } .latin-text { font-size: 1.25rem; line-height: 2.2; } }

        /* Style highlighting */
        .word.style-tier1 { border-bottom: 2px solid #f0c040; }
        .word.style-tier2 { border-bottom: 2px solid #38b2ac; }
        .word.style-tier3 { border-bottom: 2px solid #9f7aea; }
        .word.style-tier1:hover, .word.style-tier2:hover, .word.style-tier3:hover {
            background: rgba(159, 122, 234, 0.15);
        }
        body.dark-mode .word.style-tier1 { border-bottom-color: #ecc94b; }
        body.dark-mode .word.style-tier2 { border-bottom-color: #4fd1c5; }
        body.dark-mode .word.style-tier3 { border-bottom-color: #b794f4; }

        .style-popup {
            position: fixed;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            padding: 1rem 1.25rem;
            z-index: 1000;
            max-width: 400px;
            min-width: 280px;
            display: none;
        }
        .style-popup.visible { display: block; }
        .style-popup .device { font-weight: 600; color: #9f7aea; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem; }
        .style-popup .latin { font-style: italic; color: #4b5563; margin-bottom: 0.5rem; }
        .style-popup .effect { font-size: 0.95rem; line-height: 1.6; color: #1f2937; }
        body.dark-mode .style-popup { background: #4f0c28; }
        body.dark-mode .style-popup .device { color: #b794f4; }
        body.dark-mode .style-popup .latin { color: #b8a8b8; }
        body.dark-mode .style-popup .effect { color: #c5d2f8; }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="logo-section">
            <a href="../../../index.html" class="logo">
                <div class="logo-icon">C</div>
                <span class="logo-text">Classicalia</span>
            </a>
        </div>
        <nav class="nav-section">
            <div class="nav-title">Resources</div>
            <div class="nav-item active" onclick="showView('text')">
                <span class="nav-icon">üìñ</span>
                <span>Read</span>
            </div>
            <div class="nav-item" onclick="showView('summary')">
                <span class="nav-icon">üìã</span>
                <span>Summary</span>
            </div>
            <div class="nav-item" onclick="showView('context')">
                <span class="nav-icon">üèõÔ∏è</span>
                <span>Context</span>
            </div>
            <div class="nav-item" onclick="showView('comprehension')">
                <span class="nav-icon">‚ùì</span>
                <span>Comprehension</span>
            </div>
        </nav>
        <nav class="nav-section">
            <div class="nav-title">Sections</div>
            <a href="section1.html" class="nav-item active">Section 1 (14.1)</a>
            <a href="section2.html" class="nav-item">Section 2 (14.2)</a>
            <a href="section3.html" class="nav-item">Section 3 (14.3)</a>
            <a href="section4.html" class="nav-item">Section 4 (14.4)</a>
            <a href="section5.html" class="nav-item">Section 5 (14.5)</a>
            <a href="section6.html" class="nav-item">Section 6 (14.6)</a>
            <a href="section7.html" class="nav-item">Section 7 (14.7)</a>
            <a href="section8.html" class="nav-item">Section 8 (14.8)</a>
        </nav>
    </aside>

    <main class="main-content">
        <div class="top-bar"></div>
        <div class="content-wrapper">
            <div class="content-container">
                <header class="lesson-header">
                    <h1 class="lesson-title">Poppaea Puts Pressure on Nero</h1>
                    <div class="lesson-meta">
                        <span>üìï Tacitus Annals 14.1</span>
                        <span>‚è±Ô∏è 60 min</span>
                        <span>üìä A-Level</span>
                    </div>
                </header>

                <div class="card" id="textCard">
                    <div class="card-header">
                        <h3 class="card-title">Latin Text</h3>
                    </div>
                    <div class="card-body">
                        <div class="latin-text" id="latinText"></div>
                        <div class="btn-group">
                            <button class="btn" onclick="toggleTranslation()">Translation</button>
                            <button class="btn" onclick="toggleSentenceMode()">Sentence Mode</button>
                            <button class="btn" onclick="toggleLineNumbers()">Line Numbers</button>
                            <button class="btn" onclick="togglePointerMode()">Pointer Mode</button>
                            <button class="btn" onclick="toggleStyleMode()">Style</button>
                            <button class="btn" onclick="toggleDarkMode()">üåô Dark</button>
                            <button class="btn" onclick="toggleFullScreen()">‚õ∂ Full Screen</button>
                        </div>
                        <div class="sentence-nav" id="sentenceNav">
                            <button onclick="prevSentence()">‚Üê Previous</button>
                            <span class="sentence-counter" id="sentenceCounter">1 / 8</span>
                            <button onclick="nextSentence()">Next ‚Üí</button>
                        </div>
                        <div class="resource-card" id="translationBox">
                            <h4>Translation</h4>
                            <p>In the consulships of Gaius Vipstanus and C. Fonteius, Nero did not postpone any longer the crime which he had long contemplated, since his daring had increased because of the duration of his power and was daily more ardent because of his love for Poppaea, who, having no hope for marriage to herself and a divorce from Octavia while Agrippina was unharmed, began to rebuke the emperor with frequent accusations sometimes in jest and to call him a ward since he was submissive to the commands of others and was not only being deprived of supreme power, but even of his freedom. For why was her marriage being put off? Of course, her beauty and ancestors who had been awarded a triumph displeased him. Or was it her fertility and her loyal heart? Was it feared that as his wife she might at the very least reveal the senators' sense of injustice and the anger of the people against the pride and greed of his mother? But if Agrippina could not bear a daughter-in-law apart from one who was hostile to her son, she should be restored to her marriage with Otho: she would go anywhere in the world, where she would rather hear insults against the emperor than be involved in his dangers and see them. No one prevented these and the like which were impressive because of the tears and skill of the adulteress, as everyone wanted the mother's power to be broken and no one believed that the son's hatred would harden as far as murdering her.</p>
                        </div>
                    </div>
                </div>

                <div class="card" id="resourceCard" style="display: none; margin-top: 1.5rem;">
                    <div class="card-header">
                        <h3 class="card-title" id="resourceTitle">Summary</h3>
                    </div>
                    <div class="card-body" id="resourceContent"></div>
                </div>
            </div>
        </div>
    </main>

    <div class="vocab-popup" id="vocabPopup"></div>
    <div class="style-popup" id="stylePopup"></div>
    <div class="mode-indicator">üìç Pointer Mode</div>

    <script>
const vocab = {
    "gaio": { lemma: "Gaius, -i (m.)", parsing: "abl. sing.", meaning: "Gaius (praenomen)" },
    "vipstano": { lemma: "Vipstanus, -i (m.)", parsing: "abl. sing.", meaning: "Vipstanus (nomen)" },
    "c": { lemma: "Gaius", parsing: "abbreviated praenomen", meaning: "Gaius" },
    "fonteio": { lemma: "Fonteius, -i (m.)", parsing: "abl. sing.", meaning: "Fonteius (nomen)" },
    "consulibus": { lemma: "consul, -ulis (m.)", parsing: "abl. pl.", meaning: "consuls" },
    "diu": { lemma: "diu", parsing: "adverb", meaning: "for a long time" },
    "meditatum": { lemma: "meditor, -ari, -atus sum", parsing: "perf. pass. part. acc. neut.", meaning: "contemplated, planned" },
    "scelus": { lemma: "scelus, sceleris (n.)", parsing: "acc. sing.", meaning: "crime, wickedness" },
    "non": { lemma: "non", parsing: "adverb", meaning: "not" },
    "ultra": { lemma: "ultra", parsing: "adverb", meaning: "any longer, further" },
    "nero": { lemma: "Nero, -onis (m.)", parsing: "nom. sing.", meaning: "Nero" },
    "distulit": { lemma: "differo, differre, distuli, dilatum", parsing: "perf. act. ind. 3rd sing.", meaning: "postponed, delayed" },
    "vetustate": { lemma: "vetustas, -atis (f.)", parsing: "abl. sing.", meaning: "long duration, age" },
    "imperii": { lemma: "imperium, -i (n.)", parsing: "gen. sing.", meaning: "of power, of empire" },
    "coalita": { lemma: "coalesco, -ere, coalui, coalitum", parsing: "perf. pass. part. abl. fem.", meaning: "having grown strong" },
    "audacia": { lemma: "audacia, -ae (f.)", parsing: "abl. sing.", meaning: "boldness, daring" },
    "et": { lemma: "et", parsing: "conjunction", meaning: "and" },
    "flagrantior": { lemma: "flagrans, -antis", parsing: "comparative nom.", meaning: "more burning, more passionate" },
    "in": { lemma: "in", parsing: "preposition + acc.", meaning: "into, towards" },
    "dies": { lemma: "dies, diei (m.)", parsing: "acc. pl.", meaning: "days" },
    "amore": { lemma: "amor, -oris (m.)", parsing: "abl. sing.", meaning: "with love" },
    "poppaeae": { lemma: "Poppaea, -ae (f.)", parsing: "gen. sing.", meaning: "of Poppaea" },
    "quae": { lemma: "qui, quae, quod", parsing: "rel. pron. nom. fem.", meaning: "who" },
    "sibi": { lemma: "sui, sibi, se", parsing: "dat. reflexive", meaning: "for herself" },
    "matrimonium": { lemma: "matrimonium, -i (n.)", parsing: "acc. sing.", meaning: "marriage" },
    "discidium": { lemma: "discidium, -i (n.)", parsing: "acc. sing.", meaning: "divorce, separation" },
    "octaviae": { lemma: "Octavia, -ae (f.)", parsing: "gen. sing.", meaning: "from Octavia" },
    "incolumi": { lemma: "incolumis, -e", parsing: "abl. sing.", meaning: "unharmed, safe" },
    "agrippina": { lemma: "Agrippina, -ae (f.)", parsing: "abl. sing.", meaning: "Agrippina" },
    "haud": { lemma: "haud", parsing: "adverb", meaning: "not at all, by no means" },
    "sperans": { lemma: "spero, -are, -avi, -atum", parsing: "pres. act. part. nom.", meaning: "hoping" },
    "crebris": { lemma: "creber, -bra, -brum", parsing: "abl. pl.", meaning: "frequent, repeated" },
    "criminationibus": { lemma: "criminatio, -onis (f.)", parsing: "abl. pl.", meaning: "with accusations" },
    "aliquando": { lemma: "aliquando", parsing: "adverb", meaning: "sometimes" },
    "per": { lemma: "per", parsing: "preposition + acc.", meaning: "through, by means of" },
    "facetias": { lemma: "facetiae, -arum (f. pl.)", parsing: "acc. pl.", meaning: "jests, witticisms" },
    "incusare": { lemma: "incuso, -are, -avi, -atum", parsing: "pres. inf. act.", meaning: "to accuse, rebuke" },
    "principem": { lemma: "princeps, -cipis (m.)", parsing: "acc. sing.", meaning: "emperor, prince" },
    "pupillum": { lemma: "pupillus, -i (m.)", parsing: "acc. sing.", meaning: "ward, orphan boy" },
    "vocare": { lemma: "voco, -are, -avi, -atum", parsing: "pres. inf. act.", meaning: "to call" },
    "qui": { lemma: "qui, quae, quod", parsing: "rel. pron. nom. masc.", meaning: "who" },
    "iussis": { lemma: "iussum, -i (n.)", parsing: "dat./abl. pl.", meaning: "to commands" },
    "alienis": { lemma: "alienus, -a, -um", parsing: "dat./abl. pl.", meaning: "of others, foreign" },
    "obnoxius": { lemma: "obnoxius, -a, -um", parsing: "nom. masc. sing.", meaning: "submissive, subservient" },
    "modo": { lemma: "modo", parsing: "adverb", meaning: "only" },
    "sed": { lemma: "sed", parsing: "conjunction", meaning: "but" },
    "libertatis": { lemma: "libertas, -atis (f.)", parsing: "gen. sing.", meaning: "of freedom" },
    "etiam": { lemma: "etiam", parsing: "adverb", meaning: "even, also" },
    "indigeret": { lemma: "indigeo, -ere, -ui", parsing: "imperf. subj. act. 3rd sing.", meaning: "he lacked, needed" },
    "cur": { lemma: "cur", parsing: "adverb", meaning: "why" },
    "enim": { lemma: "enim", parsing: "conjunction", meaning: "for, indeed" },
    "differri": { lemma: "differo, differre, distuli, dilatum", parsing: "pres. pass. inf.", meaning: "to be postponed" },
    "nuptias": { lemma: "nuptiae, -arum (f. pl.)", parsing: "acc. pl.", meaning: "marriage, wedding" },
    "suas": { lemma: "suus, -a, -um", parsing: "acc. fem. pl.", meaning: "her own" },
    "formam": { lemma: "forma, -ae (f.)", parsing: "acc. sing.", meaning: "beauty, form" },
    "scilicet": { lemma: "scilicet", parsing: "adverb", meaning: "of course, evidently (sarcastic)" },
    "displicere": { lemma: "displiceo, -ere, -ui, -itum", parsing: "pres. inf. act.", meaning: "to displease" },
    "triumphales": { lemma: "triumphalis, -e", parsing: "acc. pl.", meaning: "triumphal, who had triumphs" },
    "avos": { lemma: "avus, -i (m.)", parsing: "acc. pl.", meaning: "ancestors, grandfathers" },
    "an": { lemma: "an", parsing: "conjunction", meaning: "or (in questions)" },
    "fecunditatem": { lemma: "fecunditas, -atis (f.)", parsing: "acc. sing.", meaning: "fertility" },
    "verum": { lemma: "verus, -a, -um", parsing: "acc. neut. sing.", meaning: "true, genuine" },
    "animum": { lemma: "animus, -i (m.)", parsing: "acc. sing.", meaning: "spirit, heart" },
    "timeri": { lemma: "timeo, -ere, timui", parsing: "pres. pass. inf.", meaning: "to be feared" },
    "ne": { lemma: "ne", parsing: "conjunction", meaning: "that, lest (+ subjunctive)" },
    "uxor": { lemma: "uxor, -oris (f.)", parsing: "nom. sing.", meaning: "wife" },
    "saltem": { lemma: "saltem", parsing: "adverb", meaning: "at least" },
    "iniurias": { lemma: "iniuria, -ae (f.)", parsing: "acc. pl.", meaning: "injustices, wrongs" },
    "patrum": { lemma: "pater, patris (m.)", parsing: "gen. pl.", meaning: "of the senators, fathers" },
    "iram": { lemma: "ira, -ae (f.)", parsing: "acc. sing.", meaning: "anger" },
    "populi": { lemma: "populus, -i (m.)", parsing: "gen. sing.", meaning: "of the people" },
    "adversus": { lemma: "adversus", parsing: "preposition + acc.", meaning: "against" },
    "superbiam": { lemma: "superbia, -ae (f.)", parsing: "acc. sing.", meaning: "pride, arrogance" },
    "avaritiam": { lemma: "avaritia, -ae (f.)", parsing: "acc. sing.", meaning: "greed, avarice" },
    "que": { lemma: "-que", parsing: "enclitic", meaning: "and" },
    "matris": { lemma: "mater, matris (f.)", parsing: "gen. sing.", meaning: "of mother" },
    "aperiat": { lemma: "aperio, -ire, aperui, apertum", parsing: "pres. subj. act. 3rd sing.", meaning: "might reveal, open" },
    "quod": { lemma: "quod", parsing: "conjunction", meaning: "but, and" },
    "si": { lemma: "si", parsing: "conjunction", meaning: "if" },
    "nurum": { lemma: "nurus, -us (f.)", parsing: "acc. sing.", meaning: "daughter-in-law" },
    "nisi": { lemma: "nisi", parsing: "conjunction", meaning: "except, unless" },
    "filio": { lemma: "filius, -i (m.)", parsing: "dat. sing.", meaning: "to son" },
    "infestam": { lemma: "infestus, -a, -um", parsing: "acc. fem. sing.", meaning: "hostile" },
    "ferre": { lemma: "fero, ferre, tuli, latum", parsing: "pres. inf. act.", meaning: "to bear, endure" },
    "posset": { lemma: "possum, posse, potui", parsing: "imperf. subj. act. 3rd sing.", meaning: "could, would be able" },
    "redderetur": { lemma: "reddo, -ere, reddidi, redditum", parsing: "imperf. subj. pass. 3rd sing.", meaning: "she should be returned" },
    "ipsa": { lemma: "ipse, ipsa, ipsum", parsing: "nom. fem. sing.", meaning: "she herself" },
    "othonis": { lemma: "Otho, -onis (m.)", parsing: "gen. sing.", meaning: "of Otho" },
    "coniugio": { lemma: "coniugium, -i (n.)", parsing: "dat. sing.", meaning: "to marriage" },
    "ituram": { lemma: "eo, ire, ivi/ii, itum", parsing: "fut. act. part. acc. fem.", meaning: "would go" },
    "quoquo": { lemma: "quoquo", parsing: "adverb", meaning: "wherever, anywhere" },
    "terrarum": { lemma: "terra, -ae (f.)", parsing: "gen. pl.", meaning: "of lands, in the world" },
    "ubi": { lemma: "ubi", parsing: "adverb", meaning: "where" },
    "audiret": { lemma: "audio, -ire, -ivi, -itum", parsing: "imperf. subj. act. 3rd sing.", meaning: "she might hear" },
    "potius": { lemma: "potius", parsing: "adverb", meaning: "rather" },
    "contumelias": { lemma: "contumelia, -ae (f.)", parsing: "acc. pl.", meaning: "insults" },
    "imperatoris": { lemma: "imperator, -oris (m.)", parsing: "gen. sing.", meaning: "of the emperor" },
    "quam": { lemma: "quam", parsing: "conjunction", meaning: "than" },
    "viseret": { lemma: "viso, -ere, visi, visum", parsing: "imperf. subj. act. 3rd sing.", meaning: "she might see" },
    "periculis": { lemma: "periculum, -i (n.)", parsing: "abl. pl.", meaning: "in dangers" },
    "eius": { lemma: "is, ea, id", parsing: "gen. sing.", meaning: "his, of him" },
    "immixta": { lemma: "immisceo, -ere, -ui, -mixtum", parsing: "perf. pass. part. nom. fem.", meaning: "involved, mixed up" },
    "haec": { lemma: "hic, haec, hoc", parsing: "acc. pl. neut.", meaning: "these things" },
    "atque": { lemma: "atque", parsing: "conjunction", meaning: "and" },
    "talia": { lemma: "talis, -e", parsing: "acc. pl. neut.", meaning: "such things" },
    "lacrimis": { lemma: "lacrima, -ae (f.)", parsing: "abl. pl.", meaning: "with tears" },
    "arte": { lemma: "ars, artis (f.)", parsing: "abl. sing.", meaning: "with skill, art" },
    "adulterae": { lemma: "adultera, -ae (f.)", parsing: "gen. sing.", meaning: "of the adulteress" },
    "penetrantia": { lemma: "penetro, -are, -avi, -atum", parsing: "pres. act. part. acc. pl. neut.", meaning: "penetrating, impressive" },
    "nemo": { lemma: "nemo, neminis", parsing: "nom. sing.", meaning: "no one" },
    "prohibebat": { lemma: "prohibeo, -ere, -ui, -itum", parsing: "imperf. act. ind. 3rd sing.", meaning: "was preventing" },
    "cupientibus": { lemma: "cupio, -ere, -ivi, -itum", parsing: "pres. act. part. abl. pl.", meaning: "desiring, wanting" },
    "cunctis": { lemma: "cunctus, -a, -um", parsing: "abl. pl.", meaning: "all" },
    "infringi": { lemma: "infringo, -ere, -fregi, -fractum", parsing: "pres. pass. inf.", meaning: "to be broken" },
    "potentiam": { lemma: "potentia, -ae (f.)", parsing: "acc. sing.", meaning: "power" },
    "credente": { lemma: "credo, -ere, credidi, creditum", parsing: "pres. act. part. abl.", meaning: "believing" },
    "nullo": { lemma: "nullus, -a, -um", parsing: "abl. sing.", meaning: "no one" },
    "usque": { lemma: "usque", parsing: "adverb", meaning: "as far as, up to" },
    "ad": { lemma: "ad", parsing: "preposition + acc.", meaning: "to, towards" },
    "caedem": { lemma: "caedes, -is (f.)", parsing: "acc. sing.", meaning: "murder, slaughter" },
    "duratura": { lemma: "duro, -are, -avi, -atum", parsing: "fut. act. part. acc. pl. neut.", meaning: "would harden, last" },
    "filii": { lemma: "filius, -i (m.)", parsing: "gen. sing.", meaning: "of the son" },
    "odia": { lemma: "odium, -i (n.)", parsing: "acc. pl.", meaning: "hatred" }
};

const styleData = {
    "diu,distulit": { tier: 1, device: "Alliteration", text: "diu...distulit" },
    "flagrantior,facetias": { tier: 1, device: "Alliteration", text: "flagrantior...facetias" },
    "matrimonium,discidium": { tier: 1, device: "Homoeoteleuton", text: "matrimonium et discidium" },
    "non,modo,sed,etiam": { tier: 2, device: "Correlative Structure", text: "non modo...sed...etiam", effect: "The balanced 'not only...but also' construction emphasises that Nero lacks both power AND freedom, building Poppaea's accusation to a climax." },
    "formam,avos,fecunditatem,animum": { tier: 2, device: "Tricolon with Variation", text: "formam...avos...fecunditatem...animum", effect: "A series of rhetorical questions listing Poppaea's qualities, each answered with implicit sarcasm. The accumulation creates mounting pressure on Nero." },
    "superbiam,avaritiam": { tier: 2, device: "Asyndetic Pair", text: "superbiam avaritiamque", effect: "The vices are piled up without pause, suggesting Agrippina's faults are too numerous to list properly." },
    "scelus": { tier: 3, device: "Proleptic Irony", text: "diu meditatum scelus", effect: "Tacitus names the 'crime' before revealing its nature (matricide), creating dramatic tension. The reader knows the outcome; the word 'scelus' colours everything that follows with moral judgement." },
    "pupillum": { tier: 3, device: "Degrading Metaphor", text: "pupillum vocare", effect: "Calling the emperor a 'ward' (legally, a minor under guardianship) inverts the power structure entirely. The word's placement after 'principem' (emperor) creates maximum shock through juxtaposition." },
    "lacrimis,arte": { tier: 3, device: "Oxymoronic Pairing", text: "lacrimis et arte adulterae", effect: "The combination of 'tears' (suggesting genuine emotion) with 'skill' (suggesting calculation) exposes Poppaea's manipulation. The genitive 'adulterae' adds Tacitus's moral condemnation." },
    "caedem": { tier: 3, device: "Climactic Word Order", text: "usque ad caedem", effect: "The passage builds inexorably to this word - 'murder'. Placed at the end of the chapter, it provides the shocking climax that the formal consular dating at the opening belied." },
    "nullo,credente": { tier: 3, device: "Tragic Irony", text: "credente nullo", effect: "The ablative absolute 'with no one believing' creates devastating dramatic irony: the reader knows that Nero's hatred WILL extend to matricide. Universal disbelief becomes universal complicity." }
};

const latinSentences = [
    "Gaio Vipstano C. Fonteio consulibus diu meditatum scelus non ultra Nero distulit, vetustate imperii coalita audacia et flagrantior in dies amore Poppaeae,",
    "quae sibi matrimonium et discidium Octaviae incolumi Agrippina haud sperans crebris criminationibus, aliquando per facetias incusare principem et pupillum vocare,",
    "qui iussis alienis obnoxius non modo imperii sed libertatis etiam indigeret.",
    "cur enim differri nuptias suas?",
    "formam scilicet displicere et triumphales avos. an fecunditatem et verum animum?",
    "timeri ne uxor saltem iniurias patrum, iram populi adversus superbiam avaritiamque matris aperiat.",
    "quod si nurum Agrippina non nisi filio infestam ferre posset, redderetur ipsa Othonis coniugio: ituram quoquo terrarum, ubi audiret potius contumelias imperatoris quam viseret periculis eius immixta.",
    "haec atque talia lacrimis et arte adulterae penetrantia nemo prohibebat, cupientibus cunctis infringi potentiam matris et credente nullo usque ad caedem eius duratura filii odia."
];

const resources = {
    summary: `<h4>Summary</h4>
<p>Book 14 opens with a dramatic turning point: Nero finally acts on his long-contemplated plan to murder his mother. Tacitus shows us Poppaea Sabina, Nero's mistress, applying psychological pressure through a calculated campaign of manipulation.</p>
<p>She alternates between serious accusations and jokes, calling Nero a 'ward' (pupillum) controlled by his mother, questioning why their marriage is delayed, and suggesting she'd rather return to her husband Otho than watch Nero remain enslaved. The passage ends ominously with everyone wanting Agrippina's power broken, though none believe Nero's hatred will extend to matricide.</p>`,
    context: `<h4>Historical Context</h4>
<p><strong>Date and Setting:</strong> This scene occurs in AD 59, five years into Nero's reign. The consular dating (Gaio Vipstano C. Fonteio consulibus) was the standard Roman method of marking years.</p>
<p><strong>Agrippina's Power:</strong> Agrippina had secured Nero's succession by marrying Emperor Claudius and having Nero adopted. She expected to rule through her son, but Nero increasingly resented her control.</p>
<p><strong>Poppaea Sabina:</strong> Poppaea was the wife of future emperor Otho, who had become Nero's mistress. She couldn't marry Nero while his mother lived and his wife Octavia (Claudius's daughter) remained. The mention of 'triumphales avos' reminds us that Poppaea came from genuine aristocracy, unlike Nero whose recent ancestors included freedmen.</p>
<p><strong>Tacitus's Perspective:</strong> Tacitus writes with hindsight, knowing this murder will unleash Nero's worst excesses. His description of Poppaea as 'adultera' (adulteress) signals clear moral judgement.</p>`,
    comprehension: `<h4>Comprehension Questions</h4>
<p><strong>Opening Lines:</strong> How does Tacitus's opening with consular dating create ironic contrast with what follows? What effect does 'diu meditatum scelus' have before we know what the crime is?</p>
<p><strong>Poppaea's Tactics:</strong> What different manipulation techniques does Poppaea employ? Consider the use of 'crebris criminationibus' and 'per facetias'.</p>
<p><strong>The 'Pupillum' Insult:</strong> Why is calling Nero a 'ward' (pupillum) such an effective insult? What does 'iussis alienis obnoxius' imply about his status?</p>
<p><strong>Rhetorical Questions:</strong> Analyse Poppaea's series of rhetorical questions. What is the effect of 'scilicet' (of course) and how does it function sarcastically?</p>
<p><strong>The Threat to Leave:</strong> What is the significance of Poppaea threatening to return to Otho? How does 'quoquo terrarum' emphasise her point?</p>
<p><strong>Final Observation:</strong> What is the significance of 'nemo prohibebat' and 'credente nullo'? How does Tacitus use these phrases to implicate the wider court?</p>
<p><strong>Essay Question:</strong> How effective is Tacitus' portrayal of Poppaea in this chapter and what does it add to his narrative? [15 marks]</p>`
};

let currentPopup = null;
let sentenceModeActive = false;
let currentSentenceIndex = 0;
let pointerModeActive = false;
let styleModeActive = false;

function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    const isDark = document.body.classList.contains('dark-mode');
    localStorage.setItem('darkMode', isDark);
    const btn = event.currentTarget;
    btn.textContent = isDark ? '‚òÄÔ∏è Light' : 'üåô Dark';
    btn.classList.toggle('active', isDark);
}

function toggleFullScreen() {
    document.body.classList.toggle('full-screen');
    const btn = event.currentTarget;
    const isFS = document.body.classList.contains('full-screen');
    btn.textContent = isFS ? '‚õ∂ Exit Full Screen' : '‚õ∂ Full Screen';
    btn.classList.toggle('active', isFS);
}

function toggleLineNumbers() {
    const latinText = document.getElementById('latinText');
    latinText.classList.toggle('show-lines');
    localStorage.setItem('lineNumbers', latinText.classList.contains('show-lines'));
    event.currentTarget.classList.toggle('active');
}

function togglePointerMode() {
    pointerModeActive = !pointerModeActive;
    document.body.classList.toggle('pointer-mode');
    event.currentTarget.classList.toggle('active');
    if (!pointerModeActive) document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
    if (pointerModeActive) hidePopup();
}

function toggleStyleMode() {
    styleModeActive = !styleModeActive;
    const btn = event.currentTarget;
    btn.classList.toggle('active');

    // Show/hide style underlines
    document.querySelectorAll('.word').forEach(word => {
        const w = word.dataset.word.toLowerCase();
        for (const [words, data] of Object.entries(styleData)) {
            if (words.split(',').includes(w)) {
                if (styleModeActive) {
                    word.classList.add('style-tier' + data.tier);
                } else {
                    word.classList.remove('style-tier1', 'style-tier2', 'style-tier3');
                }
            }
        }
    });

    if (!styleModeActive) hideStylePopup();
}

function showStylePopup(event, word) {
    if (!styleModeActive) return;

    const popup = document.getElementById('stylePopup');
    let styleInfo = null;

    for (const [words, data] of Object.entries(styleData)) {
        if (words.split(',').includes(word.toLowerCase())) {
            styleInfo = data;
            break;
        }
    }

    if (!styleInfo) return;

    let html = `<div class="device">${styleInfo.device}</div>`;
    html += `<div class="latin">"${styleInfo.text}"</div>`;
    if (styleInfo.effect) {
        html += `<div class="effect">${styleInfo.effect}</div>`;
    }

    popup.innerHTML = html;

    const rect = event.target.getBoundingClientRect();
    popup.style.left = Math.min(rect.left, window.innerWidth - 420) + 'px';
    popup.style.top = (rect.bottom + 10) + 'px';
    popup.classList.add('visible');
}

function hideStylePopup() {
    document.getElementById('stylePopup').classList.remove('visible');
}

function toggleSentenceMode() {
    const latinText = document.getElementById('latinText');
    const sentenceNav = document.getElementById('sentenceNav');
    const btn = event.currentTarget;
    sentenceModeActive = !sentenceModeActive;
    if (sentenceModeActive) {
        latinText.classList.add('sentence-mode');
        sentenceNav.classList.add('visible');
        btn.classList.add('active');
        btn.textContent = 'Full Text';
        currentSentenceIndex = 0;
        updateSentenceDisplay();
    } else {
        latinText.classList.remove('sentence-mode');
        sentenceNav.classList.remove('visible');
        btn.classList.remove('active');
        btn.textContent = 'Sentence Mode';
        document.querySelectorAll('.latin-text p').forEach(p => p.classList.remove('current-sentence'));
    }
}

function updateSentenceDisplay() {
    const paragraphs = document.querySelectorAll('.latin-text p');
    paragraphs.forEach((p, i) => p.classList.toggle('current-sentence', i === currentSentenceIndex));
    document.getElementById('sentenceCounter').textContent = `${currentSentenceIndex + 1} / ${paragraphs.length}`;
    const navButtons = document.querySelectorAll('.sentence-nav button');
    navButtons[0].disabled = currentSentenceIndex === 0;
    navButtons[1].disabled = currentSentenceIndex === paragraphs.length - 1;
}

function prevSentence() { if (currentSentenceIndex > 0) { currentSentenceIndex--; updateSentenceDisplay(); hidePopup(); } }
function nextSentence() { const p = document.querySelectorAll('.latin-text p'); if (currentSentenceIndex < p.length - 1) { currentSentenceIndex++; updateSentenceDisplay(); hidePopup(); } }

function generateLatinHTML() {
    let html = '';
    latinSentences.forEach((sentence, index) => {
        const tokens = sentence.match(/[a-zA-Z]+[.,;:?!]*|[.,;:?!]+/g);
        html += '<p><span class="line-number">' + (index + 1) + '</span><span class="line-content">';
        if (tokens) {
            tokens.forEach((token, i) => {
                const match = token.match(/^([a-zA-Z]+)([.,;:?!]*)$/);
                if (match) {
                    const word = match[1], punct = match[2], lookupWord = word.toLowerCase();
                    html += `<span class="word" data-word="${lookupWord}">${word}</span>${punct}`;
                    if (i < tokens.length - 1) html += ' ';
                } else { html += token + ' '; }
            });
        }
        html += '</span></p>';
    });
    return html;
}

function showVocabPopup(event, word) {
    const popup = document.getElementById('vocabPopup');
    const wordData = vocab[word.toLowerCase()];
    document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active'));
    if (!wordData) { popup.classList.remove('visible'); return; }
    event.target.classList.add('active');
    popup.innerHTML = `<h4>${word}</h4><div class="parsing">${wordData.parsing}</div><div class="meaning">${wordData.meaning}</div><div class="principal-parts">${wordData.lemma}</div>`;
    const rect = event.target.getBoundingClientRect();
    let left = rect.left + (rect.width / 2) - 150, top = rect.bottom + 12, arrowBottom = false;
    if (left < 10) left = 10;
    if (left + 300 > window.innerWidth - 10) left = window.innerWidth - 310;
    if (top + 150 > window.innerHeight) { top = rect.top - 162; arrowBottom = true; }
    const arrowLeft = Math.max(20, Math.min(280, rect.left + (rect.width / 2) - left));
    popup.style.left = left + 'px';
    popup.style.top = top + 'px';
    popup.style.setProperty('--arrow-left', arrowLeft + 'px');
    popup.classList.toggle('arrow-bottom', arrowBottom);
    popup.classList.add('visible');
}

function hidePopup() { document.getElementById('vocabPopup').classList.remove('visible'); document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active')); }

function toggleTranslation() {
    const box = document.getElementById('translationBox'), btn = event.currentTarget;
    const active = box.classList.toggle('active');
    btn.textContent = active ? 'Hide Translation' : 'Translation';
    btn.classList.toggle('active', active);
}

function showView(view) {
    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
    event.currentTarget.classList.add('active');
    const textCard = document.getElementById('textCard'), resourceCard = document.getElementById('resourceCard');
    if (view === 'text') { textCard.style.display = 'block'; resourceCard.style.display = 'none'; }
    else { textCard.style.display = 'none'; resourceCard.style.display = 'block'; document.getElementById('resourceTitle').textContent = view.charAt(0).toUpperCase() + view.slice(1); document.getElementById('resourceContent').innerHTML = resources[view]; }
}

document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('latinText').innerHTML = generateLatinHTML();
    if (localStorage.getItem('darkMode') === 'true') { document.body.classList.add('dark-mode'); setTimeout(() => { document.querySelectorAll('.btn').forEach(btn => { if (btn.textContent.includes('Dark')) { btn.textContent = '‚òÄÔ∏è Light'; btn.classList.add('active'); } }); }, 0); }
    if (localStorage.getItem('lineNumbers') === 'true') { document.getElementById('latinText').classList.add('show-lines'); setTimeout(() => { document.querySelectorAll('.btn').forEach(btn => { if (btn.textContent === 'Line Numbers') btn.classList.add('active'); }); }, 0); }
    document.querySelectorAll('.word').forEach(word => {
        word.addEventListener('click', function(e) {
            e.stopPropagation();
            if (pointerModeActive) {
                this.classList.toggle('pointed');
            } else if (styleModeActive) {
                showStylePopup(e, this.dataset.word);
            } else {
                showVocabPopup(e, this.dataset.word);
            }
        });
    });
    document.addEventListener('click', function(e) {
        if (!e.target.classList.contains('word')) {
            hidePopup();
            hideStylePopup();
            if (pointerModeActive && !e.target.closest('.btn-group') && !e.target.closest('.sentence-nav')) {
                document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
            }
        }
    });
    document.addEventListener('keydown', function(e) { if (e.key === 'Escape') { if (document.body.classList.contains('full-screen')) { document.body.classList.remove('full-screen'); document.querySelectorAll('.btn').forEach(btn => { if (btn.textContent.includes('Full Screen')) { btn.textContent = '‚õ∂ Full Screen'; btn.classList.remove('active'); } }); } if (pointerModeActive) { pointerModeActive = false; document.body.classList.remove('pointer-mode'); document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed')); document.querySelectorAll('.btn').forEach(btn => { if (btn.textContent === 'Pointer Mode') btn.classList.remove('active'); }); } } if (sentenceModeActive) { if (e.key === 'ArrowLeft') prevSentence(); else if (e.key === 'ArrowRight') nextSentence(); } });
});
    </script>
</body>
</html>
