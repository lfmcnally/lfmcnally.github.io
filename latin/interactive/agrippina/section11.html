<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classicalia - Tacitus Annals 14.11</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 240px;
            background: white;
            border-right: 1px solid #e5e7eb;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }
        .logo-section {
            padding: 1.5rem 1.25rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }
        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #0066ff 0%, #4d94ff 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.1rem;
        }
        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
        }
        .nav-section {
            padding: 1rem 0.5rem;
        }
        .nav-title {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #9ca3af;
            letter-spacing: 0.05em;
            padding: 0 0.75rem;
            margin-bottom: 0.5rem;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.625rem 0.75rem;
            margin: 0.125rem 0;
            border-radius: 8px;
            text-decoration: none;
            color: #4b5563;
            font-size: 0.9rem;
            transition: all 0.15s ease;
            cursor: pointer;
        }
        .nav-item:hover {
            background: #f3f4f6;
            color: #1f2937;
        }
        .nav-item.active {
            background: #eef2ff;
            color: #0066ff;
            font-weight: 500;
        }
        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }
        .main-content {
            margin-left: 240px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .top-bar {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0.875rem 2rem;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .content-wrapper {
            flex: 1;
            overflow-y: auto;
        }
        .content-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }
        .lesson-header {
            margin-bottom: 2rem;
        }
        .lesson-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        .lesson-meta {
            display: flex;
            gap: 1.5rem;
            font-size: 0.875rem;
            color: #6b7280;
        }
        .card {
            background: white;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }
        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
        }
        .card-body {
            padding: 2rem;
        }
        .latin-text {
            font-size: 1.5rem;
            line-height: 2.4;
            color: #1f2937;
        }
        .word {
            cursor: pointer;
            padding: 2px 4px;
            margin: 0 1px;
            border-radius: 4px;
            transition: all 0.15s ease;
            display: inline;
        }
        .word:hover {
            background: rgba(0, 102, 255, 0.15);
        }
        .word.active {
            background: rgba(0, 102, 255, 0.25);
        }

        /* Popup styles */
        .vocab-popup {
            position: fixed;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05);
            padding: 1rem 1.25rem;
            z-index: 1000;
            max-width: 350px;
            min-width: 250px;
            display: none;
            animation: popIn 0.2s ease;
        }
        .vocab-popup::before {
            content: '';
            position: absolute;
            top: -8px;
            left: var(--arrow-left, 50%);
            transform: translateX(-50%);
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid white;
        }
        .vocab-popup.arrow-bottom::before {
            top: auto;
            bottom: -8px;
            border-bottom: none;
            border-top: 8px solid white;
        }
        body.dark-mode .vocab-popup::before {
            border-bottom-color: #4f0c28;
        }
        body.dark-mode .vocab-popup.arrow-bottom::before {
            border-bottom-color: transparent;
            border-top-color: #4f0c28;
        }
        @keyframes popIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .vocab-popup.visible {
            display: block;
        }
        .vocab-popup h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #0066ff;
            margin-bottom: 0.5rem;
        }
        .vocab-popup .parsing {
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
            font-style: italic;
        }
        .vocab-popup .meaning {
            font-size: 0.95rem;
            color: #1f2937;
            line-height: 1.5;
        }
        .vocab-popup .principal-parts {
            font-size: 0.85rem;
            color: #4b5563;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid #e5e7eb;
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }
        .btn {
            padding: 0.625rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        .btn:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }
        .btn.active {
            background: #0066ff;
            color: white;
            border-color: #0066ff;
        }

        /* Dark mode styles */
        body.dark-mode {
            background: #2d0818;
        }
        body.dark-mode .sidebar {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .logo-icon {
            background: linear-gradient(135deg, #8b5a8a 0%, #a67aa6 100%);
        }
        body.dark-mode .logo-text {
            color: #c5d2f8;
        }
        body.dark-mode .nav-title {
            color: #9a8a9a;
        }
        body.dark-mode .nav-item {
            color: #b8a8b8;
        }
        body.dark-mode .nav-item:hover {
            background: #4f0c28;
            color: #c5d2f8;
        }
        body.dark-mode .nav-item.active {
            background: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .top-bar {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .card {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .card-header {
            border-color: #5a1a3a;
        }
        body.dark-mode .card-title {
            color: #c5d2f8;
        }
        body.dark-mode .lesson-title {
            color: #c5d2f8;
        }
        body.dark-mode .lesson-meta {
            color: #b8a8b8;
        }
        body.dark-mode .latin-text {
            color: #c5d2f8;
            text-shadow: 0 0 20px rgba(197, 210, 248, 0.15);
        }
        body.dark-mode .word:hover {
            background: rgba(232, 212, 168, 0.25);
        }
        body.dark-mode .word.active {
            background: rgba(232, 212, 168, 0.35);
        }
        body.dark-mode .btn {
            background: #4f0c28;
            border-color: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .btn:hover {
            background: #5a1a3a;
        }
        body.dark-mode .btn.active {
            background: #7a3a5a;
            border-color: #8a4a6a;
        }
        body.dark-mode .resource-card {
            background: #4f0c28;
            border-color: #5a1a3a;
        }
        body.dark-mode .resource-card h4 {
            color: #c5d2f8;
        }
        body.dark-mode .resource-card p {
            color: #b8c8e8;
        }
        body.dark-mode .vocab-popup {
            background: #4f0c28;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        body.dark-mode .vocab-popup h4 {
            color: #e8d4a8;
        }
        body.dark-mode .vocab-popup .parsing {
            color: #b8a8b8;
        }
        body.dark-mode .vocab-popup .meaning {
            color: #c5d2f8;
        }
        body.dark-mode .vocab-popup .principal-parts {
            color: #a8b8d8;
            border-color: #5a1a3a;
        }

        /* Sentence hover highlight */
        .latin-text p {
            padding: 0.5rem 0.75rem;
            margin: 0 -0.75rem 1.5rem -0.75rem;
            border-radius: 6px;
            transition: background 0.2s ease;
        }
        .latin-text p:hover {
            background: rgba(59, 130, 246, 0.08);
        }
        body.dark-mode .latin-text p:hover {
            background: rgba(197, 210, 248, 0.1);
        }

        /* Sentence-by-sentence mode */
        .latin-text.sentence-mode p {
            display: none;
        }
        .latin-text.sentence-mode p.current-sentence {
            display: block;
        }
        .latin-text.sentence-mode p:hover {
            background: transparent;
        }

        .sentence-nav {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }
        .sentence-nav.visible {
            display: flex;
        }
        body.dark-mode .sentence-nav {
            border-color: #5a1a3a;
        }
        .sentence-nav button {
            padding: 0.5rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        .sentence-nav button:hover:not(:disabled) {
            background: #f3f4f6;
        }
        .sentence-nav button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        body.dark-mode .sentence-nav button {
            background: #4f0c28;
            border-color: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .sentence-nav button:hover:not(:disabled) {
            background: #5a1a3a;
        }
        .sentence-counter {
            font-size: 0.875rem;
            color: #6b7280;
            min-width: 80px;
            text-align: center;
        }
        body.dark-mode .sentence-counter {
            color: #b8a8b8;
        }

        /* Full-screen mode */
        body.full-screen .sidebar {
            display: none;
        }
        body.full-screen .main-content {
            margin-left: 0;
        }
        body.full-screen .lesson-header {
            display: none;
        }
        body.full-screen .content-container {
            max-width: 100%;
            padding: 1rem 2rem;
        }
        body.full-screen .card {
            border: none;
            border-radius: 0;
            background: transparent;
        }
        body.full-screen .card-header {
            display: none;
        }
        body.full-screen .card-body {
            padding: 1rem 2rem;
        }
        body.full-screen .latin-text {
            font-size: 2rem;
            line-height: 2.6;
        }
        body.full-screen .btn-group {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            background: white;
            padding: 0.75rem;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 200;
        }
        body.full-screen.dark-mode .btn-group {
            background: #3a0a1f;
        }
        body.full-screen .resource-card {
            display: none !important;
        }
        body.full-screen .sentence-nav {
            border: none;
            padding-top: 0;
        }
        body.full-screen .top-bar {
            display: none;
        }

        /* Line numbers */
        .latin-text.show-lines p {
            display: flex;
            align-items: flex-start;
        }
        .line-number {
            display: none;
            min-width: 2.5rem;
            color: #9ca3af;
            font-size: 0.875rem;
            padding-top: 0.3rem;
            user-select: none;
        }
        .latin-text.show-lines .line-number {
            display: block;
        }
        body.dark-mode .line-number {
            color: #7a6a7a;
        }
        .line-content {
            flex: 1;
        }

        /* Pointer/highlight mode */
        .word.pointed {
            background: rgba(255, 200, 50, 0.5) !important;
            box-shadow: 0 0 12px rgba(255, 200, 50, 0.6);
            border-radius: 4px;
        }
        body.dark-mode .word.pointed {
            background: rgba(232, 212, 168, 0.5) !important;
            box-shadow: 0 0 15px rgba(232, 212, 168, 0.5);
        }

        /* Pointer mode indicator */
        body.pointer-mode .word {
            cursor: crosshair;
        }
        .mode-indicator {
            display: none;
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: #fef3c7;
            color: #92400e;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            z-index: 200;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        body.pointer-mode .mode-indicator {
            display: block;
        }
        body.dark-mode .mode-indicator {
            background: #4f0c28;
            color: #e8d4a8;
        }

        .resource-card {
            background: #f9fafb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px solid #e5e7eb;
            display: none;
        }
        .resource-card.active {
            display: block;
        }
        .resource-card h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.75rem;
        }
        .resource-card p {
            font-size: 0.95rem;
            line-height: 1.8;
            color: #374151;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
            }
            .latin-text {
                font-size: 1.25rem;
                line-height: 2.2;
            }
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="logo-section">
            <a href="../../../index.html" class="logo">
                <div class="logo-icon">C</div>
                <span class="logo-text">Classicalia</span>
            </a>
        </div>
        <nav class="nav-section">
            <div class="nav-title">Resources</div>
            <div class="nav-item active" onclick="showView('text')">
                <span class="nav-icon">üìñ</span>
                <span>Read</span>
            </div>
            <div class="nav-item" onclick="showView('summary')">
                <span class="nav-icon">üìã</span>
                <span>Summary</span>
            </div>
            <div class="nav-item" onclick="showView('context')">
                <span class="nav-icon">üèõÔ∏è</span>
                <span>Context</span>
            </div>
            <div class="nav-item" onclick="showView('comprehension')">
                <span class="nav-icon">‚ùì</span>
                <span>Comprehension</span>
            </div>
        </nav>
    </aside>

    <main class="main-content">
        <div class="top-bar"></div>
        <div class="content-wrapper">
            <div class="content-container">
                <header class="lesson-header">
                    <h1 class="lesson-title">The Failed Justification</h1>
                    <div class="lesson-meta">
                        <span>üìï Tacitus Annals 14.11</span>
                        <span>‚è±Ô∏è 60 min</span>
                        <span>üìä A-Level</span>
                    </div>
                </header>

                <div class="card" id="textCard">
                    <div class="card-header">
                        <h3 class="card-title">Latin Text</h3>
                    </div>
                    <div class="card-body">
                        <div class="latin-text" id="latinText"></div>
                        <div class="btn-group">
                            <button class="btn" onclick="toggleTranslation()">Translation</button>
                            <button class="btn" onclick="toggleSentenceMode()">Sentence Mode</button>
                            <button class="btn" onclick="toggleLineNumbers()">Line Numbers</button>
                            <button class="btn" onclick="togglePointerMode()">Pointer Mode</button>
                            <button class="btn" onclick="toggleDarkMode()">üåô Dark</button>
                            <button class="btn" onclick="toggleFullScreen()">‚õ∂ Full Screen</button>
                        </div>
                        <div class="sentence-nav" id="sentenceNav">
                            <button onclick="prevSentence()">‚Üê Previous</button>
                            <span class="sentence-counter" id="sentenceCounter">1 / 7</span>
                            <button onclick="nextSentence()">Next ‚Üí</button>
                        </div>
                        <div class="resource-card" id="translationBox">
                            <h4>Translation</h4>
                            <p>He added accusations sought from further back in time, that she had hoped for a sharing of supreme power, and that the praetorian cohorts would swear allegiance to a woman, and (for) the same disgrace of the Senate and people, and when she had been thwarted, in her hatred, she had advised against giving largesse to the army and a monetary gift to the senators and plebs and had contrived danger for distinguished men. With how much effort on his part had it been achieved to prevent her from entering the Senate house and giving replies to foreign races. With an indirect attack of Claudius's times also, he transferred all the scandals of that rule onto his mother, relating that she had been destroyed thanks to the good fortune of the public. For he even related the shipwreck: but who could be found so stupid as to believe that it had been an accident? Or that one person had been sent with a weapon by a shipwrecked woman to break through the cohorts and fleets of the emperor? Therefore, it was no longer Nero, whose bestiality was surpassing everyone's complaints, but Seneca (who) was in bad repute, because he had written the confession with a speech of such a kind.</p>
                        </div>
                    </div>
                </div>

                <div class="card" id="resourceCard" style="display: none; margin-top: 1.5rem;">
                    <div class="card-header">
                        <h3 class="card-title" id="resourceTitle">Summary</h3>
                    </div>
                    <div class="card-body" id="resourceContent"></div>
                </div>
            </div>
        </div>
    </main>

    <div class="vocab-popup" id="vocabPopup"></div>
    <div class="mode-indicator">üìç Pointer Mode (click words to highlight, click again to remove)</div>

    <script>
const vocab = {
    "adiciebat": { lemma: "adicio, -ere, adieci, adiectum", parsing: "imperf. act. ind. 3rd sing.", meaning: "was adding" },
    "crimina": { lemma: "crimen, criminis (n.)", parsing: "acc. pl.", meaning: "accusations, charges" },
    "longius": { lemma: "longe", parsing: "comparative adverb", meaning: "further back, more distantly" },
    "repetita": { lemma: "repeto, -ere, -ivi, -itum", parsing: "perf. pass. part. acc. pl.", meaning: "sought, fetched" },
    "quod": { lemma: "quod", parsing: "conjunction", meaning: "that, because" },
    "consortium": { lemma: "consortium, -i (n.)", parsing: "acc. sing.", meaning: "partnership, sharing" },
    "imperii": { lemma: "imperium, -i (n.)", parsing: "gen. sing.", meaning: "of power, of supreme command" },
    "iuraturas": { lemma: "iuro, -are, -avi, -atum", parsing: "fut. act. part. acc. fem. pl.", meaning: "about to swear" },
    "in": { lemma: "in", parsing: "preposition + acc.", meaning: "to, into, upon" },
    "feminae": { lemma: "femina, -ae (f.)", parsing: "gen. sing.", meaning: "of a woman" },
    "verba": { lemma: "verbum, -i (n.)", parsing: "acc. pl.", meaning: "words" },
    "praetorias": { lemma: "praetorius, -a, -um", parsing: "acc. fem. pl.", meaning: "praetorian" },
    "cohortes": { lemma: "cohors, cohortis (f.)", parsing: "acc. pl.", meaning: "cohorts" },
    "idemque": { lemma: "idem + -que", parsing: "acc. neut. sing. + and", meaning: "and the same" },
    "dedecus": { lemma: "dedecus, -oris (n.)", parsing: "acc. sing.", meaning: "disgrace, dishonour" },
    "senatus": { lemma: "senatus, -us (m.)", parsing: "gen. sing.", meaning: "of the Senate" },
    "et": { lemma: "et", parsing: "conjunction", meaning: "and" },
    "populi": { lemma: "populus, -i (m.)", parsing: "gen. sing.", meaning: "of the people" },
    "speravisset": { lemma: "spero, -are, -avi, -atum", parsing: "pluperf. subj. act. 3rd sing.", meaning: "had hoped" },
    "ac": { lemma: "ac / atque", parsing: "conjunction", meaning: "and" },
    "postquam": { lemma: "postquam", parsing: "conjunction", meaning: "after, when" },
    "frustra": { lemma: "frustra", parsing: "adverb", meaning: "in vain, unsuccessfully" },
    "habita": { lemma: "habeo, -ere, habui, habitum", parsing: "perf. pass. part. nom. fem. sing.", meaning: "held, considered, thwarted" },
    "sit": { lemma: "sum, esse, fui", parsing: "perf. subj. 3rd sing.", meaning: "was" },
    "infensa": { lemma: "infensus, -a, -um", parsing: "nom. fem. sing.", meaning: "hostile, enraged" },
    "militi": { lemma: "miles, militis (m.)", parsing: "dat. sing.", meaning: "to the soldier, to the army" },
    "patribusque": { lemma: "pater, patris (m.) + -que", parsing: "dat. pl. + and", meaning: "and to the senators" },
    "plebi": { lemma: "plebs, plebis (f.)", parsing: "dat. sing.", meaning: "to the common people" },
    "dissuasisset": { lemma: "dissuadeo, -ere, -suasi, -suasum", parsing: "pluperf. subj. act. 3rd sing.", meaning: "had advised against" },
    "donativum": { lemma: "donativum, -i (n.)", parsing: "acc. sing.", meaning: "military bonus, largesse" },
    "congiarium": { lemma: "congiarium, -i (n.)", parsing: "acc. sing.", meaning: "civilian monetary gift" },
    "periculaque": { lemma: "periculum, -i (n.) + -que", parsing: "acc. pl. + and", meaning: "and dangers" },
    "viris": { lemma: "vir, viri (m.)", parsing: "dat. pl.", meaning: "for men" },
    "inlustribus": { lemma: "inlustris, -e", parsing: "dat. pl.", meaning: "distinguished, illustrious" },
    "struxisset": { lemma: "struo, -ere, struxi, structum", parsing: "pluperf. subj. act. 3rd sing.", meaning: "had contrived, had built up" },
    "quanto": { lemma: "quantus, -a, -um", parsing: "abl. sing.", meaning: "with how much" },
    "suo": { lemma: "suus, -a, -um", parsing: "abl. masc. sing.", meaning: "his own" },
    "labore": { lemma: "labor, laboris (m.)", parsing: "abl. sing.", meaning: "effort, toil" },
    "perpetratum": { lemma: "perpetro, -are, -avi, -atum", parsing: "perf. pass. part. nom./acc. neut. sing.", meaning: "achieved, accomplished" },
    "ne": { lemma: "ne", parsing: "conjunction", meaning: "that not, lest" },
    "inrumperet": { lemma: "inrumpo, -ere, -rupi, -ruptum", parsing: "imperf. subj. act. 3rd sing.", meaning: "might burst into" },
    "curiam": { lemma: "curia, -ae (f.)", parsing: "acc. sing.", meaning: "Senate house" },
    "gentibus": { lemma: "gens, gentis (f.)", parsing: "dat. pl.", meaning: "to nations, to peoples" },
    "externis": { lemma: "externus, -a, -um", parsing: "dat. pl.", meaning: "foreign, external" },
    "responsa": { lemma: "responsum, -i (n.)", parsing: "acc. pl.", meaning: "replies, answers" },
    "daret": { lemma: "do, dare, dedi, datum", parsing: "imperf. subj. act. 3rd sing.", meaning: "might give" },
    "temporum": { lemma: "tempus, temporis (n.)", parsing: "gen. pl.", meaning: "of times" },
    "quoque": { lemma: "quoque", parsing: "adverb", meaning: "also, too" },
    "Claudianorum": { lemma: "Claudianus, -a, -um", parsing: "gen. pl.", meaning: "Claudian, of Claudius" },
    "obliqua": { lemma: "obliquus, -a, -um", parsing: "abl. fem. sing.", meaning: "indirect, oblique" },
    "insectatione": { lemma: "insectatio, -onis (f.)", parsing: "abl. sing.", meaning: "with attack, with denunciation" },
    "cuncta": { lemma: "cunctus, -a, -um", parsing: "acc. pl.", meaning: "all" },
    "eius": { lemma: "is, ea, id", parsing: "gen. sing.", meaning: "of that, of her" },
    "dominationis": { lemma: "dominatio, -onis (f.)", parsing: "gen. sing.", meaning: "of domination, of rule" },
    "flagitia": { lemma: "flagitium, -i (n.)", parsing: "acc. pl.", meaning: "scandals, outrages" },
    "matrem": { lemma: "mater, matris (f.)", parsing: "acc. sing.", meaning: "mother" },
    "transtulit": { lemma: "transfero, -ferre, -tuli, -latum", parsing: "perf. act. ind. 3rd sing.", meaning: "transferred" },
    "publica": { lemma: "publicus, -a, -um", parsing: "abl. fem. sing.", meaning: "public" },
    "fortuna": { lemma: "fortuna, -ae (f.)", parsing: "abl. sing.", meaning: "by fortune, by luck" },
    "extinctam": { lemma: "exstinguo, -ere, -stinxi, -stinctum", parsing: "perf. pass. part. acc. fem. sing.", meaning: "destroyed, extinguished" },
    "referens": { lemma: "refero, -ferre, rettuli, relatum", parsing: "pres. act. part. nom. sing.", meaning: "relating, reporting" },
    "namque": { lemma: "namque", parsing: "conjunction", meaning: "for indeed, for" },
    "naufragium": { lemma: "naufragium, -i (n.)", parsing: "acc. sing.", meaning: "shipwreck" },
    "narrabat": { lemma: "narro, -are, -avi, -atum", parsing: "imperf. act. ind. 3rd sing.", meaning: "was relating, was narrating" },
    "fortuitum": { lemma: "fortuitus, -a, -um", parsing: "acc. neut. sing.", meaning: "accidental, by chance" },
    "fuisse": { lemma: "sum, esse, fui", parsing: "perf. inf.", meaning: "to have been" },
    "quis": { lemma: "quis, quid", parsing: "nom. sing.", meaning: "who" },
    "adeo": { lemma: "adeo", parsing: "adverb", meaning: "so, to such a degree" },
    "hebes": { lemma: "hebes, hebetis", parsing: "nom. sing.", meaning: "dull, stupid" },
    "inveniretur": { lemma: "invenio, -ire, inveni, inventum", parsing: "imperf. subj. pass. 3rd sing.", meaning: "could be found" },
    "ut": { lemma: "ut", parsing: "conjunction", meaning: "that, so that" },
    "crederet": { lemma: "credo, -ere, credidi, creditum", parsing: "imperf. subj. act. 3rd sing.", meaning: "would believe" },
    "aut": { lemma: "aut", parsing: "conjunction", meaning: "or" },
    "a": { lemma: "a / ab", parsing: "preposition + abl.", meaning: "by, from" },
    "muliere": { lemma: "mulier, mulieris (f.)", parsing: "abl. sing.", meaning: "by a woman" },
    "naufraga": { lemma: "naufragus, -a, -um", parsing: "abl. fem. sing.", meaning: "shipwrecked" },
    "missum": { lemma: "mitto, -ere, misi, missum", parsing: "perf. pass. part. acc. masc. sing.", meaning: "sent" },
    "cum": { lemma: "cum", parsing: "preposition + abl.", meaning: "with" },
    "telo": { lemma: "telum, -i (n.)", parsing: "abl. sing.", meaning: "weapon" },
    "unum": { lemma: "unus, -a, -um", parsing: "acc. masc. sing.", meaning: "one person" },
    "qui": { lemma: "qui, quae, quod", parsing: "rel. pron. nom. masc. sing.", meaning: "who" },
    "classes": { lemma: "classis, -is (f.)", parsing: "acc. pl.", meaning: "fleets" },
    "imperatoris": { lemma: "imperator, -oris (m.)", parsing: "gen. sing.", meaning: "of the emperor" },
    "perfringeret": { lemma: "perfringo, -ere, -fregi, -fractum", parsing: "imperf. subj. act. 3rd sing.", meaning: "might break through" },
    "ergo": { lemma: "ergo", parsing: "conjunction", meaning: "therefore" },
    "non": { lemma: "non", parsing: "adverb", meaning: "not" },
    "iam": { lemma: "iam", parsing: "adverb", meaning: "now, already" },
    "Nero": { lemma: "Nero, Neronis (m.)", parsing: "nom. sing.", meaning: "Nero" },
    "cuius": { lemma: "qui, quae, quod", parsing: "rel. pron. gen. sing.", meaning: "whose" },
    "immanitas": { lemma: "immanitas, -atis (f.)", parsing: "nom. sing.", meaning: "savagery, brutality" },
    "omnium": { lemma: "omnis, -e", parsing: "gen. pl.", meaning: "of all" },
    "questus": { lemma: "questus, -us (m.)", parsing: "acc. pl.", meaning: "complaints" },
    "anteibat": { lemma: "anteeo, -ire, -ivi/-ii, -itum", parsing: "imperf. act. ind. 3rd sing.", meaning: "was surpassing" },
    "sed": { lemma: "sed", parsing: "conjunction", meaning: "but" },
    "Seneca": { lemma: "Seneca, -ae (m.)", parsing: "nom. sing.", meaning: "Seneca" },
    "adverso": { lemma: "adversus, -a, -um", parsing: "abl. masc. sing.", meaning: "hostile, unfavourable" },
    "rumore": { lemma: "rumor, -oris (m.)", parsing: "abl. sing.", meaning: "with reputation, with rumour" },
    "erat": { lemma: "sum, esse, fui", parsing: "imperf. ind. 3rd sing.", meaning: "was" },
    "oratione": { lemma: "oratio, -onis (f.)", parsing: "abl. sing.", meaning: "with a speech" },
    "tali": { lemma: "talis, -e", parsing: "abl. sing.", meaning: "such, of such a kind" },
    "confessionem": { lemma: "confessio, -onis (f.)", parsing: "acc. sing.", meaning: "confession, admission" },
    "scripsisset": { lemma: "scribo, -ere, scripsi, scriptum", parsing: "pluperf. subj. act. 3rd sing.", meaning: "had written" }
};

const latinSentences = [
    "adiciebat crimina longius repetita, quod consortium imperii iuraturasque in feminae verba praetorias cohortes idemque dedecus senatus et populi speravisset,",
    "ac postquam frustra habita sit, infensa militi patribusque et plebi dissuasisset donativum et congiarium periculaque viris inlustribus struxisset.",
    "quanto suo labore perpetratum ne inrumperet curiam, ne gentibus externis responsa daret.",
    "temporum quoque Claudianorum obliqua insectatione cuncta eius dominationis flagitia in matrem transtulit, publica fortuna extinctam referens.",
    "namque et naufragium narrabat: quod fortuitum fuisse quis adeo hebes inveniretur ut crederet?",
    "aut a muliere naufraga missum cum telo unum qui cohortes et classes imperatoris perfringeret?",
    "ergo non iam Nero, cuius immanitas omnium questus anteibat, sed Seneca adverso rumore erat quod oratione tali confessionem scripsisset."
];

const resources = {
    summary: `<h4>Summary</h4>
<p>In this passage, Nero attempts to justify matricide by piling up retrospective accusations. He claims Agrippina wanted co-emperorship, tried to make the Praetorian Guard swear loyalty to a woman (scandalous in Roman terms), opposed military bonuses and public handouts when thwarted, and plotted against nobles.</p>
<p>He boasts of his efforts keeping her from bursting into the Senate or answering foreign embassies‚Äîpresenting her overreach as justification for murder. He even blames all of Claudius's scandals on her, retroactively rewriting history. Most absurdly, he includes the shipwreck in his official story as if it were real and accidental.</p>
<p>Tacitus's scorn erupts: who would be stupid enough to believe a shipwrecked woman sent one assassin through imperial guards? The passage ends with bitter irony‚ÄîNero's savagery exceeded all complaints, yet Seneca gets blamed for writing such an eloquent confession that it exposed itself as fiction. The philosopher's skill with words ironically reveals the lie.</p>`,
    context: `<h4>Historical Context</h4>
<p><strong>The Praetorian Oath:</strong> The Praetorian Guard swearing to a woman would violate fundamental Roman military tradition‚Äîthe sacramentum (oath) was masculine domain. The very suggestion was designed to shock Roman sensibilities.</p>
<p><strong>Senate and Foreign Embassies:</strong> The Senate house (curia) was exclusively male space; women entering would transgress sacred boundaries. Foreign embassies were received by the emperor as diplomatic protocol‚ÄîAgrippina answering them would usurp imperial prerogative.</p>
<p><strong>Donativum and Congiarium:</strong> The donativum was military bonus, congiarium was civilian handout‚Äîboth crucial for maintaining loyalty. Blaming Agrippina for opposing these was politically calculated.</p>
<p><strong>Claudius's Reign:</strong> Blaming Claudius's reign on Agrippina was particularly cynical since she'd helped Nero succeed Claudius. The phrase "temporum Claudianorum obliqua insectatione" shows Nero rewriting history.</p>
<p><strong>Seneca's Role:</strong> Seneca, the Stoic philosopher and Nero's tutor, writing the justification implicates intellectual culture in tyranny. The phrase "oratione tali" suggests the speech was too polished, too rhetorical‚Äîits very quality revealed its falseness.</p>`,
    comprehension: `<h4>Comprehension Questions</h4>
<p><strong>Lines 1-2:</strong> What accusations does Nero add ("adiciebat crimina")? What is the significance of "consortium imperii"?</p>
<p><strong>Line 2:</strong> What does "in feminae verba" imply about Roman attitudes to female power? Why would the Praetorians swearing to a woman be scandalous?</p>
<p><strong>Lines 3-4:</strong> What did Agrippina allegedly oppose when thwarted? What does "viris inlustribus" suggest about her supposed victims?</p>
<p><strong>Line 5:</strong> What does "quanto suo labore" emphasise about Nero's self-presentation? What was he preventing Agrippina from doing?</p>
<p><strong>Lines 6-7:</strong> How does Nero use "temporum Claudianorum obliqua insectatione"? What does transferring Claudius's scandals to Agrippina achieve?</p>
<p><strong>Lines 8-9:</strong> What is the rhetorical force of "quis adeo hebes"? How does Tacitus expose the absurdity of the shipwreck story?</p>
<p><strong>Lines 10-11:</strong> Why does Tacitus shift blame from Nero to Seneca at the end? What does "oratione tali confessionem" reveal about the relationship between rhetoric and truth?</p>
<p><strong>Overall:</strong> How does this passage illustrate Tacitean irony? Consider the tension between what Nero claims and what Tacitus reveals.</p>`
};

let currentPopup = null;
let sentenceModeActive = false;
let currentSentenceIndex = 0;
let pointerModeActive = false;

function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    const isDark = document.body.classList.contains('dark-mode');
    savePreference('darkMode', isDark);

    const btn = event.currentTarget;
    if (isDark) {
        btn.textContent = '‚òÄÔ∏è Light';
        btn.classList.add('active');
    } else {
        btn.textContent = 'üåô Dark';
        btn.classList.remove('active');
    }
}

function toggleFullScreen() {
    document.body.classList.toggle('full-screen');
    const btn = event.currentTarget;
    if (document.body.classList.contains('full-screen')) {
        btn.textContent = '‚õ∂ Exit Full Screen';
        btn.classList.add('active');
    } else {
        btn.textContent = '‚õ∂ Full Screen';
        btn.classList.remove('active');
    }
}

function toggleLineNumbers() {
    const latinText = document.getElementById('latinText');
    latinText.classList.toggle('show-lines');
    const showLines = latinText.classList.contains('show-lines');
    savePreference('lineNumbers', showLines);

    const btn = event.currentTarget;
    btn.classList.toggle('active');
}

function togglePointerMode() {
    pointerModeActive = !pointerModeActive;
    document.body.classList.toggle('pointer-mode');
    const btn = event.currentTarget;
    btn.classList.toggle('active');

    if (!pointerModeActive) {
        // Clear all pointed words when exiting pointer mode
        document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
    }

    // Hide vocab popup when entering pointer mode
    if (pointerModeActive) {
        hidePopup();
    }
}

function toggleSentenceMode() {
    const latinText = document.getElementById('latinText');
    const sentenceNav = document.getElementById('sentenceNav');
    const btn = event.currentTarget;

    sentenceModeActive = !sentenceModeActive;

    if (sentenceModeActive) {
        latinText.classList.add('sentence-mode');
        sentenceNav.classList.add('visible');
        btn.classList.add('active');
        btn.textContent = 'Full Text';
        currentSentenceIndex = 0;
        updateSentenceDisplay();
    } else {
        latinText.classList.remove('sentence-mode');
        sentenceNav.classList.remove('visible');
        btn.classList.remove('active');
        btn.textContent = 'Sentence Mode';
        // Remove current-sentence class from all
        document.querySelectorAll('.latin-text p').forEach(p => p.classList.remove('current-sentence'));
    }
}

function updateSentenceDisplay() {
    const paragraphs = document.querySelectorAll('.latin-text p');
    paragraphs.forEach((p, i) => {
        if (i === currentSentenceIndex) {
            p.classList.add('current-sentence');
        } else {
            p.classList.remove('current-sentence');
        }
    });
    document.getElementById('sentenceCounter').textContent = `${currentSentenceIndex + 1} / ${paragraphs.length}`;

    // Update button states
    const navButtons = document.querySelectorAll('.sentence-nav button');
    navButtons[0].disabled = currentSentenceIndex === 0;
    navButtons[1].disabled = currentSentenceIndex === paragraphs.length - 1;
}

function prevSentence() {
    if (currentSentenceIndex > 0) {
        currentSentenceIndex--;
        updateSentenceDisplay();
        hidePopup();
    }
}

function nextSentence() {
    const paragraphs = document.querySelectorAll('.latin-text p');
    if (currentSentenceIndex < paragraphs.length - 1) {
        currentSentenceIndex++;
        updateSentenceDisplay();
        hidePopup();
    }
}

function generateLatinHTML() {
    let html = '';
    latinSentences.forEach((sentence, index) => {
        // Split into tokens, keeping punctuation attached to words
        const tokens = sentence.match(/[a-zA-Z]+[.,;:?]*|[.,;:?]+/g);
        html += '<p style="margin-bottom: 1.5rem;">';
        html += `<span class="line-number">${index + 1}</span>`;
        html += '<span class="line-content">';
        if (tokens) {
            tokens.forEach((token, i) => {
                // Separate word from trailing punctuation
                const match = token.match(/^([a-zA-Z]+)([.,;:?]*)$/);
                if (match) {
                    const word = match[1];
                    const punct = match[2];
                    const lookupWord = word.toLowerCase();
                    html += `<span class="word" data-word="${lookupWord}">${word}</span>${punct}`;
                    // Add space after unless it's the last token
                    if (i < tokens.length - 1) html += ' ';
                } else {
                    // Just punctuation
                    html += token + ' ';
                }
            });
        }
        html += '</span></p>';
    });
    return html;
}

function showVocabPopup(event, word) {
    const popup = document.getElementById('vocabPopup');
    const wordData = vocab[word.toLowerCase()];

    // Remove active class from all words
    document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active'));

    if (!wordData) {
        popup.classList.remove('visible');
        return;
    }

    // Add active class to clicked word
    event.target.classList.add('active');

    popup.innerHTML = `
        <h4>${word}</h4>
        <div class="parsing">${wordData.parsing}</div>
        <div class="meaning">${wordData.meaning}</div>
        <div class="principal-parts">${wordData.lemma}</div>
    `;

    // Position popup near the word
    const rect = event.target.getBoundingClientRect();
    const popupWidth = 300;
    const popupHeight = 150;

    let left = rect.left + (rect.width / 2) - (popupWidth / 2);
    let top = rect.bottom + 12;
    let arrowBottom = false;

    // Keep popup within viewport horizontally
    if (left < 10) left = 10;
    if (left + popupWidth > window.innerWidth - 10) {
        left = window.innerWidth - popupWidth - 10;
    }

    // If popup would go below viewport, show above word
    if (top + popupHeight > window.innerHeight) {
        top = rect.top - popupHeight - 12;
        arrowBottom = true;
    }

    // Calculate arrow position relative to popup
    const wordCenterX = rect.left + (rect.width / 2);
    const arrowLeft = Math.max(20, Math.min(popupWidth - 20, wordCenterX - left));

    popup.style.left = left + 'px';
    popup.style.top = top + 'px';
    popup.style.setProperty('--arrow-left', arrowLeft + 'px');
    popup.classList.toggle('arrow-bottom', arrowBottom);
    popup.classList.add('visible');

    currentPopup = popup;
}

function hidePopup() {
    const popup = document.getElementById('vocabPopup');
    popup.classList.remove('visible');
    document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active'));
}

function toggleTranslation() {
    const box = document.getElementById('translationBox');
    const btn = event.currentTarget;

    if (box.classList.contains('active')) {
        box.classList.remove('active');
        btn.textContent = 'Translation';
        btn.classList.remove('active');
    } else {
        box.classList.add('active');
        btn.textContent = 'Hide Translation';
        btn.classList.add('active');
    }
}

function showView(view) {
    // Update nav
    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
    event.currentTarget.classList.add('active');

    const textCard = document.getElementById('textCard');
    const resourceCard = document.getElementById('resourceCard');

    if (view === 'text') {
        textCard.style.display = 'block';
        resourceCard.style.display = 'none';
    } else {
        textCard.style.display = 'none';
        resourceCard.style.display = 'block';
        document.getElementById('resourceTitle').textContent = view.charAt(0).toUpperCase() + view.slice(1);
        document.getElementById('resourceContent').innerHTML = resources[view];
    }
}

// Initialise
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('latinText').innerHTML = generateLatinHTML();

    // Load saved preferences
    loadPreferences();

    // Add click handlers to words
    document.querySelectorAll('.word').forEach(word => {
        word.addEventListener('click', function(e) {
            e.stopPropagation();

            if (pointerModeActive) {
                // Toggle pointed class
                this.classList.toggle('pointed');
            } else {
                showVocabPopup(e, this.dataset.word);
            }
        });
    });

    // Hide popup when clicking elsewhere, clear pointer highlights on background click
    document.addEventListener('click', function(e) {
        if (!e.target.classList.contains('word')) {
            hidePopup();

            // If in pointer mode and clicking background (not buttons), clear all highlights
            if (pointerModeActive && !e.target.closest('.btn-group') && !e.target.closest('.sentence-nav')) {
                document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
            }
        }
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Escape to exit full screen
        if (e.key === 'Escape') {
            if (document.body.classList.contains('full-screen')) {
                document.body.classList.remove('full-screen');
                const btn = document.querySelector('.btn-group .btn:last-child');
                if (btn) {
                    btn.textContent = '‚õ∂ Full Screen';
                    btn.classList.remove('active');
                }
            }
            // Also exit pointer mode on escape
            if (pointerModeActive) {
                pointerModeActive = false;
                document.body.classList.remove('pointer-mode');
                document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
                document.querySelectorAll('.btn').forEach(btn => {
                    if (btn.textContent === 'Pointer Mode') btn.classList.remove('active');
                });
            }
        }

        // Arrow keys for sentence navigation
        if (sentenceModeActive) {
            if (e.key === 'ArrowLeft') {
                prevSentence();
            } else if (e.key === 'ArrowRight') {
                nextSentence();
            }
        }
    });
});

function loadPreferences() {
    // Dark mode
    if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
        setTimeout(() => {
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent.includes('Dark')) {
                    btn.textContent = '‚òÄÔ∏è Light';
                    btn.classList.add('active');
                }
            });
        }, 0);
    }

    // Line numbers
    if (localStorage.getItem('lineNumbers') === 'true') {
        document.getElementById('latinText').classList.add('show-lines');
        setTimeout(() => {
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent === 'Line Numbers') {
                    btn.classList.add('active');
                }
            });
        }, 0);
    }
}

function savePreference(key, value) {
    localStorage.setItem(key, value);
}
    </script>
</body>
</html>
