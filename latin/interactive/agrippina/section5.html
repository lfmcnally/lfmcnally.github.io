<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classicalia - Tacitus Annals 14.5</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 240px;
            background: white;
            border-right: 1px solid #e5e7eb;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }
        .logo-section {
            padding: 1.5rem 1.25rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }
        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #0066ff 0%, #4d94ff 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.1rem;
        }
        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
        }
        .nav-section {
            padding: 1rem 0.5rem;
        }
        .nav-title {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #9ca3af;
            letter-spacing: 0.05em;
            padding: 0 0.75rem;
            margin-bottom: 0.5rem;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.625rem 0.75rem;
            margin: 0.125rem 0;
            border-radius: 8px;
            text-decoration: none;
            color: #4b5563;
            font-size: 0.9rem;
            transition: all 0.15s ease;
            cursor: pointer;
        }
        .nav-item:hover {
            background: #f3f4f6;
            color: #1f2937;
        }
        .nav-item.active {
            background: #eef2ff;
            color: #0066ff;
            font-weight: 500;
        }
        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }
        .main-content {
            margin-left: 240px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .top-bar {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0.875rem 2rem;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .content-wrapper {
            flex: 1;
            overflow-y: auto;
        }
        .content-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }
        .lesson-header {
            margin-bottom: 2rem;
        }
        .lesson-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        .lesson-meta {
            display: flex;
            gap: 1.5rem;
            font-size: 0.875rem;
            color: #6b7280;
        }
        .card {
            background: white;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }
        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
        }
        .card-body {
            padding: 2rem;
        }
        .latin-text {
            font-size: 1.5rem;
            line-height: 2.4;
            color: #1f2937;
        }
        .word {
            cursor: pointer;
            padding: 2px 4px;
            margin: 0 1px;
            border-radius: 4px;
            transition: all 0.15s ease;
            display: inline;
        }
        .word:hover {
            background: rgba(0, 102, 255, 0.15);
        }
        .word.active {
            background: rgba(0, 102, 255, 0.25);
        }

        /* Popup styles */
        .vocab-popup {
            position: fixed;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05);
            padding: 1rem 1.25rem;
            z-index: 1000;
            max-width: 350px;
            min-width: 250px;
            display: none;
            animation: popIn 0.2s ease;
        }
        .vocab-popup::before {
            content: '';
            position: absolute;
            top: -8px;
            left: var(--arrow-left, 50%);
            transform: translateX(-50%);
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid white;
        }
        .vocab-popup.arrow-bottom::before {
            top: auto;
            bottom: -8px;
            border-bottom: none;
            border-top: 8px solid white;
        }
        body.dark-mode .vocab-popup::before {
            border-bottom-color: #4f0c28;
        }
        body.dark-mode .vocab-popup.arrow-bottom::before {
            border-bottom-color: transparent;
            border-top-color: #4f0c28;
        }
        @keyframes popIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .vocab-popup.visible {
            display: block;
        }
        .vocab-popup h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #0066ff;
            margin-bottom: 0.5rem;
        }
        .vocab-popup .parsing {
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
            font-style: italic;
        }
        .vocab-popup .meaning {
            font-size: 0.95rem;
            color: #1f2937;
            line-height: 1.5;
        }
        .vocab-popup .principal-parts {
            font-size: 0.85rem;
            color: #4b5563;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid #e5e7eb;
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }
        .btn {
            padding: 0.625rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        .btn:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }
        .btn.active {
            background: #0066ff;
            color: white;
            border-color: #0066ff;
        }

        /* Dark mode styles */
        body.dark-mode {
            background: #2d0818;
        }
        body.dark-mode .sidebar {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .logo-icon {
            background: linear-gradient(135deg, #8b5a8a 0%, #a67aa6 100%);
        }
        body.dark-mode .logo-text {
            color: #c5d2f8;
        }
        body.dark-mode .nav-title {
            color: #9a8a9a;
        }
        body.dark-mode .nav-item {
            color: #b8a8b8;
        }
        body.dark-mode .nav-item:hover {
            background: #4f0c28;
            color: #c5d2f8;
        }
        body.dark-mode .nav-item.active {
            background: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .top-bar {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .card {
            background: #3a0a1f;
            border-color: #5a1a3a;
        }
        body.dark-mode .card-header {
            border-color: #5a1a3a;
        }
        body.dark-mode .card-title {
            color: #c5d2f8;
        }
        body.dark-mode .lesson-title {
            color: #c5d2f8;
        }
        body.dark-mode .lesson-meta {
            color: #b8a8b8;
        }
        body.dark-mode .latin-text {
            color: #c5d2f8;
            text-shadow: 0 0 20px rgba(197, 210, 248, 0.15);
        }
        body.dark-mode .word:hover {
            background: rgba(232, 212, 168, 0.25);
        }
        body.dark-mode .word.active {
            background: rgba(232, 212, 168, 0.35);
        }
        body.dark-mode .btn {
            background: #4f0c28;
            border-color: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .btn:hover {
            background: #5a1a3a;
        }
        body.dark-mode .btn.active {
            background: #7a3a5a;
            border-color: #8a4a6a;
        }
        body.dark-mode .resource-card {
            background: #4f0c28;
            border-color: #5a1a3a;
        }
        body.dark-mode .resource-card h4 {
            color: #c5d2f8;
        }
        body.dark-mode .resource-card p {
            color: #b8c8e8;
        }
        body.dark-mode .vocab-popup {
            background: #4f0c28;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        body.dark-mode .vocab-popup h4 {
            color: #e8d4a8;
        }
        body.dark-mode .vocab-popup .parsing {
            color: #b8a8b8;
        }
        body.dark-mode .vocab-popup .meaning {
            color: #c5d2f8;
        }
        body.dark-mode .vocab-popup .principal-parts {
            color: #a8b8d8;
            border-color: #5a1a3a;
        }

        /* Sentence hover highlight */
        .latin-text p {
            padding: 0.5rem 0.75rem;
            margin: 0 -0.75rem 1.5rem -0.75rem;
            border-radius: 6px;
            transition: background 0.2s ease;
        }
        .latin-text p:hover {
            background: rgba(59, 130, 246, 0.08);
        }
        body.dark-mode .latin-text p:hover {
            background: rgba(197, 210, 248, 0.1);
        }

        /* Sentence-by-sentence mode */
        .latin-text.sentence-mode p {
            display: none;
        }
        .latin-text.sentence-mode p.current-sentence {
            display: block;
        }
        .latin-text.sentence-mode p:hover {
            background: transparent;
        }

        .sentence-nav {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }
        .sentence-nav.visible {
            display: flex;
        }
        body.dark-mode .sentence-nav {
            border-color: #5a1a3a;
        }
        .sentence-nav button {
            padding: 0.5rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        .sentence-nav button:hover:not(:disabled) {
            background: #f3f4f6;
        }
        .sentence-nav button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        body.dark-mode .sentence-nav button {
            background: #4f0c28;
            border-color: #6b2a4a;
            color: #c5d2f8;
        }
        body.dark-mode .sentence-nav button:hover:not(:disabled) {
            background: #5a1a3a;
        }
        .sentence-counter {
            font-size: 0.875rem;
            color: #6b7280;
            min-width: 80px;
            text-align: center;
        }
        body.dark-mode .sentence-counter {
            color: #b8a8b8;
        }

        /* Full-screen mode */
        body.full-screen .sidebar {
            display: none;
        }
        body.full-screen .main-content {
            margin-left: 0;
        }
        body.full-screen .lesson-header {
            display: none;
        }
        body.full-screen .content-container {
            max-width: 100%;
            padding: 1rem 2rem;
        }
        body.full-screen .card {
            border: none;
            border-radius: 0;
            background: transparent;
        }
        body.full-screen .card-header {
            display: none;
        }
        body.full-screen .card-body {
            padding: 1rem 2rem;
        }
        body.full-screen .latin-text {
            font-size: 2rem;
            line-height: 2.6;
        }
        body.full-screen .btn-group {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            background: white;
            padding: 0.75rem;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 200;
        }
        body.full-screen.dark-mode .btn-group {
            background: #3a0a1f;
        }
        body.full-screen .resource-card {
            display: none !important;
        }
        body.full-screen .sentence-nav {
            border: none;
            padding-top: 0;
        }
        body.full-screen .top-bar {
            display: none;
        }

        /* Line numbers */
        .latin-text.show-lines p {
            display: flex;
            align-items: flex-start;
        }
        .line-number {
            display: none;
            min-width: 2.5rem;
            color: #9ca3af;
            font-size: 0.875rem;
            padding-top: 0.3rem;
            user-select: none;
        }
        .latin-text.show-lines .line-number {
            display: block;
        }
        body.dark-mode .line-number {
            color: #7a6a7a;
        }
        .line-content {
            flex: 1;
        }

        /* Pointer/highlight mode */
        .word.pointed {
            background: rgba(255, 200, 50, 0.5) !important;
            box-shadow: 0 0 12px rgba(255, 200, 50, 0.6);
            border-radius: 4px;
        }
        body.dark-mode .word.pointed {
            background: rgba(232, 212, 168, 0.5) !important;
            box-shadow: 0 0 15px rgba(232, 212, 168, 0.5);
        }

        /* Pointer mode indicator */
        body.pointer-mode .word {
            cursor: crosshair;
        }
        .mode-indicator {
            display: none;
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: #fef3c7;
            color: #92400e;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            z-index: 200;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        body.pointer-mode .mode-indicator {
            display: block;
        }
        body.dark-mode .mode-indicator {
            background: #4f0c28;
            color: #e8d4a8;
        }

        .resource-card {
            background: #f9fafb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px solid #e5e7eb;
            display: none;
        }
        .resource-card.active {
            display: block;
        }
        .resource-card h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.75rem;
        }
        .resource-card p {
            font-size: 0.95rem;
            line-height: 1.8;
            color: #374151;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
            }
            .latin-text {
                font-size: 1.25rem;
                line-height: 2.2;
            }
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="logo-section">
            <a href="../../../index.html" class="logo">
                <div class="logo-icon">C</div>
                <span class="logo-text">Classicalia</span>
            </a>
        </div>
        <nav class="nav-section">
            <div class="nav-title">Resources</div>
            <div class="nav-item active" onclick="showView('text')">
                <span class="nav-icon">üìñ</span>
                <span>Read</span>
            </div>
            <div class="nav-item" onclick="showView('summary')">
                <span class="nav-icon">üìã</span>
                <span>Summary</span>
            </div>
            <div class="nav-item" onclick="showView('context')">
                <span class="nav-icon">üèõÔ∏è</span>
                <span>Context</span>
            </div>
            <div class="nav-item" onclick="showView('comprehension')">
                <span class="nav-icon">‚ùì</span>
                <span>Comprehension</span>
            </div>
        </nav>
    </aside>

    <main class="main-content">
        <div class="top-bar"></div>
        <div class="content-wrapper">
            <div class="content-container">
                <header class="lesson-header">
                    <h1 class="lesson-title">The Failed Assassination</h1>
                    <div class="lesson-meta">
                        <span>üìï Tacitus Annals 14.5</span>
                        <span>‚è±Ô∏è 60 min</span>
                        <span>üìä A-Level</span>
                    </div>
                </header>

                <div class="card" id="textCard">
                    <div class="card-header">
                        <h3 class="card-title">Latin Text</h3>
                    </div>
                    <div class="card-body">
                        <div class="latin-text" id="latinText"></div>
                        <div class="btn-group">
                            <button class="btn" onclick="toggleTranslation()">Translation</button>
                            <button class="btn" onclick="toggleSentenceMode()">Sentence Mode</button>
                            <button class="btn" onclick="toggleLineNumbers()">Line Numbers</button>
                            <button class="btn" onclick="togglePointerMode()">Pointer Mode</button>
                            <button class="btn" onclick="toggleDarkMode()">üåô Dark</button>
                            <button class="btn" onclick="toggleFullScreen()">‚õ∂ Full Screen</button>
                        </div>
                        <div class="sentence-nav" id="sentenceNav">
                            <button onclick="prevSentence()">‚Üê Previous</button>
                            <span class="sentence-counter" id="sentenceCounter">1 / 9</span>
                            <button onclick="nextSentence()">Next ‚Üí</button>
                        </div>
                        <div class="resource-card" id="translationBox">
                            <h4>Translation</h4>
                            <p>The gods offered a night bright with stars and calm with a peaceful sea, as if to expose the crime. The ship had not advanced far, with two from the number of her friends accompanying Agrippina, of whom Crepereius Gallus was standing not far from the rudders, while Acerronia, reclining above the feet of her lying down, was joyfully talking about the repentance of her son and the mother's recovered influence, when at a given signal the roof of the room, heavy with much lead, collapsed, and Crepereius was crushed and immediately killed. Agrippina and Acerronia were protected by the projecting walls of the couch, which by chance were too strong to yield to the weight. Nor did the breaking up of the ship follow, since everyone was confused and the ignorant majority were even hindering those in the know. Then it seemed good to the rowers to lean to one side and thus sink the ship: but their agreement was not quick for the sudden situation, and others pressing against gave the opportunity for a gentler casting into the sea. But Acerronia, through imprudence, while she shouts that she is Agrippina and that help be given to the emperor's mother, is killed with poles and oars and whatever naval weapons chance had offered. Agrippina, silent and for that reason less recognised (she received, however, one wound in the shoulder), by swimming, then having been carried by meeting little boats to the Lucrine lake, is brought to her villa.</p>
                        </div>
                    </div>
                </div>

                <div class="card" id="resourceCard" style="display: none; margin-top: 1.5rem;">
                    <div class="card-header">
                        <h3 class="card-title" id="resourceTitle">Summary</h3>
                    </div>
                    <div class="card-body" id="resourceContent"></div>
                </div>
            </div>
        </div>
    </main>

    <div class="vocab-popup" id="vocabPopup"></div>
    <div class="mode-indicator">üìç Pointer Mode (click words to highlight, click again to remove)</div>

    <script>
const vocab = {
    "noctem": { lemma: "nox, noctis (f.)", parsing: "acc. sing.", meaning: "night" },
    "sideribus": { lemma: "sidus, sideris (n.)", parsing: "abl. pl.", meaning: "with stars" },
    "inlustrem": { lemma: "inlustris, -e", parsing: "acc. sing.", meaning: "bright, illuminated" },
    "et": { lemma: "et", parsing: "conjunction", meaning: "and" },
    "placido": { lemma: "placidus, -a, -um", parsing: "abl. sing.", meaning: "peaceful, calm" },
    "mari": { lemma: "mare, maris (n.)", parsing: "abl. sing.", meaning: "sea" },
    "quietam": { lemma: "quietus, -a, -um", parsing: "acc. sing.", meaning: "calm, quiet" },
    "quasi": { lemma: "quasi", parsing: "adverb", meaning: "as if" },
    "convincendum": { lemma: "convinco, -ere", parsing: "gerundive neut. acc.", meaning: "for exposing, for proving" },
    "ad": { lemma: "ad", parsing: "preposition + acc.", meaning: "for, toward" },
    "scelus": { lemma: "scelus, sceleris (n.)", parsing: "acc. sing.", meaning: "crime" },
    "dii": { lemma: "deus, -i (m.)", parsing: "nom. pl.", meaning: "the gods" },
    "praebuere": { lemma: "praebeo, -ere, -ui, -itum", parsing: "perf. act. ind. 3rd pl.", meaning: "offered, provided" },
    "nec": { lemma: "nec", parsing: "conjunction", meaning: "and not, nor" },
    "multum": { lemma: "multum", parsing: "adverb", meaning: "much, far" },
    "erat": { lemma: "sum, esse, fui", parsing: "imperf. ind. 3rd sing.", meaning: "had (with perfect participle)" },
    "progressa": { lemma: "progredior, progredi, progressus sum", parsing: "perf. part. nom. fem. sing.", meaning: "having advanced" },
    "navis": { lemma: "navis, -is (f.)", parsing: "nom. sing.", meaning: "ship" },
    "duobus": { lemma: "duo, duae, duo", parsing: "abl. masc.", meaning: "with two" },
    "e": { lemma: "e/ex", parsing: "preposition + abl.", meaning: "from, out of" },
    "numero": { lemma: "numerus, -i (m.)", parsing: "abl. sing.", meaning: "number" },
    "familiarium": { lemma: "familiaris, -is (m./f.)", parsing: "gen. pl.", meaning: "of friends, of attendants" },
    "Agrippinam": { lemma: "Agrippina, -ae (f.)", parsing: "acc. sing.", meaning: "Agrippina" },
    "comitantibus": { lemma: "comitor, -ari, -atus sum", parsing: "pres. part. abl. pl.", meaning: "accompanying" },
    "ex": { lemma: "e/ex", parsing: "preposition + abl.", meaning: "from, of" },
    "quis": { lemma: "qui, quae, quod", parsing: "abl. pl.", meaning: "whom" },
    "Crepereius": { lemma: "Crepereius, -i (m.)", parsing: "nom. sing.", meaning: "Crepereius (proper name)" },
    "Gallus": { lemma: "Gallus, -i (m.)", parsing: "nom. sing.", meaning: "Gallus (proper name)" },
    "haud": { lemma: "haud", parsing: "adverb", meaning: "not" },
    "procul": { lemma: "procul", parsing: "adverb", meaning: "far" },
    "gubernaculis": { lemma: "gubernaculum, -i (n.)", parsing: "abl. pl.", meaning: "from the rudders" },
    "adstabat": { lemma: "adsto, -are, adstiti", parsing: "imperf. ind. 3rd sing.", meaning: "was standing" },
    "Acerronia": { lemma: "Acerronia, -ae (f.)", parsing: "nom. sing.", meaning: "Acerronia (proper name)" },
    "super": { lemma: "super", parsing: "preposition + acc.", meaning: "above, over" },
    "pedes": { lemma: "pes, pedis (m.)", parsing: "acc. pl.", meaning: "feet" },
    "cubitantis": { lemma: "cubito, -are", parsing: "pres. part. gen. sing.", meaning: "of one lying down" },
    "reclinis": { lemma: "reclinis, -e", parsing: "nom. sing.", meaning: "reclining, leaning back" },
    "paenitentiam": { lemma: "paenitentia, -ae (f.)", parsing: "acc. sing.", meaning: "repentance" },
    "filii": { lemma: "filius, -i (m.)", parsing: "gen. sing.", meaning: "of son" },
    "reciperatam": { lemma: "recipero, -are, -avi, -atum", parsing: "perf. part. acc. fem. sing.", meaning: "recovered" },
    "matris": { lemma: "mater, matris (f.)", parsing: "gen. sing.", meaning: "of mother" },
    "gratiam": { lemma: "gratia, -ae (f.)", parsing: "acc. sing.", meaning: "favour, influence" },
    "per": { lemma: "per", parsing: "preposition + acc.", meaning: "through, with" },
    "gaudium": { lemma: "gaudium, -i (n.)", parsing: "acc. sing.", meaning: "joy" },
    "memorabat": { lemma: "memoro, -are, -avi, -atum", parsing: "imperf. ind. 3rd sing.", meaning: "was recounting, was talking about" },
    "cum": { lemma: "cum", parsing: "conjunction", meaning: "when" },
    "dato": { lemma: "do, dare, dedi, datum", parsing: "perf. part. abl. neut. sing.", meaning: "given" },
    "signo": { lemma: "signum, -i (n.)", parsing: "abl. sing.", meaning: "signal" },
    "ruere": { lemma: "ruo, ruere, rui, rutum", parsing: "pres. inf. / historic inf.", meaning: "to collapse, to fall" },
    "tectum": { lemma: "tectum, -i (n.)", parsing: "nom. sing.", meaning: "roof, ceiling" },
    "loci": { lemma: "locus, -i (m.)", parsing: "gen. sing.", meaning: "of the place, of the room" },
    "multo": { lemma: "multus, -a, -um", parsing: "abl. sing.", meaning: "much, considerable" },
    "plumbo": { lemma: "plumbum, -i (n.)", parsing: "abl. sing.", meaning: "with lead" },
    "grave": { lemma: "gravis, -e", parsing: "nom. neut. sing.", meaning: "heavy" },
    "pressus": { lemma: "premo, premere, pressi, pressum", parsing: "perf. part. nom. masc. sing.", meaning: "crushed, pressed" },
    "pressusque": { lemma: "premo + -que", parsing: "perf. part. nom. + and", meaning: "and crushed" },
    "statim": { lemma: "statim", parsing: "adverb", meaning: "immediately" },
    "exanimatus": { lemma: "exanimo, -are, -avi, -atum", parsing: "perf. part. nom. masc. sing.", meaning: "killed, lifeless" },
    "est": { lemma: "sum, esse, fui", parsing: "pres. ind. 3rd sing.", meaning: "is, was" },
    "Agrippina": { lemma: "Agrippina, -ae (f.)", parsing: "nom. sing.", meaning: "Agrippina" },
    "eminentibus": { lemma: "emineo, -ere", parsing: "pres. part. abl. pl.", meaning: "projecting, standing out" },
    "lecti": { lemma: "lectus, -i (m.)", parsing: "gen. sing.", meaning: "of the couch, of the bed" },
    "parietibus": { lemma: "paries, parietis (m.)", parsing: "abl. pl.", meaning: "by the walls" },
    "ac": { lemma: "ac/atque", parsing: "conjunction", meaning: "and" },
    "forte": { lemma: "forte", parsing: "adverb", meaning: "by chance" },
    "validioribus": { lemma: "validus, -a, -um", parsing: "abl. pl. comparative", meaning: "stronger" },
    "quam": { lemma: "quam", parsing: "conjunction", meaning: "than" },
    "ut": { lemma: "ut", parsing: "conjunction", meaning: "that, so that" },
    "oneri": { lemma: "onus, oneris (n.)", parsing: "dat. sing.", meaning: "to the weight" },
    "cederent": { lemma: "cedo, cedere, cessi, cessum", parsing: "imperf. subj. 3rd pl.", meaning: "they might yield" },
    "protectae": { lemma: "protego, -ere, protexi, protectum", parsing: "perf. part. nom. fem. pl.", meaning: "protected" },
    "sunt": { lemma: "sum, esse, fui", parsing: "pres. ind. 3rd pl.", meaning: "are, were" },
    "dissolutio": { lemma: "dissolutio, -onis (f.)", parsing: "nom. sing.", meaning: "breaking apart, dissolution" },
    "navigii": { lemma: "navigium, -i (n.)", parsing: "gen. sing.", meaning: "of the ship" },
    "sequebatur": { lemma: "sequor, sequi, secutus sum", parsing: "imperf. ind. 3rd sing.", meaning: "followed" },
    "turbatis": { lemma: "turbo, -are, -avi, -atum", parsing: "perf. part. abl. pl.", meaning: "confused, thrown into disorder" },
    "omnibus": { lemma: "omnis, -e", parsing: "abl. pl.", meaning: "all, everyone" },
    "quod": { lemma: "quod", parsing: "conjunction", meaning: "because" },
    "plerique": { lemma: "plerique, pleraeque, pleraque", parsing: "nom. pl.", meaning: "the majority, most people" },
    "ignari": { lemma: "ignarus, -a, -um", parsing: "nom. pl.", meaning: "ignorant, not knowing" },
    "etiam": { lemma: "etiam", parsing: "adverb", meaning: "even, also" },
    "conscios": { lemma: "conscius, -a, -um", parsing: "acc. pl.", meaning: "those in the know, accomplices" },
    "impediebant": { lemma: "impedio, -ire, -ivi, -itum", parsing: "imperf. ind. 3rd pl.", meaning: "were hindering" },
    "visum": { lemma: "video, videre, vidi, visum", parsing: "perf. part. neut. (impers.)", meaning: "it seemed good" },
    "dehinc": { lemma: "dehinc", parsing: "adverb", meaning: "then, next" },
    "remigibus": { lemma: "remex, remigis (m.)", parsing: "dat. pl.", meaning: "to the rowers" },
    "unum": { lemma: "unus, -a, -um", parsing: "acc. neut. sing.", meaning: "one" },
    "in": { lemma: "in", parsing: "preposition + acc.", meaning: "to, into, onto" },
    "latus": { lemma: "latus, lateris (n.)", parsing: "acc. sing.", meaning: "side" },
    "inclinare": { lemma: "inclino, -are, -avi, -atum", parsing: "pres. inf.", meaning: "to lean, to tilt" },
    "atque": { lemma: "atque", parsing: "conjunction", meaning: "and, and so" },
    "ita": { lemma: "ita", parsing: "adverb", meaning: "thus, so" },
    "navem": { lemma: "navis, -is (f.)", parsing: "acc. sing.", meaning: "ship" },
    "submergere": { lemma: "submergo, -ere, -mersi, -mersum", parsing: "pres. inf.", meaning: "to sink, to submerge" },
    "sed": { lemma: "sed", parsing: "conjunction", meaning: "but" },
    "neque": { lemma: "neque", parsing: "conjunction", meaning: "and not, nor" },
    "ipsis": { lemma: "ipse, ipsa, ipsum", parsing: "dat. pl.", meaning: "to them, for them" },
    "promptus": { lemma: "promptus, -a, -um", parsing: "nom. sing.", meaning: "ready, quick" },
    "rem": { lemma: "res, rei (f.)", parsing: "acc. sing.", meaning: "situation, matter" },
    "subitam": { lemma: "subitus, -a, -um", parsing: "acc. sing.", meaning: "sudden" },
    "consensus": { lemma: "consensus, -us (m.)", parsing: "nom. sing.", meaning: "agreement" },
    "alii": { lemma: "alius, -a, -ud", parsing: "nom. pl.", meaning: "others" },
    "contra": { lemma: "contra", parsing: "adverb", meaning: "opposite, against" },
    "nitentes": { lemma: "nitor, niti, nisus sum", parsing: "pres. part. nom. pl.", meaning: "pressing, straining" },
    "dedere": { lemma: "do, dare, dedi, datum", parsing: "perf. ind. 3rd pl.", meaning: "gave, produced" },
    "facultatem": { lemma: "facultas, -atis (f.)", parsing: "acc. sing.", meaning: "opportunity" },
    "lenioris": { lemma: "lenis, -e", parsing: "gen. sing. comparative", meaning: "of gentler" },
    "mare": { lemma: "mare, maris (n.)", parsing: "acc. sing.", meaning: "sea" },
    "iactus": { lemma: "iactus, -us (m.)", parsing: "gen. sing.", meaning: "of throwing, of casting" },
    "verum": { lemma: "verum", parsing: "conjunction", meaning: "but, however" },
    "imprudentia": { lemma: "imprudentia, -ae (f.)", parsing: "abl. sing.", meaning: "through imprudence, through bad judgement" },
    "dum": { lemma: "dum", parsing: "conjunction", meaning: "while" },
    "se": { lemma: "sui, sibi, se", parsing: "acc. reflexive", meaning: "herself" },
    "esse": { lemma: "sum, esse, fui", parsing: "pres. inf.", meaning: "to be" },
    "utque": { lemma: "ut + -que", parsing: "conjunction", meaning: "and that" },
    "subveniretur": { lemma: "subvenio, -ire, -veni, -ventum", parsing: "imperf. subj. pass. 3rd sing.", meaning: "help be given" },
    "matri": { lemma: "mater, matris (f.)", parsing: "dat. sing.", meaning: "to the mother" },
    "principis": { lemma: "princeps, principis (m.)", parsing: "gen. sing.", meaning: "of the emperor" },
    "clamitat": { lemma: "clamito, -are", parsing: "pres. ind. 3rd sing.", meaning: "keeps shouting, shouts repeatedly" },
    "contis": { lemma: "contus, -i (m.)", parsing: "abl. pl.", meaning: "with poles" },
    "remis": { lemma: "remus, -i (m.)", parsing: "abl. pl.", meaning: "with oars" },
    "quae": { lemma: "qui, quae, quod", parsing: "acc. pl. neut.", meaning: "which things, whatever" },
    "fors": { lemma: "fors, fortis (f.)", parsing: "nom. sing.", meaning: "chance" },
    "obtulerat": { lemma: "offero, offerre, obtuli, oblatum", parsing: "pluperf. ind. 3rd sing.", meaning: "had offered" },
    "navalibus": { lemma: "navalis, -e", parsing: "abl. pl.", meaning: "naval" },
    "telis": { lemma: "telum, -i (n.)", parsing: "abl. pl.", meaning: "with weapons" },
    "conficitur": { lemma: "conficio, -ere, -feci, -fectum", parsing: "pres. pass. 3rd sing.", meaning: "is killed, is finished off" },
    "silens": { lemma: "sileo, -ere, -ui", parsing: "pres. part. nom. sing.", meaning: "silent, keeping quiet" },
    "eo": { lemma: "is, ea, id", parsing: "abl. neut.", meaning: "for that reason" },
    "eoque": { lemma: "eo + -que", parsing: "abl. + and", meaning: "and for that reason" },
    "minus": { lemma: "minus", parsing: "adverb", meaning: "less" },
    "adgnita": { lemma: "agnosco, -ere, agnovi, agnitum", parsing: "perf. part. nom. fem. sing.", meaning: "recognised" },
    "tamen": { lemma: "tamen", parsing: "adverb", meaning: "however, nevertheless" },
    "vulnus": { lemma: "vulnus, vulneris (n.)", parsing: "acc. sing.", meaning: "wound" },
    "umero": { lemma: "umerus, -i (m.)", parsing: "abl. sing.", meaning: "in the shoulder" },
    "excepit": { lemma: "excipio, -ere, excepi, exceptum", parsing: "perf. ind. 3rd sing.", meaning: "received" },
    "nando": { lemma: "no, nare, navi", parsing: "gerund abl.", meaning: "by swimming" },
    "deinde": { lemma: "deinde", parsing: "adverb", meaning: "then, next" },
    "occursu": { lemma: "occursus, -us (m.)", parsing: "abl. sing.", meaning: "by meeting, by encounter" },
    "lenunculorum": { lemma: "lenunculus, -i (m.)", parsing: "gen. pl.", meaning: "of small boats, of skiffs" },
    "Lucrinum": { lemma: "Lucrinus, -a, -um", parsing: "acc. sing.", meaning: "Lucrine" },
    "lacum": { lemma: "lacus, -us (m.)", parsing: "acc. sing.", meaning: "lake" },
    "vecta": { lemma: "veho, vehere, vexi, vectum", parsing: "perf. part. nom. fem. sing.", meaning: "having been carried" },
    "villae": { lemma: "villa, -ae (f.)", parsing: "dat. sing.", meaning: "to the villa" },
    "suae": { lemma: "suus, -a, -um", parsing: "gen. fem. sing.", meaning: "her own" },
    "infertur": { lemma: "infero, inferre, intuli, illatum", parsing: "pres. pass. 3rd sing.", meaning: "is brought in, is carried" }
};

const latinSentences = [
    "noctem sideribus inlustrem et placido mari quietam quasi convincendum ad scelus dii praebuere.",
    "nec multum erat progressa navis, duobus e numero familiarium Agrippinam comitantibus, ex quis Crepereius Gallus haud procul gubernaculis adstabat, Acerronia super pedes cubitantis reclinis paenitentiam filii et reciperatam matris gratiam per gaudium memorabat,",
    "cum dato signo ruere tectum loci multo plumbo grave, pressusque Crepereius et statim exanimatus est:",
    "Agrippina et Acerronia eminentibus lecti parietibus ac forte validioribus quam ut oneri cederent protectae sunt.",
    "nec dissolutio navigii sequebatur, turbatis omnibus et quod plerique ignari etiam conscios impediebant.",
    "visum dehinc remigibus unum in latus inclinare atque ita navem submergere:",
    "sed neque ipsis promptus in rem subitam consensus, et alii contra nitentes dedere facultatem lenioris in mare iactus.",
    "verum Acerronia, imprudentia dum se Agrippinam esse utque subveniretur matri principis clamitat, contis et remis et quae fors obtulerat navalibus telis conficitur:",
    "Agrippina silens eoque minus adgnita (unum tamen vulnus umero excepit) nando, deinde occursu lenunculorum Lucrinum in lacum vecta villae suae infertur."
];

const resources = {
    summary: `<h4>Summary</h4>
<p>This passage describes the dramatic failure of Nero's elaborate assassination plot against his mother Agrippina. The gods seem to conspire against the crime by providing a perfectly beautiful night - clear stars and calm seas - as if to expose what is about to happen.</p>
<p>The ship had not travelled far when the signal was given. Two of Agrippina's attendants were with her: Crepereius Gallus stood near the rudders, while Acerronia reclined at Agrippina's feet, happily discussing Nero's supposed reconciliation with his mother. At the signal, the lead-weighted ceiling collapsed. Crepereius was killed instantly, but Agrippina and Acerronia survived, protected by the raised walls of the couch which by chance were strong enough to support the weight.</p>
<p>The ship failed to break apart as planned. Chaos ensued as the ignorant crew hindered those who knew the plot. When the conspirators tried to capsize the boat by leaning to one side, others pushed back, resulting in a gentler fall into the water. Acerronia, fatally shouting that she was Agrippina and demanding help for the emperor's mother, was beaten to death with poles and oars. The real Agrippina, keeping silent and therefore unrecognised despite receiving a shoulder wound, swam away and was rescued by fishing boats, eventually reaching her villa.</p>`,
    context: `<h4>Historical Context</h4>
<p><strong>The Assassination Plot:</strong> By 59 CE, Nero had grown increasingly hostile towards his dominating mother Agrippina. Having already murdered his stepbrother Britannicus, Nero now turned his attention to eliminating his mother. The chosen method was ingenious: a specially constructed ship designed to collapse at sea, making death appear accidental.</p>
<p><strong>The Collapsing Ship:</strong> The ship was engineered with a weighted ceiling that would fall on signal and a hull designed to break apart. This elaborate mechanism reflects Roman engineering prowess being perverted for murder. The plan's failure‚Äîtoo much lead, walls too strong, chaos preventing the ship from breaking up‚Äîexposes the gap between theoretical planning and practical execution.</p>
<p><strong>Divine Irony:</strong> Tacitus opens with the gods providing perfect weather "quasi convincendum ad scelus" (as if to expose the crime). This divine framing transforms the beautiful night into moral commentary‚Äîthe gods offer clarity precisely so the crime cannot be hidden.</p>
<p><strong>Acerronia's Tragic Mistake:</strong> Acerronia's death represents tragic irony: she claimed to be Agrippina hoping to be rescued as the emperor's mother, but this very claim marked her for death by the conspirators. Her loyalty and quick thinking proved fatal.</p>
<p><strong>Agrippina's Survival:</strong> Agrippina's survival demonstrates her political intelligence. Unlike Acerronia, she remained silent and unidentified. Despite being wounded, she swam to safety‚Äîa remarkable feat that Tacitus presents without much comment, allowing readers to appreciate her physical and mental resilience.</p>`,
    comprehension: `<h4>Comprehension Questions</h4>
<p><strong>Lines 1-2:</strong> What kind of night did the gods provide? What does "quasi convincendum ad scelus" suggest about the gods' role in this narrative?</p>
<p><strong>Lines 2-3:</strong> Who were the two attendants with Agrippina? What was each of them doing when the ship had advanced only a short distance?</p>
<p><strong>Lines 3-4:</strong> What happened "dato signo"? What was the ceiling weighted with, and what was the immediate result?</p>
<p><strong>Lines 4-5:</strong> How were Agrippina and Acerronia protected? What role does "forte" (by chance) play in their survival?</p>
<p><strong>Lines 5-6:</strong> Why didn't the ship break apart as planned? What is the significance of "ignari" versus "conscios"?</p>
<p><strong>Lines 6-7:</strong> What did the rowers decide to do? Why did this plan also fail?</p>
<p><strong>Lines 7-8:</strong> What was the consequence of the failed capsizing attempt? What does "lenioris in mare iactus" suggest?</p>
<p><strong>Lines 8-9:</strong> What fatal mistake did Acerronia make? How is she killed?</p>
<p><strong>Lines 9-10:</strong> How does Agrippina's behaviour contrast with Acerronia's? What does "silens eoque minus adgnita" reveal about Agrippina's survival strategy?</p>
<p><strong>Overall:</strong> How does Tacitus use the contrast between mechanical planning and human chaos to comment on Nero's plot? What role does fortune (forte, fors) play throughout the passage?</p>`
};

let currentPopup = null;
let sentenceModeActive = false;
let currentSentenceIndex = 0;
let pointerModeActive = false;

function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    const isDark = document.body.classList.contains('dark-mode');
    savePreference('darkMode', isDark);

    const btn = event.currentTarget;
    if (isDark) {
        btn.textContent = '‚òÄÔ∏è Light';
        btn.classList.add('active');
    } else {
        btn.textContent = 'üåô Dark';
        btn.classList.remove('active');
    }
}

function toggleFullScreen() {
    document.body.classList.toggle('full-screen');
    const btn = event.currentTarget;
    if (document.body.classList.contains('full-screen')) {
        btn.textContent = '‚õ∂ Exit Full Screen';
        btn.classList.add('active');
    } else {
        btn.textContent = '‚õ∂ Full Screen';
        btn.classList.remove('active');
    }
}

function toggleLineNumbers() {
    const latinText = document.getElementById('latinText');
    latinText.classList.toggle('show-lines');
    const showLines = latinText.classList.contains('show-lines');
    savePreference('lineNumbers', showLines);

    const btn = event.currentTarget;
    btn.classList.toggle('active');
}

function togglePointerMode() {
    pointerModeActive = !pointerModeActive;
    document.body.classList.toggle('pointer-mode');
    const btn = event.currentTarget;
    btn.classList.toggle('active');

    if (!pointerModeActive) {
        // Clear all pointed words when exiting pointer mode
        document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
    }

    // Hide vocab popup when entering pointer mode
    if (pointerModeActive) {
        hidePopup();
    }
}

function toggleSentenceMode() {
    const latinText = document.getElementById('latinText');
    const sentenceNav = document.getElementById('sentenceNav');
    const btn = event.currentTarget;

    sentenceModeActive = !sentenceModeActive;

    if (sentenceModeActive) {
        latinText.classList.add('sentence-mode');
        sentenceNav.classList.add('visible');
        btn.classList.add('active');
        btn.textContent = 'Full Text';
        currentSentenceIndex = 0;
        updateSentenceDisplay();
    } else {
        latinText.classList.remove('sentence-mode');
        sentenceNav.classList.remove('visible');
        btn.classList.remove('active');
        btn.textContent = 'Sentence Mode';
        // Remove current-sentence class from all
        document.querySelectorAll('.latin-text p').forEach(p => p.classList.remove('current-sentence'));
    }
}

function updateSentenceDisplay() {
    const paragraphs = document.querySelectorAll('.latin-text p');
    paragraphs.forEach((p, i) => {
        if (i === currentSentenceIndex) {
            p.classList.add('current-sentence');
        } else {
            p.classList.remove('current-sentence');
        }
    });
    document.getElementById('sentenceCounter').textContent = `${currentSentenceIndex + 1} / ${paragraphs.length}`;

    // Update button states
    const navButtons = document.querySelectorAll('.sentence-nav button');
    navButtons[0].disabled = currentSentenceIndex === 0;
    navButtons[1].disabled = currentSentenceIndex === paragraphs.length - 1;
}

function prevSentence() {
    if (currentSentenceIndex > 0) {
        currentSentenceIndex--;
        updateSentenceDisplay();
        hidePopup();
    }
}

function nextSentence() {
    const paragraphs = document.querySelectorAll('.latin-text p');
    if (currentSentenceIndex < paragraphs.length - 1) {
        currentSentenceIndex++;
        updateSentenceDisplay();
        hidePopup();
    }
}

function generateLatinHTML() {
    let html = '';
    latinSentences.forEach((sentence, index) => {
        // Split into tokens, keeping punctuation attached to words
        const tokens = sentence.match(/[a-zA-Z]+[.,;:()]*|[.,;:()]+/g);
        html += '<p style="margin-bottom: 1.5rem;">';
        html += `<span class="line-number">${index + 1}</span>`;
        html += '<span class="line-content">';
        if (tokens) {
            tokens.forEach((token, i) => {
                // Separate word from trailing punctuation
                const match = token.match(/^([a-zA-Z]+)([.,;:()]*)$/);
                if (match) {
                    const word = match[1];
                    const punct = match[2];
                    const lookupWord = word.toLowerCase();
                    html += `<span class="word" data-word="${lookupWord}">${word}</span>${punct}`;
                    // Add space after unless it's the last token
                    if (i < tokens.length - 1) html += ' ';
                } else {
                    // Just punctuation
                    html += token + ' ';
                }
            });
        }
        html += '</span></p>';
    });
    return html;
}

function showVocabPopup(event, word) {
    const popup = document.getElementById('vocabPopup');
    const wordData = vocab[word.toLowerCase()];

    // Remove active class from all words
    document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active'));

    if (!wordData) {
        popup.classList.remove('visible');
        return;
    }

    // Add active class to clicked word
    event.target.classList.add('active');

    popup.innerHTML = `
        <h4>${word}</h4>
        <div class="parsing">${wordData.parsing}</div>
        <div class="meaning">${wordData.meaning}</div>
        <div class="principal-parts">${wordData.lemma}</div>
    `;

    // Position popup near the word
    const rect = event.target.getBoundingClientRect();
    const popupWidth = 300;
    const popupHeight = 150;

    let left = rect.left + (rect.width / 2) - (popupWidth / 2);
    let top = rect.bottom + 12;
    let arrowBottom = false;

    // Keep popup within viewport horizontally
    if (left < 10) left = 10;
    if (left + popupWidth > window.innerWidth - 10) {
        left = window.innerWidth - popupWidth - 10;
    }

    // If popup would go below viewport, show above word
    if (top + popupHeight > window.innerHeight) {
        top = rect.top - popupHeight - 12;
        arrowBottom = true;
    }

    // Calculate arrow position relative to popup
    const wordCenterX = rect.left + (rect.width / 2);
    const arrowLeft = Math.max(20, Math.min(popupWidth - 20, wordCenterX - left));

    popup.style.left = left + 'px';
    popup.style.top = top + 'px';
    popup.style.setProperty('--arrow-left', arrowLeft + 'px');
    popup.classList.toggle('arrow-bottom', arrowBottom);
    popup.classList.add('visible');

    currentPopup = popup;
}

function hidePopup() {
    const popup = document.getElementById('vocabPopup');
    popup.classList.remove('visible');
    document.querySelectorAll('.word.active').forEach(w => w.classList.remove('active'));
}

function toggleTranslation() {
    const box = document.getElementById('translationBox');
    const btn = event.currentTarget;

    if (box.classList.contains('active')) {
        box.classList.remove('active');
        btn.textContent = 'Translation';
        btn.classList.remove('active');
    } else {
        box.classList.add('active');
        btn.textContent = 'Hide Translation';
        btn.classList.add('active');
    }
}

function showView(view) {
    // Update nav
    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
    event.currentTarget.classList.add('active');

    const textCard = document.getElementById('textCard');
    const resourceCard = document.getElementById('resourceCard');

    if (view === 'text') {
        textCard.style.display = 'block';
        resourceCard.style.display = 'none';
    } else {
        textCard.style.display = 'none';
        resourceCard.style.display = 'block';
        document.getElementById('resourceTitle').textContent = view.charAt(0).toUpperCase() + view.slice(1);
        document.getElementById('resourceContent').innerHTML = resources[view];
    }
}

// Initialise
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('latinText').innerHTML = generateLatinHTML();

    // Load saved preferences
    loadPreferences();

    // Add click handlers to words
    document.querySelectorAll('.word').forEach(word => {
        word.addEventListener('click', function(e) {
            e.stopPropagation();

            if (pointerModeActive) {
                // Toggle pointed class
                this.classList.toggle('pointed');
            } else {
                showVocabPopup(e, this.dataset.word);
            }
        });
    });

    // Hide popup when clicking elsewhere, clear pointer highlights on background click
    document.addEventListener('click', function(e) {
        if (!e.target.classList.contains('word')) {
            hidePopup();

            // If in pointer mode and clicking background (not buttons), clear all highlights
            if (pointerModeActive && !e.target.closest('.btn-group') && !e.target.closest('.sentence-nav')) {
                document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
            }
        }
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Escape to exit full screen
        if (e.key === 'Escape') {
            if (document.body.classList.contains('full-screen')) {
                document.body.classList.remove('full-screen');
                const btn = document.querySelector('.btn-group .btn:last-child');
                if (btn) {
                    btn.textContent = '‚õ∂ Full Screen';
                    btn.classList.remove('active');
                }
            }
            // Also exit pointer mode on escape
            if (pointerModeActive) {
                pointerModeActive = false;
                document.body.classList.remove('pointer-mode');
                document.querySelectorAll('.word.pointed').forEach(w => w.classList.remove('pointed'));
                document.querySelectorAll('.btn').forEach(btn => {
                    if (btn.textContent === 'Pointer Mode') btn.classList.remove('active');
                });
            }
        }

        // Arrow keys for sentence navigation
        if (sentenceModeActive) {
            if (e.key === 'ArrowLeft') {
                prevSentence();
            } else if (e.key === 'ArrowRight') {
                nextSentence();
            }
        }
    });
});

function loadPreferences() {
    // Dark mode
    if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
        setTimeout(() => {
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent.includes('Dark')) {
                    btn.textContent = '‚òÄÔ∏è Light';
                    btn.classList.add('active');
                }
            });
        }, 0);
    }

    // Line numbers
    if (localStorage.getItem('lineNumbers') === 'true') {
        document.getElementById('latinText').classList.add('show-lines');
        setTimeout(() => {
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent === 'Line Numbers') {
                    btn.classList.add('active');
                }
            });
        }, 0);
    }
}

function savePreference(key, value) {
    localStorage.setItem(key, value);
}
    </script>
</body>
</html>
