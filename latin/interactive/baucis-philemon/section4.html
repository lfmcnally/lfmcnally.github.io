<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classicalia - Ovid Met. 8.36-50</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 240px;
            background: white;
            border-right: 1px solid #e5e7eb;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }
        .logo-section {
            padding: 1.5rem 1.25rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }
        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #0066ff 0%, #4d94ff 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.1rem;
        }
        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
        }
        .nav-section {
            padding: 1rem 0.5rem;
        }
        .nav-title {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #9ca3af;
            letter-spacing: 0.05em;
            padding: 0 0.75rem;
            margin-bottom: 0.5rem;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.625rem 0.75rem;
            margin: 0.125rem 0;
            border-radius: 8px;
            text-decoration: none;
            color: #4b5563;
            font-size: 0.9rem;
            transition: all 0.15s ease;
            cursor: pointer;
        }
        .nav-item:hover {
            background: #f3f4f6;
            color: #1f2937;
        }
        .nav-item.active {
            background: #eef2ff;
            color: #0066ff;
            font-weight: 500;
        }
        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }
        .main-content {
            margin-left: 240px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .top-bar {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0.875rem 2rem;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .content-wrapper {
            flex: 1;
            overflow-y: auto;
        }
        .content-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        .lesson-header {
            margin-bottom: 2rem;
        }
        .lesson-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        .lesson-meta {
            display: flex;
            gap: 1.5rem;
            font-size: 0.875rem;
            color: #6b7280;
        }
        .story-recap {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            color: white;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
        }
        .recap-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
        }
        .recap-icon {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            backdrop-filter: blur(10px);
        }
        .recap-title-section h2 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        .recap-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            font-weight: 500;
        }
        .recap-content {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }
        .recap-moment {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .recap-moment:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }
        .moment-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            display: block;
        }
        .moment-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }
        .moment-description {
            font-size: 0.9375rem;
            line-height: 1.6;
            opacity: 0.95;
        }
        .learning-objectives {
            background: white;
            border-radius: 12px;
            border: 2px solid #0066ff;
            padding: 2rem;
            margin-bottom: 2rem;
            max-width: 1200px;
        }
        .learning-intention {
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 2px solid #e5e7eb;
        }
        .objective-heading {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0066ff;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .intention-text {
            font-size: 1.25rem;
            line-height: 1.6;
            color: #1f2937;
            font-weight: 500;
        }
        .success-criteria {
            margin-top: 2rem;
        }
        .criteria-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.25rem;
            margin-top: 1.25rem;
        }
        .criterion {
            display: flex;
            gap: 1rem;
            padding: 1.25rem;
            background: #f9fafb;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            transition: all 0.2s ease;
        }
        .criterion:hover {
            border-color: #0066ff;
            box-shadow: 0 2px 8px rgba(0, 102, 255, 0.1);
        }
        .criterion-number {
            flex-shrink: 0;
            width: 36px;
            height: 36px;
            background: #0066ff;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.125rem;
        }
        .criterion-content h3 {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        .criterion-content p {
            font-size: 0.875rem;
            line-height: 1.5;
            color: #4b5563;
        }
        .exam-question-section {
            max-width: 1200px;
            margin-bottom: 2rem;
        }
        .exam-question-card {
            background: white;
            border-radius: 12px;
            border: 2px solid #dc2626;
            padding: 2rem;
        }
        .exam-header {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid #e5e7eb;
        }
        .exam-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #dc2626;
            margin-bottom: 0.5rem;
        }
        .exam-meta {
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .question-box {
            background: #fef2f2;
            border-left: 4px solid #dc2626;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        .question-text {
            font-size: 1.125rem;
            line-height: 1.7;
            color: #1f2937;
            margin: 0;
        }
        .latin-extract {
            background: #f9fafb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        .latin-extract h3 {
            font-size: 1rem;
            font-weight: 600;
            color: #4b5563;
            margin-bottom: 1rem;
        }
        .extract-text {
            font-family: 'Georgia', serif;
            font-size: 1.125rem;
            line-height: 2;
            color: #1f2937;
        }
        .extract-text p {
            margin: 0.25rem 0;
        }
        .exam-guidance {
            background: #eff6ff;
            border-left: 4px solid #0066ff;
            padding: 1.5rem;
            border-radius: 8px;
        }
        .exam-guidance h3 {
            font-size: 1rem;
            font-weight: 600;
            color: #0066ff;
            margin-bottom: 1rem;
        }
        .exam-guidance ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .exam-guidance li {
            font-size: 0.9375rem;
            line-height: 1.6;
            color: #1f2937;
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
        }
        .exam-guidance li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #0066ff;
            font-weight: 700;
        }
        .lesson-layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 1.5rem;
            align-items: start;
        }
        .card {
            background: white;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }
        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
        }
        .card-body {
            padding: 1.5rem;
        }
        .tabs {
            display: flex;
            gap: 0.25rem;
            background: #f3f4f6;
            padding: 0.25rem;
            border-radius: 8px;
        }
        .tab {
            flex: 1;
            padding: 0.5rem 1rem;
            background: transparent;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        .tab.active {
            background: white;
            color: #0066ff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .section-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        .section-btn {
            flex: 1;
            padding: 0.875rem;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.9375rem;
            font-weight: 600;
            color: #4b5563;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .section-btn:hover {
            border-color: #0066ff;
            color: #0066ff;
        }
        .section-btn.active {
            background: #0066ff;
            border-color: #0066ff;
            color: white;
        }
        .section-content {
            display: none;
        }
        .section-content.active {
            display: block;
        }
        .latin-text {
            font-size: 1.2rem;
            line-height: 2.4;
            color: #1f2937;
            margin: 1.5rem 0;
            font-family: 'Georgia', serif;
        }
        .line {
            display: block;
            margin: 0.5rem 0;
        }
        .line-number {
            display: inline-block;
            width: 35px;
            color: #9ca3af;
            font-size: 0.85rem;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            user-select: none;
        }
        .phrase {
            cursor: pointer;
            padding: 3px 6px;
            margin: 0 2px;
            border-radius: 4px;
            transition: all 0.2s ease;
            display: inline;
        }
        .phrase.phrase-1 { background: rgba(76, 175, 80, 0.15); }
        .phrase.phrase-1:hover { background: rgba(76, 175, 80, 0.3); }
        .phrase.phrase-2 { background: rgba(33, 150, 243, 0.15); }
        .phrase.phrase-2:hover { background: rgba(33, 150, 243, 0.3); }
        .phrase.phrase-3 { background: rgba(156, 39, 176, 0.15); }
        .phrase.phrase-3:hover { background: rgba(156, 39, 176, 0.3); }
        .phrase.phrase-4 { background: rgba(255, 152, 0, 0.15); }
        .phrase.phrase-4:hover { background: rgba(255, 152, 0, 0.3); }
        .phrase.phrase-5 { background: rgba(244, 67, 54, 0.15); }
        .phrase.phrase-5:hover { background: rgba(244, 67, 54, 0.3); }
        .phrase.phrase-6 { background: rgba(0, 188, 212, 0.15); }
        .phrase.phrase-6:hover { background: rgba(0, 188, 212, 0.3); }
        .phrase.phrase-7 { background: rgba(76, 175, 80, 0.15); }
        .phrase.phrase-7:hover { background: rgba(76, 175, 80, 0.3); }
        .phrase.phrase-8 { background: rgba(33, 150, 243, 0.15); }
        .phrase.phrase-8:hover { background: rgba(33, 150, 243, 0.3); }
        .phrase.phrase-9 { background: rgba(156, 39, 176, 0.15); }
        .phrase.phrase-9:hover { background: rgba(156, 39, 176, 0.3); }
        .phrase.phrase-10 { background: rgba(255, 152, 0, 0.15); }
        .phrase.phrase-10:hover { background: rgba(255, 152, 0, 0.3); }
        .phrase.phrase-11 { background: rgba(244, 67, 54, 0.15); }
        .phrase.phrase-11:hover { background: rgba(244, 67, 54, 0.3); }
        .phrase.phrase-12 { background: rgba(0, 188, 212, 0.15); }
        .phrase.phrase-12:hover { background: rgba(0, 188, 212, 0.3); }
        .phrase.phrase-13 { background: rgba(76, 175, 80, 0.15); }
        .phrase.phrase-13:hover { background: rgba(76, 175, 80, 0.3); }
        .phrase.phrase-14 { background: rgba(33, 150, 243, 0.15); }
        .phrase.phrase-14:hover { background: rgba(33, 150, 243, 0.3); }
        .phrase.phrase-15 { background: rgba(156, 39, 176, 0.15); }
        .phrase.phrase-15:hover { background: rgba(156, 39, 176, 0.3); }
        .phrase.phrase-16 { background: rgba(255, 152, 0, 0.15); }
        .phrase.phrase-16:hover { background: rgba(255, 152, 0, 0.3); }
        .phrase.phrase-17 { background: rgba(244, 67, 54, 0.15); }
        .phrase.phrase-17:hover { background: rgba(244, 67, 54, 0.3); }
        .phrase.phrase-18 { background: rgba(0, 188, 212, 0.15); }
        .phrase.phrase-18:hover { background: rgba(0, 188, 212, 0.3); }
        .phrase.phrase-19 { background: rgba(76, 175, 80, 0.15); }
        .phrase.phrase-19:hover { background: rgba(76, 175, 80, 0.3); }
        .phrase.phrase-20 { background: rgba(33, 150, 243, 0.15); }
        .phrase.phrase-20:hover { background: rgba(33, 150, 243, 0.3); }
        .phrase.phrase-21 { background: rgba(156, 39, 176, 0.15); }
        .phrase.phrase-21:hover { background: rgba(156, 39, 176, 0.3); }
        .phrase.phrase-22 { background: rgba(255, 152, 0, 0.15); }
        .phrase.phrase-22:hover { background: rgba(255, 152, 0, 0.3); }
        .phrase.phrase-23 { background: rgba(244, 67, 54, 0.15); }
        .phrase.phrase-23:hover { background: rgba(244, 67, 54, 0.3); }
        .phrase.phrase-24 { background: rgba(0, 188, 212, 0.15); }
        .phrase.phrase-24:hover { background: rgba(0, 188, 212, 0.3); }
        .phrase.phrase-25 { background: rgba(76, 175, 80, 0.15); }
        .phrase.phrase-25:hover { background: rgba(76, 175, 80, 0.3); }
        .phrase.phrase-26 { background: rgba(33, 150, 243, 0.15); }
        .phrase.phrase-26:hover { background: rgba(33, 150, 243, 0.3); }
        .phrase.phrase-27 { background: rgba(156, 39, 176, 0.15); }
        .phrase.phrase-27:hover { background: rgba(156, 39, 176, 0.3); }
        .phrase.phrase-28 { background: rgba(255, 152, 0, 0.15); }
        .phrase.phrase-28:hover { background: rgba(255, 152, 0, 0.3); }
        .phrase.phrase-29 { background: rgba(244, 67, 54, 0.15); }
        .phrase.phrase-29:hover { background: rgba(244, 67, 54, 0.3); }
        .phrase.phrase-30 { background: rgba(0, 188, 212, 0.15); }
        .phrase.phrase-30:hover { background: rgba(0, 188, 212, 0.3); }
        .highlight-style {
            cursor: pointer;
            padding: 3px 6px;
            margin: 0 2px;
            border-radius: 4px;
            transition: all 0.2s ease;
            display: inline;
            background: transparent;
        }
        .mode-style .highlight-style.style-1 { background: rgba(255, 235, 59, 0.25); }
        .mode-style .highlight-style.style-1:hover { background: rgba(255, 235, 59, 0.4); }
        .mode-style .highlight-style.style-2 { background: rgba(255, 152, 0, 0.25); }
        .mode-style .highlight-style.style-2:hover { background: rgba(255, 152, 0, 0.4); }
        .mode-style .highlight-style.style-3 { background: rgba(76, 175, 80, 0.25); }
        .mode-style .highlight-style.style-3:hover { background: rgba(76, 175, 80, 0.4); }
        .mode-style .highlight-style.style-4 { background: rgba(33, 150, 243, 0.25); }
        .mode-style .highlight-style.style-4:hover { background: rgba(33, 150, 243, 0.4); }
        .mode-style .highlight-style.style-5 { background: rgba(156, 39, 176, 0.25); }
        .mode-style .highlight-style.style-5:hover { background: rgba(156, 39, 176, 0.4); }
        .mode-style .highlight-style.style-6 { background: rgba(244, 67, 54, 0.25); }
        .mode-style .highlight-style.style-6:hover { background: rgba(244, 67, 54, 0.4); }
        .mode-style .highlight-style.style-7 { background: rgba(0, 188, 212, 0.25); }
        .mode-style .highlight-style.style-7:hover { background: rgba(0, 188, 212, 0.4); }
        .mode-style .highlight-style.style-8 { background: rgba(255, 235, 59, 0.25); }
        .mode-style .highlight-style.style-8:hover { background: rgba(255, 235, 59, 0.4); }
        .mode-style .highlight-style.style-9 { background: rgba(255, 152, 0, 0.25); }
        .mode-style .highlight-style.style-9:hover { background: rgba(255, 152, 0, 0.4); }
        .mode-style .highlight-style.style-10 { background: rgba(76, 175, 80, 0.25); }
        .mode-style .highlight-style.style-10:hover { background: rgba(76, 175, 80, 0.4); }
        .mode-style .highlight-style.style-11 { background: rgba(33, 150, 243, 0.25); }
        .mode-style .highlight-style.style-11:hover { background: rgba(33, 150, 243, 0.4); }
        .mode-style .highlight-style.style-12 { background: rgba(156, 39, 176, 0.25); }
        .mode-style .highlight-style.style-12:hover { background: rgba(156, 39, 176, 0.4); }
        .mode-style .highlight-style.style-13 { background: rgba(244, 67, 54, 0.25); }
        .mode-style .highlight-style.style-13:hover { background: rgba(244, 67, 54, 0.4); }
        .mode-style .highlight-style.style-14 { background: rgba(0, 188, 212, 0.25); }
        .mode-style .highlight-style.style-14:hover { background: rgba(0, 188, 212, 0.4); }
        .mode-style .highlight-style.style-15 { background: rgba(255, 235, 59, 0.25); }
        .mode-style .highlight-style.style-15:hover { background: rgba(255, 235, 59, 0.4); }
        .mode-style .highlight-style.style-16 { background: rgba(255, 152, 0, 0.25); }
        .mode-style .highlight-style.style-16:hover { background: rgba(255, 152, 0, 0.4); }
        .mode-style .highlight-style.style-17 { background: rgba(76, 175, 80, 0.25); }
        .mode-style .highlight-style.style-17:hover { background: rgba(76, 175, 80, 0.4); }
        .mode-style .highlight-style.style-18 { background: rgba(33, 150, 243, 0.25); }
        .mode-style .highlight-style.style-18:hover { background: rgba(33, 150, 243, 0.4); }
        .mode-style .highlight-style.style-19 { background: rgba(156, 39, 176, 0.25); }
        .mode-style .highlight-style.style-19:hover { background: rgba(156, 39, 176, 0.4); }
        .mode-style .highlight-style.style-20 { background: rgba(244, 67, 54, 0.25); }
        .mode-style .highlight-style.style-20:hover { background: rgba(244, 67, 54, 0.4); }
        .mode-style .highlight-style.style-21 { background: rgba(0, 188, 212, 0.25); }
        .mode-style .highlight-style.style-21:hover { background: rgba(0, 188, 212, 0.4); }
        .mode-style .highlight-style.style-22 { background: rgba(255, 235, 59, 0.25); }
        .mode-style .highlight-style.style-22:hover { background: rgba(255, 235, 59, 0.4); }
        .mode-style .highlight-style.style-23 { background: rgba(255, 152, 0, 0.25); }
        .mode-style .highlight-style.style-23:hover { background: rgba(255, 152, 0, 0.4); }
        .mode-style .highlight-style.style-24 { background: rgba(76, 175, 80, 0.25); }
        .mode-style .highlight-style.style-24:hover { background: rgba(76, 175, 80, 0.4); }
        .mode-style .highlight-style.style-25 { background: rgba(33, 150, 243, 0.25); }
        .mode-style .highlight-style.style-25:hover { background: rgba(33, 150, 243, 0.4); }
        .mode-style .highlight-style.style-26 { background: rgba(156, 39, 176, 0.25); }
        .mode-style .highlight-style.style-26:hover { background: rgba(156, 39, 176, 0.4); }
        .mode-style .highlight-style.style-27 { background: rgba(244, 67, 54, 0.25); }
        .mode-style .highlight-style.style-27:hover { background: rgba(244, 67, 54, 0.4); }
        .mode-style .highlight-style.style-28 { background: rgba(0, 188, 212, 0.25); }
        .mode-style .highlight-style.style-28:hover { background: rgba(0, 188, 212, 0.4); }
        .mode-style .highlight-style.style-29 { background: rgba(255, 235, 59, 0.25); }
        .mode-style .highlight-style.style-29:hover { background: rgba(255, 235, 59, 0.4); }
        .mode-style .highlight-style.style-30 { background: rgba(255, 152, 0, 0.25); }
        .mode-style .highlight-style.style-30:hover { background: rgba(255, 152, 0, 0.4); }
        .mode-style .phrase {
            background: transparent !important;
            cursor: default;
        }
        .latin-text:not(.mode-style) .highlight-style {
            background: transparent;
            cursor: default;
            padding: 0;
            pointer-events: none;
        }
        .analysis-card {
            background: #f9fafb;
            border-radius: 8px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            border: 1px solid #e5e7eb;
            display: none;
        }
        .analysis-card.active {
            display: block;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .analysis-badge {
            display: inline-block;
            padding: 0.25rem 0.625rem;
            background: rgba(0, 102, 255, 0.1);
            color: #0066ff;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.75rem;
        }
        .analysis-card h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.75rem;
        }
        .analysis-card p {
            font-size: 0.875rem;
            line-height: 1.6;
            color: #4b5563;
            margin-bottom: 0.5rem;
        }
        .analysis-card .vocab-list {
            font-size: 0.85rem;
            line-height: 1.7;
            color: #4b5563;
            margin: 0.5rem 0;
        }
        .analysis-card strong {
            color: #0066ff;
        }
        .translation-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }
        .translation-text {
            display: none;
            font-size: 0.875rem;
            line-height: 1.6;
            color: #059669;
            margin-top: 0.5rem;
            padding: 0.75rem;
            background: rgba(5, 150, 105, 0.05);
            border-radius: 6px;
            border-left: 3px solid #059669;
        }
        .translation-text.visible {
            display: block;
        }
        .reveal-translation-btn {
            background: #0066ff;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .reveal-translation-btn:hover {
            background: #0052cc;
        }
        .reveal-translation-btn.revealed {
            background: #10b981;
        }
        .reveal-translation-btn.revealed:hover {
            background: #059669;
        }
        .btn-group {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }
        .btn {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        .btn:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }
        .default-message {
            text-align: center;
            padding: 2rem 1rem;
            color: #9ca3af;
            font-style: italic;
            font-size: 0.9rem;
        }
        .teaching-section {
            max-width: 1200px;
        }
        .activity-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        .activity-btn {
            flex: 1;
            min-width: 200px;
            padding: 1.25rem;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        .activity-btn:hover {
            border-color: #0066ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 102, 255, 0.15);
        }
        .activity-btn.active {
            background: #0066ff;
            border-color: #0066ff;
            color: white;
        }
        .activity-icon {
            font-size: 2rem;
            display: block;
            margin-bottom: 0.5rem;
        }
        .activity-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        .activity-desc {
            font-size: 0.8125rem;
            opacity: 0.8;
        }
        .activity-btn.active .activity-desc {
            opacity: 0.95;
        }
        .activity-content {
            display: none;
        }
        .activity-content.active {
            display: block;
        }
        .tps-card {
            background: white;
            border-radius: 12px;
            border: 2px solid #10b981;
            padding: 2rem;
            margin-bottom: 1.5rem;
        }
        .tps-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e5e7eb;
        }
        .tps-number {
            width: 50px;
            height: 50px;
            background: #10b981;
            color: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        .tps-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
        }
        .tps-phases {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .tps-phase {
            background: #f0fdf4;
            padding: 1.25rem;
            border-radius: 8px;
            border: 1px solid #bbf7d0;
        }
        .tps-phase.hidden {
            background: #f3f4f6;
            border: 1px solid #e5e7eb;
            opacity: 0.6;
        }
        .tps-phase.hidden .phase-content {
            display: none;
        }
        .tps-phase.revealed {
            animation: revealPhase 0.3s ease;
        }
        @keyframes revealPhase {
            from {
                opacity: 0.6;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .reveal-phase-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 0.5rem 1.25rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 0.75rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .reveal-phase-btn:hover {
            background: #059669;
            transform: translateY(-1px);
        }
        .reveal-phase-btn.revealed {
            background: #6b7280;
            cursor: default;
        }
        .reveal-phase-btn.revealed:hover {
            transform: none;
            background: #6b7280;
        }
        .tps-phase-controls {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e5e7eb;
        }
        .phase-icon {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }
        .phase-title {
            font-size: 0.875rem;
            font-weight: 700;
            color: #10b981;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }
        .phase-content {
            font-size: 0.9375rem;
            line-height: 1.6;
            color: #1f2937;
        }
        .tps-latin {
            background: #f9fafb;
            padding: 1.25rem;
            border-radius: 8px;
            font-family: 'Georgia', serif;
            font-size: 1.125rem;
            line-height: 1.8;
            color: #1f2937;
            margin-bottom: 1rem;
            border-left: 4px solid #10b981;
        }
        .translation-game-card {
            background: white;
            border-radius: 12px;
            border: 2px solid #6366f1;
            padding: 2rem;
            margin-bottom: 1.5rem;
        }
        .game-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid #e5e7eb;
        }
        .game-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #6366f1;
            margin-bottom: 0.5rem;
        }
        .game-instructions {
            font-size: 1rem;
            color: #4b5563;
        }
        .game-progress {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }
        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e5e7eb;
            transition: all 0.3s ease;
        }
        .progress-dot.completed {
            background: #10b981;
        }
        .progress-dot.current {
            background: #6366f1;
            transform: scale(1.3);
        }
        .game-latin-display {
            background: #f9fafb;
            padding: 1.5rem;
            border-radius: 8px;
            font-family: 'Georgia', serif;
            font-size: 1.25rem;
            line-height: 1.8;
            color: #1f2937;
            text-align: center;
            margin-bottom: 2rem;
            border: 2px solid #6366f1;
        }
        .translation-options {
            display: grid;
            gap: 1rem;
        }
        .translation-option {
            padding: 1.25rem;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
            line-height: 1.6;
            text-align: left;
        }
        .translation-option:hover {
            border-color: #6366f1;
            background: #f5f3ff;
        }
        .translation-option.selected {
            border-color: #6366f1;
            background: #eef2ff;
        }
        .translation-option.correct {
            border-color: #10b981;
            background: #f0fdf4;
            animation: correctPulse 0.5s ease;
        }
        .translation-option.incorrect {
            border-color: #ef4444;
            background: #fef2f2;
            animation: incorrectShake 0.5s ease;
        }
        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        .game-feedback {
            margin-top: 1.5rem;
            padding: 1.25rem;
            border-radius: 8px;
            font-size: 0.9375rem;
            line-height: 1.6;
            display: none;
        }
        .game-feedback.show {
            display: block;
        }
        .game-feedback.correct {
            background: #f0fdf4;
            border: 2px solid #10b981;
            color: #065f46;
        }
        .game-feedback.incorrect {
            background: #fef2f2;
            border: 2px solid #ef4444;
            color: #991b1b;
        }
        .game-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }
        .game-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 0.9375rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .game-btn.primary {
            background: #6366f1;
            color: white;
        }
        .game-btn.primary:hover {
            background: #4f46e5;
        }
        .game-btn.primary:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
        }
        .game-btn.secondary {
            background: white;
            color: #4b5563;
            border: 2px solid #e5e7eb;
        }
        .game-btn.secondary:hover {
            border-color: #6366f1;
            color: #6366f1;
        }
        .visual-grammar-card {
            background: white;
            border-radius: 12px;
            border: 2px solid #f59e0b;
            padding: 2rem;
            margin-bottom: 1.5rem;
        }
        .visual-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .visual-icon {
            width: 50px;
            height: 50px;
            background: #f59e0b;
            color: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
        }
        .visual-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
        }
        .visual-latin {
            font-family: 'Georgia', serif;
            font-size: 1.5rem;
            line-height: 2.5;
            color: #1f2937;
            text-align: center;
            padding: 2rem;
            background: #fffbeb;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            position: relative;
        }
        .grammar-word {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            margin: 0 0.25rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        .grammar-word:hover {
            transform: translateY(-2px);
        }
        .grammar-word.subject {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid #ef4444;
        }
        .grammar-word.verb {
            background: rgba(59, 130, 246, 0.2);
            border: 2px solid #3b82f6;
        }
        .grammar-word.object {
            background: rgba(16, 185, 129, 0.2);
            border: 2px solid #10b981;
        }
        .grammar-word.adjective {
            background: rgba(245, 158, 11, 0.2);
            border: 2px solid #f59e0b;
        }
        .grammar-word.adverb {
            background: rgba(139, 92, 246, 0.2);
            border: 2px solid #8b5cf6;
        }
        .grammar-word.prep-phrase {
            background: rgba(236, 72, 153, 0.2);
            border: 2px solid #ec4899;
        }
        .grammar-arrow {
            position: absolute;
            pointer-events: none;
            z-index: 10;
        }
        .grammar-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            padding: 1.5rem;
            background: #f9fafb;
            border-radius: 8px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }
        .legend-color {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: 2px solid currentColor;
        }
        .legend-item.subject .legend-color { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .legend-item.verb .legend-color { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .legend-item.object .legend-color { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .legend-item.adjective .legend-color { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .legend-item.adverb .legend-color { background: rgba(139, 92, 246, 0.2); color: #8b5cf6; }
        .legend-item.prep-phrase .legend-color { background: rgba(236, 72, 153, 0.2); color: #ec4899; }
        .visual-nav-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e5e7eb;
            display: inline-block;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .visual-nav-dot.active {
            background: #f59e0b;
            transform: scale(1.4);
        }
        .visual-nav-dot:hover {
            background: #fbbf24;
        }
        .tps-nav-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e5e7eb;
            display: inline-block;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .tps-nav-dot.active {
            background: #10b981;
            transform: scale(1.4);
        }
        .tps-nav-dot:hover {
            background: #34d399;
        }
        @media (max-width: 1024px) {
            .lesson-layout {
                grid-template-columns: 1fr;
            }
            .recap-content {
                grid-template-columns: 1fr;
            }
            .tps-phases {
                grid-template-columns: 1fr;
            }
        }
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
            }
            .criteria-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="logo-section">
            <a href="../../index.html" class="logo">
                <div class="logo-icon">C</div>
                <span class="logo-text">Classicalia</span>
            </a>
        </div>
        <nav class="nav-section">
            <div class="nav-title">Resources</div>
            <div class="nav-item active" onclick="showView('recap')">
                <span class="nav-icon">üìñ</span>
                <span>Story So Far</span>
            </div>
            <div class="nav-item" onclick="showView('objectives')">
                <span class="nav-icon">üéØ</span>
                <span>Learning Intentions</span>
            </div>
            <div class="nav-item" onclick="showView('text')">
                <span class="nav-icon">üìú</span>
                <span>Read</span>
            </div>
            <div class="nav-item" onclick="showView('teaching')">
                <span class="nav-icon">üë•</span>
                <span>Teaching Activities</span>
            </div>
            <div class="nav-item" onclick="showView('exam')">
                <span class="nav-icon">‚úçÔ∏è</span>
                <span>Exam Questions</span>
            </div>
        </nav>
    </aside>
    <main class="main-content">
        <div class="top-bar"></div>
        <div class="content-wrapper">
            <div class="content-container">
                <header class="lesson-header">
                    <h1 class="lesson-title">(4) Lines 36-50: The miracle revealed & divine judgement</h1>
                    <div class="lesson-meta">
                        <span>üìï Ovid Metamorphoses 8.36-50</span>
                        <span>‚è±Ô∏è 60 min</span>
                        <span>üìä GCSE</span>
                    </div>
                </header>
                
                <!-- Story Recap Section -->
                <div class="story-recap" id="recapSection">
                    <div class="recap-header">
                        <div class="recap-icon">üìö</div>
                        <div class="recap-title-section">
                            <h2>The Story So Far</h2>
                            <div class="recap-subtitle">Section 3: Lines 26-35 Summary</div>
                        </div>
                    </div>
                    <div class="recap-content">
                        <div class="recap-moment">
                            <span class="moment-icon">üí¨</span>
                            <div class="moment-title">Passing Time</div>
                            <div class="moment-description">Baucis and Philemon entertain their mysterious guests with conversation, making time pass imperceptibly as good hospitality should.</div>
                        </div>
                        <div class="recap-moment">
                            <span class="moment-icon">üõÅ</span>
                            <div class="moment-title">Humble Preparations</div>
                            <div class="moment-description">A beech-wood tub is prepared with warm water for foot-washing. Every detail emphasises poverty: hard nail, willow wood, soft sedge mattress.</div>
                        </div>
                        <div class="recap-moment">
                            <span class="moment-icon">‚ú®</span>
                            <div class="moment-title">Their Best Cloth</div>
                            <div class="moment-description">The couple spreads out their festival cloth‚Äîcheap and old, but the finest they have. It's 'not unworthy' of the willow couch. Then: the gods reclined.</div>
                        </div>
                    </div>
                </div>
                
                <div class="learning-objectives" id="objectivesSection" style="display: none;">
                    <div class="learning-intention">
                        <h2 class="objective-heading">Learning Intention</h2>
                        <p class="intention-text">Understand how Ovid creates dramatic tension through the miracle of the wine, the couple's response, and the gods' revelation of divine judgement</p>
                    </div>
                    <div class="success-criteria">
                        <h2 class="objective-heading">Success Criteria</h2>
                        <div class="criteria-grid">
                            <div class="criterion">
                                <div class="criterion-number">1</div>
                                <div class="criterion-content">
                                    <h3>Translation</h3>
                                    <p>I can translate both sections (4a: lines 36-42, 4b: lines 43-50) with support from vocabulary and grammar notes</p>
                                </div>
                            </div>
                            <div class="criterion">
                                <div class="criterion-number">2</div>
                                <div class="criterion-content">
                                    <h3>Content Understanding</h3>
                                    <p>I can explain the sequence of events: miracle ‚Üí fear ‚Üí goose chase ‚Üí divine revelation ‚Üí warning of punishment</p>
                                </div>
                            </div>
                            <div class="criterion">
                                <div class="criterion-number">3</div>
                                <div class="criterion-content">
                                    <h3>Stylistic Analysis</h3>
                                    <p>I can identify and explain literary devices (vivid description, direct speech, dramatic irony, pathos)</p>
                                </div>
                            </div>
                            <div class="criterion">
                                <div class="criterion-number">4</div>
                                <div class="criterion-content">
                                    <h3>Exam Application</h3>
                                    <p>I can apply my knowledge to answer exam-style questions on both narrative development and stylistic technique</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Exam Questions Section -->
                <div class="exam-question-section" id="examSection" style="display: none;">
                    <div class="exam-question-card" style="margin-bottom: 2rem;">
                        <div class="exam-header">
                            <h2 class="exam-title">Exam-Style Question 1 [4 marks]</h2>
                            <div class="exam-meta">Section 4a: Lines 36-42</div>
                        </div>
                        
                        <div class="question-box">
                            <p class="question-text">How does Ovid, by his style of writing, emphasise the couple's amazement and fear at witnessing the wine miracle? You should make <strong>two points</strong> and <strong>refer to the Latin</strong> in your answer. <strong>[4]</strong></p>
                        </div>
                        
                        <div class="latin-extract">
                            <h3>Lines 37-40</h3>
                            <div class="extract-text">
                                <p>sponte sua per seque vident succrescere vina;</p>
                                <p>attoniti novitate pavent manibusque supinis</p>
                                <p>concipiunt Baucisque preces timidusque Philemon</p>
                                <p>et veniam dapibus nullisque paratibus orant.</p>
                            </div>
                        </div>
                        
                        <div class="exam-guidance">
                            <h3>Remember to:</h3>
                            <ul>
                                <li>Make <strong>two</strong> separate points about style</li>
                                <li>Quote or refer to the <strong>Latin text</strong> for each point</li>
                                <li>Explain the <strong>effect</strong> of each stylistic choice</li>
                                <li>Focus on <strong>how</strong> Ovid emphasises amazement and fear</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="exam-question-card">
                        <div class="exam-header">
                            <h2 class="exam-title">Exam-Style Question 2 [4 marks]</h2>
                            <div class="exam-meta">Section 4b: Lines 43-50</div>
                        </div>
                        
                        <div class="question-box">
                            <p class="question-text">How does Ovid create dramatic effect through the goose chase and the gods' revelation? You should make <strong>two points</strong> and <strong>refer to the Latin</strong> in your answer. <strong>[4]</strong></p>
                        </div>
                        
                        <div class="latin-extract">
                            <h3>Lines 44-47</h3>
                            <div class="extract-text">
                                <p>ille celer penna tardos aetate fatigat</p>
                                <p>eluditque diu tandemque est visus ad ipsos</p>
                                <p>confugisse deos. superi vetuere necari</p>
                                <p>'di'que 'sumus, meritasque luet vicinia poenas</p>
                            </div>
                        </div>
                        
                        <div class="exam-guidance">
                            <h3>Remember to:</h3>
                            <ul>
                                <li>Make <strong>two</strong> separate points about dramatic effect</li>
                                <li>Quote or refer to the <strong>Latin text</strong> for each point</li>
                                <li>Explain <strong>how</strong> Ovid creates drama</li>
                                <li>Consider both the goose chase <strong>and</strong> the revelation</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Teaching Activities Section -->
                <div class="teaching-section" id="teachingSection" style="display: none;">
                    <div style="background: white; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; border: 2px solid #e5e7eb;">
                        <h3 style="font-size: 1.125rem; font-weight: 600; color: #1f2937; margin-bottom: 1rem;">Select Section:</h3>
                        <div style="display: flex; gap: 1rem;">
                            <button class="section-btn active" onclick="filterTeachingSection('4a')" id="teaching4aBtn">
                                Section 4a (Lines 36-42)<br>
                                <span style="font-size: 0.8125rem; opacity: 0.8;">The wine miracle & the goose</span>
                            </button>
                            <button class="section-btn" onclick="filterTeachingSection('4b')" id="teaching4bBtn">
                                Section 4b (Lines 43-50)<br>
                                <span style="font-size: 0.8125rem; opacity: 0.8;">The chase & divine revelation</span>
                            </button>
                            <button class="section-btn" onclick="filterTeachingSection('all')" id="teachingAllBtn">
                                All Activities<br>
                                <span style="font-size: 0.8125rem; opacity: 0.8;">Show everything</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="activity-selector">
                        <div class="activity-btn active" onclick="switchActivity('tps')">
                            <span class="activity-icon">üí¨</span>
                            <div class="activity-title">Think-Pair-Share</div>
                            <div class="activity-desc">Discussion prompts for key lines</div>
                        </div>
                        <div class="activity-btn" onclick="switchActivity('translation')">
                            <span class="activity-icon">üéØ</span>
                            <div class="activity-title">Translation Challenge</div>
                            <div class="activity-desc">Choose the best translation</div>
                        </div>
                        <div class="activity-btn" onclick="switchActivity('visual')">
                            <span class="activity-icon">üîç</span>
                            <div class="activity-title">Visual Grammar</div>
                            <div class="activity-desc">See sentence structure</div>
                        </div>
                    </div>
                    
                    <!-- Think-Pair-Share Activity -->
                    <div id="tpsActivity" class="activity-content active">
                        <div class="tps-card">
                            <div class="tps-header">
                                <div class="tps-number" id="tpsNumber">1</div>
                                <div>
                                    <div class="tps-title" id="tpsTitle">Think-Pair-Share Activities</div>
                                    <div style="font-size: 0.875rem; color: #6b7280; margin-top: 0.25rem;">
                                        <span id="tpsCounter">1 of 12</span> - Click arrows to navigate
                                    </div>
                                </div>
                            </div>
                            <div class="tps-latin" id="tpsLatin"></div>
                            <div class="tps-phases" id="tpsPhases"></div>
                            
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 2rem;">
                                <button class="game-btn secondary" onclick="prevTPS()" id="prevTPSBtn">
                                    ‚Üê Previous
                                </button>
                                <div style="display: flex; gap: 0.5rem;">
                                    <span class="tps-nav-dot" data-index="0"></span>
                                    <span class="tps-nav-dot" data-index="1"></span>
                                    <span class="tps-nav-dot" data-index="2"></span>
                                    <span class="tps-nav-dot" data-index="3"></span>
                                    <span class="tps-nav-dot" data-index="4"></span>
                                    <span class="tps-nav-dot" data-index="5"></span>
                                    <span class="tps-nav-dot" data-index="6"></span>
                                    <span class="tps-nav-dot" data-index="7"></span>
                                    <span class="tps-nav-dot" data-index="8"></span>
                                    <span class="tps-nav-dot" data-index="9"></span>
                                    <span class="tps-nav-dot" data-index="10"></span>
                                    <span class="tps-nav-dot" data-index="11"></span>
                                </div>
                                <button class="game-btn primary" onclick="nextTPS()" id="nextTPSBtn">
                                    Next ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Translation Challenge Activity -->
                    <div id="translationActivity" class="activity-content">
                        <div class="translation-game-card">
                            <div class="game-header">
                                <h2 class="game-title">Translation Challenge</h2>
                                <p class="game-instructions">Choose the most accurate translation for each Latin phrase</p>
                            </div>
                            
                            <div class="game-progress" id="gameProgress"></div>
                            
                            <div class="game-latin-display" id="latinDisplay"></div>
                            
                            <div class="translation-options" id="translationOptions"></div>
                            
                            <div class="game-feedback" id="gameFeedback"></div>
                            
                            <div class="game-controls">
                                <button class="game-btn secondary" onclick="resetGame()">Start Over</button>
                                <button class="game-btn primary" id="nextBtn" onclick="nextQuestion()" disabled>Next Question</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Visual Grammar Activity -->
                    <div id="visualActivity" class="activity-content">
                        <div class="visual-grammar-card">
                            <div class="visual-header">
                                <div class="visual-icon">üîç</div>
                                <div>
                                    <div class="visual-title" id="visualTitle">Visual Grammar Examples</div>
                                    <div style="font-size: 0.875rem; color: #6b7280; margin-top: 0.25rem;">
                                        <span id="visualCounter">1 of 10</span> - Click arrows to navigate
                                    </div>
                                </div>
                            </div>
                            
                            <div id="visualContent"></div>
                            
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 2rem;">
                                <button class="game-btn secondary" onclick="prevVisual()" id="prevVisualBtn">
                                    ‚Üê Previous
                                </button>
                                <div style="display: flex; gap: 0.5rem;">
                                    <span class="visual-nav-dot" data-index="0"></span>
                                    <span class="visual-nav-dot" data-index="1"></span>
                                    <span class="visual-nav-dot" data-index="2"></span>
                                    <span class="visual-nav-dot" data-index="3"></span>
                                    <span class="visual-nav-dot" data-index="4"></span>
                                    <span class="visual-nav-dot" data-index="5"></span>
                                    <span class="visual-nav-dot" data-index="6"></span>
                                    <span class="visual-nav-dot" data-index="7"></span>
                                    <span class="visual-nav-dot" data-index="8"></span>
                                    <span class="visual-nav-dot" data-index="9"></span>
                                </div>
                                <button class="game-btn primary" onclick="nextVisual()" id="nextVisualBtn">
                                    Next ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Text Reading Section -->
                <div class="lesson-layout" id="textSection" style="display: none;">
                    <div class="card" id="textCard">
                        <div class="card-header">
                            <h3 class="card-title">Latin Text</h3>
                            <div class="tabs">
                                <button class="tab active" onclick="setMode('grammar')">Grammar</button>
                                <button class="tab" onclick="setMode('style')">Style</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="section-selector">
                                <button class="section-btn active" onclick="switchSection('4a')">Section 4a (Lines 36-42)</button>
                                <button class="section-btn" onclick="switchSection('4b')">Section 4b (Lines 43-50)</button>
                            </div>
                            
                            <div id="section4a" class="section-content active">
                                <div class="latin-text" id="latinText4a"></div>
                            </div>
                            
                            <div id="section4b" class="section-content">
                                <div class="latin-text" id="latinText4b"></div>
                            </div>
                            
                            <div class="btn-group">
                                <button class="btn" onclick="toggleFullTranslation()">Show Translation</button>
                                <button class="btn" onclick="resetView()">Reset View</button>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title" id="panelTitle">Analysis</h3>
                            </div>
                            <div class="card-body" id="analysisPanel">
                                <div class="default-message" id="defaultMessage">
                                    Click any coloured phrase to see vocabulary and grammar
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script>
const lessonData = {
    section4a: {
        fullTranslation: "Meanwhile they see the wine, drained so many times, grow back of its own accord and by itself; amazed at the strangeness they are afraid and with upturned hands Baucis and timid Philemon utter prayers and beg pardon for their meagre meal and their lack of preparations. There was one goose, guardian of their tiny farm, which the hosts were preparing to sacrifice for their divine guests;",
        latinText: `<span class="line"><span class="line-number">36</span><span class="phrase phrase-1" onclick="showAnalysis('phrase1')"><span class="highlight-style style-1" onclick="showAnalysis('style1'); event.stopPropagation()">interea</span> <span class="highlight-style style-2" onclick="showAnalysis('style2'); event.stopPropagation()">totiens haustum</span> cratera <span class="highlight-style style-3" onclick="showAnalysis('style3'); event.stopPropagation()">repleri</span></span></span>
<span class="line"><span class="line-number">37</span><span class="phrase phrase-2" onclick="showAnalysis('phrase2')"><span class="highlight-style style-4" onclick="showAnalysis('style4'); event.stopPropagation()">sponte sua per seque</span> vident <span class="highlight-style style-5" onclick="showAnalysis('style5'); event.stopPropagation()">succrescere</span> vina</span>;</span>
<span class="line"><span class="line-number">38</span><span class="phrase phrase-3" onclick="showAnalysis('phrase3')"><span class="highlight-style style-6" onclick="showAnalysis('style6'); event.stopPropagation()">attoniti</span> <span class="highlight-style style-7" onclick="showAnalysis('style7'); event.stopPropagation()">novitate</span> <span class="highlight-style style-8" onclick="showAnalysis('style8'); event.stopPropagation()">pavent</span></span> <span class="phrase phrase-4" onclick="showAnalysis('phrase4')"><span class="highlight-style style-9" onclick="showAnalysis('style9'); event.stopPropagation()">manibusque supinis</span></span></span>
<span class="line"><span class="line-number">39</span><span class="phrase phrase-5" onclick="showAnalysis('phrase5')"><span class="highlight-style style-10" onclick="showAnalysis('style10'); event.stopPropagation()">concipiunt</span> <span class="highlight-style style-11" onclick="showAnalysis('style11'); event.stopPropagation()">Baucisque preces timidusque Philemon</span></span></span>
<span class="line"><span class="line-number">40</span><span class="phrase phrase-6" onclick="showAnalysis('phrase6')">et <span class="highlight-style style-12" onclick="showAnalysis('style12'); event.stopPropagation()">veniam</span> <span class="highlight-style style-13" onclick="showAnalysis('style13'); event.stopPropagation()">dapibus nullisque paratibus</span> orant</span>.</span>
<span class="line"><span class="line-number">41</span><span class="phrase phrase-7" onclick="showAnalysis('phrase7')"><span class="highlight-style style-14" onclick="showAnalysis('style14'); event.stopPropagation()">unicus</span> anser erat, <span class="highlight-style style-15" onclick="showAnalysis('style15'); event.stopPropagation()">minimae custodia villae</span></span>,</span>
<span class="line"><span class="line-number">42</span><span class="phrase phrase-8" onclick="showAnalysis('phrase8')">quem <span class="highlight-style style-16" onclick="showAnalysis('style16'); event.stopPropagation()">dis hospitibus</span> <span class="highlight-style style-17" onclick="showAnalysis('style17'); event.stopPropagation()">domini</span> <span class="highlight-style style-18" onclick="showAnalysis('style18'); event.stopPropagation()">mactare</span> parabant</span>;</span>`,
        grammar: {
            phrase1: {
                title: "interea totiens haustum cratera repleri (36)",
                vocab: [
                    "<strong>interea</strong> = meanwhile (adv.)",
                    "<strong>totiens</strong> = so many times (adv.)",
                    "<strong>haustum</strong> = drained, emptied (acc. sing. masc. perf. pass. part.)",
                    "<strong>cratera</strong> = mixing bowl (acc. sing. masc.)",
                    "<strong>repleri</strong> = to be refilled (pres. pass. inf.)"
                ],
                grammar: "Accusative + infinitive construction after 'vident' (they see). Haustum is perfect passive participle agreeing with cratera. Totiens emphasises repeated miracle - every time drained, it refills. Historic infinitive creates vivid present-tense effect.",
                translation: "meanwhile (they see) the mixing bowl, drained so many times, to be refilled"
            },
            phrase2: {
                title: "sponte sua per seque vident succrescere vina (37)",
                vocab: [
                    "<strong>sponte sua</strong> = of its own accord (abl.)",
                    "<strong>per se</strong> = by itself",
                    "<strong>-que</strong> = and",
                    "<strong>vident</strong> = they see (3rd pl. pres.)",
                    "<strong>succrescere</strong> = to grow back, grow up (pres. inf.)",
                    "<strong>vina</strong> = wines (acc. pl. neut.)"
                ],
                grammar: "Main verb 'vident' with accusative-infinitive. Sponte sua (ablative) + per se emphasise supernatural self-action. Succrescere (sub + crescere) means grow back/up from below. Vina plural poetic for wine. Dramatic enjambment places vident at line start.",
                translation: "of its own accord and by itself they see the wines grow back"
            },
            phrase3: {
                title: "attoniti novitate pavent (38)",
                vocab: [
                    "<strong>attoniti</strong> = thunderstruck, amazed (nom. pl. masc. perf. pass. part.)",
                    "<strong>novitate</strong> = at/by the strangeness (abl. sing. fem.)",
                    "<strong>pavent</strong> = they are afraid, tremble (3rd pl. pres.)"
                ],
                grammar: "Attoniti (literally 'thunderstruck', from ad + tonare) is perfect participle used as adjective describing Baucis and Philemon. Ablative of cause: novitate (because of strangeness). Pavent historic present shows vivid fear. Religious terror at divine miracle.",
                translation: "thunderstruck by the strangeness they are afraid"
            },
            phrase4: {
                title: "manibusque supinis (38)",
                vocab: [
                    "<strong>manibus</strong> = with hands (abl. pl. fem.)",
                    "<strong>-que</strong> = and",
                    "<strong>supinis</strong> = upturned, face-up (abl. pl. fem.)"
                ],
                grammar: "Ablative of manner/description. Manus supinae = upturned hands, classic gesture of prayer to gods above. Physical detail shows immediate religious response to miracle. -que connects to previous action smoothly.",
                translation: "and with upturned hands"
            },
            phrase5: {
                title: "concipiunt Baucisque preces timidusque Philemon (39)",
                vocab: [
                    "<strong>concipiunt</strong> = they utter, form (3rd pl. pres.)",
                    "<strong>Baucis</strong> = Baucis (nom. sing. fem.)",
                    "<strong>-que</strong> = and",
                    "<strong>preces</strong> = prayers (acc. pl. fem.)",
                    "<strong>timidus</strong> = timid, fearful (nom. sing. masc.)",
                    "<strong>-que</strong> = and",
                    "<strong>Philemon</strong> = Philemon (nom. sing. masc.)"
                ],
                grammar: "Historic present. Concipiunt preces = utter/form prayers (conceive words). Names appear with -que linking: Baucis...que...timidusque Philemon. Timidus emphasises their fear. Enclosed word order puts preces centrally between the couple's names.",
                translation: "both Baucis and timid Philemon utter prayers"
            },
            phrase6: {
                title: "et veniam dapibus nullisque paratibus orant (40)",
                vocab: [
                    "<strong>et</strong> = and",
                    "<strong>veniam</strong> = pardon, forgiveness (acc. sing. fem.)",
                    "<strong>dapibus</strong> = for the meal (dat/abl. pl. fem.)",
                    "<strong>nullis</strong> = no, lacking (abl. pl. neut.)",
                    "<strong>-que</strong> = and",
                    "<strong>paratibus</strong> = for preparations (abl. pl. neut.)",
                    "<strong>orant</strong> = they beg, pray (3rd pl. pres.)"
                ],
                grammar: "Continues prayer. Oro takes accusative (veniam) + dative/ablative of thing for which pardon sought. Dapibus = for their meagre feast. Nullisque paratibus = for their lack of preparations. Pathos - they apologise for trying their best.",
                translation: "and they beg pardon for their meal and lacking preparations"
            },
            phrase7: {
                title: "unicus anser erat, minimae custodia villae (41)",
                vocab: [
                    "<strong>unicus</strong> = only, sole (nom. sing. masc.)",
                    "<strong>anser</strong> = goose (nom. sing. masc.)",
                    "<strong>erat</strong> = was, there was (3rd sing. imperf.)",
                    "<strong>minimae</strong> = of the tiny (gen. sing. fem.)",
                    "<strong>custodia</strong> = guardian, protection (nom. sing. fem.)",
                    "<strong>villae</strong> = of the farm (gen. sing. fem.)"
                ],
                grammar: "Imperfect of sum introduces new element. Unicus emphasises singularity - only one goose (ultimate sacrifice). Custodia in apposition to anser. Minimae villae (genitive) shows farm's tiny size. Structure parallels earlier 'alveus erat' descriptions of poverty.",
                translation: "there was one goose, guardian of the tiny farm"
            },
            phrase8: {
                title: "quem dis hospitibus domini mactare parabant (42)",
                vocab: [
                    "<strong>quem</strong> = which (acc. sing. masc.)",
                    "<strong>dis</strong> = for the gods (dat. pl. masc.)",
                    "<strong>hospitibus</strong> = as guests (dat. pl. masc.)",
                    "<strong>domini</strong> = the masters (nom. pl. masc.)",
                    "<strong>mactare</strong> = to sacrifice, slaughter (pres. inf.)",
                    "<strong>parabant</strong> = they were preparing (3rd pl. imperf.)"
                ],
                grammar: "Relative clause. Quem refers to anser. Dis hospitibus dative with mactare (sacrifice for the divine guests). Domini subject = masters/hosts. Parabant with complementary infinitive shows incomplete action. Dramatic irony - they still don't know guests ARE gods.",
                translation: "which the hosts were preparing to sacrifice for their divine guests"
            }
        },
        style: {
            style1: {
                title: "interea (36)",
                device: "Temporal Transition",
                effect: "Creates continuity with previous scene. 'Meanwhile' suggests simultaneous divine activity whilst mortals serve. Builds narrative momentum towards revelation moment."
            },
            style2: {
                title: "totiens haustum (36)",
                device: "Adverbial Emphasis + Emphatic Vocabulary",
                effect: "'So many times drained' - totiens stresses how freely the gods have been drinking, showing their divine appetite. Haustum (drained/emptied) contrasts dramatically with repleri (refilled) - the miracle lies in this impossible reversal. Each complete emptying followed by supernatural refilling."
            },
            style3: {
                title: "repleri / cratera (36)",
                device: "Rustic Imagery + Chiasmus",
                effect: "Cratera (mixing bowl) is humble, rustic vocabulary matching the poverty of the setting - not precious golden vessels but simple pottery. Notice chiasmus across lines 36-37: object-verb / verb-object (cratera repleri / succrescere vina). This balanced structure perhaps reflects the completion and perfection of the miracle - grammatical balance mirrors supernatural balance."
            },
            style4: {
                title: "sponte sua per seque (37)",
                device: "Juxtaposition + Emphatic Repetition",
                effect: "The two phrases placed directly side by side creates juxtaposition that doubles down on the self-action: 'of its own accord AND by itself'. Sponte sua + per se aren't just redundant - they're emphatic, insistent. Ovid won't let us miss the impossibility: no one is doing this, it's happening spontaneously."
            },
            style5: {
                title: "succrescere / line 37 sibilance (37)",
                device: "Sound Effects: Sibilance + Alliteration",
                effect: "Line 37 is full of 's' sounds: 'sponte sua per seque...succrescere' - sibilance creates magical, bubbling sound, as if we can hear the wine rising in the bowl. The prefix sub- (from below) + crescere intensifies this auditory effect. Additionally, 'vident...vina' creates v-alliteration drawing attention to what they see - the visual miracle emphasised through sound."
            },
            style6: {
                title: "attoniti (38)",
                device: "Emotive Participle + Alliteration",
                effect: "Literally 'thunderstruck' (ad + tonare = struck by thunder). Religious terminology - experiencing numinous terror. The t-alliteration in 'attoniti...novitate' perhaps mimics the stuttering shock of witnessing the impossible. Perfect participle shows completed state of shock. Romans recognised divine presence through fear and awe."
            },
            style7: {
                title: "novitate (38)",
                device: "Ablative of Cause",
                effect: "'Because of/by the strangeness' - novitas = unprecedented, strange phenomenon. Novus (new/strange) emphasises total unfamiliarity. They've never witnessed anything like this - completely outside normal experience."
            },
            style8: {
                title: "pavent (38)",
                device: "Vivid Present Tense",
                effect: "Historic present creates immediacy. Pavere = tremble with fear, religious awe. Strong verb showing physical and spiritual trembling. Fear appropriate response to divine manifestation."
            },
            style9: {
                title: "manibusque supinis (38)",
                device: "Visual Gesture Detail + Religious Recognition",
                effect: "Manus supinae = hands turned upward, the classic Roman prayer gesture acknowledging gods above. This visual detail shows immediate recognition that they're in the presence of the divine - the physical gesture confirms their spiritual understanding. Hands literally reach toward heaven."
            },
            style10: {
                title: "concipiunt (39)",
                device: "Metaphorical Verb",
                effect: "Literally 'conceive' prayers - form/give birth to words. More emotional than simple 'dicunt'. Preces must be formed/created in moment of panic and awe."
            },
            style11: {
                title: "Baucisque preces timidusque Philemon (39)",
                device: "Enclosing Word Order + -que...-que",
                effect: "Names enclose 'preces' (prayers): Baucis-prayers-Philemon. The couple come together to address the gods, their unity reflected in the very shape of the line. Double -que links them in joint supplication. Timidus (timid/fearful) before Philemon emphasises the elderly man's fear despite being male householder - even he is terrified."
            },
            style12: {
                title: "veniam...orant (40)",
                device: "Line-Framing Structure",
                effect: "Veniam (pardon) at the start and orant (they beg) at the end frame the entire line, creating emphasis on their apology. The structure wraps around what they're apologising for (dapibus nullisque paratibus), making the plea itself structurally prominent. Everything leads to and from their desperate request for forgiveness."
            },
            style13: {
                title: "dapibus nullisque paratibus (40)",
                device: "Sound Pattern (Rhyme) + Double Ablative",
                effect: "The rhyming endings '-ibus...-ibus' create a sound pattern that links the two sources of shame: their meagre food AND their lack of preparations. The rhyme makes the line feel considered, deliberate - as if they're carefully listing their inadequacies. The matching sounds emphasise that both failings weigh equally on their conscience."
            },
            style14: {
                title: "unicus (41)",
                device: "Emphatic Position + Advanced Placement",
                effect: "'Only one' - positioned emphatically at the start of the line (advanced before the noun), immediately signalling poverty. Not one of many geese - their single goose, total livestock. Ultimate sacrifice - guardian AND final possession. Line-initial position makes the isolation stark before we even know what's singular."
            },
            style15: {
                title: "minimae custodia villae (41)",
                device: "Genitive Description + Ironic Diction",
                effect: "Minima villa = tiniest farm. Custodia (guardian) creates potential irony - what grand thing could possibly need 'guarding' at such a tiny holding? Yet the term also shows affection and importance: even in poverty, this goose matters. The formal vocabulary (custodia) applied to humble circumstances creates pathos."
            },
            style16: {
                title: "dis hospitibus (42)",
                device: "Dramatic Irony + Juxtaposition",
                effect: "'For divine guests' - dative with mactare creates juxtaposition: they want to sacrifice the goose FOR gods, not yet realising their guests ARE the gods. The two words placed together (dis hospitibus) contain the whole dramatic irony: divine guests who will soon reveal their divinity and prevent this very sacrifice."
            },
            style17: {
                title: "domini (42)",
                device: "Ironic Title",
                effect: "Domini (masters/lords of the house) could be read ironically - Baucis and Philemon are barely managing subsistence but are called 'lords' of their tiny villa. Yet the term also dignifies them: they are masters of hospitality even in poverty."
            },
            style18: {
                title: "mactare (42)",
                device: "Technical Sacrifice Vocabulary",
                effect: "Mactare = proper religious term for animal sacrifice, not just 'kill' - ritual slaughter for gods. Shows they know correct religious protocols despite poverty. They understand proper procedures for honouring divine visitors."
            }
        }
    },
    section4b: {
        fullTranslation: "swift with his wings he wearies the elderly couple and evades them for a long time, and at last he seemed to have fled for refuge to the gods themselves. The gods forbade him to be killed and said 'we are gods, and this wicked neighbourhood will pay deserved punishment; but to you it will be granted to be immune from this evil. Just leave your home and accompany our steps and go together to the mountain heights.'",
        latinText: `<span class="line"><span class="line-number">43</span><span class="phrase phrase-9" onclick="showAnalysis('phrase9')">ille <span class="highlight-style style-19" onclick="showAnalysis('style19'); event.stopPropagation()">celer penna</span> <span class="highlight-style style-19" onclick="showAnalysis('style19'); event.stopPropagation()">tardos aetate</span> fatigat</span></span>
<span class="line"><span class="line-number">44</span><span class="phrase phrase-10" onclick="showAnalysis('phrase10')"><span class="highlight-style style-20" onclick="showAnalysis('style20'); event.stopPropagation()">eluditque diu</span> <span class="highlight-style style-20" onclick="showAnalysis('style20'); event.stopPropagation()">tandemque</span> est visus <span class="highlight-style style-21" onclick="showAnalysis('style21'); event.stopPropagation()">ad ipsos</span></span></span>
<span class="line"><span class="line-number">45</span><span class="phrase phrase-11" onclick="showAnalysis('phrase11')">confugisse deos</span>. <span class="phrase phrase-12" onclick="showAnalysis('phrase12')"><span class="highlight-style style-22" onclick="showAnalysis('style22'); event.stopPropagation()">superi vetuere necari</span></span></span>
<span class="line"><span class="line-number">46</span><span class="phrase phrase-13" onclick="showAnalysis('phrase13')"><span class="highlight-style style-23" onclick="showAnalysis('style23'); event.stopPropagation()">'di'que 'sumus, meritasque luet vicinia poenas</span></span></span>
<span class="line"><span class="line-number">47</span><span class="phrase phrase-14" onclick="showAnalysis('phrase14')"><span class="highlight-style style-24" onclick="showAnalysis('style24'); event.stopPropagation()">impia</span>'</span> <span class="phrase phrase-15" onclick="showAnalysis('phrase15')">dixerunt</span>; '<span class="phrase phrase-16" onclick="showAnalysis('phrase16')"><span class="highlight-style style-25" onclick="showAnalysis('style25'); event.stopPropagation()">vobis immunibus huius</span></span></span>
<span class="line"><span class="line-number">48</span><span class="phrase phrase-17" onclick="showAnalysis('phrase17')">esse mali dabitur</span>. <span class="phrase phrase-18" onclick="showAnalysis('phrase18')">modo <span class="highlight-style style-26" onclick="showAnalysis('style26'); event.stopPropagation()">vestra relinquite tecta</span></span></span>
<span class="line"><span class="line-number">49</span><span class="phrase phrase-19" onclick="showAnalysis('phrase19')">ac nostros comitate gradus</span> <span class="phrase phrase-20" onclick="showAnalysis('phrase20')">et in <span class="highlight-style style-27" onclick="showAnalysis('style27'); event.stopPropagation()">ardua montis</span></span></span>
<span class="line"><span class="line-number">50</span><span class="phrase phrase-21" onclick="showAnalysis('phrase21')"><span class="highlight-style style-28" onclick="showAnalysis('style28'); event.stopPropagation()">ite simul</span></span>.'</span>`,
        grammar: {
            phrase9: {
                title: "ille celer penna tardos aetate fatigat (43)",
                vocab: [
                    "<strong>ille</strong> = that one, he (nom. sing. masc.)",
                    "<strong>celer</strong> = swift, quick (nom. sing. masc.)",
                    "<strong>penna</strong> = with his wing (abl. sing. fem.)",
                    "<strong>tardos</strong> = slow (acc. pl. masc.)",
                    "<strong>aetate</strong> = in/by age (abl. sing. fem.)",
                    "<strong>fatigat</strong> = wearies, exhausts (3rd sing. pres.)"
                ],
                grammar: "Ille refers to anser. Celer nominative agreeing with ille. Ablative of means: penna (with wing/flight). Tardos accusative plural object. Ablative of respect: aetate (slow with regard to age). Antithesis: celer vs tardos. Historic present fatigat.",
                translation: "that one, swift with his wing, wearies those slow with age"
            },
            phrase10: {
                title: "eluditque diu tandemque est visus ad ipsos (44)",
                vocab: [
                    "<strong>eludit</strong> = evades, mocks (3rd sing. pres.)",
                    "<strong>-que</strong> = and",
                    "<strong>diu</strong> = for a long time (adv.)",
                    "<strong>tandem</strong> = at last, finally (adv.)",
                    "<strong>-que</strong> = and",
                    "<strong>est visus</strong> = he seemed, appeared (3rd sing. perf. pass.)",
                    "<strong>ad ipsos</strong> = to those very ones (+ acc.)"
                ],
                grammar: "Historic present eludit with -que continuing action. Diu emphasises duration of chase. Tandem marks turning point. Est visus (perfect passive) = 'he seemed/appeared' with complementary infinitive (confugisse). Ad ipsos = to the very gods themselves. Comic chase ends at divine revelation.",
                translation: "and he evades them for a long time and at last seemed to the very ones"
            },
            phrase11: {
                title: "confugisse deos (45)",
                vocab: [
                    "<strong>confugisse</strong> = to have fled for refuge (perf. inf.)",
                    "<strong>deos</strong> = to the gods (acc. pl. masc.)"
                ],
                grammar: "Perfect infinitive completing 'est visus'. Confugere = flee for refuge (con + fugere). Goose 'appeared to have fled to the gods'. Dramatic irony - gods protect goose from being sacrificed TO gods. Line-initial position of confugisse before revelation.",
                translation: "to have fled for refuge to the gods"
            },
            phrase12: {
                title: "superi vetuere necari (45)",
                vocab: [
                    "<strong>superi</strong> = the gods above (nom. pl. masc.)",
                    "<strong>vetuere</strong> = forbade (3rd pl. perf.)",
                    "<strong>necari</strong> = to be killed (pres. pass. inf.)"
                ],
                grammar: "Perfect tense marks decisive action. Superi = gods above (super). Vetare takes passive infinitive. They forbid goose's slaughter - first explicit divine intervention. Sets up direct speech revelation. Superi finally identified.",
                translation: "the gods above forbade (him) to be killed"
            },
            phrase13: {
                title: "'di'que 'sumus, meritasque luet vicinia poenas (46)",
                vocab: [
                    "<strong>di</strong> = gods (nom. pl. masc.)",
                    "<strong>-que</strong> = and",
                    "<strong>sumus</strong> = we are (1st pl. pres.)",
                    "<strong>meritas</strong> = deserved (acc. pl. fem.)",
                    "<strong>-que</strong> = and",
                    "<strong>luet</strong> = will pay (3rd sing. fut.)",
                    "<strong>vicinia</strong> = neighbourhood (nom. sing. fem.)",
                    "<strong>poenas</strong> = punishments (acc. pl. fem.)"
                ],
                grammar: "Direct speech begins. 'Di sumus' = emphatic revelation (predicate nominative first). Meritas agrees with poenas. Future tense luet announces coming judgement. Vicinia subject. Luo takes accusative (poenas). -que...que structures revelation AND punishment.",
                translation: "'We are gods, and the neighbourhood will pay deserved punishments"
            },
            phrase14: {
                title: "impia' (47)",
                vocab: [
                    "<strong>impia</strong> = wicked, impious (nom. sing. fem.)"
                ],
                grammar: "Adjective agreeing with vicinia, positioned at line start for emphasis. Impia = opposite of pius (dutiful/pious). Neighbourhood rejected hospitality showing impiety. Single-word clause creates dramatic pause before 'dixerunt'.",
                translation: "the wicked (neighbourhood)'"
            },
            phrase15: {
                title: "dixerunt (47)",
                vocab: [
                    "<strong>dixerunt</strong> = they said (3rd pl. perf.)"
                ],
                grammar: "Perfect tense closes direct speech attribution. Marks completion of first part of divine pronouncement. Placed mid-line before continuing with exception for Baucis and Philemon.",
                translation: "they said"
            },
            phrase16: {
                title: "'vobis immunibus huius (47)",
                vocab: [
                    "<strong>vobis</strong> = to/for you (dat. pl.)",
                    "<strong>immunibus</strong> = free from, exempt (dat. pl.)",
                    "<strong>huius</strong> = from this (gen. sing. neut.)"
                ],
                grammar: "Direct speech resumes. Dative of possession/advantage: vobis. Immunibus (in + munus = free from duty/burden) dative agreeing with vobis. Huius genitive with next phrase (mali) - exempt from this evil. Contrast with vicinia's punishment.",
                translation: "'for you, exempt from this"
            },
            phrase17: {
                title: "esse mali dabitur (48)",
                vocab: [
                    "<strong>esse</strong> = to be (pres. inf.)",
                    "<strong>mali</strong> = evil, harm (gen. sing. neut.)",
                    "<strong>dabitur</strong> = it will be granted (3rd sing. fut. pass.)"
                ],
                grammar: "Infinitive phrase as subject of passive dabitur. Genitive with immunibus: free FROM evil. Future passive: 'it will be granted to you to be free from this evil'. Divine promise of protection. Formal, elevated syntax.",
                translation: "to be of evil will be granted"
            },
            phrase18: {
                title: "modo vestra relinquite tecta (48)",
                vocab: [
                    "<strong>modo</strong> = only, just (adv.)",
                    "<strong>vestra</strong> = your (acc. pl. neut.)",
                    "<strong>relinquite</strong> = leave! (2nd pl. pres. impv.)",
                    "<strong>tecta</strong> = homes, roofs (acc. pl. neut.)"
                ],
                grammar: "Direct command. Modo = 'only/just' (they need only do this one thing). Present imperative plural addressing both. Vestra tecta = their humble home. Command to abandon everything - test of faith and obedience.",
                translation: "just leave your homes"
            },
            phrase19: {
                title: "ac nostros comitate gradus (49)",
                vocab: [
                    "<strong>ac</strong> = and (conj.)",
                    "<strong>nostros</strong> = our (acc. pl. masc.)",
                    "<strong>comitate</strong> = accompany! (2nd pl. pres. impv.)",
                    "<strong>gradus</strong> = steps (acc. pl. masc.)"
                ],
                grammar: "Second imperative. Comitare (deponent) = accompany. Nostros gradus = our steps/pace. Gods will lead way. Plural imperative maintains direct address to couple. Commands build urgency: leave, accompany, go.",
                translation: "and accompany our steps"
            },
            phrase20: {
                title: "et in ardua montis (49)",
                vocab: [
                    "<strong>et</strong> = and (conj.)",
                    "<strong>in</strong> = to, into (+ acc.)",
                    "<strong>ardua</strong> = heights, steep places (acc. pl. neut.)",
                    "<strong>montis</strong> = of the mountain (gen. sing. masc.)"
                ],
                grammar: "Prepositional phrase with motion. In + acc shows direction. Ardua (substantive neut. pl.) = steep/high places, heights. Genitive montis. Mountain traditionally place of divine revelation and safety. Climbing up = symbolic salvation.",
                translation: "and to the heights of the mountain"
            },
            phrase21: {
                title: "ite simul' (50)",
                vocab: [
                    "<strong>ite</strong> = go! (2nd pl. pres. impv.)",
                    "<strong>simul</strong> = together (adv.)"
                ],
                grammar: "Final imperative. Ire (irregular) = go. Simul emphasises togetherness - couple will face salvation together. Direct speech ends with simple, powerful command. Closing quotation mark returns to narrative. Short clauses create urgency.",
                translation: "go together'"
            }
        },
        style: {
            style19: {
                title: "celer penna / tardos aetate (43)",
                device: "Balanced Phrase + Parallelism/Juxtaposition",
                effect: "Balanced phrase structure: celer penna (swift with wing) mirrors tardos aetate (slow with age). The parallelism creates juxtaposition between speed and slowness, youth and age. This is a funny, lighthearted moment - comic relief of elderly couple chasing nimble goose. The balanced grammatical structure (adjective + ablative / adjective + ablative) mirrors the physical comedy of the chase."
            },
            style20: {
                title: "eluditque diu / tandemque (44)",
                device: "Temporal Juxtaposition",
                effect: "Diu (for a long time) and tandem (at last) are juxtaposed - stretches out the chase, then snaps it shut immediately. The comic sequence expands (diu) then contracts (tandem) at the moment of divine revelation. Time stretches out in comedy, then collapses at the numinous moment."
            },
            style21: {
                title: "ad ipsos (44-45)",
                device: "Emphatic Pronoun + Enjambment",
                effect: "Ipsos (themselves, the very ones) placed at line end creates emphasis and suspense through enjambment - 'to the very ones...' then line break before revealing who: '...gods'. The position draws out the dramatic moment. Goose flees not just near but TO the gods themselves - dramatic irony at its peak."
            },
            style22: {
                title: "superi vetuere necari (45)",
                device: "Divine Intervention + Grand Language",
                effect: "Superi (gods above) is formal, elevated vocabulary that marks the shift to divine intervention. Vetare (forbid) shows divine authority - the gods make their presence fully known through this command. Grand, solemn language replaces the comic tone. This is the first explicit exercise of divine power in the narrative."
            },
            style23: {
                title: "'di'que 'sumus / meritasque luet vicinia poenas (46)",
                device: "Enclosing Word Order + Emphatic Structure",
                effect: "Line 46 sets up contrast through enclosing order: meritas (deserved) at the start, then luet vicinia poenas (neighbourhood will pay punishments), then impia (wicked) enjambed on next line. The punishment linguistically encircles the guilt - just as the neighbourhood will soon be entrapped by the flood. Meritas positioned emphatically at the start of this structure announces that justice is deserved. 'Di sumus' revelation uses predicate nominative first for drama: 'Gods - we are (them)!'"
            },
            style24: {
                title: "impia (47)",
                device: "Single-Word Condemnation + Enjambment",
                effect: "Impia (impious/wicked) clarifies the reason for punishment. Positioned at line start, enjambed from previous line, it hangs off as an afterthought - almost like the gods spitting out the word with contempt. One word summarises the neighbourhood's crime: opposite of pietas (religious duty). The enjambment makes it feel isolated, damned."
            },
            style25: {
                title: "Line 47 assonance + vobis immunibus huius (47)",
                device: "Assonance + Dative of Advantage",
                effect: "Line 47 has repeated 'i' sounds: 'impia dixerunt vobis immunibus' - the assonance perhaps links the wickedness of the villagers through sound patterning. Then vobis (to you) shifts focus to the saved couple. Immunibus (exempt, free from) is legal/civic terminology for exemption. Creates stark contrast: neighbourhood punished, but YOU exempt."
            },
            style26: {
                title: "vestra relinquite tecta (48)",
                device: "Balanced Phrase + Direct Command",
                effect: "Simple, balanced phrase structure: possessive-verb-object (vestra relinquite tecta). The direct command is unadorned, urgent. Relinquite (imperative) - they must abandon everything. The simplicity makes the command feel absolute, non-negotiable. No elaborate explanation - just: leave your home."
            },
            style27: {
                title: "ardua montis (49)",
                device: "Virgilian Phrasing + Partitive Genitive",
                effect: "Ardua montis uses elevated, Virgilian-style phrasing with partitive genitive: 'the heights OF the mountain' (not 'the high mountain'). This construction emphasises how far and how high they need to climb to be safe - selecting out the highest, steepest parts of the mountain. Epic diction for epic salvation."
            },
            style28: {
                title: "ite simul (50)",
                device: "Dramatic Brevity",
                effect: "Just two words to end the divine speech: 'Go together'. After elaborate explanation of punishment and salvation, everything else falls away - the moment for talking is over. Ite (imperative) demands action. Simul (together) emphasises their unity will save them. Brevity creates urgency and finality."
            }
        }
    }
};

let currentAnalysis = null;
let currentMode = 'grammar';
let currentView = 'recap';
let currentSection = '4a';

document.addEventListener('DOMContentLoaded', function() {
    loadLesson();
    showView('recap');
    displayTPS(0);
    displayVisual(0);
});

function loadLesson() {
    document.getElementById('latinText4a').innerHTML = lessonData.section4a.latinText;
    document.getElementById('latinText4b').innerHTML = lessonData.section4b.latinText;
}

function showView(view) {
    currentView = view;
    
    if (event && event.currentTarget) {
        document.querySelectorAll('.sidebar .nav-item').forEach(item => {
            item.classList.remove('active');
        });
        event.currentTarget.classList.add('active');
    }
    
    const recapSection = document.getElementById('recapSection');
    const objectivesSection = document.getElementById('objectivesSection');
    const textSection = document.getElementById('textSection');
    const examSection = document.getElementById('examSection');
    const teachingSection = document.getElementById('teachingSection');
    
    recapSection.style.display = 'none';
    objectivesSection.style.display = 'none';
    textSection.style.display = 'none';
    examSection.style.display = 'none';
    if (teachingSection) teachingSection.style.display = 'none';
    
    if (view === 'recap') {
        recapSection.style.display = 'block';
    } else if (view === 'objectives') {
        objectivesSection.style.display = 'block';
    } else if (view === 'exam') {
        examSection.style.display = 'block';
    } else if (view === 'teaching') {
        if (teachingSection) teachingSection.style.display = 'block';
        if (currentGameQuestion === -1) initTranslationGame();
    } else if (view === 'text') {
        textSection.style.display = 'grid';
        setupAnalysisPanel();
    }
    
    currentAnalysis = null;
}

function setupAnalysisPanel() {
    const panelTitle = document.getElementById('panelTitle');
    const analysisPanel = document.getElementById('analysisPanel');
    
    panelTitle.textContent = 'Analysis';
    analysisPanel.innerHTML = '<div class="default-message" id="defaultMessage">Click any coloured phrase to see vocabulary and grammar</div>';
    
    const currentData = currentSection === '4a' ? lessonData.section4a : lessonData.section4b;
    
    for (const [key, data] of Object.entries(currentData.grammar)) {
        const card = createGrammarCard(key, data);
        analysisPanel.appendChild(card);
    }
    
    for (const [key, data] of Object.entries(currentData.style)) {
        const card = createStyleCard(key, data);
        analysisPanel.appendChild(card);
    }
}

function switchSection(section) {
    currentSection = section;
    
    document.querySelectorAll('.section-btn').forEach(btn => btn.classList.remove('active'));
    event.currentTarget.classList.add('active');
    
    document.querySelectorAll('.section-content').forEach(content => content.classList.remove('active'));
    document.getElementById('section' + section).classList.add('active');
    
    const latinText4a = document.querySelector('#section4a .latin-text');
    const latinText4b = document.querySelector('#section4b .latin-text');
    
    if (currentMode === 'style') {
        if (section === '4a') {
            latinText4a.classList.add('mode-style');
            latinText4b.classList.remove('mode-style');
        } else {
            latinText4b.classList.add('mode-style');
            latinText4a.classList.remove('mode-style');
        }
    }
    
    setupAnalysisPanel();
    currentAnalysis = null;
}

function setMode(mode) {
    currentMode = mode;
    
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
    event.currentTarget.classList.add('active');
    
    const latinText = document.querySelector(`#section${currentSection} .latin-text`);
    if (mode === 'style') {
        latinText.classList.add('mode-style');
    } else {
        latinText.classList.remove('mode-style');
    }
    
    if (currentAnalysis) {
        currentAnalysis.classList.remove('active');
        currentAnalysis = null;
    }
    
    const defaultMessage = document.getElementById('defaultMessage');
    if (defaultMessage) {
        defaultMessage.style.display = 'block';
    }
}

function showAnalysis(id) {
    if (currentView !== 'text') return;
    
    if (id.startsWith('style') && currentMode !== 'style') return;
    if (id.startsWith('phrase') && currentMode === 'style') return;
    
    const defaultMessage = document.getElementById('defaultMessage');
    if (defaultMessage) {
        defaultMessage.style.display = 'none';
    }
    
    if (currentAnalysis) {
        currentAnalysis.classList.remove('active');
    }
    
    const card = document.getElementById(id);
    if (card) {
        card.classList.add('active');
        currentAnalysis = card;
        card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
}

function createGrammarCard(id, data) {
    const card = document.createElement('div');
    card.className = 'analysis-card';
    card.id = id;
    
    let vocabHTML = data.vocab.map(item => `<p>‚Ä¢ ${item}</p>`).join('');
    
    card.innerHTML = `
        <div class="analysis-badge">Grammar & Vocabulary</div>
        <h4>${data.title}</h4>
        <div class="vocab-list">${vocabHTML}</div>
        <p><strong>Grammar:</strong> ${data.grammar}</p>
        <div class="translation-section">
            <button class="reveal-translation-btn" onclick="revealTranslation('${id}')">Reveal Translation</button>
            <div class="translation-text" id="${id}-translation">
                <strong>Translation:</strong> "${data.translation}"
            </div>
        </div>
    `;
    
    return card;
}

function revealTranslation(id) {
    const translation = document.getElementById(id + '-translation');
    const button = event.currentTarget;
    
    if (translation && !translation.classList.contains('visible')) {
        translation.classList.add('visible');
        button.textContent = '‚úì Translation Revealed';
        button.classList.add('revealed');
    }
}

function createStyleCard(id, data) {
    const card = document.createElement('div');
    card.className = 'analysis-card';
    card.id = id;
    
    card.innerHTML = `
        <div class="analysis-badge">Literary Device</div>
        <h4>${data.title}</h4>
        <p><strong>Device:</strong> ${data.device}</p>
        <p><strong>Effect:</strong> ${data.effect}</p>
    `;
    
    return card;
}

function toggleFullTranslation() {
    const existingBox = document.getElementById('fullTranslationBox');
    if (existingBox) {
        existingBox.remove();
        event.currentTarget.textContent = 'Show Translation';
        return;
    }
    
    const currentData = currentSection === '4a' ? lessonData.section4a : lessonData.section4b;
    
    const translationBox = document.createElement('div');
    translationBox.id = 'fullTranslationBox';
    translationBox.style.cssText = 'background: rgba(230, 240, 255, 0.8); border-radius: 12px; padding: 1.5rem; margin-top: 1rem; border: 1px solid rgba(0, 102, 255, 0.2);';
    translationBox.innerHTML = `
        <h4 style="font-size: 0.9rem; font-weight: 600; color: #0066ff; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.75rem;">Full Translation (Section ${currentSection.toUpperCase()})</h4>
        <p style="font-size: 1rem; line-height: 1.8; color: #333;">${currentData.fullTranslation}</p>
    `;
    
    document.querySelector('.btn-group').insertAdjacentElement('beforebegin', translationBox);
    event.currentTarget.textContent = 'Hide Translation';
}

function resetView() {
    if (currentAnalysis) {
        currentAnalysis.classList.remove('active');
        currentAnalysis = null;
    }
    
    const defaultMessage = document.getElementById('defaultMessage');
    if (defaultMessage) {
        defaultMessage.style.display = 'block';
    }
    
    const translationBox = document.getElementById('fullTranslationBox');
    if (translationBox) {
        translationBox.remove();
    }
}

// Translation Game Data and Functions
const translationQuestions = [
    {
        latin: "sponte sua per seque",
        options: [
            "of its own accord and by itself",
            "with its own spirit and through itself", 
            "from its desire and its nature",
            "spontaneously by the gods"
        ],
        correct: 0,
        explanation: "This emphasises the self-action - no human or divine agency makes this happen. The wine refills itself through supernatural power."
    },
    {
        latin: "attoniti novitate pavent",
        options: [
            "stunned by novelty they are afraid",
            "thunderstruck by the strangeness they tremble",
            "amazed by newness they worry",
            "astonished at innovation they fear"
        ],
        correct: 1,
        explanation: "'Attoniti' literally means thunderstruck (from tonare = thunder), and 'pavent' captures the religious trembling/fear at a divine miracle."
    },
    {
        latin: "unicus anser erat",
        options: [
            "one goose was there",
            "a unique goose existed",
            "there was a single goose",
            "their only goose was there"
        ],
        correct: 2,
        explanation: "'Unicus' emphasises singularity - not just 'one' but their ONLY goose. The imperfect 'erat' introduces description."
    },
    {
        latin: "minimae custodia villae",
        options: [
            "guardian of the smallest farm",
            "protection of the tiny estate",
            "guard of the minimal villa",
            "guardian of the tiniest farm"
        ],
        correct: 3,
        explanation: "'Minima' emphasises extreme smallness. 'Custodia' is the guard/guardian - the goose protects their humble property."
    },
    {
        latin: "celer penna tardos aetate fatigat",
        options: [
            "swift with wing he wearies the slow with age",
            "quick with feather he tires those slow in years",
            "fast on wing he exhausts the aged slow ones",
            "speedy with his wings he wears out those slow with age"
        ],
        correct: 0,
        explanation: "The balanced structure (adjective + ablative) on both sides creates the comic contrast: swift WITH wing vs slow WITH age."
    },
    {
        latin: "di sumus",
        options: [
            "we are gods",
            "gods we are",
            "we exist as gods",
            "gods are we"
        ],
        correct: 1,
        explanation: "The emphatic word order puts 'gods' first for dramatic revelation: 'GODS - we are!' Not the normal 'we are gods'."
    },
    {
        latin: "meritasque luet vicinia poenas impia",
        options: [
            "and the wicked neighbourhood will pay deserved punishments",
            "and the neighbourhood, being wicked, will pay deserved penalties",
            "and the neighbourhood will pay the punishments it deserved, being impious",
            "the neighbourhood will suffer punishments deserved and wicked"
        ],
        correct: 0,
        explanation: "'Meritas' (deserved) comes first, then 'impia' (wicked) is enjambed to next line, creating the enclosing structure around 'vicinia'."
    },
    {
        latin: "ite simul",
        options: [
            "go at the same time",
            "go together",
            "walk simultaneously", 
            "proceed united"
        ],
        correct: 1,
        explanation: "Just two words for maximum dramatic effect. 'Simul' emphasises their togetherness even in this urgent command."
    }
];

let currentGameQuestion = -1;
let gameScore = 0;

function initTranslationGame() {
    currentGameQuestion = 0;
    gameScore = 0;
    updateGameProgress();
    displayQuestion();
}

function switchActivity(activity) {
    // Update button states
    document.querySelectorAll('.activity-btn').forEach(btn => btn.classList.remove('active'));
    event.currentTarget.classList.add('active');
    
    // Update content visibility
    document.querySelectorAll('.activity-content').forEach(content => content.classList.remove('active'));
    
    if (activity === 'tps') {
        document.getElementById('tpsActivity').classList.add('active');
    } else if (activity === 'translation') {
        document.getElementById('translationActivity').classList.add('active');
        if (currentGameQuestion === -1) initTranslationGame();
    } else if (activity === 'visual') {
        document.getElementById('visualActivity').classList.add('active');
    }
}

function updateGameProgress() {
    const progressContainer = document.getElementById('gameProgress');
    progressContainer.innerHTML = '';
    
    for (let i = 0; i < translationQuestions.length; i++) {
        const dot = document.createElement('div');
        dot.className = 'progress-dot';
        if (i < currentGameQuestion) dot.classList.add('completed');
        if (i === currentGameQuestion) dot.classList.add('current');
        progressContainer.appendChild(dot);
    }
}

function displayQuestion() {
    if (currentGameQuestion >= translationQuestions.length) {
        showGameComplete();
        return;
    }
    
    const question = translationQuestions[currentGameQuestion];
    document.getElementById('latinDisplay').textContent = question.latin;
    
    const optionsContainer = document.getElementById('translationOptions');
    optionsContainer.innerHTML = '';
    
    question.options.forEach((option, index) => {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'translation-option';
        optionDiv.textContent = option;
        optionDiv.onclick = () => selectOption(index);
        optionsContainer.appendChild(optionDiv);
    });
    
    document.getElementById('gameFeedback').classList.remove('show', 'correct', 'incorrect');
    document.getElementById('nextBtn').disabled = true;
}

function selectOption(selectedIndex) {
    const question = translationQuestions[currentGameQuestion];
    const options = document.querySelectorAll('.translation-option');
    const feedback = document.getElementById('gameFeedback');
    
    // Remove previous selections
    options.forEach(opt => opt.classList.remove('selected', 'correct', 'incorrect'));
    
    // Mark selected option
    options[selectedIndex].classList.add('selected');
    
    // Check if correct
    const isCorrect = selectedIndex === question.correct;
    
    if (isCorrect) {
        options[selectedIndex].classList.add('correct');
        feedback.className = 'game-feedback show correct';
        feedback.innerHTML = `<strong>‚úì Correct!</strong> ${question.explanation}`;
        gameScore++;
    } else {
        options[selectedIndex].classList.add('incorrect');
        options[question.correct].classList.add('correct');
        feedback.className = 'game-feedback show incorrect';
        feedback.innerHTML = `<strong>‚úó Not quite.</strong> The best translation is: "${question.options[question.correct]}". ${question.explanation}`;
    }
    
    document.getElementById('nextBtn').disabled = false;
}

function nextQuestion() {
    currentGameQuestion++;
    updateGameProgress();
    displayQuestion();
}

function resetGame() {
    initTranslationGame();
}

function showGameComplete() {
    const percentage = Math.round((gameScore / translationQuestions.length) * 100);
    document.getElementById('latinDisplay').textContent = 'üéâ Complete!';
    document.getElementById('translationOptions').innerHTML = `
        <div style="text-align: center; padding: 2rem;">
            <h3 style="font-size: 2rem; color: #6366f1; margin-bottom: 1rem;">Quiz Completed!</h3>
            <p style="font-size: 1.5rem; margin-bottom: 0.5rem;">You scored ${gameScore} out of ${translationQuestions.length}</p>
            <p style="font-size: 1.125rem; color: #4b5563;">${percentage}% correct</p>
        </div>
    `;
    document.getElementById('gameFeedback').classList.remove('show');
    document.getElementById('nextBtn').style.display = 'none';
}

// Think-Pair-Share Data and Functions
const tpsActivities = [
    {
        title: "Double Emphasis",
        latin: "sponte sua per seque",
        lineRef: "Line 37",
        section: "4a",
        think: "Why does Ovid use BOTH 'sponte sua' AND 'per se'? Write down what you think each phrase means. Is this just repetition, or is something else happening?",
        pair: "Compare your interpretations with your partner. When might doubling or repetition make something MORE effective rather than less? Can you think of examples from everyday language?",
        share: "What's the effect of insisting - twice - that this happens by itself? How does the doubled emphasis contribute to the sense of miracle or impossibility?"
    },
    {
        title: "Sound and Meaning",
        latin: "sponte sua per seque vident succrescere",
        lineRef: "Line 37",
        section: "4a",
        think: "Say this line out loud (quietly). Count how many 's' sounds you can hear. What associations do 's' sounds have? What do they remind you of?",
        pair: "Share what you noticed. What different things could repeated 's' sounds represent in this context? List at least three possibilities.",
        share: "Could sound be doing more than just 'sounding nice' here? How might Ovid be using the sound of the words to reinforce what the words mean?"
    },
    {
        title: "Chiasmus Structure",
        latin: "cratera repleri...succrescere vina",
        lineRef: "Lines 36-37",
        section: "4a",
        think: "The pattern here is: OBJECT-VERB...VERB-OBJECT (bowl to-be-filled...to-grow-back wines). Why cross them over instead of keeping the same order in both lines?",
        pair: "Discuss: what does a crossing or 'X' pattern suggest? Balance? Completion? Something else? How might this structure reflect the nature of the miracle?",
        share: "Does the grammatical structure mirror the supernatural balance of the refilling wine? How does form complement content?"
    },
    {
        title: "Enclosing Unity",
        latin: "concipiunt Baucisque preces timidusque Philemon",
        lineRef: "Line 39",
        section: "4a",
        think: "Map out the word order. Where does 'preces' (prayers) sit? What's on either side of it? Why might Ovid arrange the words this way instead of putting the names together?",
        pair: "What might it symbolise that the two names 'surround' or 'enclose' the prayers? Think about their relationship - what does this structure show about how they approach the gods?",
        share: "Can word order reflect meaning? How does the SHAPE of this line mirror the couple's unity?"
    },
    {
        title: "Rhyming Shame",
        latin: "veniam dapibus nullisque paratibus orant",
        lineRef: "Line 40",
        section: "4a",
        think: "Notice the endings: dap-ibus...parat-ibus. Why make these two things rhyme? What are they apologising for in each case?",
        pair: "Discuss: when we make things rhyme, what effect does that create? How does the matching sound link their two sources of shame together?",
        share: "Does the rhyme make their apology feel more considered, deliberate, or formal? Why might that matter?"
    },
    {
        title: "Poverty in One Word",
        latin: "unicus anser erat",
        lineRef: "Line 41",
        section: "4a",
        think: "'Unicus' could mean 'one' or 'only' or 'sole' or 'unique'. Which English word best captures what Ovid's emphasising? What does this single word tell us about their situation?",
        pair: "Why put 'unicus' at the START of the line before we even know what's 'only one'? What's the effect of that positioning?",
        share: "How can a single word create pathos? What does their sacrifice of their 'only' goose reveal about their character?"
    },
    {
        title: "Ironic Titles",
        latin: "domini",
        lineRef: "Line 42",
        section: "4a",
        think: "'Domini' means 'masters' or 'lords' of the house. But what have we learned about Baucis and Philemon's wealth and possessions? Is this title ironic?",
        pair: "Discuss whether Ovid is being sarcastic or sincere. Can someone be a 'master' of very little and still deserve the title? Why or why not?",
        share: "What does this word choice reveal about dignity in poverty? Can you be lordly while being poor?"
    },
    {
        title: "Comic Symmetry",
        latin: "ille celer penna tardos aetate fatigat",
        lineRef: "Line 43",
        section: "4b",
        think: "The structure is perfectly balanced: ADJECTIVE + ABLATIVE vs ADJECTIVE + ABLATIVE (swift with-wing vs slow with-age). Why use such symmetrical grammar for a comic chase scene?",
        pair: "How does balanced structure create humour? Does the neat pattern make the physical mismatch (fast bird vs slow humans) funnier? Why?",
        share: "Why include comedy at this moment in the narrative? What happens RIGHT after this scene? Could there be a dramatic reason for the tonal shift?"
    },
    {
        title: "Time Manipulation",
        latin: "eluditque diu tandemque",
        lineRef: "Line 44",
        section: "4b",
        think: "'Diu' means 'for a long time' and 'tandem' means 'at last/finally'. What's the effect of putting these two time markers right next to each other?",
        pair: "Discuss: how does Ovid manipulate our sense of time here? Does he stretch it out, then snap it closed? What's the narrative effect?",
        share: "How does time function differently in comedy versus in numinous/sacred moments? Can you identify where the tone shifts?"
    },
    {
        title: "Emphatic Revelation",
        latin: "'di'que 'sumus",
        lineRef: "Line 46",
        section: "4b",
        think: "Normal Latin word order would be 'sumus di' (we-are gods). Why reverse it to 'di sumus' (gods we-are)? What word does this make us hear FIRST?",
        pair: "After 45 lines of mystery and dramatic irony, how does putting 'di' (gods) at the very front create impact? Compare the emotional effect of both word orders.",
        share: "Can grammar create drama? How does word order in this two-word revelation maximise the thunder-clap moment?"
    },
    {
        title: "Encircling Justice",
        latin: "meritasque luet vicinia poenas impia",
        lineRef: "Lines 46-47",
        section: "4b",
        think: "Map out the structure: what words come BEFORE 'vicinia' (neighbourhood)? What word comes AFTER (on the next line)? How is the neighbourhood positioned?",
        pair: "The punishment words (deserved...punishments...wicked) surround/encircle the guilty party. Is this intentional? What's about to happen to the neighbourhood in the story?",
        share: "Can word order foreshadow plot? How does linguistic entrapment mirror physical entrapment by the flood?"
    },
    {
        title: "Dramatic Brevity",
        latin: "ite simul",
        lineRef: "Line 50",
        section: "4b",
        think: "The gods have just explained everything - the revelation, the punishment, the exception. Then just two words to end: 'ite simul' (go together). Why so SHORT after all that?",
        pair: "What's the effect of 'simul' (together)? Why emphasise their togetherness even in this urgent command to flee? What does it tell us about why they're being saved?",
        share: "How does extreme brevity create urgency? What's the emotional shift when elaborate explanation gives way to stark command?"
    }
];

let currentTPSIndex = 0;
let filteredTPSActivities = [...tpsActivities];
let currentTeachingSection = 'all';

function displayTPS(index) {
    const tps = tpsActivities[index];
    
    // Update content
    document.getElementById('tpsNumber').textContent = index + 1;
    document.getElementById('tpsTitle').textContent = tps.title + ' (' + tps.lineRef + ')';
    document.getElementById('tpsLatin').textContent = tps.latin;
    document.getElementById('tpsCounter').textContent = `${index + 1} of ${tpsActivities.length}`;
    
    // Build phases HTML - Think always visible, Pair and Share hidden initially
    document.getElementById('tpsPhases').innerHTML = `
        <div class="tps-phase" id="thinkPhase">
            <div class="phase-icon">ü§î</div>
            <div class="phase-title">Think (1-2 min)</div>
            <div class="phase-content">${tps.think}</div>
        </div>
        <div class="tps-phase hidden" id="pairPhase">
            <div class="phase-icon">üë•</div>
            <div class="phase-title">Pair (2-3 min)</div>
            <div class="phase-content">${tps.pair}</div>
            <button class="reveal-phase-btn" onclick="revealPhase('pair')">
                ‚ñ∂ Reveal Pair Activity
            </button>
        </div>
        <div class="tps-phase hidden" id="sharePhase">
            <div class="phase-icon">üó£Ô∏è</div>
            <div class="phase-title">Share (3-5 min)</div>
            <div class="phase-content">${tps.share}</div>
            <button class="reveal-phase-btn" onclick="revealPhase('share')">
                ‚ñ∂ Reveal Share Activity
            </button>
        </div>
        <div class="tps-phase-controls">
            <button class="game-btn secondary" onclick="revealAllPhases()" style="flex: 1;">
                Show All Phases
            </button>
            <button class="game-btn secondary" onclick="resetPhases()" style="flex: 1;">
                Reset to Think Only
            </button>
        </div>
    `;
    
    // Update navigation dots
    document.querySelectorAll('.tps-nav-dot').forEach((dot, i) => {
        dot.classList.toggle('active', i === index);
        dot.onclick = () => {
            currentTPSIndex = i;
            displayTPS(i);
        };
    });
    
    // Update button states
    document.getElementById('prevTPSBtn').disabled = (index === 0);
    document.getElementById('nextTPSBtn').disabled = (index === tpsActivities.length - 1);
}

function nextTPS() {
    if (currentTPSIndex < tpsActivities.length - 1) {
        currentTPSIndex++;
        displayTPS(currentTPSIndex);
    }
}

function prevTPS() {
    if (currentTPSIndex > 0) {
        currentTPSIndex--;
        displayTPS(currentTPSIndex);
    }
}

function revealPhase(phase) {
    const phaseElement = document.getElementById(phase + 'Phase');
    const button = phaseElement.querySelector('.reveal-phase-btn');
    
    if (phaseElement && phaseElement.classList.contains('hidden')) {
        phaseElement.classList.remove('hidden');
        phaseElement.classList.add('revealed');
        button.textContent = '‚úì Revealed';
        button.classList.add('revealed');
        button.disabled = true;
    }
}

function revealAllPhases() {
    revealPhase('pair');
    revealPhase('share');
}

function resetPhases() {
    const pairPhase = document.getElementById('pairPhase');
    const sharePhase = document.getElementById('sharePhase');
    
    if (pairPhase) {
        pairPhase.classList.add('hidden');
        pairPhase.classList.remove('revealed');
        const pairBtn = pairPhase.querySelector('.reveal-phase-btn');
        pairBtn.textContent = '‚ñ∂ Reveal Pair Activity';
        pairBtn.classList.remove('revealed');
        pairBtn.disabled = false;
    }
    
    if (sharePhase) {
        sharePhase.classList.add('hidden');
        sharePhase.classList.remove('revealed');
        const shareBtn = sharePhase.querySelector('.reveal-phase-btn');
        shareBtn.textContent = '‚ñ∂ Reveal Share Activity';
        shareBtn.classList.remove('revealed');
        shareBtn.disabled = false;
    }
}

// Visual Grammar Examples
const visualGrammarExamples = [
    {
        title: "Enclosing Word Order (Line 39)",
        section: "4a",
        latin: '<span class="grammar-word verb">concipiunt</span> <span class="grammar-word subject">Baucisque</span> <span class="grammar-word object">preces</span> <span class="grammar-word adjective">timidusque</span> <span class="grammar-word subject">Philemon</span>',
        legend: [
            { type: 'subject', label: 'Subject (who\'s praying)' },
            { type: 'verb', label: 'Verb (they form/utter)' },
            { type: 'object', label: 'Object (prayers)' },
            { type: 'adjective', label: 'Adjective (timid/fearful)' }
        ],
        explanation: 'Notice how <strong>Baucis</strong> and <strong>Philemon</strong> surround the <strong>prayers</strong> - the couple literally enclose their supplication in the word order. The form mirrors the meaning: they come together to address the gods, their unity reflected in the structure of the line itself.'
    },
    {
        title: "Chiasmus: Object-Verb / Verb-Object (Lines 36-37)",
        section: "4a",
        latin: '<span class="grammar-word object">cratera</span> <span class="grammar-word verb">repleri</span><br><span class="grammar-word verb">succrescere</span> <span class="grammar-word object">vina</span>',
        legend: [
            { type: 'object', label: 'Object (bowl / wines)' },
            { type: 'verb', label: 'Verb (to be refilled / to grow back)' }
        ],
        explanation: 'Chiasmus creates an ABBA pattern: object-verb-verb-object. The crossing structure perhaps reflects the completion and perfection of the miracle - grammatical balance mirrors supernatural balance. Each refilling is perfectly symmetrical.'
    },
    {
        title: "Balanced Parallelism (Line 43)",
        section: "4b",
        latin: '<span class="grammar-word adjective">celer</span> <span class="grammar-word prep-phrase">penna</span> <span style="margin: 0 1rem; color: #9ca3af;">vs</span> <span class="grammar-word adjective">tardos</span> <span class="grammar-word prep-phrase">aetate</span>',
        legend: [
            { type: 'adjective', label: 'Adjective (swift / slow)' },
            { type: 'prep-phrase', label: 'Ablative (with wing / with age)' }
        ],
        explanation: 'The grammar is perfectly balanced: <strong>adjective + ablative</strong> on each side. This parallel structure creates the humorous juxtaposition of the swift goose versus the slow elderly couple. The balanced form mirrors the physical comedy of the chase.'
    },
    {
        title: "Sibilance Pattern (Line 37)",
        section: "4a",
        latin: '<span class="grammar-word prep-phrase" style="background: rgba(139, 92, 246, 0.3);">sponte</span> <span class="grammar-word prep-phrase" style="background: rgba(139, 92, 246, 0.3);">sua</span> <span class="grammar-word prep-phrase" style="background: rgba(139, 92, 246, 0.3);">per</span> <span class="grammar-word prep-phrase" style="background: rgba(139, 92, 246, 0.3);">seque</span> <span class="grammar-word verb">vident</span> <span class="grammar-word verb" style="background: rgba(139, 92, 246, 0.3);">succrescere</span> <span class="grammar-word object">vina</span>',
        legend: [
            { type: 'prep-phrase', label: 'Words with S-sounds (highlighted in purple)' },
            { type: 'verb', label: 'Verbs' },
            { type: 'object', label: 'Object' }
        ],
        explanation: 'Count the s-sounds: <strong>s</strong>ponte <strong>s</strong>ua per <strong>s</strong>eque....<strong>s</strong>uc<strong>c</strong>re<strong>s</strong>cere. The sibilance creates a magical, bubbling sound - we can almost HEAR the wine rising mysteriously in the bowl. Sound reinforces meaning.'
    },
    {
        title: "Alliteration: V-sounds (Line 37)",
        section: "4a",
        latin: '<span class="grammar-word prep-phrase">sponte sua per seque</span> <span class="grammar-word verb" style="background: rgba(139, 92, 246, 0.3);">vident</span> <span class="grammar-word verb">succrescere</span> <span class="grammar-word object" style="background: rgba(139, 92, 246, 0.3);">vina</span>',
        legend: [
            { type: 'prep-phrase', label: 'Words with V-alliteration (highlighted)' }
        ],
        explanation: '<strong>Vident...vina</strong> - the v-alliteration draws attention to what they SEE and WHAT they see (the wine). The sound pattern links the observers to the observed miracle, connecting their perception to the supernatural event.'
    },
    {
        title: "Punishment Encircles Guilt (Lines 46-47)",
        section: "4b",
        latin: '<span class="grammar-word adjective">meritas</span> <span class="grammar-word verb">luet</span> <span class="grammar-word subject">vicinia</span> <span class="grammar-word object">poenas</span><br><span class="grammar-word adjective">impia</span>',
        legend: [
            { type: 'adjective', label: 'Adjectives (deserved / wicked)' },
            { type: 'subject', label: 'Subject (neighbourhood)' },
            { type: 'verb', label: 'Verb (will pay)' },
            { type: 'object', label: 'Object (punishments)' }
        ],
        explanation: 'Look at the enclosing order: <strong>deserved</strong> punishment wraps around the <strong>wicked neighbourhood</strong> that will pay it. The guilt is linguistically trapped, just as the neighbourhood will soon be physically trapped by the flood. The word order foreshadows divine justice.'
    },
    {
        title: "Line-Framing Structure (Line 40)",
        section: "4a",
        latin: '<span class="grammar-word object">veniam</span> <span class="grammar-word prep-phrase">dapibus</span> <span class="grammar-word prep-phrase">nullisque paratibus</span> <span class="grammar-word verb">orant</span>',
        legend: [
            { type: 'object', label: 'Object (pardon)' },
            { type: 'prep-phrase', label: 'Ablative phrases (for feast, for lack of preparations)' },
            { type: 'verb', label: 'Verb (they beg)' }
        ],
        explanation: '<strong>Veniam</strong> (pardon) at the start and <strong>orant</strong> (they beg) at the end frame the entire line, creating emphasis on their apology. The structure wraps around what they\'re apologising for, making the plea itself structurally prominent.'
    },
    {
        title: "Sound Pattern: Rhyming Ablatives (Line 40)",
        section: "4a",
        latin: '<span class="grammar-word object">veniam</span> <span class="grammar-word prep-phrase" style="background: rgba(245, 158, 11, 0.3);">dapibus</span> <span class="grammar-word prep-phrase" style="background: rgba(245, 158, 11, 0.3);">nullisque paratibus</span> <span class="grammar-word verb">orant</span>',
        legend: [
            { type: 'prep-phrase', label: 'Rhyming ablative endings -ibus (highlighted)' }
        ],
        explanation: 'The rhyming endings <strong>-ibus...-ibus</strong> create a sound pattern that links the two sources of shame: their meagre food AND their lack of preparations. The matching sounds emphasise that both failings weigh equally on their conscience. The rhyme makes the line feel deliberate, considered.'
    },
    {
        title: "Temporal Juxtaposition (Line 44)",
        section: "4b",
        latin: '<span class="grammar-word verb">eludit</span><span class="grammar-word adverb" style="background: rgba(139, 92, 246, 0.3);">que diu</span> <span class="grammar-word adverb" style="background: rgba(245, 158, 11, 0.3);">tandem</span><span class="grammar-word verb">que</span>',
        legend: [
            { type: 'verb', label: 'Verbs (evades / and)' },
            { type: 'adverb', label: 'Adverb of duration (for a long time) - purple' },
            { type: 'adverb', label: 'Adverb of conclusion (at last) - orange' }
        ],
        explanation: '<strong>Diu</strong> (for a long time) and <strong>tandem</strong> (at last) are juxtaposed - the text stretches out the chase, then snaps it shut immediately. The comic sequence expands (diu) then contracts (tandem) at the moment of divine revelation. Time stretches in comedy, then collapses at the numinous moment.'
    },
    {
        title: "Emphatic Revelation: Predicate First (Line 46)",
        section: "4b",
        latin: '<span class="grammar-word subject" style="background: rgba(239, 68, 68, 0.3);">di</span> <span class="grammar-word verb">sumus</span>',
        legend: [
            { type: 'subject', label: 'Predicate nominative (gods) - EMPHATIC' },
            { type: 'verb', label: 'Verb (we are)' }
        ],
        explanation: 'Normal Latin would be "sumus di" (we are gods). But Ovid reverses it: <strong>\'DI sumus\'</strong> - "GODS we are!" The predicate nominative comes first for maximum dramatic impact. After 45 lines of mystery, the truth is declared with the most important word at the very front. Thunder-clap revelation.'
    }
];

let currentVisualIndex = 0;
let filteredVisualExamples = [...visualGrammarExamples];

function filterTeachingSection(section) {
    currentTeachingSection = section;
    
    // Update button states
    document.querySelectorAll('#teachingSection .section-btn').forEach(btn => btn.classList.remove('active'));
    if (section === '4a') {
        document.getElementById('teaching4aBtn').classList.add('active');
    } else if (section === '4b') {
        document.getElementById('teaching4bBtn').classList.add('active');
    } else {
        document.getElementById('teachingAllBtn').classList.add('active');
    }
    
    // Filter TPS activities
    if (section === 'all') {
        filteredTPSActivities = [...tpsActivities];
    } else {
        filteredTPSActivities = tpsActivities.filter(activity => activity.section === section);
    }
    
    // Filter visual grammar examples
    if (section === 'all') {
        filteredVisualExamples = [...visualGrammarExamples];
    } else {
        filteredVisualExamples = visualGrammarExamples.filter(example => example.section === section);
    }
    
    // Reset to first item and display
    currentTPSIndex = 0;
    currentVisualIndex = 0;
    displayTPS(0);
    displayVisual(0);
    
    // Update navigation dots visibility
    updateTPSNavigation();
    updateVisualNavigation();
}

function updateTPSNavigation() {
    const dotsContainer = document.querySelector('#tpsActivity .tps-nav-dot').parentElement;
    dotsContainer.innerHTML = '';
    filteredTPSActivities.forEach((_, index) => {
        const dot = document.createElement('span');
        dot.className = 'tps-nav-dot';
        dot.dataset.index = index;
        dotsContainer.appendChild(dot);
    });
}

function updateVisualNavigation() {
    const dotsContainer = document.querySelector('#visualActivity .visual-nav-dot').parentElement;
    dotsContainer.innerHTML = '';
    filteredVisualExamples.forEach((_, index) => {
        const dot = document.createElement('span');
        dot.className = 'visual-nav-dot';
        dot.dataset.index = index;
        dotsContainer.appendChild(dot);
    });
}

function displayVisual(index) {
    if (filteredVisualExamples.length === 0) return;
    
    const example = filteredVisualExamples[index];
    const content = document.getElementById('visualContent');
    
    // Build legend HTML
    let legendHTML = '';
    example.legend.forEach(item => {
        legendHTML += `
            <div class="legend-item ${item.type}">
                <div class="legend-color"></div>
                <span>${item.label}</span>
            </div>
        `;
    });
    
    content.innerHTML = `
        <div class="visual-latin">
            ${example.latin}
        </div>
        <div class="grammar-legend">
            ${legendHTML}
        </div>
        <p style="text-align: center; margin-top: 1.5rem; font-size: 1rem; color: #4b5563; line-height: 1.6;">
            ${example.explanation}
        </p>
    `;
    
    // Update title and counter
    document.getElementById('visualTitle').textContent = example.title;
    document.getElementById('visualCounter').textContent = `${index + 1} of ${filteredVisualExamples.length}`;
    
    // Update navigation dots
    document.querySelectorAll('.visual-nav-dot').forEach((dot, i) => {
        dot.classList.toggle('active', i === index);
        dot.onclick = () => {
            currentVisualIndex = i;
            displayVisual(i);
        };
    });
    
    // Update button states
    document.getElementById('prevVisualBtn').disabled = (index === 0);
    document.getElementById('nextVisualBtn').disabled = (index === filteredVisualExamples.length - 1);
}

function nextVisual() {
    if (currentVisualIndex < filteredVisualExamples.length - 1) {
        currentVisualIndex++;
        displayVisual(currentVisualIndex);
    }
}

function prevVisual() {
    if (currentVisualIndex > 0) {
        currentVisualIndex--;
        displayVisual(currentVisualIndex);
    }
}
    </script>
</body>
</html>
