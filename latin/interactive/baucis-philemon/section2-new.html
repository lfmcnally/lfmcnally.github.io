<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classicalia - Ovid: Baucis and Philemon</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            display: flex;
        }

        .sidebar {
            width: 260px;
            background: white;
            border-right: 1px solid #e5e7eb;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }

        .logo-section {
            padding: 1.5rem 1.25rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #0066ff 0%, #4d94ff 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.1rem;
        }

        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
        }

        .nav-section {
            padding: 1rem 0.5rem;
        }

        .nav-title {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #9ca3af;
            letter-spacing: 0.05em;
            padding: 0 0.75rem;
            margin-bottom: 0.5rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.625rem 0.75rem;
            margin: 0.125rem 0;
            border-radius: 8px;
            color: #4b5563;
            font-size: 0.9rem;
            transition: all 0.15s ease;
            cursor: pointer;
            user-select: none;
        }

        .nav-item:hover {
            background: #f3f4f6;
            color: #1f2937;
        }

        .nav-item.active {
            background: #eef2ff;
            color: #0066ff;
            font-weight: 500;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .main-content {
            margin-left: 260px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .top-bar {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0.875rem 2rem;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .content-wrapper {
            flex: 1;
            overflow-y: auto;
        }

        .content-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .lesson-header {
            margin-bottom: 2rem;
        }

        .lesson-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .lesson-meta {
            display: flex;
            gap: 1.5rem;
            font-size: 0.875rem;
            color: #6b7280;
        }

        .section-content {
            display: none;
        }

        .section-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            background: white;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            padding: 2rem;
            margin-bottom: 1.5rem;
        }

        .explanation-text {
            font-size: 1.05rem;
            line-height: 1.7;
            color: #4b5563;
            margin-bottom: 1.5rem;
        }

        .key-point {
            background: #eff6ff;
            border-left: 4px solid #0066ff;
            padding: 1rem 1.25rem;
            border-radius: 8px;
            margin: 1.5rem 0;
        }

        .key-point-title {
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .key-point-text {
            color: #1e40af;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* Full Text Latin */
        .latin-text {
            font-size: 1.3rem;
            line-height: 2.4;
            color: #1f2937;
            margin: 1.5rem 0;
            font-family: 'Georgia', 'Times New Roman', serif;
        }

        .latin-line {
            margin-bottom: 0.5rem;
            padding-left: 3rem;
            position: relative;
        }

        .line-number {
            position: absolute;
            left: 0;
            font-size: 0.85rem;
            color: #9ca3af;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            min-width: 2.5rem;
            font-weight: 500;
        }

        .phrase {
            cursor: pointer;
            padding: 3px 6px;
            margin: 0 2px;
            border-radius: 4px;
            transition: all 0.2s ease;
            display: inline;
        }

        .phrase.phrase-1 { background: rgba(76, 175, 80, 0.15); }
        .phrase.phrase-1:hover { background: rgba(76, 175, 80, 0.3); }
        .phrase.phrase-2 { background: rgba(33, 150, 243, 0.15); }
        .phrase.phrase-2:hover { background: rgba(33, 150, 243, 0.3); }
        .phrase.phrase-3 { background: rgba(156, 39, 176, 0.15); }
        .phrase.phrase-3:hover { background: rgba(156, 39, 176, 0.3); }
        .phrase.phrase-4 { background: rgba(255, 152, 0, 0.15); }
        .phrase.phrase-4:hover { background: rgba(255, 152, 0, 0.3); }
        .phrase.phrase-5 { background: rgba(244, 67, 54, 0.15); }
        .phrase.phrase-5:hover { background: rgba(244, 67, 54, 0.3); }
        .phrase.phrase-6 { background: rgba(0, 188, 212, 0.15); }
        .phrase.phrase-6:hover { background: rgba(0, 188, 212, 0.3); }
        .phrase.phrase-7 { background: rgba(76, 175, 80, 0.15); }
        .phrase.phrase-7:hover { background: rgba(76, 175, 80, 0.3); }
        .phrase.phrase-8 { background: rgba(33, 150, 243, 0.15); }
        .phrase.phrase-8:hover { background: rgba(33, 150, 243, 0.3); }
        .phrase.phrase-9 { background: rgba(156, 39, 176, 0.15); }
        .phrase.phrase-9:hover { background: rgba(156, 39, 176, 0.3); }
        .phrase.phrase-10 { background: rgba(255, 152, 0, 0.15); }
        .phrase.phrase-10:hover { background: rgba(255, 152, 0, 0.3); }
        .phrase.phrase-11 { background: rgba(244, 67, 54, 0.15); }
        .phrase.phrase-11:hover { background: rgba(244, 67, 54, 0.3); }
        .phrase.phrase-12 { background: rgba(0, 188, 212, 0.15); }
        .phrase.phrase-12:hover { background: rgba(0, 188, 212, 0.3); }
        .phrase.phrase-13 { background: rgba(76, 175, 80, 0.15); }
        .phrase.phrase-13:hover { background: rgba(76, 175, 80, 0.3); }
        .phrase.phrase-14 { background: rgba(33, 150, 243, 0.15); }
        .phrase.phrase-14:hover { background: rgba(33, 150, 243, 0.3); }

        /* Teaching Sections Layout */
        .teaching-layout {
            display: grid;
            grid-template-columns: 1fr 450px;
            gap: 2rem;
            align-items: start;
        }

        .teaching-latin {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
        }

        .teaching-latin .latin-text {
            font-size: 1.4rem;
            line-height: 2.6;
        }

        .teaching-latin .latin-line {
            padding-left: 0;
        }

        .teaching-latin .line-number {
            position: static;
            display: inline-block;
            margin-right: 1rem;
        }

        .style-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 2rem;
        }

        .style-btn {
            padding: 0.875rem 1.25rem;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            color: #374151;
            cursor: pointer;
            transition: all 0.15s ease;
            text-align: left;
        }

        .style-btn:hover {
            border-color: #0066ff;
            background: #f9fafb;
            color: #0066ff;
        }

        .style-btn.active {
            background: #eef2ff;
            border-color: #0066ff;
            color: #0066ff;
        }

        .analysis-panel {
            background: white;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            padding: 1.5rem;
            min-height: 400px;
        }

        .panel-placeholder {
            text-align: center;
            padding: 3rem 1rem;
            color: #9ca3af;
            font-style: italic;
        }

        .analysis-content {
            display: none;
        }

        .analysis-content.active {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .analysis-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #0066ff;
            margin-bottom: 1.5rem;
        }

        .reveal-section {
            margin-bottom: 1.5rem;
        }

        .reveal-btn {
            width: 100%;
            padding: 0.75rem 1rem;
            background: #0066ff;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .reveal-btn:hover {
            background: #0052cc;
        }

        .reveal-btn.revealed {
            background: #10b981;
        }

        .reveal-content {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #0066ff;
        }

        .reveal-content.visible {
            display: block;
        }

        .reveal-content p {
            font-size: 0.95rem;
            line-height: 1.7;
            color: #4b5563;
            margin-bottom: 0.75rem;
        }

        .reveal-content strong {
            color: #0066ff;
        }

        .highlight-active {
            background: rgba(255, 193, 7, 0.4) !important;
            padding: 3px 6px;
            border-radius: 4px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e5e7eb;
        }

        .nav-btn {
            padding: 0.75rem 1.5rem;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            color: #374151;
            cursor: pointer;
            transition: all 0.15s ease;
            text-decoration: none;
        }

        .nav-btn:hover:not(:disabled) {
            border-color: #0066ff;
            background: #f9fafb;
            color: #0066ff;
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nav-btn.primary {
            background: #0066ff;
            border-color: #0066ff;
            color: white;
        }

        @media (max-width: 1200px) {
            .teaching-layout {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="logo-section">
            <a href="../../index.html" class="logo">
                <div class="logo-icon">C</div>
                <span class="logo-text">Classicalia</span>
            </a>
        </div>

        <nav class="nav-section">
            <div class="nav-title">Lesson Sections</div>
            <div class="nav-item active" data-section="introduction">
                <span class="nav-icon">📖</span>
                <span>Introduction</span>
            </div>
            <div class="nav-item" data-section="full-text">
                <span class="nav-icon">📜</span>
                <span>Full Text</span>
            </div>
            <div class="nav-item" data-section="section1">
                <span class="nav-icon">1️⃣</span>
                <span>Lines 637-641</span>
            </div>
            <div class="nav-item" data-section="section2">
                <span class="nav-icon">2️⃣</span>
                <span>Lines 642-646</span>
            </div>
            <div class="nav-item" data-section="section3">
                <span class="nav-icon">3️⃣</span>
                <span>Lines 647-650</span>
            </div>
            <div class="nav-item" data-section="context">
                <span class="nav-icon">🏛️</span>
                <span>Context</span>
            </div>
        </nav>
    </aside>

    <main class="main-content">
        <div class="top-bar"></div>
        <div class="content-wrapper">
            <div class="content-container">
                <header class="lesson-header">
                    <h1 class="lesson-title">Baucis and Philemon: Welcoming the Gods</h1>
                    <div class="lesson-meta">
                        <span>📕 Ovid Metamorphoses 8.637-650</span>
                        <span>⏱️ 40 min</span>
                        <span>📊 GCSE Latin</span>
                    </div>
                </header>

                <!-- Introduction -->
                <div class="section-content active" id="introduction">
                    <div class="card">
                        <h3 style="color: #0066ff; margin-bottom: 1rem;">Learning Objectives</h3>
                        <p class="explanation-text">
                            In this lesson, you will read how the elderly couple Baucis and Philemon welcome disguised gods into their humble home. You'll explore Ovid's poetic techniques and understand how this story illustrates Roman values.
                        </p>
                    </div>

                    <div class="card">
                        <h3 style="color: #0066ff; margin-bottom: 1rem;">The Story So Far</h3>
                        <p class="explanation-text">
                            Jupiter and Mercury have disguised themselves as mortal travellers to test human hospitality. They've knocked on a thousand doors, but every household has turned them away. Finally, they arrive at the tiny cottage of Baucis and Philemon, an elderly couple who, despite their poverty, welcome the strangers warmly.
                        </p>
                        <div class="key-point">
                            <div class="key-point-title">Why This Passage Matters</div>
                            <div class="key-point-text">
                                This is one of Ovid's most charming stories, showing that virtue and kindness matter more than wealth. The detailed description of domestic life gives us a vivid picture of how ordinary Romans lived.
                            </div>
                        </div>
                    </div>

                    <div class="nav-buttons">
                        <button class="nav-btn" disabled>← Previous</button>
                        <button class="nav-btn primary" onclick="showSection('full-text')">Next: Full Text →</button>
                    </div>
                </div>

                <!-- Full Text -->
                <div class="section-content" id="full-text">
                    <div class="card">
                        <h3 style="color: #0066ff; margin-bottom: 1rem;">Latin Text (Lines 637-650)</h3>
                        <p class="explanation-text">Click on each coloured phrase to see vocabulary, grammar, and translation.</p>
                        <div class="latin-text" id="latinText"></div>
                    </div>

                    <div class="nav-buttons">
                        <button class="nav-btn" onclick="showSection('introduction')">← Previous</button>
                        <button class="nav-btn primary" onclick="showSection('section1')">Next: Lines 637-641 →</button>
                    </div>
                </div>

                <!-- Section 1: Lines 637-641 -->
                <div class="section-content" id="section1">
                    <h3 style="color: #0066ff; margin-bottom: 1.5rem;">Lines 637-641: The Gods Enter</h3>
                    
                    <div class="teaching-layout">
                        <div class="teaching-latin">
                            <div class="latin-text" id="section1Latin"></div>
                            <div class="style-buttons" id="section1Buttons"></div>
                        </div>
                        
                        <div class="analysis-panel" id="section1Panel">
                            <div class="panel-placeholder">
                                Click a style feature button to begin analysis →
                            </div>
                        </div>
                    </div>

                    <div class="nav-buttons">
                        <button class="nav-btn" onclick="showSection('full-text')">← Previous</button>
                        <button class="nav-btn primary" onclick="showSection('section2')">Next: Lines 642-646 →</button>
                    </div>
                </div>

                <!-- Section 2: Lines 642-646 -->
                <div class="section-content" id="section2">
                    <h3 style="color: #0066ff; margin-bottom: 1.5rem;">Lines 642-646: Baucis Revives the Fire</h3>
                    
                    <div class="teaching-layout">
                        <div class="teaching-latin">
                            <div class="latin-text" id="section2Latin"></div>
                            <div class="style-buttons" id="section2Buttons"></div>
                        </div>
                        
                        <div class="analysis-panel" id="section2Panel">
                            <div class="panel-placeholder">
                                Click a style feature button to begin analysis →
                            </div>
                        </div>
                    </div>

                    <div class="nav-buttons">
                        <button class="nav-btn" onclick="showSection('section1')">← Previous</button>
                        <button class="nav-btn primary" onclick="showSection('section3')">Next: Lines 647-650 →</button>
                    </div>
                </div>

                <!-- Section 3: Lines 647-650 -->
                <div class="section-content" id="section3">
                    <h3 style="color: #0066ff; margin-bottom: 1.5rem;">Lines 647-650: Preparing the Meal</h3>
                    
                    <div class="teaching-layout">
                        <div class="teaching-latin">
                            <div class="latin-text" id="section3Latin"></div>
                            <div class="style-buttons" id="section3Buttons"></div>
                        </div>
                        
                        <div class="analysis-panel" id="section3Panel">
                            <div class="panel-placeholder">
                                Click a style feature button to begin analysis →
                            </div>
                        </div>
                    </div>

                    <div class="nav-buttons">
                        <button class="nav-btn" onclick="showSection('section2')">← Previous</button>
                        <button class="nav-btn primary" onclick="showSection('context')">Next: Context →</button>
                    </div>
                </div>

                <!-- Context -->
                <div class="section-content" id="context">
                    <div class="card">
                        <h3 style="color: #0066ff; margin-bottom: 1rem;">Historical and Cultural Context</h3>
                        
                        <p class="explanation-text">
                            <strong>Roman Hospitality:</strong> The Romans took hospitality (<em>hospitalitas</em>) very seriously. Turning away a traveller was considered deeply shameful, especially since you never knew if a stranger might be a god in disguise!
                        </p>

                        <p class="explanation-text">
                            <strong>Humble Living:</strong> Ovid's detailed description shows us how poor rural Romans lived. The contrast between their poverty and their generosity makes the story powerful.
                        </p>

                        <p class="explanation-text">
                            <strong>Fire and Hearth:</strong> The hearth fire was the centre of Roman domestic life. It was sacred to Vesta, goddess of the hearth. Keeping the fire going was an important daily task.
                        </p>

                        <div class="key-point">
                            <div class="key-point-title">The Moral of the Story</div>
                            <div class="key-point-text">
                                This tale teaches that the gods reward genuine kindness regardless of wealth. When the rest of the town is destroyed by flood, Baucis and Philemon are saved and granted their wish to die together. They become trees that grow intertwined.
                            </div>
                        </div>
                    </div>

                    <div class="nav-buttons">
                        <button class="nav-btn" onclick="showSection('section3')">← Previous</button>
                        <button class="nav-btn" disabled>Next →</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Load data file FIRST -->
    <script src="section2-data.js"></script>
    
    <!-- Then load all the functions -->
    <script>
        // Global variable to track highlights
        let currentHighlights = [];

        // Navigation between sections
        function showSection(sectionId) {
            document.querySelectorAll('.section-content').forEach(s => s.classList.remove('active'));
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-section') === sectionId) {
                    item.classList.add('active');
                }
            });
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Load full text with coloured phrases
        function loadFullText() {
            const latinTextEl = document.getElementById('latinText');
            if (!latinTextEl || !window.lessonData) return;
            
            let html = '';
            window.lessonData.fullText.forEach(line => {
                html += `<div class="latin-line"><span class="line-number">${line.number}</span>${line.text}</div>`;
            });
            latinTextEl.innerHTML = html;
        }

        // Show modal for line analysis
        function showLineAnalysis(lineId) {
            const lineIndex = parseInt(lineId.replace('line', '')) - 1;
            const data = window.lessonData.fullText[lineIndex];
            
            let modal = document.getElementById('lineModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'lineModal';
                modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 2rem;';
                modal.onclick = (e) => { if (e.target === modal) modal.style.display = 'none'; };
                document.body.appendChild(modal);
            }
            
            let vocabHTML = data.vocab.map(v => `<p style="margin: 0.5rem 0;">• ${v}</p>`).join('');
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 12px; padding: 2rem; max-width: 600px; max-height: 80vh; overflow-y: auto; position: relative;">
                    <button onclick="document.getElementById('lineModal').style.display='none'" style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #9ca3af;">×</button>
                    <div style="display: inline-block; padding: 0.25rem 0.625rem; background: rgba(0, 102, 255, 0.1); color: #0066ff; border-radius: 4px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; margin-bottom: 1rem;">Line ${data.number}</div>
                    <div style="margin: 1rem 0;">${vocabHTML}</div>
                    <p style="margin: 1rem 0;"><strong style="color: #0066ff;">Grammar:</strong> ${data.grammar}</p>
                    <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #e5e7eb;">
                        <button onclick="this.nextElementSibling.style.display='block'; this.style.display='none';" style="background: #0066ff; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">Reveal Translation</button>
                        <div style="display: none; margin-top: 1rem; padding: 0.75rem; background: rgba(5, 150, 105, 0.05); border-radius: 6px; border-left: 3px solid #059669; color: #047857;">
                            <strong>Translation:</strong> "${data.translation}"
                        </div>
                    </div>
                </div>
            `;
            modal.style.display = 'flex';
        }

        // Load all teaching sections
        function loadTeachingSections() {
            if (!window.lessonData) return;
            
            ['section1', 'section2', 'section3'].forEach(sectionKey => {
                const sectionData = window.lessonData.sections[sectionKey];
                if (!sectionData) return;
                
                // Load Latin text
                const latinEl = document.getElementById(`${sectionKey}Latin`);
                if (latinEl) {
                    let html = '';
                    sectionData.lines.forEach(line => {
                        html += `<div class="latin-line"><span class="line-number">${line.number}</span>${line.text}</div>`;
                    });
                    latinEl.innerHTML = html;
                }
                
                // Load style buttons
                const buttonsEl = document.getElementById(`${sectionKey}Buttons`);
                if (buttonsEl) {
                    let html = '';
                    sectionData.features.forEach(feature => {
                        html += `<button class="style-btn" onclick="showStyleFeature('${sectionKey}', '${feature.id}')">${feature.title}</button>`;
                    });
                    buttonsEl.innerHTML = html;
                }
                
                // Create analysis panels
                const panelEl = document.getElementById(`${sectionKey}Panel`);
                if (panelEl) {
                    sectionData.features.forEach(feature => {
                        const analysisDiv = document.createElement('div');
                        analysisDiv.className = 'analysis-content';
                        analysisDiv.id = `${sectionKey}-${feature.id}`;
                        analysisDiv.innerHTML = `
                            <h3 class="analysis-title">${feature.title}</h3>
                            
                            <div class="reveal-section">
                                <button class="reveal-btn" onclick="toggleReveal('${sectionKey}-${feature.id}-what')">
                                    What is it? <span>▼</span>
                                </button>
                                <div class="reveal-content" id="${sectionKey}-${feature.id}-what">
                                    <p>${feature.whatIsIt}</p>
                                </div>
                            </div>
                            
                            <div class="reveal-section">
                                <button class="reveal-btn" onclick="toggleReveal('${sectionKey}-${feature.id}-why')">
                                    Why does it matter? <span>▼</span>
                                </button>
                                <div class="reveal-content" id="${sectionKey}-${feature.id}-why">
                                    <p>${feature.whyMatters}</p>
                                </div>
                            </div>
                        `;
                        panelEl.appendChild(analysisDiv);
                    });
                }
            });
        }

        // Show style feature with highlighting
        function showStyleFeature(sectionKey, featureId) {
            // Remove previous highlights
            currentHighlights.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.classList.remove('highlight-active');
            });
            currentHighlights = [];
            
            // Update buttons
            document.querySelectorAll(`#${sectionKey}Buttons .style-btn`).forEach(btn => {
                btn.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // Hide placeholder and all panels
            const panelEl = document.getElementById(`${sectionKey}Panel`);
            const placeholder = panelEl.querySelector('.panel-placeholder');
            if (placeholder) placeholder.style.display = 'none';
            
            panelEl.querySelectorAll('.analysis-content').forEach(c => c.classList.remove('active'));
            
            // Show selected panel
            const targetPanel = document.getElementById(`${sectionKey}-${featureId}`);
            if (targetPanel) targetPanel.classList.add('active');
            
            // Highlight words
            const feature = window.lessonData.sections[sectionKey].features.find(f => f.id === featureId);
            if (feature && feature.highlight) {
                feature.highlight.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) {
                        el.classList.add('highlight-active');
                        currentHighlights.push(id);
                    }
                });
            }
        }

        // Toggle reveal sections
        function toggleReveal(contentId) {
            const contentEl = document.getElementById(contentId);
            const button = event.currentTarget;
            
            if (contentEl.classList.contains('visible')) {
                contentEl.classList.remove('visible');
                button.classList.remove('revealed');
            } else {
                contentEl.classList.add('visible');
                button.classList.add('revealed');
            }
        }

        // Setup navigation listeners
        function setupNavigation() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    showSection(this.getAttribute('data-section'));
                });
            });
        }

        // Initialize everything when page loads
        window.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, initializing...');
            console.log('lessonData available:', typeof window.lessonData !== 'undefined');
            
            setupNavigation();
            loadFullText();
            loadTeachingSections();
            
            console.log('Initialization complete');
        });
    </script>
</body>
</html>
