<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mysterium Brumale</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet">
    <style>
        :root {
            --parchment: #f4e4bc;
            --parchment-dark: #e8d5a3;
            --ink: #2c1810;
            --ink-faded: #5c4030;
            --gold: #c9a227;
            --gold-dark: #8b7015;
            --rust: #8b4513;
            --blood: #722f37;
            --shadow: rgba(44, 24, 16, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cormorant Garamond', Georgia, serif;
            background: 
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="4" stitchTiles="stitch"/><feColorMatrix type="saturate" values="0"/></filter></defs><rect width="100" height="100" filter="url(%23noise)" opacity="0.08"/></svg>'),
                linear-gradient(135deg, var(--parchment) 0%, var(--parchment-dark) 50%, var(--parchment) 100%);
            min-height: 100vh;
            color: var(--ink);
            overflow-x: hidden;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 100vh;
        }

        /* Header styling */
        .header {
            text-align: center;
            padding: 2rem 0 3rem;
            border-bottom: 3px double var(--gold);
            margin-bottom: 2rem;
            position: relative;
        }

        .header::before,
        .header::after {
            content: 'â§';
            position: absolute;
            bottom: -0.7rem;
            font-size: 1.5rem;
            color: var(--gold);
            background: var(--parchment);
            padding: 0 0.5rem;
        }

        .header::before { left: 20%; }
        .header::after { right: 20%; }

        .title {
            font-family: 'Cinzel', serif;
            font-size: 3rem;
            font-weight: 700;
            color: var(--blood);
            text-shadow: 2px 2px 0 var(--gold);
            letter-spacing: 0.15em;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            font-size: 1.3rem;
            font-style: italic;
            color: var(--ink-faded);
            letter-spacing: 0.1em;
        }

        /* Story panel */
        .story-panel {
            background: 
                linear-gradient(to right, var(--shadow) 0%, transparent 3%, transparent 97%, var(--shadow) 100%),
                linear-gradient(to bottom, var(--shadow) 0%, transparent 3%, transparent 97%, var(--shadow) 100%),
                var(--parchment);
            border: 2px solid var(--gold-dark);
            border-radius: 4px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: 
                0 4px 20px var(--shadow),
                inset 0 0 60px rgba(201, 162, 39, 0.1);
            position: relative;
        }

        .story-panel::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 1px solid var(--gold);
            border-radius: 2px;
            pointer-events: none;
        }

        /* Character portraits */
        .character-block {
            display: flex;
            gap: 1.5rem;
            margin: 1.5rem 0;
            align-items: flex-start;
        }

        .character-block.reverse {
            flex-direction: row-reverse;
        }

        .portrait-frame {
            flex-shrink: 0;
            width: 100px;
            height: 100px;
            border: 4px solid var(--gold);
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 
                0 4px 15px var(--shadow),
                inset 0 0 20px rgba(0,0,0,0.2);
            background: var(--parchment-dark);
            position: relative;
        }

        .portrait-frame::before {
            content: '';
            position: absolute;
            inset: 3px;
            border: 2px solid var(--gold-dark);
            border-radius: 50%;
            pointer-events: none;
        }

        .portrait-frame img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .portrait-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Cinzel', serif;
            font-size: 2.5rem;
            color: var(--gold-dark);
            background: linear-gradient(145deg, var(--parchment) 0%, var(--parchment-dark) 100%);
        }

        .character-name {
            font-family: 'Cinzel', serif;
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--blood);
            margin-bottom: 0.3rem;
            letter-spacing: 0.05em;
        }

        .speech-bubble {
            flex: 1;
            background: rgba(255, 255, 255, 0.4);
            border: 1px solid var(--gold);
            border-radius: 8px;
            padding: 1rem 1.25rem;
            position: relative;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .speech-bubble::before {
            content: '';
            position: absolute;
            top: 20px;
            width: 0;
            height: 0;
            border: 10px solid transparent;
        }

        .character-block:not(.reverse) .speech-bubble::before {
            left: -20px;
            border-right-color: var(--gold);
        }

        .character-block.reverse .speech-bubble::before {
            right: -20px;
            border-left-color: var(--gold);
        }

        /* Latin text styling */
        .latin {
            font-size: 1.25rem;
            font-style: italic;
            color: var(--ink);
            line-height: 1.6;
            margin-bottom: 0.75rem;
        }

        .translation {
            font-size: 1rem;
            color: var(--ink-faded);
            border-top: 1px dotted var(--gold);
            padding-top: 0.5rem;
            margin-top: 0.5rem;
            display: none;
        }

        .translation.revealed {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .reveal-btn {
            font-family: 'Cormorant Garamond', Georgia, serif;
            font-size: 0.9rem;
            padding: 0.4rem 0.8rem;
            margin-top: 0.5rem;
            background: transparent;
            border: 1px solid var(--gold);
            border-radius: 4px;
            color: var(--gold-dark);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .reveal-btn:hover {
            background: var(--gold);
            color: var(--parchment);
        }

        .reveal-btn.revealed {
            opacity: 0.5;
            cursor: default;
        }

        /* Glossed words */
        .gloss {
            position: relative;
            border-bottom: 1px dotted var(--rust);
            cursor: help;
            color: var(--rust);
        }

        .gloss:hover::after {
            content: attr(data-meaning);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--ink);
            color: var(--parchment);
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            font-size: 0.9rem;
            font-style: normal;
            white-space: nowrap;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        /* Narrative text */
        .narrative {
            font-size: 1.2rem;
            line-height: 1.8;
            text-align: justify;
            margin: 1.5rem 0;
            text-indent: 2rem;
        }

        .narrative:first-of-type::first-letter {
            font-family: 'Cinzel', serif;
            font-size: 3.5rem;
            float: left;
            line-height: 1;
            padding-right: 0.5rem;
            color: var(--blood);
            text-shadow: 1px 1px 0 var(--gold);
        }

        /* Stolen item display */
        .stolen-item {
            text-align: center;
            margin: 2rem 0;
            padding: 1.5rem;
            background: rgba(201, 162, 39, 0.15);
            border: 2px solid var(--gold);
            border-radius: 8px;
        }

        .stolen-item img {
            max-width: 150px;
            max-height: 150px;
            border: 3px solid var(--gold-dark);
            border-radius: 8px;
            box-shadow: 0 4px 15px var(--shadow);
        }

        .stolen-item-placeholder {
            width: 120px;
            height: 120px;
            margin: 0 auto;
            background: var(--parchment-dark);
            border: 3px solid var(--gold-dark);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
        }

        .stolen-item p {
            margin-top: 1rem;
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            color: var(--blood);
        }

        /* Choice buttons */
        .choices {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px solid var(--gold);
        }

        .choices-title {
            font-family: 'Cinzel', serif;
            font-size: 1.2rem;
            color: var(--gold-dark);
            text-align: center;
            margin-bottom: 0.5rem;
            letter-spacing: 0.1em;
        }

        .choice-btn {
            font-family: 'Cormorant Garamond', Georgia, serif;
            font-size: 1.15rem;
            padding: 1rem 1.5rem;
            background: linear-gradient(to bottom, var(--parchment) 0%, var(--parchment-dark) 100%);
            border: 2px solid var(--gold-dark);
            border-radius: 6px;
            color: var(--ink);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .choice-btn::before {
            content: 'â¤';
            margin-right: 0.75rem;
            color: var(--gold-dark);
            transition: transform 0.3s ease;
        }

        .choice-btn:hover {
            background: linear-gradient(to bottom, #fff 0%, var(--parchment) 100%);
            border-color: var(--gold);
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        .choice-btn:hover::before {
            transform: translateX(5px);
            color: var(--blood);
        }

        .choice-btn:active {
            transform: translateX(5px) scale(0.98);
        }

        /* Scene transitions */
        .scene {
            animation: fadeIn 0.6s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Restart button */
        .restart-btn {
            display: block;
            margin: 2rem auto 0;
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            padding: 0.75rem 2rem;
            background: var(--blood);
            border: 2px solid var(--gold);
            border-radius: 6px;
            color: var(--parchment);
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 0.1em;
        }

        .restart-btn:hover {
            background: var(--ink);
            box-shadow: 0 4px 15px var(--shadow);
        }

        .reveal-all-btn {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            font-family: 'Cinzel', serif;
            font-size: 0.85rem;
            padding: 0.6rem 1.2rem;
            background: var(--gold);
            border: 2px solid var(--gold-dark);
            border-radius: 6px;
            color: var(--ink);
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 0.05em;
            box-shadow: 0 4px 15px var(--shadow);
            z-index: 1000;
        }

        .reveal-all-btn:hover {
            background: var(--parchment);
            transform: translateY(-2px);
        }

        /* Decorative elements */
        .divider {
            text-align: center;
            margin: 2rem 0;
            color: var(--gold);
            font-size: 1.5rem;
            letter-spacing: 0.5em;
        }

        .ending-banner {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(to bottom, rgba(201, 162, 39, 0.2), transparent);
            border-radius: 8px;
            margin-top: 1.5rem;
        }

        .ending-banner h2 {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            color: var(--blood);
            margin-bottom: 0.5rem;
        }

        .ending-banner p {
            font-style: italic;
            color: var(--ink-faded);
        }

        /* Responsive */
        @media (max-width: 600px) {
            .title { font-size: 2rem; }
            .character-block { flex-direction: column; align-items: center; text-align: center; }
            .character-block.reverse { flex-direction: column; }
            .speech-bubble::before { display: none; }
            .portrait-frame { width: 80px; height: 80px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">MYSTÄ’RIUM BRÅªMÄ€LE</h1>
            <p class="subtitle">A Midwinter Mystery</p>
        </header>

        <main id="story-container">
            <!-- Story content injected by JavaScript -->
        </main>
    </div>

    <button class="reveal-all-btn" onclick="revealAll()">Reveal All</button>

    <script>
        // Character data with image fallbacks
        const characters = {
            faustus: { name: 'Faustus', initial: 'F', img: 'faustus.png' },
            sabina: { name: 'SabÄ«na', initial: 'S', img: 'sabina.png' },
            rufina: { name: 'RufÄ«na', initial: 'R', img: 'rufina.png' },
            gisco: { name: 'GiscÅ', initial: 'G', img: 'gisco.png' },
            celer: { name: 'Celer', initial: 'C', img: 'celer.png' },
            catia: { name: 'Catia', initial: 'C', img: 'catia.png' }
        };

        // Story scenes
        const scenes = {
            start: {
                content: `
                    <div class="scene">
                        <p class="narrative">
                            It is the night before the Kalendae IÄnuÄriae â€“ the first day of the new year. 
                            Snow falls gently on the streets of Subura. But in Faustus's taberna, something is very wrong...
                        </p>
                        
                        <div class="stolen-item">
                            <div class="stolen-item-placeholder" id="stolen-item-img">ğŸ†</div>
                            <p>patera argentea â€“ a silver offering dish</p>
                        </div>

                        ${characterSpeech('faustus', 
                            '<span class="gloss" data-meaning="where?">ubi</span> est patera mea?! patera <span class="gloss" data-meaning="silver">argentea</span> <span class="gloss" data-meaning="is not">nÅn adest</span>! <span class="gloss" data-meaning="someone">aliquis</span> pateram <span class="gloss" data-meaning="stole">cÄ“pit</span>!',
                            'Where is my dish?! The silver dish is not here! Someone has stolen the dish!'
                        )}

                        <p class="narrative">
                            Faustus is furious. The patera was precious â€“ he planned to use it for the New Year offering to the gods.
                            Now it has vanished. Five people were near the taberna last night. One of them must know something...
                        </p>

                        <div class="divider">â€¢ â€¢ â€¢</div>

                        <div class="choices">
                            <p class="choices-title">Quid facimus? â€“ What shall we do?</p>
                            <button class="choice-btn" onclick="goTo('suspect_gisco')">Question GiscÅ â€“ he was seen near the taberna late last night</button>
                            <button class="choice-btn" onclick="goTo('suspect_celer')">Question Celer â€“ the fastest boy in Subura, quick enough to steal anything</button>
                            <button class="choice-btn" onclick="goTo('suspect_catia')">Question Catia â€“ she knows where Faustus keeps everything</button>
                        </div>
                    </div>
                `,
            },

            suspect_gisco: {
                content: `
                    <div class="scene">
                        <p class="narrative">
                            You find GiscÅ in the street. He looks nervous when you approach him...
                        </p>

                        ${characterSpeech('gisco',
                            'ego <span class="gloss" data-meaning="innocent">innocÄ“ns</span> sum! <span class="gloss" data-meaning="yes, indeed">ita vÄ“rÅ</span>, prope tabernam <span class="gloss" data-meaning="I was">eram</span>... sed <span class="gloss" data-meaning="only">tantum</span> <span class="gloss" data-meaning="I was walking">ambulÄbam</span>. <span class="gloss" data-meaning="nothing">nihil</span> cÄ“pÄ«!',
                            'I am innocent! Yes indeed, I was near the taberna... but I was only walking. I took nothing!'
                        )}

                        ${characterSpeech('gisco',
                            'sed... <span class="gloss" data-meaning="I saw">vÄ«dÄ«</span> SabÄ«nam. SabÄ«na prope tabernam <span class="gloss" data-meaning="at first light">prÄ«mÄ lÅ«ce</span> erat. <span class="gloss" data-meaning="why?">cÅ«r</span>?',
                            'But... I saw SabÄ«na. SabÄ«na was near the taberna at first light. Why?'
                        )}

                        <p class="narrative">
                            Interesting! GiscÅ claims he saw SabÄ«na near the taberna at dawn. But can we trust him? 
                            He might be trying to blame someone else...
                        </p>

                        <div class="divider">â€¢ â€¢ â€¢</div>

                        <div class="choices">
                            <p class="choices-title">Quid nunc? â€“ What now?</p>
                            <button class="choice-btn" onclick="goTo('confront_sabina')">Find SabÄ«na and ask her about this</button>
                            <button class="choice-btn" onclick="goTo('suspect_rufina')">Question RufÄ«na â€“ she argued with Faustus recently</button>
                            <button class="choice-btn" onclick="goTo('search_taberna')">Search the taberna for clues</button>
                        </div>
                    </div>
                `
            },

            suspect_celer: {
                content: `
                    <div class="scene">
                        <p class="narrative">
                            Celer is playing in the street with his friends. He runs over when he sees you...
                        </p>

                        ${characterSpeech('celer',
                            'ego?! <span class="gloss" data-meaning="I did not steal">nÅn fÅ«rÄtus sum</span>! <span class="gloss" data-meaning="I am fast">celer sum</span>, sed <span class="gloss" data-meaning="not a thief">fÅ«r nÅn sum</span>!',
                            'Me?! I did not steal! I am fast, but I am not a thief!'
                        )}

                        ${characterSpeech('celer',
                            '<span class="gloss" data-meaning="but listen">sed audÄ«</span>! <span class="gloss" data-meaning="last night">herÄ« nocte</span>, <span class="gloss" data-meaning="I saw">vÄ«dÄ«</span> SabÄ«nam. SabÄ«na <span class="gloss" data-meaning="something">aliquid</span> <span class="gloss" data-meaning="was carrying">portÄbat</span>. aliquid <span class="gloss" data-meaning="shining">fulgÄ“ns</span>...',
                            'But listen! Last night, I saw SabÄ«na. SabÄ«na was carrying something. Something shining...'
                        )}

                        <p class="narrative">
                            Something shining? Like silver, perhaps? But why would SabÄ«na take the patera?
                            She has always been kind and honest...
                        </p>

                        <div class="divider">â€¢ â€¢ â€¢</div>

                        <div class="choices">
                            <p class="choices-title">Quid nunc? â€“ What now?</p>
                            <button class="choice-btn" onclick="goTo('confront_sabina')">Find SabÄ«na immediately</button>
                            <button class="choice-btn" onclick="goTo('suspect_catia')">Question Catia first â€“ she works in the taberna</button>
                            <button class="choice-btn" onclick="goTo('search_taberna')">Search the taberna for more clues</button>
                        </div>
                    </div>
                `
            },

            suspect_catia: {
                content: `
                    <div class="scene">
                        <p class="narrative">
                            Catia is cleaning nearby. She looks tired and worried...
                        </p>

                        ${characterSpeech('catia',
                            '<span class="gloss" data-meaning="I know">sciÅ</span> <span class="gloss" data-meaning="where">ubi</span> Faustus pateram <span class="gloss" data-meaning="keeps">servat</span>. sed ego <span class="gloss" data-meaning="I did not take">nÅn cÄ“pÄ«</span>! <span class="gloss" data-meaning="I swear">iÅ«rÅ</span>!',
                            'I know where Faustus keeps the dish. But I did not take it! I swear!'
                        )}

                        ${characterSpeech('catia',
                            '<span class="gloss" data-meaning="however">tamen</span>... SabÄ«na <span class="gloss" data-meaning="yesterday">herÄ«</span> <span class="gloss" data-meaning="was asking">rogÄbat</span>: "ubi est patera FaustÄ«?" <span class="gloss" data-meaning="strange">mÄ«rum</span>, <span class="gloss" data-meaning="isn\'t it?">nÅnne</span>?',
                            'However... SabÄ«na yesterday was asking: "where is Faustus\'s dish?" Strange, isn\'t it?'
                        )}

                        <p class="narrative">
                            Three witnesses now point to SabÄ«na! But SabÄ«na has always been trustworthy.
                            What could she possibly want with a silver dish?
                        </p>

                        <div class="divider">â€¢ â€¢ â€¢</div>

                        <div class="choices">
                            <p class="choices-title">Quid nunc? â€“ What now?</p>
                            <button class="choice-btn" onclick="goTo('confront_sabina')">Confront SabÄ«na with this evidence</button>
                            <button class="choice-btn" onclick="goTo('suspect_rufina')">Wait â€“ question RufÄ«na first</button>
                            <button class="choice-btn" onclick="goTo('search_taberna')">Search the taberna before accusing anyone</button>
                        </div>
                    </div>
                `
            },

            suspect_rufina: {
                content: `
                    <div class="scene">
                        <p class="narrative">
                            RufÄ«na is at her home. She does not look pleased to see you...
                        </p>

                        ${characterSpeech('rufina',
                            '<span class="gloss" data-meaning="what do you want?">quid vÄ«s</span>? <span class="gloss" data-meaning="yes">ita</span>, Faustus <span class="gloss" data-meaning="owes">dÄ“bet</span> mihi <span class="gloss" data-meaning="money">pecÅ«niam</span>. sed ego fÅ«r nÅn sum!',
                            'What do you want? Yes, Faustus owes me money. But I am not a thief!'
                        )}

                        ${characterSpeech('rufina',
                            '<span class="gloss" data-meaning="ask">rogÄ</span> SabÄ«nam. ego SabÄ«nam <span class="gloss" data-meaning="this morning">hodiÄ“ mÄne</span> vÄ«dÄ«. SabÄ«na ad <span class="gloss" data-meaning="silversmith">argentÄrium</span> <span class="gloss" data-meaning="was hurrying">festÄ«nÄbat</span>. <span class="gloss" data-meaning="to the silversmith">ad argentÄrium</span>!',
                            'Ask SabÄ«na. I saw SabÄ«na this morning. SabÄ«na was hurrying to the silversmith. To the silversmith!'
                        )}

                        <p class="narrative">
                            The silversmith! Why would SabÄ«na visit a silversmith... unless she had silver to sell?
                            Or perhaps... to have something repaired?
                        </p>

                        <div class="divider">â€¢ â€¢ â€¢</div>

                        <div class="choices">
                            <p class="choices-title">Quid nunc? â€“ What now?</p>
                            <button class="choice-btn" onclick="goTo('confront_sabina')">Find SabÄ«na and demand answers</button>
                            <button class="choice-btn" onclick="goTo('silversmith')">Go to the silversmith first</button>
                        </div>
                    </div>
                `
            },

            search_taberna: {
                content: `
                    <div class="scene">
                        <p class="narrative">
                            You search the taberna carefully. In the corner, you find something...
                        </p>

                        <p class="narrative">
                            A small piece of papyrus! There is writing on it...
                        </p>

                        <div class="stolen-item">
                            <p style="font-size: 1.3rem; font-style: italic; margin: 0;">
                                "patera ad argentÄrium. <span class="gloss" data-meaning="I will return">reddam</span> <span class="gloss" data-meaning="before the Kalends">ante KalendÄs</span>. - S"
                            </p>
                            <p class="translation" id="trans_note" style="margin-top: 1rem; border: none; padding: 0;">
                                "The dish to the silversmith. I will return it before the Kalends. - S"
                            </p>
                            <button class="reveal-btn" onclick="revealTranslation('trans_note', this)">Show Translation</button>
                        </div>

                        <p class="narrative">
                            "S" - for SabÄ«na? This note suggests the dish was taken to be returned!
                            But why? And will it really come back?
                        </p>

                        <div class="divider">â€¢ â€¢ â€¢</div>

                        <div class="choices">
                            <p class="choices-title">Quid nunc? â€“ What now?</p>
                            <button class="choice-btn" onclick="goTo('confront_sabina')">Find SabÄ«na with this evidence</button>
                            <button class="choice-btn" onclick="goTo('silversmith')">Go to the silversmith to verify the story</button>
                        </div>
                    </div>
                `
            },

            silversmith: {
                content: `
                    <div class="scene">
                        <p class="narrative">
                            You arrive at the silversmith's workshop. The argentÄrius looks up from his work...
                        </p>

                        <div class="speech-bubble" style="margin: 1.5rem 0;">
                            <p class="latin" style="margin-bottom: 0;">
                                "<span class="gloss" data-meaning="the dish">patera</span>? <span class="gloss" data-meaning="yes!">ita!</span> <span class="gloss" data-meaning="a woman">fÄ“mina</span> <span class="gloss" data-meaning="brought">attulit</span> pateram. 
                                patera <span class="gloss" data-meaning="broken">fracta</span> erat! ego pateram <span class="gloss" data-meaning="I repaired">refÄ“cÄ«</span>. 
                                <span class="gloss" data-meaning="look!">ecce</span>!"
                            </p>
                            <p class="translation" id="trans_smith">"The dish? Yes! A woman brought the dish. The dish was broken! I repaired the dish. Look!"</p>
                            <button class="reveal-btn" onclick="revealTranslation('trans_smith', this)">Show Translation</button>
                        </div>

                        <p class="narrative">
                            The silversmith shows you the patera. It gleams beautifully â€“ better than before!
                            There is an inscription newly engraved on it...
                        </p>

                        <div class="stolen-item">
                            <p style="font-size: 1.2rem; font-style: italic; margin: 0;">
                                "FAVSTO AMÄªCÅŒ OPTIMÅŒ"
                            </p>
                            <p class="translation" id="trans_inscr1" style="margin-top: 0.5rem; border: none; padding: 0;">
                                "To Faustus, the best friend"
                            </p>
                            <button class="reveal-btn" onclick="revealTranslation('trans_inscr1', this)">Show Translation</button>
                        </div>

                        <div class="divider">â€¢ â€¢ â€¢</div>

                        <div class="choices">
                            <p class="choices-title">Now you understand...</p>
                            <button class="choice-btn" onclick="goTo('revelation')">Return to tell everyone the truth</button>
                        </div>
                    </div>
                `
            },

            confront_sabina: {
                content: `
                    <div class="scene">
                        <p class="narrative">
                            You find SabÄ«na walking back from the Via ArgentÄria â€“ the street of the silversmiths.
                            She is carrying something wrapped in cloth...
                        </p>

                        ${characterSpeech('sabina',
                            '<span class="gloss" data-meaning="wait!">manÄ“</span>! <span class="gloss" data-meaning="I can explain">possum explicÄre</span>! ego pateram <span class="gloss" data-meaning="I did not steal">nÅn fÅ«rÄta sum</span>!',
                            'Wait! I can explain! I did not steal the dish!'
                        )}

                        ${characterSpeech('sabina',
                            'patera <span class="gloss" data-meaning="broken">fracta</span> erat. ego pateram <span class="gloss" data-meaning="I found">invÄ“nÄ«</span> <span class="gloss" data-meaning="on the floor">in pavÄ«mentÅ</span>. Faustus <span class="gloss" data-meaning="will be sad">tristis erit</span>! <span class="gloss" data-meaning="so, therefore">itaque</span> ego pateram ad argentÄrium <span class="gloss" data-meaning="I took">tulÄ«</span>...',
                            'The dish was broken. I found the dish on the floor. Faustus will be sad! So I took the dish to the silversmith...'
                        )}

                        <p class="narrative">
                            SabÄ«na unwraps the cloth. The patera gleams beautifully â€“ repaired and polished!
                            And there is something new engraved on it...
                        </p>

                        <div class="stolen-item">
                            <p style="font-size: 1.2rem; font-style: italic; margin: 0;">
                                "FAVSTO AMÄªCÅŒ OPTIMÅŒ"
                            </p>
                            <p class="translation" id="trans_inscr2" style="margin-top: 0.5rem; border: none; padding: 0;">
                                "To Faustus, the best friend"
                            </p>
                            <button class="reveal-btn" onclick="revealTranslation('trans_inscr2', this)">Show Translation</button>
                        </div>

                        ${characterSpeech('sabina',
                            '<span class="gloss" data-meaning="it is a gift">dÅnum est</span>! <span class="gloss" data-meaning="for the new year">prÅ annÅ novÅ</span>! sed <span class="gloss" data-meaning="now">nunc</span> omnÄ“s <span class="gloss" data-meaning="think">putant</span> mÄ“ fÅ«rem esse...',
                            'It is a gift! For the new year! But now everyone thinks I am a thief...'
                        )}

                        <div class="divider">â€¢ â€¢ â€¢</div>

                        <div class="choices">
                            <p class="choices-title">SabÄ«na looks worried. What do you do?</p>
                            <button class="choice-btn" onclick="goTo('revelation')">Take her to Faustus to explain everything</button>
                        </div>
                    </div>
                `
            },

            revelation: {
                content: `
                    <div class="scene">
                        <p class="narrative">
                            Everyone gathers in the taberna â€“ Faustus, SabÄ«na, GiscÅ, Celer, Catia, and RufÄ«na.
                            SabÄ«na presents the patera to Faustus...
                        </p>

                        ${characterSpeech('sabina',
                            'Fauste, <span class="gloss" data-meaning="forgive me">ignÅsce mihi</span>. patera fracta erat. ego pateram <span class="gloss" data-meaning="secretly">clam</span> ad argentÄrium tulÄ«. <span class="gloss" data-meaning="I wanted">volÄ“bam</span> tibi <span class="gloss" data-meaning="a surprise">rem inopÄ«nÄtam</span> dare...',
                            'Faustus, forgive me. The dish was broken. I secretly took the dish to the silversmith. I wanted to give you a surprise...'
                        )}

                        ${characterSpeech('faustus',
                            'SabÄ«na... tÅ« pateram <span class="gloss" data-meaning="you repaired">refÄ“cistÄ«</span>? <span class="gloss" data-meaning="for me?">mihi</span>?',
                            'SabÄ«na... you repaired the dish? For me?'
                        )}

                        <p class="narrative">
                            Faustus reads the inscription: "FAVSTO AMÄªCÅŒ OPTIMÅŒ" â€“ "To Faustus, the best friend."
                            His eyes fill with tears...
                        </p>

                        ${characterSpeech('faustus',
                            '<span class="gloss" data-meaning="oh!">Å</span>! SabÄ«na, <span class="gloss" data-meaning="thank you">grÄtiÄs tibi agÅ</span>! tÅ« es amÄ«ca <span class="gloss" data-meaning="the best">optima</span>! <span class="gloss" data-meaning="I am sorry">mÄ“ paenitet</span>... ego tÄ“ accÅ«sÄvÄ«...',
                            'Oh! SabÄ«na, thank you! You are the best friend! I am sorry... I accused you...'
                        )}

                        <div class="divider">â§ â§ â§</div>

                        <div class="ending-banner">
                            <h2>MYSTÄ’RIUM SOLÅªTUM EST!</h2>
                            <p>The mystery is solved!</p>
                        </div>

                        <p class="narrative" style="text-indent: 0; text-align: center; margin-top: 1.5rem;">
                            There was no thief â€“ only a friend trying to do something kind.
                            As the new year begins, Faustus makes his offering to the gods with the beautiful restored patera,
                            grateful for the friends who surround him.
                        </p>

                        <p class="narrative" style="text-indent: 0; text-align: center; font-style: italic;">
                            <span class="gloss" data-meaning="happy">fÄ“lÄ«x</span> sit <span class="gloss" data-meaning="new year">annus novus</span>!
                        </p>
                        <p class="translation" id="trans_final" style="text-align: center; border: none; padding: 0; margin-top: 0.5rem;">May the new year be happy!</p>
                        <div style="text-align: center;">
                            <button class="reveal-btn" onclick="revealTranslation('trans_final', this)">Show Translation</button>
                        </div>

                        <button class="restart-btn" onclick="goTo('start')">Lege Iterum â€“ Read Again</button>
                    </div>
                `
            }
        };

        // Helper function to create character speech blocks
        function characterSpeech(charId, latin, translation, reverse = false) {
            const char = characters[charId];
            const id = 'trans_' + Math.random().toString(36).substr(2, 9);
            return `
                <div class="character-block ${reverse ? 'reverse' : ''}">
                    <div class="portrait-frame">
                        <img src="${char.img}" alt="${char.name}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="portrait-placeholder" style="display: none;">${char.initial}</div>
                    </div>
                    <div class="speech-content">
                        <div class="character-name">${char.name}</div>
                        <div class="speech-bubble">
                            <p class="latin">"${latin}"</p>
                            <p class="translation" id="${id}">${translation}</p>
                            <button class="reveal-btn" onclick="revealTranslation('${id}', this)">Show Translation</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Reveal translation function
        function revealTranslation(id, btn) {
            document.getElementById(id).classList.add('revealed');
            btn.classList.add('revealed');
            btn.textContent = 'Translated âœ“';
        }

        // Reveal all translations on page
        function revealAll() {
            document.querySelectorAll('.translation').forEach(el => el.classList.add('revealed'));
            document.querySelectorAll('.reveal-btn').forEach(btn => {
                btn.classList.add('revealed');
                btn.textContent = 'Translated âœ“';
            });
        }

        // Navigation function
        function goTo(sceneId) {
            const container = document.getElementById('story-container');
            container.innerHTML = scenes[sceneId].content;
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // Try to load stolen item image on start scene
            if (sceneId === 'start') {
                const itemImg = document.getElementById('stolen-item-img');
                if (itemImg) {
                    const img = new Image();
                    img.onload = function() {
                        itemImg.innerHTML = '';
                        itemImg.appendChild(img);
                        itemImg.classList.remove('stolen-item-placeholder');
                        itemImg.style.width = 'auto';
                        itemImg.style.height = 'auto';
                    };
                    img.src = 'stolen_item.png';
                    img.alt = 'patera argentea';
                    img.style.maxWidth = '120px';
                    img.style.maxHeight = '120px';
                }
            }
        }

        // Fix portrait placeholders after load
        document.addEventListener('DOMContentLoaded', function() {
            goTo('start');
            
            // Check all images and show placeholders if needed
            setTimeout(() => {
                document.querySelectorAll('.portrait-frame img').forEach(img => {
                    if (!img.complete || img.naturalHeight === 0) {
                        img.style.display = 'none';
                        img.nextElementSibling.style.display = 'flex';
                    }
                });
            }, 100);
        });
    </script>
</body>
</html>
