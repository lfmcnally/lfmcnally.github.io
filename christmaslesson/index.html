<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mysterium Brumale</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet">
    <style>
        :root {
            --parchment: #f4e4bc;
            --parchment-dark: #e8d5a3;
            --ink: #2c1810;
            --ink-faded: #5c4030;
            --gold: #c9a227;
            --gold-dark: #8b7015;
            --rust: #8b4513;
            --blood: #722f37;
            --shadow: rgba(44, 24, 16, 0.3);
            --success: #2d5a27;
            --danger: #8b2020;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cormorant Garamond', Georgia, serif;
            background: 
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="4" stitchTiles="stitch"/><feColorMatrix type="saturate" values="0"/></filter></defs><rect width="100" height="100" filter="url(%23noise)" opacity="0.08"/></svg>'),
                linear-gradient(135deg, var(--parchment) 0%, var(--parchment-dark) 50%, var(--parchment) 100%);
            min-height: 100vh;
            color: var(--ink);
            overflow-x: hidden;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
            padding-top: 1rem;
            min-height: 100vh;
        }

        /* Clue Tracker */
        .clue-tracker {
            background: linear-gradient(to bottom, var(--ink) 0%, #1a0f0a 100%);
            border: 3px solid var(--gold);
            border-radius: 8px;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 20px var(--shadow);
        }

        .clue-tracker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .clue-tracker h3 {
            font-family: 'Cinzel', serif;
            color: var(--gold);
            font-size: 1rem;
            letter-spacing: 0.1em;
        }

        .clue-count {
            background: var(--gold);
            color: var(--ink);
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .clues-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            min-height: 2rem;
        }

        .clue-tag {
            background: rgba(201, 162, 39, 0.2);
            border: 1px solid var(--gold-dark);
            color: var(--parchment);
            padding: 0.3rem 0.7rem;
            border-radius: 4px;
            font-size: 0.85rem;
            animation: clueAppear 0.4s ease;
        }

        .clue-tag.dead-end {
            background: rgba(139, 32, 32, 0.3);
            border-color: var(--danger);
            text-decoration: line-through;
            opacity: 0.7;
        }

        @keyframes clueAppear {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .no-clues {
            color: var(--parchment-dark);
            font-style: italic;
            opacity: 0.6;
        }

        /* Header styling */
        .header {
            text-align: center;
            padding: 1.5rem 0 2rem;
            border-bottom: 3px double var(--gold);
            margin-bottom: 1.5rem;
            position: relative;
        }

        .header::before,
        .header::after {
            content: 'â§';
            position: absolute;
            bottom: -0.7rem;
            font-size: 1.5rem;
            color: var(--gold);
            background: var(--parchment);
            padding: 0 0.5rem;
        }

        .header::before { left: 20%; }
        .header::after { right: 20%; }

        .title {
            font-family: 'Cinzel', serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--blood);
            text-shadow: 2px 2px 0 var(--gold);
            letter-spacing: 0.15em;
            margin-bottom: 0.3rem;
        }

        .subtitle {
            font-size: 1.2rem;
            font-style: italic;
            color: var(--ink-faded);
            letter-spacing: 0.1em;
        }

        /* Character portraits */
        .character-block {
            display: flex;
            gap: 1.5rem;
            margin: 1.5rem 0;
            align-items: flex-start;
        }

        .character-block.reverse {
            flex-direction: row-reverse;
        }

        .portrait-frame {
            flex-shrink: 0;
            width: 90px;
            height: 90px;
            border: 4px solid var(--gold);
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 4px 15px var(--shadow);
            background: var(--parchment-dark);
            position: relative;
        }

        .portrait-frame img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .portrait-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Cinzel', serif;
            font-size: 2.2rem;
            color: var(--gold-dark);
            background: linear-gradient(145deg, var(--parchment) 0%, var(--parchment-dark) 100%);
        }

        .character-name {
            font-family: 'Cinzel', serif;
            font-weight: 600;
            font-size: 1rem;
            color: var(--blood);
            margin-bottom: 0.3rem;
            letter-spacing: 0.05em;
        }

        .speech-bubble {
            flex: 1;
            background: rgba(255, 255, 255, 0.4);
            border: 1px solid var(--gold);
            border-radius: 8px;
            padding: 1rem 1.25rem;
            position: relative;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* Latin text styling */
        .latin {
            font-size: 1.2rem;
            font-style: italic;
            color: var(--ink);
            line-height: 1.6;
        }

        .translation {
            font-size: 0.95rem;
            color: var(--ink-faded);
            border-top: 1px dotted var(--gold);
            padding-top: 0.5rem;
            margin-top: 0.5rem;
            display: none;
        }

        .translation.revealed {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .reveal-btn {
            font-family: 'Cormorant Garamond', Georgia, serif;
            font-size: 0.85rem;
            padding: 0.35rem 0.7rem;
            margin-top: 0.5rem;
            background: transparent;
            border: 1px solid var(--gold);
            border-radius: 4px;
            color: var(--gold-dark);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .reveal-btn:hover {
            background: var(--gold);
            color: var(--parchment);
        }

        .reveal-btn.revealed {
            opacity: 0.5;
            cursor: default;
        }

        /* Glossed words */
        .gloss {
            position: relative;
            border-bottom: 1px dotted var(--rust);
            cursor: help;
            color: var(--rust);
        }

        .gloss:hover::after {
            content: attr(data-meaning);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--ink);
            color: var(--parchment);
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            font-size: 0.85rem;
            font-style: normal;
            white-space: nowrap;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        /* Narrative text */
        .narrative {
            font-size: 1.15rem;
            line-height: 1.7;
            text-align: justify;
            margin: 1.25rem 0;
        }

        .narrative.first-para::first-letter {
            font-family: 'Cinzel', serif;
            font-size: 3.2rem;
            float: left;
            line-height: 1;
            padding-right: 0.5rem;
            color: var(--blood);
            text-shadow: 1px 1px 0 var(--gold);
        }

        /* Discovery box for items/clues found */
        .discovery-box {
            text-align: center;
            margin: 1.5rem 0;
            padding: 1.25rem;
            background: rgba(201, 162, 39, 0.15);
            border: 2px solid var(--gold);
            border-radius: 8px;
        }

        .discovery-box.dead-end {
            background: rgba(139, 32, 32, 0.1);
            border-color: var(--danger);
        }

        .discovery-box img {
            max-width: 120px;
            max-height: 120px;
            border: 3px solid var(--gold-dark);
            border-radius: 8px;
        }

        .discovery-box-placeholder {
            width: 100px;
            height: 100px;
            margin: 0 auto;
            background: var(--parchment-dark);
            border: 3px solid var(--gold-dark);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
        }

        .discovery-box p {
            margin-top: 0.75rem;
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            color: var(--blood);
        }

        .discovery-box .latin-inscription {
            font-size: 1.2rem;
            font-style: italic;
            margin: 0;
            color: var(--ink);
        }

        /* Choice buttons */
        .choices {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1.5rem;
            padding-top: 1.25rem;
            border-top: 2px solid var(--gold);
        }

        .choices-title {
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            color: var(--gold-dark);
            text-align: center;
            margin-bottom: 0.5rem;
            letter-spacing: 0.1em;
        }

        .choice-btn {
            font-family: 'Cormorant Garamond', Georgia, serif;
            font-size: 1.1rem;
            padding: 0.9rem 1.25rem;
            background: linear-gradient(to bottom, var(--parchment) 0%, var(--parchment-dark) 100%);
            border: 2px solid var(--gold-dark);
            border-radius: 6px;
            color: var(--ink);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .choice-btn::before {
            content: 'â¤';
            margin-right: 0.75rem;
            color: var(--gold-dark);
            transition: transform 0.3s ease;
        }

        .choice-btn:hover {
            background: linear-gradient(to bottom, #fff 0%, var(--parchment) 100%);
            border-color: var(--gold);
            transform: translateX(5px);
        }

        .choice-btn.accuse-btn {
            background: linear-gradient(to bottom, #f5e6e6 0%, #e8d0d0 100%);
            border-color: var(--danger);
        }

        .choice-btn.accuse-btn::before {
            content: 'âš–';
            color: var(--danger);
        }

        .choice-btn.accuse-btn:hover {
            background: linear-gradient(to bottom, #fff 0%, #f5e6e6 100%);
        }

        /* Accusation screen */
        .accusation-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .suspect-card {
            background: rgba(255, 255, 255, 0.4);
            border: 2px solid var(--gold);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .suspect-card:hover {
            background: rgba(255, 255, 255, 0.7);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px var(--shadow);
        }

        .suspect-card .portrait-frame {
            width: 70px;
            height: 70px;
            margin: 0 auto 0.5rem;
        }

        .suspect-card .suspect-name {
            font-family: 'Cinzel', serif;
            font-size: 0.95rem;
            color: var(--blood);
        }

        /* Scene transitions */
        .scene {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dead end styling */
        .dead-end-banner {
            background: linear-gradient(to right, transparent, rgba(139, 32, 32, 0.2), transparent);
            border: 1px solid var(--danger);
            border-left: none;
            border-right: none;
            padding: 1rem;
            text-align: center;
            margin: 1.5rem 0;
        }

        .dead-end-banner h3 {
            font-family: 'Cinzel', serif;
            color: var(--danger);
            font-size: 1.2rem;
            letter-spacing: 0.1em;
        }

        .dead-end-banner p {
            color: var(--ink-faded);
            font-style: italic;
            margin-top: 0.3rem;
        }

        /* Ending banner */
        .ending-banner {
            text-align: center;
            padding: 1.5rem;
            background: linear-gradient(to bottom, rgba(201, 162, 39, 0.2), transparent);
            border-radius: 8px;
            margin-top: 1.25rem;
        }

        .ending-banner h2 {
            font-family: 'Cinzel', serif;
            font-size: 1.6rem;
            color: var(--blood);
            margin-bottom: 0.3rem;
        }

        .ending-banner p {
            font-style: italic;
            color: var(--ink-faded);
        }

        /* Restart button */
        .restart-btn {
            display: block;
            margin: 1.5rem auto 0;
            font-family: 'Cinzel', serif;
            font-size: 0.95rem;
            padding: 0.7rem 1.75rem;
            background: var(--blood);
            border: 2px solid var(--gold);
            border-radius: 6px;
            color: var(--parchment);
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 0.1em;
        }

        .restart-btn:hover {
            background: var(--ink);
            box-shadow: 0 4px 15px var(--shadow);
        }

        /* Reveal all button */
        .reveal-all-btn {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            font-family: 'Cinzel', serif;
            font-size: 0.8rem;
            padding: 0.5rem 1rem;
            background: var(--gold);
            border: 2px solid var(--gold-dark);
            border-radius: 6px;
            color: var(--ink);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: 0 4px 15px var(--shadow);
        }

        .reveal-all-btn:hover {
            background: var(--parchment);
        }

        .divider {
            text-align: center;
            margin: 1.5rem 0;
            color: var(--gold);
            font-size: 1.3rem;
            letter-spacing: 0.5em;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .title { font-size: 1.8rem; }
            .accusation-grid { grid-template-columns: repeat(2, 1fr); }
            .character-block { flex-direction: column; align-items: center; text-align: center; }
            .portrait-frame { width: 70px; height: 70px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="clue-tracker">
            <div class="clue-tracker-header">
                <h3>ğŸ“œ INDICIAE â€“ CLUES</h3>
                <span class="clue-count" id="clue-count">0</span>
            </div>
            <div class="clues-list" id="clues-list">
                <span class="no-clues">No clues yet...</span>
            </div>
        </div>

        <header class="header">
            <h1 class="title">MYSTÄ’RIUM BRÅªMÄ€LE</h1>
            <p class="subtitle">A Midwinter Mystery</p>
        </header>

        <main id="story-container">
            <!-- Story content injected by JavaScript -->
        </main>
    </div>

    <button class="reveal-all-btn" onclick="revealAll()">Reveal All</button>

    <script>
        // Game state
        let clues = [];
        let deadEnds = [];

        // Character data
        const characters = {
            faustus: { name: 'Faustus', initial: 'F', img: 'faustus.png' },
            sabina: { name: 'SabÄ«na', initial: 'S', img: 'sabina.png' },
            rufina: { name: 'RufÄ«na', initial: 'R', img: 'rufina.png' },
            gisco: { name: 'GiscÅ', initial: 'G', img: 'gisco.png' },
            celer: { name: 'Celer', initial: 'C', img: 'celer.png' },
            catia: { name: 'Catia', initial: 'Ca', img: 'catia.png' }
        };

        // Add a clue
        function addClue(clueText) {
            if (!clues.includes(clueText) && !deadEnds.includes(clueText)) {
                clues.push(clueText);
                updateClueDisplay();
            }
        }

        // Mark a clue as dead end
        function markDeadEnd(clueText) {
            if (!deadEnds.includes(clueText)) {
                deadEnds.push(clueText);
                // Remove from active clues if present
                clues = clues.filter(c => c !== clueText);
                updateClueDisplay();
            }
        }

        // Update clue display
        function updateClueDisplay() {
            const list = document.getElementById('clues-list');
            const count = document.getElementById('clue-count');
            
            if (clues.length === 0 && deadEnds.length === 0) {
                list.innerHTML = '<span class="no-clues">No clues yet...</span>';
                count.textContent = '0';
                return;
            }

            let html = '';
            clues.forEach(c => {
                html += `<span class="clue-tag">${c}</span>`;
            });
            deadEnds.forEach(c => {
                html += `<span class="clue-tag dead-end">${c}</span>`;
            });
            
            list.innerHTML = html;
            count.textContent = clues.length;
        }

        // Reset game
        function resetGame() {
            clues = [];
            deadEnds = [];
            updateClueDisplay();
            goTo('start');
        }

        // Story scenes
        const scenes = {
            start: {
                content: `
                    <div class="scene">
                        <p class="narrative first-para">
                            It is the night before the Kalendae IÄnuÄriae â€“ the first day of the new year. 
                            Snow falls gently on the streets of Subura. But in Faustus's taberna, something is terribly wrong...
                        </p>
                        
                        <div class="discovery-box">
                            <div class="discovery-box-placeholder" id="stolen-item-img">ğŸ†</div>
                            <p>patera argentea â€“ a silver offering dish<br><em>MISSING!</em></p>
                        </div>

                        ${characterSpeech('faustus', 
                            '<span class="gloss" data-meaning="where?">ubi</span> est patera mea?! patera <span class="gloss" data-meaning="silver">argentea</span> <span class="gloss" data-meaning="is not here">nÅn adest</span>! <span class="gloss" data-meaning="someone">aliquis</span> pateram <span class="gloss" data-meaning="took/stole">cÄ“pit</span>!',
                            'Where is my dish?! The silver dish is not here! Someone has taken the dish!'
                        )}

                        <p class="narrative">
                            Faustus is furious. The patera was precious â€“ he planned to use it for the New Year offering to the gods.
                            Five people were near the taberna last night. One of them must know something...
                        </p>

                        <div class="divider">â€¢ â€¢ â€¢</div>

                        <div class="choices">
                            <p class="choices-title">Quid facimus? â€“ What shall we do?</p>
                            <button class="choice-btn" onclick="goTo('suspect_gisco')">Question GiscÅ â€“ he was seen near the taberna late at night</button>
                            <button class="choice-btn" onclick="goTo('suspect_celer')">Question Celer â€“ the fastest boy in Subura</button>
                            <button class="choice-btn" onclick="goTo('suspect_catia')">Question Catia â€“ she works in the taberna</button>
                        </div>
                    </div>
                `
            },

            suspect_gisco: {
                onEnter: () => addClue('GiscÅ was near taberna'),
                content: `
                    <div class="scene">
                        <p class="narrative first-para">
                            You find GiscÅ in the street. He looks very nervous when he sees you approaching...
                        </p>

                        ${characterSpeech('gisco',
                            'ego <span class="gloss" data-meaning="innocent">innocÄ“ns</span> sum! <span class="gloss" data-meaning="yes, indeed">ita vÄ“rÅ</span>, prope tabernam <span class="gloss" data-meaning="I was">eram</span>... sed <span class="gloss" data-meaning="only">tantum</span> <span class="gloss" data-meaning="I was walking">ambulÄbam</span>. <span class="gloss" data-meaning="nothing">nihil</span> cÄ“pÄ«!',
                            'I am innocent! Yes indeed, I was near the taberna... but I was only walking. I took nothing!'
                        )}

                        ${characterSpeech('gisco',
                            'sed... <span class="gloss" data-meaning="I saw">vÄ«dÄ«</span> SabÄ«nam! SabÄ«na prope tabernam <span class="gloss" data-meaning="at first light">prÄ«mÄ lÅ«ce</span> erat. <span class="gloss" data-meaning="why?">cÅ«r</span>?',
                            'But... I saw SabÄ«na! SabÄ«na was near the taberna at first light. Why?'
                        )}

                        <p class="narrative">
                            Interesting! GiscÅ claims he saw SabÄ«na near the taberna at dawn. But can we trust him? 
                            He seems very nervous... perhaps he is hiding something?
                        </p>

                        <div class="divider">â€¢ â€¢ â€¢</div>

                        <div class="choices">
                            <p class="choices-title">Quid nunc? â€“ What now?</p>
                            <button class="choice-btn" onclick="goTo('search_gisco')">Search GiscÅ's home for the patera</button>
                            <button class="choice-btn" onclick="goTo('suspect_rufina')">Question RufÄ«na â€“ she argued with Faustus recently</button>
                            <button class="choice-btn" onclick="goTo('accusation')">Make an accusation!</button>
                        </div>
                    </div>
                `
            },

            search_gisco: {
                onEnter: () => { markDeadEnd('GiscÅ was near taberna'); addClue('GiscÅ writes poetry'); },
                content: `
                    <div class="scene">
                        <p class="narrative first-para">
                            You search GiscÅ's small room carefully. Under his bed, you find... a pile of wax tablets!
                        </p>

                        <div class="discovery-box dead-end">
                            <div class="discovery-box-placeholder">ğŸ“</div>
                            <p>Poetry tablets... not the patera!</p>
                        </div>

                        <p class="narrative">
                            The tablets are covered in writing. You read one of them...
                        </p>

                        <div class="discovery-box">
                            <p class="latin-inscription">
                                "<span class="gloss" data-meaning="O Livia!">Å Livia</span>! <span class="gloss" data-meaning="eyes">oculÄ«</span> tuÄ« sunt <span class="gloss" data-meaning="like stars">sÄ«cut stellae</span>..."
                            </p>
                            <p class="translation" id="trans_poem">"O Livia! Your eyes are like stars..."</p>
                            <button class="reveal-btn" onclick="revealTranslation('trans_poem', this)">Show Translation</button>
                        </div>

                        ${characterSpeech('gisco',
                            '<span class="gloss" data-meaning="no!">minimÄ“</span>! <span class="gloss" data-meaning="don\'t read!">nÅlÄ« legere</span>! <span class="gloss" data-meaning="that is">id est</span>... <span class="gloss" data-meaning="private">sÄ“crÄ“tum</span>!',
                            'No! Don\'t read that! That is... private!'
                        )}

                        <p class="narrative">
                            GiscÅ's face turns bright red. He has been writing love poetry to a girl called Livia!
                            That explains why he was walking near the taberna at night â€“ Livia lives nearby!
                            But there is no patera here. This was a dead end.
                        </p>

                        <div class="dead-end-banner">
                            <h3>VIA CLAUSA â€“ DEAD END</h3>
                            <p>GiscÅ is innocent... just embarrassed!</p>
                        </div>

                        <div class="choices">
                            <p class="choices-title">Quid nunc? â€“ What now?</p>
                            <button class="choice-btn" onclick="goTo('suspect_celer')">Question Celer</button>
                            <button class="choice-btn" onclick="goTo('suspect_rufina')">Question RufÄ«na</button>
                            <button class="choice-btn" onclick="goTo('suspect_catia')">Question Catia</button>
                        </div>
                    </div>
                `
            },

            suspect_celer: {
                onEnter: () => addClue('SabÄ«na carried something shiny'),
                content: `
                    <div class="scene">
                        <p class="narrative first-para">
                            Celer is playing knucklebones in the street with his friends. He runs over eagerly when he sees you...
                        </p>

                        ${characterSpeech('celer',
                            'ego?! <span class="gloss" data-meaning="I did not steal">nÅn fÅ«rÄtus sum</span>! <span class="gloss" data-meaning="I am fast">celer sum</span>, sed <span class="gloss" data-meaning="a thief">fÅ«r</span> nÅn sum!',
                            'Me?! I did not steal! I am fast, but I am not a thief!'
                        )}

                        ${characterSpeech('celer',
                            '<span class="gloss" data-meaning="but listen!">sed audÄ«</span>! <span class="gloss" data-meaning="last night">herÄ« nocte</span>, ego SabÄ«nam <span class="gloss" data-meaning="I saw">vÄ«dÄ«</span>. SabÄ«na <span class="gloss" data-meaning="something">aliquid</span> <span class="gloss" data-meaning="was carrying">portÄbat</span>. aliquid <span class="gloss" data-meaning="shining">fulgÄ“ns</span>...',
                            'But listen! Last night, I saw SabÄ«na. SabÄ«na was carrying something. Something shining...'
                        )}

                        <p class="narrative">
                            Something shining? Like silver, perhaps? But why would kind SabÄ«na take the patera?
                            Celer seems excited to help with the mystery...
                        </p>

                        <div class="divider">â€¢ â€¢ â€¢</div>

                        <div class="choices">
                            <p class="choices-title">Quid nunc? â€“ What now?</p>
                            <button class="choice-btn" onclick="goTo('search_celer')">Search Celer's secret hiding spot</button>
                            <button class="choice-btn" onclick="goTo('suspect_catia')">Question Catia â€“ she works in the taberna</button>
                            <button class="choice-btn" onclick="goTo('accusation')">Make an accusation!</button>
                        </div>
                    </div>
                `
            },

            search_celer: {
                onEnter: () => markDeadEnd('Celer\'s hiding spot'),
                content: `
                    <div class="scene">
                        <p class="narrative first-para">
                            Celer takes you to his "secret" hiding spot behind the old wall. He shows you his treasures proudly...
                        </p>

                        <div class="discovery-box dead-end">
                            <div class="discovery-box-placeholder">ğŸ²</div>
                            <p>A boy's treasures... no silver dish!</p>
                        </div>

                        ${characterSpeech('celer',
                            '<span class="gloss" data-meaning="look!">ecce</span>! <span class="gloss" data-meaning="my treasures">thÄ“saurÄ« meÄ«</span>! <span class="gloss" data-meaning="dice">tÄlÄ«</span>... <span class="gloss" data-meaning="a knife">culter</span>... <span class="gloss" data-meaning="a beetle">scarabaeus</span> <span class="gloss" data-meaning="dead">mortuus</span>... <span class="gloss" data-meaning="beautiful">pulchra</span>, <span class="gloss" data-meaning="aren\'t they?">nÅnne</span>?',
                            'Look! My treasures! Dice... a knife... a dead beetle... beautiful, aren\'t they?'
                        )}

                        <p class="narrative">
                            Celer's "treasures" are just the things a boy collects: dice, a chipped old knife, some interesting stones, 
                            and yes... a very dead beetle. There is no silver patera here. Celer is not the thief.
                        </p>

                        <div class="dead-end-banner">
                            <h3>VIA CLAUSA â€“ DEAD END</h3>
                            <p>Celer is innocent... just a collector of strange things!</p>
                        </div>

                        <div class="choices">
                            <p class="choices-title">Quid nunc? â€“ What now?</p>
                            <button class="choice-btn" onclick="goTo('suspect_gisco')">Question GiscÅ</button>
                            <button class="choice-btn" onclick="goTo('suspect_rufina')">Question RufÄ«na</button>
                            <button class="choice-btn" onclick="goTo('suspect_catia')">Question Catia</button>
                        </div>
                    </div>
                `
            },

            suspect_catia: {
                onEnter: () => addClue('SabÄ«na asked about patera'),
                content: `
                    <div class="scene">
                        <p class="narrative first-para">
                            Catia is sweeping near the fountain. She looks tired and worried when you approach...
                        </p>

                        ${characterSpeech('catia',
                            '<span class="gloss" data-meaning="I know">sciÅ</span> <span class="gloss" data-meaning="where">ubi</span> Faustus pateram <span class="gloss" data-meaning="keeps">servat</span>. sed ego pateram <span class="gloss" data-meaning="I did not take">nÅn cÄ“pÄ«</span>! <span class="gloss" data-meaning="I swear!">iÅ«rÅ</span>!',
                            'I know where Faustus keeps the dish. But I did not take the dish! I swear!'
                        )}

                        ${characterSpeech('catia',
                            '<span class="gloss" data-meaning="however">tamen</span>... SabÄ«na <span class="gloss" data-meaning="yesterday">herÄ«</span> <span class="gloss" data-meaning="was asking">rogÄbat</span>: "ubi est patera FaustÄ«?" <span class="gloss" data-meaning="strange">mÄ«rum</span>, <span class="gloss" data-meaning="isn\'t it?">nÅnne</span>?',
                            'However... SabÄ«na yesterday was asking: "where is Faustus\'s dish?" Strange, isn\'t it?'
                        )}

                        <p class="narrative">
                            Another witness pointing to SabÄ«na! But why would SabÄ«na want to know where the patera was kept?
                            What was she planning?
                        </p>

                        <div class="divider">â€¢ â€¢ â€¢</div>

                        <div class="choices">
                            <p class="choices-title">Quid nunc? â€“ What now?</p>
                            <button class="choice-btn" onclick="goTo('search_taberna')">Search the taberna for clues</button>
                            <button class="choice-btn" onclick="goTo('suspect_rufina')">Question RufÄ«na</button>
                            <button class="choice-btn" onclick="goTo('accusation')">Make an accusation!</button>
                        </div>
                    </div>
                `
            },

            suspect_rufina: {
                onEnter: () => addClue('SabÄ«na at silversmith'),
                content: `
                    <div class="scene">
                        <p class="narrative first-para">
                            RufÄ«na is at her doorway, looking unwell. She does not seem pleased to see you...
                        </p>

                        ${characterSpeech('rufina',
                            '<span class="gloss" data-meaning="what do you want?">quid vÄ«s</span>? <span class="gloss" data-meaning="yes">ita</span>, Faustus mihi <span class="gloss" data-meaning="owes">dÄ“bet</span> <span class="gloss" data-meaning="money">pecÅ«niam</span>. sed ego fÅ«r nÅn sum!',
                            'What do you want? Yes, Faustus owes me money. But I am not a thief!'
                        )}

                        ${characterSpeech('rufina',
                            '<span class="gloss" data-meaning="ask">rogÄ</span> SabÄ«nam! ego SabÄ«nam <span class="gloss" data-meaning="this morning">hodiÄ“ mÄne</span> vÄ«dÄ«. SabÄ«na ad <span class="gloss" data-meaning="silversmith">argentÄrium</span> <span class="gloss" data-meaning="was hurrying">festÄ«nÄbat</span>!',
                            'Ask SabÄ«na! I saw SabÄ«na this morning. SabÄ«na was hurrying to the silversmith!'
                        )}

                        <p class="narrative">
                            The silversmith! Why would SabÄ«na visit a silversmith... unless she had silver to sell?
                            Or perhaps... to have something repaired? This is an important clue!
                        </p>

                        <div class="divider">â€¢ â€¢ â€¢</div>

                        <div class="choices">
                            <p class="choices-title">Quid nunc? â€“ What now?</p>
                            <button class="choice-btn" onclick="goTo('search_rufina')">Search RufÄ«na's house first</button>
                            <button class="choice-btn" onclick="goTo('silversmith')">Go directly to the silversmith!</button>
                            <button class="choice-btn" onclick="goTo('accusation')">Make an accusation!</button>
                        </div>
                    </div>
                `
            },

            search_rufina: {
                onEnter: () => { markDeadEnd('RufÄ«na angry with Faustus'); addClue('RufÄ«na was ill'); },
                content: `
                    <div class="scene">
                        <p class="narrative first-para">
                            You look around RufÄ«na's small house. On the table, you see medicine bottles and herbs...
                        </p>

                        <div class="discovery-box dead-end">
                            <div class="discovery-box-placeholder">ğŸµ</div>
                            <p>Medicine and herbs... she has been ill!</p>
                        </div>

                        ${characterSpeech('rufina',
                            '<span class="gloss" data-meaning="I was sick">aegra eram</span>. <span class="gloss" data-meaning="for three days">trÄ“s diÄ“s</span> <span class="gloss" data-meaning="in bed">in lectÅ</span> <span class="gloss" data-meaning="I lay">iacÄ“bam</span>. <span class="gloss" data-meaning="I couldn\'t">nÅn poteram</span> <span class="gloss" data-meaning="steal anything">quidquam fÅ«rÄrÄ«</span>!',
                            'I was sick. For three days I lay in bed. I couldn\'t steal anything!'
                        )}

                        <p class="narrative">
                            RufÄ«na has been ill â€“ that explains why she looked unwell and seemed irritable.
                            She couldn't have stolen the patera. But her tip about the silversmith is very useful...
                        </p>

                        <div class="dead-end-banner">
                            <h3>VIA CLAUSA â€“ DEAD END</h3>
                            <p>RufÄ«na is innocent... just unwell!</p>
                        </div>

                        <div class="choices">
                            <p class="choices-title">Quid nunc? â€“ What now?</p>
                            <button class="choice-btn" onclick="goTo('silversmith')">Go to the silversmith!</button>
                            <button class="choice-btn" onclick="goTo('search_taberna')">Search the taberna first</button>
                            <button class="choice-btn" onclick="goTo('accusation')">Make an accusation!</button>
                        </div>
                    </div>
                `
            },

            search_taberna: {
                onEnter: () => addClue('Note signed "S"'),
                content: `
                    <div class="scene">
                        <p class="narrative first-para">
                            You search the taberna carefully, looking in every corner. Behind a broken amphora, you find something...
                        </p>

                        <p class="narrative">
                            A small piece of papyrus! There is writing on it...
                        </p>

                        <div class="discovery-box">
                            <p class="latin-inscription">
                                "patera ad argentÄrium. <span class="gloss" data-meaning="I will return it">reddam</span> <span class="gloss" data-meaning="before the Kalends">ante KalendÄs</span>. - S"
                            </p>
                            <p class="translation" id="trans_note">"The dish to the silversmith. I will return it before the Kalends. - S"</p>
                            <button class="reveal-btn" onclick="revealTranslation('trans_note', this)">Show Translation</button>
                        </div>

                        <p class="narrative">
                            "S" â€“ for SabÄ«na? This note says the dish will be returned before the Kalends!
                            So it wasn't stolen... it was borrowed? But why?
                        </p>

                        <div class="divider">â€¢ â€¢ â€¢</div>

                        <div class="choices">
                            <p class="choices-title">Quid nunc? â€“ What now?</p>
                            <button class="choice-btn" onclick="goTo('silversmith')">Go to the silversmith to find out!</button>
                            <button class="choice-btn" onclick="goTo('accusation')">Make an accusation!</button>
                        </div>
                    </div>
                `
            },

            accusation: {
                content: `
                    <div class="scene">
                        <p class="narrative first-para">
                            Faustus gathers everyone together. It is time to make an accusation.
                            Who took the patera?
                        </p>

                        <p class="narrative" style="text-align: center; font-style: italic;">
                            <strong>Choose carefully!</strong> If you accuse the wrong person, they will be angry...
                        </p>

                        <div class="accusation-grid">
                            <div class="suspect-card" onclick="goTo('accuse_gisco')">
                                <div class="portrait-frame">
                                    <img src="gisco.png" alt="GiscÅ" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                    <div class="portrait-placeholder" style="display: none;">G</div>
                                </div>
                                <div class="suspect-name">GiscÅ</div>
                            </div>
                            <div class="suspect-card" onclick="goTo('accuse_celer')">
                                <div class="portrait-frame">
                                    <img src="celer.png" alt="Celer" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                    <div class="portrait-placeholder" style="display: none;">C</div>
                                </div>
                                <div class="suspect-name">Celer</div>
                            </div>
                            <div class="suspect-card" onclick="goTo('accuse_catia')">
                                <div class="portrait-frame">
                                    <img src="catia.png" alt="Catia" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                    <div class="portrait-placeholder" style="display: none;">Ca</div>
                                </div>
                                <div class="suspect-name">Catia</div>
                            </div>
                            <div class="suspect-card" onclick="goTo('accuse_rufina')">
                                <div class="portrait-frame">
                                    <img src="rufina.png" alt="RufÄ«na" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                    <div class="portrait-placeholder" style="display: none;">R</div>
                                </div>
                                <div class="suspect-name">RufÄ«na</div>
                            </div>
                            <div class="suspect-card" onclick="goTo('accuse_sabina')">
                                <div class="portrait-frame">
                                    <img src="sabina.png" alt="SabÄ«na" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                    <div class="portrait-placeholder" style="display: none;">S</div>
                                </div>
                                <div class="suspect-name">SabÄ«na</div>
                            </div>
                            <div class="suspect-card" onclick="goTo('accuse_nobody')">
                                <div class="portrait-frame">
                                    <div class="portrait-placeholder">?</div>
                                </div>
                                <div class="suspect-name">Nobody</div>
                            </div>
                        </div>

                        <div class="choices">
                            <button class="choice-btn" onclick="goTo('search_taberna')">Wait â€“ search for more clues first</button>
                        </div>
                    </div>
                `
            },

            accuse_gisco: {
                content: `
                    <div class="scene">
                        ${characterSpeech('gisco',
                            '<span class="gloss" data-meaning="what?!">quid?!</span> ego?! <span class="gloss" data-meaning="I am not a thief!">fÅ«r nÅn sum</span>! ego <span class="gloss" data-meaning="only">tantum</span> <span class="gloss" data-meaning="poems">carmina</span> <span class="gloss" data-meaning="I write">scrÄ«bÅ</span>!',
                            'What?! Me?! I am not a thief! I only write poems!'
                        )}

                        ${characterSpeech('faustus',
                            '<span class="gloss" data-meaning="poems?">carmina</span>? <span class="gloss" data-meaning="what poems?">quae carmina</span>?',
                            'Poems? What poems?'
                        )}

                        <p class="narrative">
                            GiscÅ turns bright red and runs away. Everyone laughs. 
                            But you still haven't found the patera... perhaps GiscÅ was not the thief after all.
                        </p>

                        <div class="dead-end-banner">
                            <h3>ACCÅªSÄ€TIÅŒ FALSA â€“ WRONG ACCUSATION</h3>
                            <p>GiscÅ is embarrassed but innocent!</p>
                        </div>

                        <div class="choices">
                            <button class="choice-btn" onclick="goTo('accusation')">Try again â€“ accuse someone else</button>
                            <button class="choice-btn" onclick="goTo('silversmith')">Go to the silversmith instead</button>
                        </div>
                    </div>
                `
            },

            accuse_celer: {
                content: `
                    <div class="scene">
                        ${characterSpeech('celer',
                            '<span class="gloss" data-meaning="no!">minimÄ“</span>! <span class="gloss" data-meaning="I didn\'t take it!">nÅn cÄ“pÄ«</span>! <span class="gloss" data-meaning="I\'m just fast">modo celer sum</span>, <span class="gloss" data-meaning="not a thief">nÅn fÅ«r</span>!',
                            'No! I didn\'t take it! I\'m just fast, not a thief!'
                        )}

                        <p class="narrative">
                            Celer looks like he might cry. His mother comes out and glares at you angrily.
                            This was clearly a mistake â€“ Celer is just a boy.
                        </p>

                        <div class="dead-end-banner">
                            <h3>ACCÅªSÄ€TIÅŒ FALSA â€“ WRONG ACCUSATION</h3>
                            <p>Celer is upset but innocent!</p>
                        </div>

                        <div class="choices">
                            <button class="choice-btn" onclick="goTo('accusation')">Try again â€“ accuse someone else</button>
                            <button class="choice-btn" onclick="goTo('silversmith')">Go to the silversmith instead</button>
                        </div>
                    </div>
                `
            },

            accuse_catia: {
                content: `
                    <div class="scene">
                        ${characterSpeech('catia',
                            '<span class="gloss" data-meaning="how dare you!">quÅmodo audÄ“s</span>?! ego <span class="gloss" data-meaning="for Faustus">prÅ FaustÅ</span> <span class="gloss" data-meaning="I work">labÅrÅ</span>! <span class="gloss" data-meaning="I am honest">proba sum</span>!',
                            'How dare you?! I work for Faustus! I am honest!'
                        )}

                        ${characterSpeech('faustus',
                            '<span class="gloss" data-meaning="it\'s true">vÄ“rum est</span>. Catia <span class="gloss" data-meaning="is a good worker">bona ministra est</span>. <span class="gloss" data-meaning="she wouldn\'t steal">nÅn fÅ«rÄrÄ“tur</span>.',
                            'It\'s true. Catia is a good worker. She wouldn\'t steal.'
                        )}

                        <p class="narrative">
                            Catia is furious and storms off. Faustus looks disappointed in you.
                            You need to find the real answer...
                        </p>

                        <div class="dead-end-banner">
                            <h3>ACCÅªSÄ€TIÅŒ FALSA â€“ WRONG ACCUSATION</h3>
                            <p>Catia is angry but innocent!</p>
                        </div>

                        <div class="choices">
                            <button class="choice-btn" onclick="goTo('accusation')">Try again â€“ accuse someone else</button>
                            <button class="choice-btn" onclick="goTo('silversmith')">Go to the silversmith instead</button>
                        </div>
                    </div>
                `
            },

            accuse_rufina: {
                content: `
                    <div class="scene">
                        ${characterSpeech('rufina',
                            '<span class="gloss" data-meaning="I was sick!">aegra eram</span>! <span class="gloss" data-meaning="in bed!">in lectÅ</span>! <span class="gloss" data-meaning="ask anyone!">rogÄ quemvÄ«s</span>!',
                            'I was sick! In bed! Ask anyone!'
                        )}

                        <p class="narrative">
                            Several neighbours confirm that RufÄ«na has been ill for days.
                            She couldn't have taken the patera. You've made a mistake...
                        </p>

                        <div class="dead-end-banner">
                            <h3>ACCÅªSÄ€TIÅŒ FALSA â€“ WRONG ACCUSATION</h3>
                            <p>RufÄ«na is offended but innocent!</p>
                        </div>

                        <div class="choices">
                            <button class="choice-btn" onclick="goTo('accusation')">Try again â€“ accuse someone else</button>
                            <button class="choice-btn" onclick="goTo('silversmith')">Go to the silversmith instead</button>
                        </div>
                    </div>
                `
            },

            accuse_nobody: {
                content: `
                    <div class="scene">
                        ${characterSpeech('faustus',
                            '<span class="gloss" data-meaning="nobody?">nÄ“mÅ</span>? sed patera <span class="gloss" data-meaning="is missing!">abest</span>! <span class="gloss" data-meaning="someone">aliquis</span> <span class="gloss" data-meaning="must have taken it">cÄ“pit</span>!',
                            'Nobody? But the dish is missing! Someone must have taken it!'
                        )}

                        <p class="narrative">
                            Perhaps you're right that none of these people are thieves... but then where is the patera?
                            Maybe you need to investigate somewhere else...
                        </p>

                        <div class="choices">
                            <button class="choice-btn" onclick="goTo('silversmith')">Go to the silversmith â€“ follow the clues!</button>
                            <button class="choice-btn" onclick="goTo('search_taberna')">Search the taberna again</button>
                        </div>
                    </div>
                `
            },

            accuse_sabina: {
                content: `
                    <div class="scene">
                        <p class="narrative first-para">
                            You turn to accuse SabÄ«na, but before you can speak, she steps forward...
                        </p>

                        ${characterSpeech('sabina',
                            '<span class="gloss" data-meaning="wait!">manÄ“</span>! <span class="gloss" data-meaning="before you speak">antequam dÄ«cÄs</span>... <span class="gloss" data-meaning="I can explain">possum explicÄre</span>. <span class="gloss" data-meaning="I have">habeÅ</span> pateram.',
                            'Wait! Before you speak... I can explain. I have the dish.'
                        )}

                        <p class="narrative">
                            Everyone gasps! SabÄ«na reaches into her bag and pulls out something wrapped in cloth...
                        </p>

                        <div class="choices">
                            <button class="choice-btn" onclick="goTo('revelation')">Listen to SabÄ«na's explanation</button>
                        </div>
                    </div>
                `
            },

            silversmith: {
                onEnter: () => addClue('Patera was broken!'),
                content: `
                    <div class="scene">
                        <p class="narrative first-para">
                            You arrive at the silversmith's workshop on the Via ArgentÄria. 
                            The argentÄrius looks up from his work, surprised to see you...
                        </p>

                        <div class="discovery-box">
                            <p class="latin-inscription">
                                "<span class="gloss" data-meaning="the dish?">patera</span>? <span class="gloss" data-meaning="yes!">ita</span>! <span class="gloss" data-meaning="a woman">fÄ“mina</span> <span class="gloss" data-meaning="brought">attulit</span> pateram. patera <span class="gloss" data-meaning="was broken">fracta erat</span>! ego pateram <span class="gloss" data-meaning="I repaired">refÄ“cÄ«</span>. <span class="gloss" data-meaning="look!">ecce</span>!"
                            </p>
                            <p class="translation" id="trans_smith">"The dish? Yes! A woman brought the dish. The dish was broken! I repaired the dish. Look!"</p>
                            <button class="reveal-btn" onclick="revealTranslation('trans_smith', this)">Show Translation</button>
                        </div>

                        <p class="narrative">
                            The silversmith shows you the patera. It gleams beautifully â€“ better than before!
                            And there is something new engraved on it...
                        </p>

                        <div class="discovery-box">
                            <p class="latin-inscription">"FAVSTO AMÄªCÅŒ OPTIMÅŒ"</p>
                            <p class="translation" id="trans_inscr">"To Faustus, the best friend"</p>
                            <button class="reveal-btn" onclick="revealTranslation('trans_inscr', this)">Show Translation</button>
                        </div>

                        <p class="narrative">
                            Now you understand! The patera wasn't stolen â€“ it was taken to be repaired and made beautiful again!
                            But who would do such a kind thing?
                        </p>

                        <div class="choices">
                            <p class="choices-title">Now you know the truth!</p>
                            <button class="choice-btn" onclick="goTo('revelation')">Return to tell everyone</button>
                        </div>
                    </div>
                `
            },

            revelation: {
                content: `
                    <div class="scene">
                        <p class="narrative first-para">
                            Everyone gathers in the taberna â€“ Faustus, SabÄ«na, GiscÅ, Celer, Catia, and RufÄ«na.
                            SabÄ«na steps forward, holding something wrapped in cloth...
                        </p>

                        ${characterSpeech('sabina',
                            'Fauste, <span class="gloss" data-meaning="forgive me">ignÅsce mihi</span>. patera <span class="gloss" data-meaning="was broken">fracta erat</span>. ego pateram <span class="gloss" data-meaning="on the floor">in pavÄ«mentÅ</span> <span class="gloss" data-meaning="I found">invÄ“nÄ«</span>. tÅ« <span class="gloss" data-meaning="would be sad">tristis erÄs</span>!',
                            'Faustus, forgive me. The dish was broken. I found the dish on the floor. You would be sad!'
                        )}

                        ${characterSpeech('sabina',
                            '<span class="gloss" data-meaning="so">itaque</span> ego pateram <span class="gloss" data-meaning="secretly">clam</span> ad argentÄrium <span class="gloss" data-meaning="I took">tulÄ«</span>. <span class="gloss" data-meaning="I wanted">volÄ“bam</span> tibi <span class="gloss" data-meaning="a gift">dÅnum</span> dare... <span class="gloss" data-meaning="a surprise">rem inopÄ«nÄtam</span>!',
                            'So I secretly took the dish to the silversmith. I wanted to give you a gift... a surprise!'
                        )}

                        <p class="narrative">
                            SabÄ«na unwraps the cloth. The patera gleams more beautifully than ever before â€“ 
                            repaired, polished, and with a new inscription: "FAVSTO AMÄªCÅŒ OPTIMÅŒ"
                        </p>

                        ${characterSpeech('faustus',
                            '<span class="gloss" data-meaning="SabÄ«na!">SabÄ«na</span>! tÅ« pateram <span class="gloss" data-meaning="you repaired">refÄ“cistÄ«</span>? <span class="gloss" data-meaning="for me?">mihi</span>? <span class="gloss" data-meaning="oh!">Å</span>! <span class="gloss" data-meaning="thank you!">grÄtiÄs tibi agÅ</span>! <span class="gloss" data-meaning="I am sorry">mÄ“ paenitet</span>...',
                            'SabÄ«na! You repaired the dish? For me? Oh! Thank you! I am sorry...'
                        )}

                        <p class="narrative">
                            Faustus's eyes fill with tears. He embraces SabÄ«na warmly.
                            There was no thief â€“ only a friend trying to do something kind.
                        </p>

                        <div class="divider">â§ â§ â§</div>

                        <div class="ending-banner">
                            <h2>MYSTÄ’RIUM SOLÅªTUM EST!</h2>
                            <p>The mystery is solved!</p>
                        </div>

                        <p class="narrative" style="text-align: center;">
                            As the new year begins, Faustus makes his offering to the gods with the beautiful restored patera,
                            surrounded by friends â€“ the greatest treasure of all.
                        </p>

                        <p class="narrative" style="text-align: center; font-style: italic;">
                            <span class="gloss" data-meaning="happy">fÄ“lÄ«x</span> sit <span class="gloss" data-meaning="new year">annus novus</span>!
                        </p>
                        <p class="translation" id="trans_final" style="text-align: center; border: none; padding: 0;">May the new year be happy!</p>
                        <div style="text-align: center;">
                            <button class="reveal-btn" onclick="revealTranslation('trans_final', this)">Show Translation</button>
                        </div>

                        <button class="restart-btn" onclick="resetGame()">Lege Iterum â€“ Play Again</button>
                    </div>
                `
            }
        };

        // Helper function to create character speech blocks
        function characterSpeech(charId, latin, translation, reverse = false) {
            const char = characters[charId];
            const id = 'trans_' + Math.random().toString(36).substr(2, 9);
            return `
                <div class="character-block ${reverse ? 'reverse' : ''}">
                    <div class="portrait-frame">
                        <img src="${char.img}" alt="${char.name}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="portrait-placeholder" style="display: none;">${char.initial}</div>
                    </div>
                    <div class="speech-content">
                        <div class="character-name">${char.name}</div>
                        <div class="speech-bubble">
                            <p class="latin">"${latin}"</p>
                            <p class="translation" id="${id}">${translation}</p>
                            <button class="reveal-btn" onclick="revealTranslation('${id}', this)">Show Translation</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Reveal translation function
        function revealTranslation(id, btn) {
            document.getElementById(id).classList.add('revealed');
            btn.classList.add('revealed');
            btn.textContent = 'âœ“';
        }

        // Reveal all translations on page
        function revealAll() {
            document.querySelectorAll('.translation').forEach(el => el.classList.add('revealed'));
            document.querySelectorAll('.reveal-btn').forEach(btn => {
                btn.classList.add('revealed');
                btn.textContent = 'âœ“';
            });
        }

        // Navigation function
        function goTo(sceneId) {
            const scene = scenes[sceneId];
            
            // Run onEnter if it exists
            if (scene.onEnter) {
                scene.onEnter();
            }

            const container = document.getElementById('story-container');
            container.innerHTML = scene.content;
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // Fix images
            setTimeout(() => {
                document.querySelectorAll('.portrait-frame img').forEach(img => {
                    if (!img.complete || img.naturalHeight === 0) {
                        img.style.display = 'none';
                        if (img.nextElementSibling) img.nextElementSibling.style.display = 'flex';
                    }
                });
            }, 100);

            // Load stolen item image on start
            if (sceneId === 'start') {
                const itemImg = document.getElementById('stolen-item-img');
                if (itemImg) {
                    const img = new Image();
                    img.onload = function() {
                        itemImg.innerHTML = '';
                        itemImg.appendChild(img);
                        itemImg.classList.remove('discovery-box-placeholder');
                    };
                    img.src = 'stolen_item.png';
                    img.style.maxWidth = '100px';
                    img.style.maxHeight = '100px';
                }
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            goTo('start');
        });
    </script>
</body>
</html>
